webpackJsonp([1],{0:function(t,e,n){t.exports=n("cDNt")},"4Y6l":function(t,e,n){"use strict";function r(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)}var i=n("/oeL"),o=function(){function t(){}return t}(),a=function(){function t(){}return t}(),s=n("gdRU"),l=n("YcBH"),c=n("Zyxv"),u=n("xs7O"),p=n("Mxwl"),d=n("BcUv"),f=n("Pp7C"),h=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t}(),y=n("8aeK"),g=n("vHGP");n.d(e,"e",function(){return m}),n.d(e,"h",function(){return _}),e.o=r,n.d(e,"l",function(){return o}),n.d(e,"k",function(){return a}),n.d(e,"a",function(){return s.a}),n.d(e,!1,function(){return l.a}),n.d(e,"g",function(){return c.a}),n.d(e,"n",function(){return u.a}),n.d(e,"m",function(){return p.a}),n.d(e,"b",function(){return d.a}),n.d(e,"d",function(){return f.a}),n.d(e,"c",function(){return h}),n.d(e,"i",function(){return y.b}),n.d(e,"f",function(){return y.a}),n.d(e,"j",function(){return g.a});var m=new i.u("npnBaseHref"),_=function(){function t(){}return t}()},"8aeK":function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o});var r=n("/oeL"),i=function(){function t(){}return t}(),o=new r.u("NpnConfiguration")},BcUv:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(){}return t.prototype.transform=function(t,e){if("string"==typeof t){var n=t.split("-");if(3===n.length){var r=parseInt(n[0]),i=parseInt(n[1]),o=parseInt(n[2]);!isNaN(r)&&!isNaN(i)&&!isNaN(o)&&i<13&&o<32&&(t=new Date(r,i-1,o))}}if(t instanceof Date){t=new Date(t.getTime()),e&&t.setFullYear(2010);for(var a=t.getDate();t.getMonth()>0;)t.setDate(1),t.setTime(t.getTime()-864e5),a+=t.getDate();return a}return t},t}()},Mxwl:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("OpsG"),i=function(){function t(){}return t.prototype.transform=function(t,e){if(t){if("common-name"===(e=e||r.a.appConfig.tagSpeciesTitle)){if(t.common_name){var n=t.common_name.toLowerCase();return n.substring(0,1).toUpperCase()+n.substring(1)}return t.common_name}if("scientific-name"===e)return t.genus+" "+t.species}return t},t}()},OpsG:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r={production:!0,googleMapsApiKey:"AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE",appConfig:{num_days_quality_filter:30,filterLqdSummary:!0,filterLqdDisclaimer:"For quality assurance purposes, only onset dates that are preceded by negative records are included in the visualization.",tagSpeciesTitle:"common-name"}}},Pp7C:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("qbdv"),i=new Date(2010,0),o=new Date((new Date).getFullYear(),0),a=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t,e,n){return t=Math.round(t),0===t&&(t=1),e=e||"MMM d",this.datePipe.transform(new Date((n?o:i).getTime()+864e5*(t-1)),e)},t.ctorParameters=function(){return[{type:r.d}]},t}()},T3r2:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r="Number of pixels included in the calculations",i={count:r,mean:"Mean day of year of the onset of the first leaf index for the pixels displayed",stdDev:"The standard deviation of the mean day of year of the onset of the first leaf index for the pixels displayed",min:"Minimum day of year of the onset of the first leaf index for the pixels displayed",max:"Maximum day of year of the onset of the first leaf index for the pixels displayed",complete:"Percent of pixels that have reached the requirements for the Spring Index."},o={count:r,mean:"Mean Accumulated Growing Degree Day value for the pixels displayed",stdDev:"The standard deviation of the Accumulated Growing Degree Day value for the pixels displayed",min:"Minimum Accumulated Growing Degree Day value for the pixels displayed",max:"Maximum Accumulated Growing Degree Day value for the pixels displayed"},a=function(){function t(){}return t.prototype.ngDoCheck=function(){this.selection&&this.selection.data&&this.selection.data.statistics&&(this.statistics=this.selection.data.statistics,this.gdd=this.selection&&/^gdd/.test(this.selection.layer.layerName),this.tooltips=this.gdd?o:i)},t}()},YcBH:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n("/oeL"),i=n("qbdv"),o=n("CPp0"),a=n("82j9"),s=(n.n(a),n("gdRU")),l=n("8aeK"),c=new o.d({"Content-Type":"application/x-www-form-urlencoded"}),u=function(){function t(t,e,n,r){this.http=t,this.cache=e,this.datePipe=n,this.config=r}return t.prototype.getAllSpecies=function(t){var e=this;return new Promise(function(n,r){console.log("SpeciesService.getAllSpecies:params",t);var i=e.config.apiRoot+"/npn_portal/species/getSpeciesFilter.json",a={u:i,params:t},s=e.cache.get(a);if(s)n(s);else{var l=new o.i;Object.keys(t).forEach(function(e){return l.set(""+e,""+t[e])}),e.http.post(i,l.toString(),{headers:c}).toPromise().then(function(t){s=t.json(),e.cache.set(a,s),n(s)}).catch(r)}})},t.prototype._getPhenophases=function(t,e){var n=this;return new Promise(function(r,i){var o=n.config.apiRoot+"/npn_portal/phenophases/getPhenophasesForSpecies.json",a={species_id:t.species_id};e?a.date=n.datePipe.transform(e,"y-MM-dd"):a.return_all=!0;var s={u:o,params:a},l=n.cache.get(s);l?r(l):n.http.get(o,{params:a}).toPromise().then(function(t){var e=t.json();l=e[0].phenophases,l=n.removeRedundantPhenophases(l),n.cache.set(s,l),r(l)}).catch(i)})},t.prototype.getAllPhenophases=function(t){return this._getPhenophases(t)},t.prototype.getPhenophasesForDate=function(t,e){return this._getPhenophases(t,e)},t.prototype.getPhenophasesForYear=function(t,e){var n=this;return new Promise(function(r,i){var o=new Date(e,0,1),a=new Date(e,11,31);Promise.all([n.getPhenophasesForDate(t,o),n.getPhenophasesForDate(t,a)]).then(function(t){r(n.mergeRedundantPhenophaseLists(t))}).catch(i)})},t.prototype.getPhenophasesForYears=function(t,e,n){var r=this;if(e&&!n)throw new Error("Missing end year.");if(e>n)throw new Error("start year cannot be greater than end");for(var i=[e],o=e;o++<n;)i.push(o);return new Promise(function(e,n){Promise.all(i.map(function(e){return r.getPhenophasesForYear(t,e)})).then(function(t){e(r.mergeRedundantPhenophaseLists(t))}).catch(n)})},t.prototype.getPhenophases=function(t,e,n){return e?this.getPhenophasesForYears(t,e,n):this.getAllPhenophases(t)},t.prototype.removeRedundantPhenophases=function(t){var e=[];return t.filter(function(t){return!e[t.phenophase_id]&&(e[t.phenophase_id]=t,!0)})},t.prototype.mergeRedundantPhenophaseLists=function(t){return this.removeRedundantPhenophases(t.reduce(function(t,e){return t.concat(e)},[]))},t.ctorParameters=function(){return[{type:o.e},{type:s.a},{type:i.d},{type:l.b,decorators:[{type:r.s,args:[l.a]}]}]},t}()},Zyxv:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n("/oeL"),i=n("CPp0"),o=n("82j9"),a=(n.n(o),n("gdRU")),s=n("8aeK"),l=function(){function t(t,e,n){this.http=t,this.cache=e,this.config=n}return t.prototype.getStations=function(t){var e=this;return new Promise(function(n,r){var i=e.config.apiRoot+"/npn_portal/stations/getStationsForNetwork.json",o={network_id:t},a={u:i,params:o},s=e.cache.get(a);s?n(s):e.http.get(i,{params:o}).toPromise().then(function(t){s=t.json(),e.cache.set(a,s),n(s)}).catch(r)})},t.ctorParameters=function(){return[{type:i.e},{type:a.a},{type:s.b,decorators:[{type:r.s,args:[s.a]}]}]},t}()},cDNt:function(t,e,n){"use strict";function r(){return window.npn_base_href}function i(){return window.npn_configuration}function o(){var t=this,e={};return Object.keys(this).forEach(function(n){var r=U(t,n);if(r){var i=t[n];/^_/.test(n)&&(n=n.substring(1)),Array.isArray(i)?e[n]=i.map(function(t){return r.ser(t)}):e[n]=r.ser(i)}}),e}function a(t){var e=this;Object.keys(t).forEach(function(n){var r=U(e,n);if(r){var i=t[n];void 0!==i?Array.isArray(i)?e[n]=i.map(function(t){return r.des(t)}):e[n]=r.des(i):e[n]=void 0}})}function s(){ke=function(t){function e(e,n,r){var i=t.call(this)||this;return i.opacity=.75,i.bounds=e,i.image=n,i.map=r,i}return xe(e,t),e.prototype.add=function(){this.setMap(this.map)},e.prototype.remove=function(){this.setMap(null)},e.prototype.setOpacity=function(t){this.opacity=t,this.div_&&(this.div_.style.opacity=t)},e.prototype.getOpacity=function(){return this.opacity},e.prototype.onAdd=function(){var t=document.createElement("div");t.style.borderStyle="none",t.style.borderWidth="0px",t.style.position="absolute";var e=document.createElement("img");e.src=this.image,e.style.width="100%",e.style.height="100%",e.style.position="absolute",t.appendChild(e),this.div_=t,this.getPanes().overlayLayer.appendChild(t),this.setOpacity(this.opacity)},e.prototype.draw=function(){var t=this.getProjection(),e=t.fromLatLngToDivPixel(this.bounds.getSouthWest()),n=t.fromLatLngToDivPixel(this.bounds.getNorthEast()),r=this.div_;r.style.left=e.x+"px",r.style.top=n.y+"px",r.style.width=n.x-e.x+"px",r.style.height=e.y-n.y+"px"},e.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},e}(google.maps.OverlayView)}function l(t){}function c(t){if(!t)return"";var e=[];return Object.keys(t).forEach(function(n){if(t[n]){var r=encodeURIComponent(n),i=encodeURIComponent(t[n]);e.push(r+"="+i)}}),e.join("&")}function u(t){if(!(Math.abs(t.lng())>180||Math.abs(t.lat())>90)){var e=.017453292519943295*t.lng(),n=6378137*e,r=.017453292519943295*t.lat();return{lng:n,lat:3189068.5*Math.log((1+Math.sin(r))/(1-Math.sin(r)))}}}function p(t){return D._38(0,[(t()(),D._16(0,0,null,null,3,"mat-option",[["class","mat-option"],["role","option"]],[[1,"tabindex",0],[2,"mat-selected",null],[2,"mat-option-multiple",null],[2,"mat-active",null],[8,"id",0],[1,"aria-selected",0],[1,"aria-disabled",0],[2,"mat-option-disabled",null]],[[null,"click"],[null,"keydown"]],function(t,e,n){var r=!0;if("click"===e){r=!1!==D._30(t,2)._selectViaInteraction()&&r}if("keydown"===e){r=!1!==D._30(t,2)._handleKeydown(n)&&r}return r},_n.b,_n.a)),D._14(1,16384,null,0,gn.q,[],null,null),D._14(2,49152,[[7,4]],0,gn.o,[D.o,D.h,[2,gn.n]],{value:[0,"value"]},null),(t()(),D._36(3,0,["",""]))],function(t,e){t(e,2,0,e.context.$implicit)},function(t,e){t(e,0,0,D._30(e,2)._getTabIndex(),D._30(e,2).selected,D._30(e,2).multiple,D._30(e,2).active,D._30(e,2).id,D._30(e,2).selected.toString(),D._30(e,2).disabled.toString(),D._30(e,2).disabled),t(e,3,0,e.context.$implicit.title)})}function d(t){return D._38(0,[(t()(),D._16(0,0,null,null,31,"mat-form-field",[["class","refuges-input mat-input-container mat-form-field"]],[[2,"mat-input-invalid",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-focused",null],[2,"mat-primary",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,vn.b,vn.a)),D._14(1,16384,null,0,gn.q,[],null,null),D._14(2,7389184,null,6,bn.a,[D.o,D.M,D.h,[2,gn.i]],null,null),D._34(335544320,1,{_control:0}),D._34(335544320,2,{_placeholderChild:0}),D._34(603979776,3,{_errorChildren:1}),D._34(603979776,4,{_hintChildren:1}),D._34(603979776,5,{_prefixChildren:1}),D._34(603979776,6,{_suffixChildren:1}),(t()(),D._36(-1,1,["\n            "])),(t()(),D._16(10,16777216,null,1,9,"input",[["aria-autocomplete","list"],["autocomplete","off"],["class","mat-input-element mat-form-field-autofill-control"],["matInput",""],["role","combobox"]],[[1,"aria-activedescendant",0],[1,"aria-expanded",0],[1,"aria-owns",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[1,"id",0],[8,"placeholder",0],[8,"disabled",0],[8,"required",0],[8,"readOnly",0],[1,"aria-describedby",0],[1,"aria-invalid",0]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"focusin"],[null,"keydown"],[null,"focus"]],function(t,e,n){var r=!0;if("input"===e){r=!1!==D._30(t,11)._handleInput(n.target.value)&&r}if("blur"===e){r=!1!==D._30(t,11).onTouched()&&r}if("compositionstart"===e){r=!1!==D._30(t,11)._compositionStart()&&r}if("compositionend"===e){r=!1!==D._30(t,11)._compositionEnd(n.target.value)&&r}if("focusin"===e){r=!1!==D._30(t,12)._handleFocus()&&r}if("blur"===e){r=!1!==D._30(t,12)._onTouched()&&r}if("input"===e){r=!1!==D._30(t,12)._handleInput(n)&&r}if("keydown"===e){r=!1!==D._30(t,12)._handleKeydown(n)&&r}if("blur"===e){r=!1!==D._30(t,18)._focusChanged(!1)&&r}if("focus"===e){r=!1!==D._30(t,18)._focusChanged(!0)&&r}if("input"===e){r=!1!==D._30(t,18)._onInput()&&r}return r},null,null)),D._14(11,16384,null,0,oe.d,[D.M,D.o,[2,oe.a]],null,null),D._14(12,147456,null,0,xn.e,[D.o,wn.b,D.Y,D.D,D.h,xn.a,[2,Sn.c],[2,bn.a],[2,Pn.b]],{autocomplete:[0,"autocomplete"]},null),D._33(1024,null,oe.k,function(t,e){return[t,e]},[oe.d,xn.e]),D._14(14,540672,null,0,oe.g,[[8,null],[8,null],[2,oe.k]],{form:[0,"form"]},null),D._33(2048,null,oe.l,null,[oe.g]),D._14(16,16384,null,0,oe.m,[oe.l],null,null),D._14(17,16384,null,0,gn.q,[],null,null),D._14(18,933888,null,0,On.a,[D.o,D.M,Dn.a,[2,oe.l],[2,oe.o],[2,oe.h],gn.c],{placeholder:[0,"placeholder"]},null),D._33(2048,[[1,4]],bn.b,null,[On.a]),(t()(),D._36(-1,1,["\n            "])),(t()(),D._16(21,0,null,1,9,"mat-autocomplete",[["class","mat-autocomplete"]],null,null,null,kn.b,kn.a)),D._14(22,16384,null,0,gn.q,[],null,null),D._14(23,1097728,[["auto",4]],2,xn.c,[D.h,D.o],{displayWith:[0,"displayWith"]},null),D._34(603979776,7,{options:1}),D._34(603979776,8,{optionGroups:1}),(t()(),D._36(-1,0,["\n               "])),(t()(),D._10(16777216,null,0,2,null,p)),D._14(28,802816,null,0,Jt.g,[D.Y,D.U,D.x],{ngForOf:[0,"ngForOf"]},null),D._31(131072,Jt.a,[D.h]),(t()(),D._36(-1,0,["\n            "])),(t()(),D._36(-1,1,["\n        "]))],function(t,e){var n=e.component;t(e,12,0,D._30(e,23)),t(e,14,0,n.refugeFormControl),t(e,18,0,n.focused?"Refuge":"Find a refuge"),t(e,23,0,n.refugeTitle),t(e,28,0,D._37(e,28,0,D._30(e,29).transform(n.filteredRefuges)))},function(t,e){t(e,0,1,[D._30(e,2)._control.errorState,D._30(e,2)._control.errorState,D._30(e,2)._canPlaceholderFloat,D._30(e,2)._control.shouldPlaceholderFloat||D._30(e,2)._shouldAlwaysFloat,D._30(e,2)._control.focused,"primary"==D._30(e,2).color,"accent"==D._30(e,2).color,"warn"==D._30(e,2).color,D._30(e,2)._shouldForward("untouched"),D._30(e,2)._shouldForward("touched"),D._30(e,2)._shouldForward("pristine"),D._30(e,2)._shouldForward("dirty"),D._30(e,2)._shouldForward("valid"),D._30(e,2)._shouldForward("invalid"),D._30(e,2)._shouldForward("pending")]),t(e,10,1,[null==D._30(e,12).activeOption?null:D._30(e,12).activeOption.id,D._30(e,12).panelOpen.toString(),null==D._30(e,12).autocomplete?null:D._30(e,12).autocomplete.id,D._30(e,16).ngClassUntouched,D._30(e,16).ngClassTouched,D._30(e,16).ngClassPristine,D._30(e,16).ngClassDirty,D._30(e,16).ngClassValid,D._30(e,16).ngClassInvalid,D._30(e,16).ngClassPending,D._30(e,18).id,D._30(e,18).placeholder,D._30(e,18).disabled,D._30(e,18).required,D._30(e,18).readonly,D._30(e,18)._ariaDescribedby||null,D._30(e,18).errorState])})}function f(t){return D._38(0,[(t()(),D._16(0,0,null,null,3,"mat-option",[["class","mat-option"],["role","option"]],[[1,"tabindex",0],[2,"mat-selected",null],[2,"mat-option-multiple",null],[2,"mat-active",null],[8,"id",0],[1,"aria-selected",0],[1,"aria-disabled",0],[2,"mat-option-disabled",null]],[[null,"click"],[null,"keydown"]],function(t,e,n){var r=!0;if("click"===e){r=!1!==D._30(t,2)._selectViaInteraction()&&r}if("keydown"===e){r=!1!==D._30(t,2)._handleKeydown(n)&&r}return r},_n.b,_n.a)),D._14(1,16384,null,0,gn.q,[],null,null),D._14(2,49152,[[15,4]],0,gn.o,[D.o,D.h,[2,gn.n]],{value:[0,"value"]},null),(t()(),D._36(3,0,["",""]))],function(t,e){t(e,2,0,e.context.$implicit.selection)},function(t,e){t(e,0,0,D._30(e,2)._getTabIndex(),D._30(e,2).selected,D._30(e,2).multiple,D._30(e,2).active,D._30(e,2).id,D._30(e,2).selected.toString(),D._30(e,2).disabled.toString(),D._30(e,2).disabled),t(e,3,0,e.context.$implicit.label)})}function h(t){return D._38(0,[(t()(),D._16(0,0,null,null,24,"mat-form-field",[["class","selection-input mat-input-container mat-form-field"]],[[2,"mat-input-invalid",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-focused",null],[2,"mat-primary",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,vn.b,vn.a)),D._14(1,16384,null,0,gn.q,[],null,null),D._14(2,7389184,null,6,bn.a,[D.o,D.M,D.h,[2,gn.i]],null,null),D._34(335544320,9,{_control:0}),D._34(335544320,10,{_placeholderChild:0}),D._34(603979776,11,{_errorChildren:1}),D._34(603979776,12,{_hintChildren:1}),D._34(603979776,13,{_prefixChildren:1}),D._34(603979776,14,{_suffixChildren:1}),(t()(),D._36(-1,1,["\n            "])),(t()(),D._16(10,0,null,1,13,"mat-select",[["class","mat-select"],["placeholder","Layer"],["role","listbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[1,"id",0],[1,"tabindex",0],[1,"aria-label",0],[1,"aria-labelledby",0],[1,"aria-required",0],[1,"aria-disabled",0],[1,"aria-invalid",0],[1,"aria-owns",0],[1,"aria-multiselectable",0],[1,"aria-describedby",0],[1,"aria-activedescendant",0],[2,"mat-select-disabled",null],[2,"mat-select-invalid",null],[2,"mat-select-required",null]],[[null,"keydown"],[null,"focus"],[null,"blur"]],function(t,e,n){var r=!0;if("keydown"===e){r=!1!==D._30(t,15)._handleKeydown(n)&&r}if("focus"===e){r=!1!==D._30(t,15)._onFocus()&&r}if("blur"===e){r=!1!==D._30(t,15)._onBlur()&&r}return r},Cn.b,Cn.a)),D._14(11,540672,null,0,oe.g,[[8,null],[8,null],[8,null]],{form:[0,"form"]},null),D._33(2048,null,oe.l,null,[oe.g]),D._14(13,16384,null,0,oe.m,[oe.l],null,null),D._14(14,16384,null,0,gn.q,[],null,null),D._14(15,1294336,null,3,jn.c,[An.f,D.h,D.D,gn.c,D.M,D.o,[2,Sn.c],[2,oe.o],[2,oe.h],[2,bn.a],[2,oe.l],[8,null],jn.a],{placeholder:[0,"placeholder"]},null),D._34(603979776,15,{options:1}),D._34(603979776,16,{optionGroups:1}),D._34(335544320,17,{customTrigger:0}),D._33(2048,[[9,4]],bn.b,null,[jn.c]),(t()(),D._36(-1,1,["\n                "])),(t()(),D._10(16777216,null,1,1,null,f)),D._14(22,802816,null,0,Jt.g,[D.Y,D.U,D.x],{ngForOf:[0,"ngForOf"]},null),(t()(),D._36(-1,1,["\n            "])),(t()(),D._36(-1,1,["\n        "]))],function(t,e){var n=e.component;t(e,11,0,n.selectionFormControl);t(e,15,0,"Layer"),t(e,22,0,n.selections)},function(t,e){t(e,0,1,[D._30(e,2)._control.errorState,D._30(e,2)._control.errorState,D._30(e,2)._canPlaceholderFloat,D._30(e,2)._control.shouldPlaceholderFloat||D._30(e,2)._shouldAlwaysFloat,D._30(e,2)._control.focused,"primary"==D._30(e,2).color,"accent"==D._30(e,2).color,"warn"==D._30(e,2).color,D._30(e,2)._shouldForward("untouched"),D._30(e,2)._shouldForward("touched"),D._30(e,2)._shouldForward("pristine"),D._30(e,2)._shouldForward("dirty"),D._30(e,2)._shouldForward("valid"),D._30(e,2)._shouldForward("invalid"),D._30(e,2)._shouldForward("pending")]),t(e,10,1,[D._30(e,13).ngClassUntouched,D._30(e,13).ngClassTouched,D._30(e,13).ngClassPristine,D._30(e,13).ngClassDirty,D._30(e,13).ngClassValid,D._30(e,13).ngClassInvalid,D._30(e,13).ngClassPending,D._30(e,15).id,D._30(e,15).tabIndex,D._30(e,15)._ariaLabel,D._30(e,15).ariaLabelledby,D._30(e,15).required.toString(),D._30(e,15).disabled.toString(),D._30(e,15).errorState,D._30(e,15)._optionIds,D._30(e,15).multiple,D._30(e,15)._ariaDescribedby||null,D._30(e,15)._getAriaActiveDescendant(),D._30(e,15).disabled,D._30(e,15).errorState,D._30(e,15).required])})}function y(t){return D._38(0,[(t()(),D._16(0,16777216,null,null,5,"button",[["class","reset-button mat-icon-button"],["mat-icon-button",""],["matTooltip","Reset map"]],[[8,"disabled",0]],[[null,"click"],[null,"longpress"],[null,"focus"],[null,"blur"],[null,"keydown"],[null,"touchend"]],function(t,e,n){var r=!0,i=t.component;if("longpress"===e){r=!1!==D._30(t,4).show()&&r}if("focus"===e){r=!1!==D._30(t,4).show()&&r}if("blur"===e){r=!1!==D._30(t,4).hide(0)&&r}if("keydown"===e){r=!1!==D._30(t,4)._handleKeydown(n)&&r}if("touchend"===e){r=!1!==D._30(t,4).hide(1500)&&r}if("click"===e){r=!1!==i.reset()&&r}return r},Ln.b,Ln.a)),D._14(1,16384,null,0,gn.q,[],null,null),D._14(2,180224,null,0,Mn.b,[D.M,D.o,Dn.a,Rn.g],null,null),D._14(3,16384,null,0,Mn.d,[],null,null),D._14(4,147456,null,0,Fn.c,[D.M,wn.b,D.o,An.c,D.Y,D.D,Dn.a,Rn.e,Fn.a,[2,Sn.c]],{message:[0,"message"]},null),(t()(),D._16(5,0,null,0,0,"i",[["aria-hidden","true"],["class","fa fa-refresh"]],null,null,null,null,null)),(t()(),D._10(0,null,null,0))],function(t,e){t(e,4,0,"Reset map")},function(t,e){t(e,0,0,D._30(e,2).disabled||null)})}function g(t){return D._38(0,[(t()(),D._16(0,0,null,null,4,"div",[["class","vis-working"]],null,null,null,null,null)),(t()(),D._36(-1,null,["\n            "])),(t()(),D._16(2,0,null,null,1,"mat-progress-spinner",[["class","mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[4,"width","px"],[4,"height","px"],[1,"aria-valuemin",0],[1,"aria-valuemax",0],[1,"aria-valuenow",0],[1,"mode",0]],null,null,zn.b,zn.a)),D._14(3,573440,null,0,Tn.a,[D.M,D.o,Dn.a,[2,Jt.c]],{mode:[0,"mode"]},null),(t()(),D._36(-1,null,["\n        "]))],function(t,e){t(e,3,0,"indeterminate")},function(t,e){t(e,2,0,D._30(e,3)._elementSize,D._30(e,3)._elementSize,"determinate"===D._30(e,3).mode?0:null,"determinate"===D._30(e,3).mode?100:null,D._30(e,3).value,D._30(e,3).mode)})}function m(t){return D._38(0,[(t()(),D._16(0,0,null,null,2,"agm-marker",[["iconUrl","https://fws.usanpn.org/sites/fws.usanpn.org/libraries/gmap_markers/marker-1.png"]],null,[[null,"markerClick"]],function(t,e,n){var r=!0,i=t.component;if("markerClick"===e){r=!1!==i.refugeClick(t.context.$implicit)&&r}return r},null,null)),D._14(1,1720320,null,1,En.a,[In.a],{latitude:[0,"latitude"],longitude:[1,"longitude"],title:[2,"title"],iconUrl:[3,"iconUrl"]},{markerClick:"markerClick"}),D._34(603979776,18,{infoWindow:1})],function(t,e){t(e,1,0,e.context.$implicit.location.lat,e.context.$implicit.location.lng,e.context.$implicit.title,"https://fws.usanpn.org/sites/fws.usanpn.org/libraries/gmap_markers/marker-1.png")},null)}function _(t){return D._38(0,[(t()(),D._16(0,0,null,null,4,"span",[],null,null,null,null,null)),(t()(),D._36(-1,null,["\n                "])),(t()(),D._10(16777216,null,null,1,null,m)),D._14(3,802816,null,0,Jt.g,[D.Y,D.U,D.x],{ngForOf:[0,"ngForOf"]},null),(t()(),D._36(-1,null,["\n            "]))],function(t,e){t(e,3,0,e.component.refuges)},null)}function v(t){return D._38(0,[(t()(),D._16(0,0,null,null,1,"wms-map-legend",[],null,null,null,Un.b,Un.a)),D._14(1,4898816,null,0,Bn.a,[Nn.a,D.o],{legend:[0,"legend"]},null)],function(t,e){t(e,1,0,e.component.selection.legend)},null)}function b(t){return D._38(0,[(t()(),D._16(0,0,null,null,1,"clipped-wms-map-statistics",[],null,null,null,qn.b,qn.a)),D._14(1,311296,null,0,an.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.selection)},null)}function x(t){return D._38(0,[(t()(),D._36(-1,null,["\n    "])),(t()(),D._16(1,0,null,null,14,"form",[["class","control-form"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(t,e,n){var r=!0;if("submit"===e){r=!1!==D._30(t,3).onSubmit(n)&&r}if("reset"===e){r=!1!==D._30(t,3).onReset()&&r}return r},null,null)),D._14(2,16384,null,0,oe.r,[],null,null),D._14(3,16384,null,0,oe.o,[[8,null],[8,null]],null,null),D._33(2048,null,oe.c,null,[oe.o]),D._14(5,16384,null,0,oe.n,[oe.c],null,null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._10(16777216,null,null,1,null,d)),D._14(8,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._10(16777216,null,null,1,null,h)),D._14(11,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._10(16777216,null,null,1,null,y)),D._14(14,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,null,["\n    "])),(t()(),D._36(-1,null,["\n\n    "])),(t()(),D._16(17,0,null,null,25,"div",[["class","map-wrapper"]],null,null,null,null,null)),(t()(),D._36(-1,null,["\n\n        "])),(t()(),D._10(16777216,null,null,1,null,g)),D._14(20,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._16(22,0,null,null,13,"agm-map",[],[[2,"sebm-google-map-container",null]],[[null,"mapReady"]],function(t,e,n){var r=!0,i=t.component;if("mapReady"===e){r=!1!==i.mapReady(n)&&r}return r},$n.b,$n.a)),D._33(4608,null,In.a,In.a,[Kn.a,D.D]),D._33(4608,null,Hn.a,Hn.a,[Kn.a,D.D,In.a]),D._33(4608,null,Jn.a,Jn.a,[Kn.a,D.D]),D._33(4608,null,Xn.a,Xn.a,[Kn.a,D.D]),D._33(4608,null,Zn.a,Zn.a,[Kn.a,D.D]),D._33(4608,null,Qn.a,Qn.a,[Kn.a,D.D]),D._33(4608,null,tr.a,tr.a,[Kn.a,D.D]),D._33(512,null,Kn.a,Kn.a,[er.a,D.D]),D._14(31,770048,null,0,nr.a,[D.o,Kn.a],{longitude:[0,"longitude"],latitude:[1,"latitude"],zoom:[2,"zoom"],scrollwheel:[3,"scrollwheel"],styles:[4,"styles"],streetViewControl:[5,"streetViewControl"]},{mapReady:"mapReady"}),(t()(),D._36(-1,0,["\n            "])),(t()(),D._10(16777216,null,0,1,null,_)),D._14(34,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,0,["\n        "])),(t()(),D._36(-1,null,["\n        "])),(t()(),D._10(16777216,null,null,1,null,v)),D._14(38,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._10(16777216,null,null,1,null,b)),D._14(41,16384,null,0,Jt.h,[D.Y,D.U],{ngIf:[0,"ngIf"]},null),(t()(),D._36(-1,null,["\n    "])),(t()(),D._36(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,8,0,n.refuges),t(e,11,0,n.selections),t(e,14,0,n.selection),t(e,20,0,n.selection&&n.selection.working);t(e,31,0,n.longitude,n.latitude,n.zoom,!1,n.mapStyles,!1),t(e,34,0,!n.focused),t(e,38,0,n.selection&&n.selection.legend),t(e,41,0,n.selection&&n.selection.data&&n.selection.data.statistics)},function(t,e){t(e,1,0,D._30(e,5).ngClassUntouched,D._30(e,5).ngClassTouched,D._30(e,5).ngClassPristine,D._30(e,5).ngClassDirty,D._30(e,5).ngClassValid,D._30(e,5).ngClassInvalid,D._30(e,5).ngClassPending);t(e,22,0,!0)})}function w(t){return D._38(0,[(t()(),D._16(0,0,null,null,1,"status-of-spring",[],null,null,null,x,ir)),D._14(1,245760,null,0,Gn,[dn,en],null,null)],function(t,e){t(e,1,0)},null)}function S(t){return D._38(0,[(t()(),D._36(-1,null,["\n            "])),(t()(),D._16(1,0,null,null,4,"div",[["class","spring-tab-label current-spring"]],null,null,null,null,null)),(t()(),D._36(-1,null,["\n                "])),(t()(),D._16(3,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),D._36(-1,null,["Current Status of Spring"])),(t()(),D._36(-1,null,["\n            "])),(t()(),D._36(-1,null,["\n        "]))],null,null)}function P(t){return D._38(0,[(t()(),D._36(-1,null,["\n  "])),(t()(),D._16(1,0,null,null,14,"mat-tab-group",[["class","spring-dashboard-tabs"]],null,[[null,"selectedTabChange"]],function(t,e,n){var r=!0,i=t.component;if("selectedTabChange"===e){r=!1!==i.selectedTabChange(n)&&r}return r},null,null)),D._14(2,16384,null,0,gn.q,[],null,null),(t()(),D._36(-1,null,["\n    "])),(t()(),D._16(4,0,null,null,10,"mat-tab",[["label","Current Status of Spring"]],null,null,null,null,null)),D._14(5,16384,null,0,gn.q,[],null,null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._10(0,null,null,0,null,S)),(t()(),D._36(-1,null,["\n        "])),(t()(),D._16(9,0,null,null,4,"div",[["class","spring-tab-content"]],null,null,null,null,null)),(t()(),D._36(-1,null,["\n            "])),(t()(),D._16(11,0,null,null,1,"status-of-spring",[],null,null,null,x,ir)),D._14(12,245760,null,0,Gn,[dn,en],null,null),(t()(),D._36(-1,null,["\n        "])),(t()(),D._36(-1,null,["\n    "])),(t()(),D._36(-1,null,["\n  "])),(t()(),D._36(-1,null,["\n  "]))],function(t,e){t(e,12,0)},null)}function O(t){return D._38(0,[(t()(),D._16(0,0,null,null,1,"spring-dashboard",[],null,null,null,P,ar)),D._14(1,114688,null,0,fn,[D.o,dn],null,null)],function(t,e){t(e,1,0)},null)}Object.defineProperty(e,"__esModule",{value:!0});var D=n("/oeL"),k=n("OpsG"),C=function(){function t(){}return t}();k.a.production&&Object(D._2)();var j,A=n("CPp0"),L=(n("82j9"),n("4Y6l")),M=(n("qhHO"),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),R=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},F=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},z=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.RESET=0]="RESET",t[t.REDRAW=1]="REDRAW",t[t.UPDATE=2]="UPDATE",t[t.RESIZE=3]="RESIZE"}(j||(j={}));var T=Symbol("npnSelectionProperty"),E=function(t){return t},I=(function(){function t(){}}(),function(t){var e=R({des:E,ser:E},t||{});return Reflect.metadata(T,e)}),U=function(t,e){var n=Reflect.getMetadata(T,t,e);return n||(n=Reflect.getMetadata(T,t,"_"+e)),n},B="invalid selection",N=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="VisSelection",e.guid=L.c.newGuid(),e.meta={},e.debug=!1,e.working=!1,e.editMode=!1,e.INVALID_SELECTION=B,e.lastEmit={},e.firstSubscriber=new Promise(function(t){e.firstSubscriberResolver=t}),e}return M(e,t),Object.defineProperty(e.prototype,"external",{get:function(){return o.apply(this,arguments)},set:function(t){a.apply(this,arguments)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.emit(j.RESET)},e.prototype.redraw=function(){this.emit(j.REDRAW)},e.prototype.update=function(){this.emit(j.UPDATE)},e.prototype.resize=function(){this.emit(j.RESIZE)},e.prototype.handleError=function(t){console.error(t),this.working=!1},e.prototype.emit=function(e){var n=this,r=arguments,i={value:e,when:Date.now(),ext:JSON.stringify(this.external)};this.lastEmit.value!==i.value||this.lastEmit.ext!==i.ext||this.lastEmit.when<i.when-500?(this.lastEmit=i,console.log("letting event through",i),this.firstSubscriber.then(function(){t.prototype.emit.apply(n,r)})):console.log("pruned out redundant event",i)},e.prototype.subscribe=function(e,n,r){return this.firstSubscriberResolver(),t.prototype.subscribe.apply(this,arguments)},e}(D.q);F([I(),z("design:type",String)],N.prototype,"$class",void 0),F([I(),z("design:type",String)],N.prototype,"guid",void 0),F([I(),z("design:type",Object)],N.prototype,"meta",void 0);var q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.networkIds=[],e}return M(e,t),e.prototype.addNetworkParams=function(t){if(t instanceof A.i){var e=t;(this.networkIds||[]).forEach(function(t,n){return e.set("network_id["+n+"]",""+t)})}else t&&"object"==typeof t&&(this.networkIds||[]).forEach(function(e,n){return t["network_id["+n+"]"]=""+e});return t},e}(N);F([I(),z("design:type",Array)],q.prototype,"networkIds",void 0);var V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stationIds=[],e}return M(e,t),e.prototype.addNetworkParams=function(e){if(t.prototype.addNetworkParams.call(this,e),e instanceof A.i){var n=e;(this.stationIds||[]).forEach(function(t,e){return n.set("station_ids["+e+"]",""+t)})}else e&&"object"==typeof e&&(this.stationIds||[]).forEach(function(t,n){return e["station_ids["+n+"]"]=""+t});return e},e}(q);F([I(),z("design:type",Array)],V.prototype,"stationIds",void 0);var Y=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),W=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},G=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$=function(t){function e(e,n,r){var i=t.call(this)||this;return i.http=e,i.cacheService=n,i.config=r,i.headers=new A.d({"Content-Type":"application/x-www-form-urlencoded"}),i.individualPhenometrics=!1,i}return Y(e,t),e.prototype.filterSuspectSummaryData=function(t){var e=0===t.latitude||0===t.longitude||t.elevation_in_meters<0;return e&&console.warn("suspect station data",t),!e},e.prototype.filterLqSummaryData=function(t){var e=t.numdays_since_prior_no>=0;return e||console.debug("filtering less precise data from summary output",t),e},e.prototype.filterLqSiteData=function(t){var e=t.mean_numdays_since_prior_no>=0;return e||console.debug("filtering less precise data from site level output",t),e},e.prototype.getData=function(){var t=this;if(!this.isValid())return Promise.reject(this.INVALID_SELECTION);var e=this.toURLSearchParams(),n=this.config.apiRoot+"/npn_portal/observations/"+(this.individualPhenometrics?"getSummarizedData":"getSiteLevelData")+".json",r={u:n,params:e.toString()},i=this.cacheService.get(r),o=this.individualPhenometrics?function(e){var n=e.filter(t.filterSuspectSummaryData),r=k.a.appConfig.filterLqdSummary?n.filter(t.filterLqSummaryData):n,i=r.reduce(function(t,e){var n=e.individual_id+"/"+e.phenophase_id+"/"+e.first_yes_year;return t[n]=t[n]||[],t[n].push(e),t},{}),o=[];console.debug("filtered out "+(e.length-n.length)+"/"+e.length+" suspect records"),console.debug("filtered out "+(n.length-r.length)+"/"+n.length+" LQD records.");for(var a in i){var s=i[a];s.length>1&&s.sort(function(t,e){return t.first_yes_doy-e.first_yes_doy}),o.push(s[0])}return console.debug("filtered out "+(r.length-o.length)+"/"+r.length+" individual records (preferring lowest first_yes_doy)"),t.filterDisclaimer=n.length!==r.length?k.a.appConfig.filterLqdDisclaimer:void 0,r}:function(e){var n=e.filter(t.filterSuspectSummaryData),r=k.a.appConfig.filterLqdSummary?n.filter(t.filterLqSiteData):n;return console.debug("filtered out "+(e.length-n.length)+"/"+e.length+" suspect records"),console.debug("filtered out "+(n.length-r.length)+"/"+n.length+" LQD records."),t.filterDisclaimer=n.length!==r.length?k.a.appConfig.filterLqdDisclaimer:void 0,r};return i?(console.log("found in cache",i),Promise.resolve(o(i))):(this.working=!0,this.http.post(n,e.toString(),{headers:this.headers}).toPromise().then(function(e){var n=e.json();t.cacheService.set(r,n);var i=o(n);return t.working=!1,i}).catch(this.handleError))},e}(V);W([I(),G("design:type",Boolean)],$.prototype,"individualPhenometrics",void 0),W([I(),G("design:type",String)],$.prototype,"filterDisclaimer",void 0);var K=n("ckYf"),H=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),J=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},X=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Z={daylength:"mean_daylength",acc_prcp:"mean_accum_prcp",gdd:"mean_gdd"},Q=[{key:"latitude",label:"Latitude",axisFmt:K.i(".2f")},{key:"longitude",label:"Longitude",axisFmt:K.i(".2f")},{key:"elevation_in_meters",label:"Elevation (m)"},{key:"fyy",label:"Year"},{key:"prcp_fall",label:"Precip Fall (mm)"},{key:"prcp_spring",label:"Precip Spring (mm)"},{key:"prcp_summer",label:"Precip Summer (mm)"},{key:"prcp_winter",label:"Precip Winter (mm)"},{key:"tmax_fall",label:"Tmax Fall (C\xb0)"},{key:"tmax_spring",label:"Tmax Spring (C\xb0)"},{key:"tmax_summer",label:"Tmax Summer (C\xb0)"},{key:"tmax_winter",label:"Tmax Winter (C\xb0)"},{key:"tmin_fall",label:"Tmin Fall (C\xb0)"},{key:"tmin_spring",label:"Tmin Spring (C\xb0)"},{key:"tmin_summer",label:"Tmin Summer (C\xb0)"},{key:"tmin_winter",label:"Tmin Winter (C\xb0)"},{key:"daylength",label:"Day Length (s)"},{key:"acc_prcp",label:"Accumulated Precip (mm)"},{key:"gdd",label:"AGDD"}],tt=(new Date,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="ScatterPlotSelection",e.start=2010,e.end=(new Date).getFullYear(),e.regressionLines=!1,e.axis=Q[0],e.plots=[],e.d3DateFormat=K.n("%x"),e}return H(e,t),e.prototype.isValid=function(){return this.start&&this.end&&this.start<this.end&&this.validPlots.length>0},Object.defineProperty(e.prototype,"validPlots",{get:function(){return this.plots.filter(function(t){return t.color&&t.species&&t.phenophase})},enumerable:!0,configurable:!0}),e.prototype.toURLSearchParams=function(){var t=new A.i;return t.set("climate_data","1"),t.set("request_src","npn-vis-scatter-plot"),t.set("start_date",this.start+"-01-01"),t.set("end_date",this.end+"-12-31"),t.set("num_days_quality_filter",""+k.a.appConfig.num_days_quality_filter),this.validPlots.forEach(function(e,n){t.set("species_id["+n+"]",""+e.species.species_id),t.set("phenophase_id["+n+"]",""+e.phenophase.phenophase_id)}),this.addNetworkParams(t),t},e.prototype.doyDateFormat=function(t){var e=new Date(this.start,0,1),n=864e5*(t-1)+e.getTime(),r=new Date(n);return this.d3DateFormat(r)},e.prototype.getDoy=function(t){return this.individualPhenometrics?t.first_yes_doy:t.mean_first_yes_doy},e.prototype.getFirstYesYear=function(t){return this.individualPhenometrics?t.first_yes_year:t.mean_first_yes_year},e.prototype.axisData=function(t){return t[this.axis.key]},e.prototype.axisNonNull=function(t){var e=this;return t.filter(function(t){return-9999!==e.axisData(t)})},e.prototype.postProcessData=function(t){var e=this,n=function(t){return t.species_id+":"+t.phenophase_id},r=this.validPlots.reduce(function(t,e){return t[e.species.species_id+":"+e.phenophase.phenophase_id]=e.color,t},{}),i=this.start,o=t.filter(function(t,o){if(!(t.color=r[n(t)]))return!1;t.id=o,t.fyy=e.getFirstYesYear(t);for(var a in Z){var s=Z[a];void 0===t[a]&&(t[a]=t[s])}return t.day_in_range=365*(t.fyy-i)+e.getDoy(t),!0});return this.working=!1,o},e}($));J([I(),X("design:type",String)],tt.prototype,"$class",void 0),J([I(),X("design:type",Number)],tt.prototype,"start",void 0),J([I(),X("design:type",Number)],tt.prototype,"end",void 0),J([I(),X("design:type",Boolean)],tt.prototype,"regressionLines",void 0),J([I(),X("design:type",Object)],tt.prototype,"axis",void 0),J([I({ser:function(t){return{color:t.color,species:t.species,phenophase:t.phenophase}}}),X("design:type",Array)],tt.prototype,"plots",void 0);var et=function(){function t(t,e,n){this.http=t,this.cacheService=e,this.config=n}return t.prototype.newSelection=function(){return new tt(this.http,this.cacheService,this.config)},t.ctorParameters=function(){return[{type:A.e},{type:L.a},{type:L.i,decorators:[{type:D.s,args:[L.f]}]}]},t}(),nt=n("zQfh"),rt=n("bKpL"),it=(n("Xtvq"),n("azLz"),function(){function t(t,e,n){var r=this;this.window=t,this.rootElement=e,this.media=n,this.thumbnail=!1,this.id="visualization-"+Math.floor(1e3*Math.random()),this.clazz="visualization "+this.constructor.name,this.margins={top:0,right:0,left:0,bottom:0},this.mobileMode=!1,this.mediaSubscription=this.media.subscribe(function(t){r.mobileMode="xs"===t.mqAlias||"sm"===t.mqAlias}),this.isIE=!!Object(L.o)()}return t.prototype.getSizeInfo=function(t){var e=this.rootElement.nativeElement,n=e.parentElement,r=function(t){return parseInt(t.replace(/px$/,""))},i=getComputedStyle(n,null),o=r(i.paddingLeft)+r(i.borderLeftWidth),a=r(i.paddingRight)+r(i.borderRightWidth),s=n.clientWidth-o-a,l=this.margins,c=Math.floor(s),u=c;t&&c<t&&(c=t);var p=Math.floor(.5376*c),d=c-l.left-l.right,f=p-l.top-l.bottom;return isNaN(d)&&(d=0),isNaN(f)&&(f=0),this.sizing={scaledWidth:u,width:d,height:f,margin:l}},t.prototype.reset=function(){throw new Error("abstract")},t.prototype.redraw=function(){throw new Error("abstract")},t.prototype.update=function(){throw new Error("abstract")},t.prototype.resize=function(){throw new Error("abstract")},t.prototype.ngAfterViewInit=function(){var t=this;console.debug("visualization.ngAfterViewInit"),this.resizeSubscription=rt.Observable.fromEvent(window,"resize").debounceTime(500).subscribe(function(e){t.resize()}),this.subscription=this.selection.subscribe(function(e){switch(e){case j.RESET:return t.reset();case j.REDRAW:return t.redraw();case j.UPDATE:return t.update();case j.RESIZE:return t.resize()}})},t.prototype.ngOnDestroy=function(){console.debug("visualization.ngOnDestroy"),this.subscription&&this.subscription.unsubscribe(),this.resizeSubscription&&this.resizeSubscription.unsubscribe(),this.mediaSubscription&&this.mediaSubscription.unsubscribe()},t.prototype.handleError=function(t){t&&t!==B&&console.error(t)},t.ctorParameters=function(){return[{type:L.n},{type:D.o},{type:nt.j}]},t}()),ot=(function(){function t(){}}(),function(){function t(){}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),at={top:20,right:30,bottom:60,left:40},st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="visualization.png",e.margins=at,e.minWidth=700,e}return ot(e,t),e.prototype.baseFontSize=function(t){return t?"14px":14},e.prototype.commonUpdates=function(){var t=this.chart,e=this.baseFontSize(!0);[".axis path",".axis line"].forEach(function(e){return t.selectAll(e).style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges")}),t.selectAll("text").style("font-family","Arial"),t.selectAll("g .axis text").style("font-size",e)},e.prototype.reset=function(){var t=this.getSizeInfo(),e=this.svg,n=t.width+t.margin.left+t.margin.right,r=t.height+t.margin.top+t.margin.bottom;e.selectAll("*").remove(),e.attr("width",n).attr("height",r).attr("viewBox","0 0 "+n+" "+r).attr("preserveAspectRatio","xMidYMid meet"),e.append("g").attr("class","vis-background").append("rect").attr("width","100%").attr("height","100%").attr("fill","#fff"),this.chart=e.append("g").attr("transform","translate("+t.margin.left+","+t.margin.top+")").attr("class","vis-chart"),e.append("g").attr("transform","translate(10,"+(t.height+t.margin.top+t.margin.bottom-10)+")").append("text").attr("font-size","11px").attr("font-style","italic").attr("text-anchor","right").text("USA National Phenology Network, www.usanpn.org")},e.prototype.resize=function(){this.reset(),this.redraw()},e.prototype.selectElements=function(){this.visRoot=K.m("#"+this.id),this.svg=this.visRoot.select("svg")},e.prototype.getSizeInfo=function(e){return this.selectElements(),t.prototype.getSizeInfo.call(this,this.minWidth)},e.prototype.redraw=function(){this.redrawSvg();var t=this.sizing;if(t.width+t.margin.left+t.margin.right===this.minWidth){var e=this.rootElement.nativeElement,n=e.querySelector("svg.svg-visualization"),r=K.m(n),i=+r.attr("height"),o=t.scaledWidth/this.minWidth;r.attr("width",t.scaledWidth),r.attr("height",Math.round(i*o))}else this.thumbnailSrc=void 0},e.prototype.redrawSvg=function(){throw new Error("abstract")},e.prototype.ngAfterViewInit=function(){this.selectElements(),t.prototype.ngAfterViewInit.call(this)},e}(it),lt=n("Iake"),ct=n("ytvl"),ut=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pt=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},dt=(function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o.window=e,o.rootElement=n,o.media=r,o.speciesTitle=i,o.defaultAxisFormat=K.i("d"),o.dateFormat=K.n("%x"),o.filename="scatter-plot.png",o.margins=pt({},at,{top:80,left:60}),o}ut(e,t),e.prototype.reset=function(){var e=this;t.prototype.reset.call(this);var n=this.chart,r=this.sizing,i=r.width<this.minWidth?this.sizing.width/3*2:this.sizing.width/2;this.title=n.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x",i).style("text-anchor","middle").style("font-size","18px"),this.x=Object(ct.b)().range([0,r.width]).domain([0,100]),this.xAxis=Object(lt.a)(this.x).tickFormat(function(t){return e.defaultAxisFormat(t)}),this.y=Object(ct.b)().range([r.height,0]).domain([1,365]),this.yAxis=Object(lt.b)(this.y),n.append("g").attr("class","x axis").attr("transform","translate(0,"+r.height+")").call(this.xAxis),n.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",r.height/2*-1).style("text-anchor","middle").text("Onset Day of Year"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(function(e){return t.handleError(e)})},e.prototype.redrawSvg=function(){var t=this;if(this.data){this.disclaimer=this.selection.filterDisclaimer;var e=this.selection.postProcessData(this.data),n=this.selection,r=n.axisNonNull(e),i=function(t){return n.axisData(t)},o=function(t){return n.getDoy(t)},a=K.h(r,i),s=n.axis.axisFmt||this.defaultAxisFormat;this.title.text(n.start+" - "+n.end),this.x.domain([a[0]-1,a[1]+1]),this.xAxis.scale(this.x).tickFormat(K.i(".2f"));var l=this.chart.selectAll("g .x.axis");l.call(this.xAxis.tickFormat(s)),l.selectAll(".axis-label").remove(),l.append("text").attr("class","axis-label").attr("x",this.sizing.width/2).attr("dy","3em").attr("fill","#000").style("text-anchor","middle").style("font-size","12px").text(this.selection.axis.label),this.chart.selectAll(".circle").remove();if(this.chart.selectAll(".circle").data(r,function(t){return t.id}).enter().append("circle").attr("class","circle").style("stroke","#333").style("stroke-width","1").attr("cx",function(e){return t.x(i(e))}).attr("cy",function(e){return t.y(o(e))}).attr("r","5").attr("fill",function(t){return t.color}).on("click",function(e){K.g.defaultPrevented||(t.record=e)}).append("title").text(function(t){return n.doyDateFormat(t.day_in_range)+" ["+t.latitude+","+t.longitude+"]"}),this.chart.selectAll(".regression").remove(),n.validPlots.forEach(function(t){return delete t.regressionLine}),this.selection.regressionLines){var c=[];n.validPlots.forEach(function(t){var e=r.filter(function(e){return e.color===t.color});e.length&&c.push(t.regressionLine=new dt(t.species.species_id+"."+t.phenophase.phenophase_id,t.color,e,i,o))});this.chart.selectAll(".regression").data(c,function(t){return t.id}).enter().append("line").attr("class","regression").attr("x1",function(e){return t.x(e.p1[0])}).attr("y1",function(e){return t.y(e.p1[1])}).attr("x2",function(e){return t.x(e.p2[0])}).attr("y2",function(e){return t.y(e.p2[1])}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.color}).attr("stroke-width",2)}this.chart.select(".legend").remove();var u=this.chart.append("g").attr("class","legend").attr("transform","translate(0,-"+(this.sizing.margin.top-10)+")").style("font-size","1em");this.selection.validPlots.forEach(function(e,n){var r=u.append("g").attr("class","legend-item").attr("transform","translate(10,"+((n+1)*t.baseFontSize()+4*n)+")"),i=t.speciesTitle.transform(e.species)+"/"+e.phenophase.phenophase_name;e.regressionLine&&"number"==typeof e.regressionLine.r2&&(t.isIE?i+=" (R2 "+e.regressionLine.r2.toFixed(2)+")":i+=' (R<tspan style="baseline-shift: super; font-size: 0.65em;">2</tspan> '+e.regressionLine.r2.toFixed(2)+")"),r.append("circle").attr("r",5).attr("fill",e.color);var o=r.append("text").style("font-size",t.baseFontSize(!0)).attr("x",8).attr("y",2.5);t.isIE?o.text(i):o.html(i)}),this.commonUpdates()}},e.ctorParameters=function(){return[{type:L.n},{type:D.o},{type:nt.j},{type:L.m}]}}(st),function(){function t(t,e,n,r,i){var o=n.sort(function(t,e){return r(t)-r(e)}),a=function(t){return"number"==typeof t},s=o.map(r).filter(a),l=o.map(i).filter(a),c=this.leastSquares(s,l),u=s[0],p=this.approxY(c,u),d=s[s.length-1],f=this.approxY(c,d);this.id=t,this.color=e,this.p1=[u,p],this.p2=[d,f],this.r2=c[2]}return t.prototype.leastSquares=function(t,e){if(0===t.length||0===e.length)return[Number.NaN,Number.NaN,Number.NaN];var n=function(t,e){return t+e},r=1*t.reduce(n)/t.length,i=1*e.reduce(n)/e.length,o=t.map(function(t){return Math.pow(t-r,2)}).reduce(n),a=e.map(function(t){return Math.pow(t-i,2)}).reduce(n),s=t.map(function(t,n){return(t-r)*(e[n]-i)}).reduce(n),l=s/o;return[l,i-r*l,Math.pow(s,2)/(o*a)]},t.prototype.approxY=function(t,e){return t[1]+t[0]*e},t}()),ft=(function(){function t(){this.axis=Q,this.updateSent=!1}t.prototype.ngOnInit=function(){0===this.selection.plots.length&&this.addPlot()},t.prototype.updateChange=function(){this.selection.isValid()&&(this.selection.update(),this.updateSent=!0)},t.prototype.redrawChange=function(t){this.selection.isValid()&&(t&&!t.oldValue&&t.newValue?this.updateChange():this.updateSent?this.selection.redraw():this.updateChange())},t.prototype.addPlot=function(){this.selection.plots.push({})},t.prototype.removePlot=function(t){this.selection.plots.splice(t,1),this.updateChange()},t.prototype.plotsValid=function(){return this.selection.plots.length===this.selection.validPlots.length}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ht=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},yt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},gt=(function(){function t(){}}(),function(){function t(){}}(),function(){function t(){this.labels=[],this.data=[]}return t}()),mt=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.http=e,o.cacheService=n,o.speciesTitle=r,o.config=i,o.headers=new A.d({"Content-Type":"application/x-www-form-urlencoded"}),o.requestSrc="observation-date-vis-selection",o.negative=!1,o.negativeColor="#aaa",o.years=[],o.plots=[],o}return ft(e,t),e.prototype.isValid=function(){return this.years&&this.years.length&&this.validPlots.length>0},Object.defineProperty(e.prototype,"validPlots",{get:function(){return(this.plots||[]).filter(function(t){return t.color&&t.species&&t.phenophase})},enumerable:!0,configurable:!0}),e.prototype.toURLSearchParams=function(){var t=new A.i;return t.set("request_src",this.requestSrc),this.years.forEach(function(e,n){t.set("year["+n+"]",""+e)}),this.validPlots.forEach(function(e,n){t.set("species_id["+n+"]",""+e.species.species_id),t.set("phenophase_id["+n+"]",""+e.phenophase.phenophase_id)}),this.addNetworkParams(t),t},e.prototype.postProcessData=function(t){var e=this;if(!t)return null;var n=new gt,r=this.validPlots,i=r.length*this.years.length-1,o=function(t,e){t.forEach(function(t){n.data.push({y:i,x:t,color:e})})},a=t.reduce(function(t,e){return t[e.species_id]=e,Array.isArray(e.phenophases)&&(e.phenophases=e.phenophases.reduce(function(t,e){return t[e.phenophase_id]=e,t},{})),t},{});return console.log("speciesMap",a),r.forEach(function(t){var r=a[t.species.species_id],s=r.phenophases[t.phenophase.phenophase_id];e.years.forEach(function(a){s&&s.years&&s.years[a]&&(e.negative&&(console.debug("year negative",i,a,r.common_name,s,s.years[a].negative),o(s.years[a].negative,e.negativeColor)),console.debug("year positive",i,a,r.common_name,s,s.years[a].positive),o(s.years[a].positive,t.color)),n.labels.splice(0,0,e.speciesTitle.transform(t.species)+"/"+t.phenophase.phenophase_name+" ("+a+")"),console.debug("y of "+i+" is for "+n.labels[0]),i--})}),console.log("observation data",n),n},e.prototype.getData=function(){var t=this;if(!this.isValid())return Promise.reject(this.INVALID_SELECTION);var e=this.toURLSearchParams(),n=this.config.apiRoot+"/npn_portal/observations/getObservationDates.json",r={u:n,params:e.toString()},i=this.cacheService.get(r);return i?Promise.resolve(i):(this.working=!0,new Promise(function(i){t.http.post(n,e.toString(),{headers:t.headers}).toPromise().then(function(e){var n=e.json();t.cacheService.set(r,n),t.working=!1,i(n)}).catch(t.handleError)}))},e}(V);ht([I(),yt("design:type",Boolean)],mt.prototype,"negative",void 0),ht([I(),yt("design:type",String)],mt.prototype,"negativeColor",void 0),ht([I(),yt("design:type",Array)],mt.prototype,"years",void 0),ht([I(),yt("design:type",Array)],mt.prototype,"plots",void 0);var _t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vt=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},bt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="CalendarSelection",e.labelOffset=4,e.bandPadding=.5,e.fontSizeDelta=0,e}return _t(e,t),e}(mt);vt([I(),bt("design:type",String)],xt.prototype,"$class",void 0),vt([I(),bt("design:type",Number)],xt.prototype,"labelOffset",void 0),vt([I(),bt("design:type",Number)],xt.prototype,"bandPadding",void 0),vt([I(),bt("design:type",Number)],xt.prototype,"fontSizeDelta",void 0),vt([I(),bt("design:type",String)],xt.prototype,"monthFormat",void 0);var wt=function(){function t(t,e,n,r){this.http=t,this.cacheService=e,this.speciesTitle=n,this.config=r,this.requestSrc="npn-vis-calendar"}return t.prototype.newSelection=function(){return new xt(this.http,this.cacheService,this.speciesTitle,this.config)},t.ctorParameters=function(){return[{type:A.e},{type:L.a},{type:L.m},{type:L.i,decorators:[{type:D.s,args:[L.f]}]}]},t}(),St=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pt=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="calendar.png",e.margins={top:20,right:35,bottom:45,left:35},e}St(e,t),e.prototype.xTickValues=function(){var t,e=[1],n=1;for(t=1;t<12;t++){var r=new Date(1900,t);r.setTime(r.getTime()-864e5),n+=r.getDate(),e.push(n)}return this.x.domain().filter(function(t){return-1!==e.indexOf(t)})},e.prototype.commonUpdates=function(){t.prototype.commonUpdates.call(this);var e=this.y.bandwidth(),n=-1*(e/2+this.selection.labelOffset),r=this.baseFontSize()+this.selection.fontSizeDelta;this.chart.selectAll(".y.axis text").attr("x",0).attr("dy",n).attr("style","text-anchor: start; font-size: "+r+"px;")},e.prototype.getMonthFormat=function(){return this.selection.monthFormat?this.selection.monthFormat:this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){var e=this;t.prototype.reset.call(this),this.processed=void 0;var n=this.chart,r=this.sizing,i=K.n(this.getMonthFormat());this.x=Object(ct.a)().range([0,r.width]).domain(K.l(1,366)).paddingInner(-.1).paddingOuter(.5),this.xAxis=Object(lt.a)(this.x).tickValues(this.xTickValues()).tickFormat(function(t){var e=new Date(1900,0);return e.setTime(e.getTime()+864e5*t),i(e)}),this.y=Object(ct.a)().range([r.height,0]).domain(K.l(0,6)).paddingOuter(.5),this.yAxis=Object(lt.c)(this.y).tickSize(r.width).tickFormat(function(t){return e.processed&&e.processed.data&&t<e.processed.labels.length?e.processed.labels[t]:""}),n.append("g").attr("class","x axis").attr("transform","translate(0,"+r.height+")").call(this.xAxis),n.append("g").attr("class","y axis").call(this.yAxis),n.selectAll("g .y.axis line").style("stroke","#777").style("stroke-dasharray","2,2"),n.selectAll("g .y.axis .domain").style("display","none"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;if(this.data){var e=(this.sizing,this.processed=this.selection.postProcessData(this.data));if(this.y.paddingInner(this.selection.bandPadding),e&&e.labels&&this.y.domain(K.l(0,e.labels.length)),this.yAxis.scale(this.y),this.chart.selectAll("g .y.axis").call(this.yAxis),this.chart.selectAll(".doy").remove(),e&&e.data){var n=this.chart.selectAll(".doy").data(e.data,function(t){var e=t;return e.y+"-"+e.x+"-"+e.color});n=n.enter().insert("line",":first-child").attr("class","doy");var r=Math.ceil(this.x.bandwidth()/2),i=this.y.bandwidth()/2;n.attr("x1",function(e){return t.x(e.x)-r}).attr("y1",function(e,n){return t.y(e.y)+i}).attr("x2",function(e){return t.x(e.x)+r}).attr("y2",function(e,n){return t.y(e.y)+i}).attr("doy-point",function(t){return"("+t.x+","+t.y+")"}).attr("stroke",function(t){return t.color}).attr("stroke-width",""+this.y.bandwidth()).append("title").text(function(t){return t.x})}this.commonUpdates()}}}(st),(new Date).getFullYear()),Ot=function(){for(var t=Pt+1,e=1900,n=[];e<t;)n.push(e++);return n}(),Dt=(function(){function t(){this.maxYears=5,this.updateSent=!1}t.prototype.selectableYears=function(t){var e=this;return t?Ot.filter(function(n){return n===t||-1===e.selection.years.indexOf(n)}):Ot},t.prototype.ngOnInit=function(){0===this.selection.years.length&&this.addYear(),0===this.selection.plots.length&&this.addPlot()},t.prototype.updateChange=function(){this.selection.isValid()&&(this.selection.update(),this.updateSent=!0)},t.prototype.redrawChange=function(t){this.selection.isValid()&&(t&&!t.oldValue&&t.newValue?this.updateChange():this.updateSent?this.selection.redraw():this.updateChange())},t.prototype.addPlot=function(){this.selection.plots.push({})},t.prototype.removePlot=function(t){this.selection.plots.splice(t,1),this.updateChange()},t.prototype.addYear=function(){for(var t=Pt;-1!==this.selection.years.indexOf(t);)t--;this.selection.years.push(t),this.updateChange()},t.prototype.removeYear=function(t){this.selection.years.splice(t,1),this.updateChange()},t.prototype.plotsValid=function(){return this.selection.plots.length===this.selection.validPlots.length}}(),this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}),kt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ct=function(){function t(){this.dataPoints=!0}return Object.defineProperty(t.prototype,"external",{get:function(){return o.apply(this,arguments)},set:function(t){a.apply(this,arguments)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){delete this.$data,delete this.$metricData},t.prototype.updateCheck=function(t){this.selection&&this.isValid()&&(!this.plotted()||t?this.selection.update():this.selection.redraw())},Object.defineProperty(t.prototype,"year",{get:function(){return this._year},set:function(t){this.reset(),this._year=t,this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"phenophase",{get:function(){return this._phenophase},set:function(t){this.reset(),this._phenophase=t,this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metric",{get:function(){return this._metric},set:function(t){this.reset(),this._metric=t,this.updateCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"species",{get:function(){return this._species},set:function(t){this.reset(),this._species=t,this.phenophase=void 0,this._metrics=this._species&&this._species.kingdom?Ut[this._species.kingdom]||[]:[],this._metric&&-1===this._metrics.indexOf(this._metric)&&delete this.metric,this._metrics.length&&!this._metric&&(this.metric=this._metrics[0])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validMetrics",{get:function(){return this._metrics||[]},enumerable:!0,configurable:!0}),t.prototype.axisLabel=function(){return this.metric?this.metric.label:"?"},t.prototype.doyDataValue=function(){var t,e,n,r=this,i=r.data();if(r.doyFocus&&i)for(n=0;n<i.length;n++)if(e=i[n],r.doyFocus>=e.start_doy&&r.doyFocus<=e.end_doy)return t=(r.metric.valueFormat||Rt)(e[r.metric.id]),-9999!==e[r.metric.sampleSize]&&(t+=" N:"+e[r.metric.sampleSize]),t},t.prototype.legendLabel=function(t){var e=this.doyDataValue();return this.year+": "+zt(this.species)+" - "+this.phenophase.phenophase_name+(t?" ("+this.metric.label+")":"")+(void 0!==e?" ["+e+"]":"")},t.prototype.metricId=function(){return this.metric?this.metric.id:void 0},t.prototype.data=function(t){if(arguments.length)return delete this.$data,delete this.$metricData,t&&(t.forEach(function(t){t.start_doy=Et(t.start_date),t.end_doy=Et(t.end_date)}),t.sort(function(t,e){return t.start_doy-e.start_doy}),this.$data=t),this;var e=this,n=e.$data;return n&&e.metric&&(e.$metricData?n=e.$metricData:(e.metric.sampleSize||console.warn("Metric does not define a sampleSize property, cannot filter out invalid data points."),n=n.filter(function(t){return(!e.metric.sampleSize||-9999!==t[e.metric.sampleSize])&&-9999!==t[e.metric.id]}),n.length!==e.$data.length&&console.debug("filtered out "+(e.$data.length-n.length)+"/"+e.$data.length+" of -9999 records for metric ",e.metric),e.$metricData=n)),n},t.prototype.axis=function(){var t=this.y(),e=t.ticks(),n=this.orient||"left",r="left"===n?K.a(t):K.b(t);return e.length&&(e[e.length-1]=t.domain()[1],r.tickValues(e)),r},t.prototype.x=function(t){return arguments.length?(this.$x=t,this):this.$x},t.prototype.y=function(t){return arguments.length?(this.$y=t,this):this.$y},t.prototype.isValid=function(){return this.species&&this.phenophase&&this.year&&this.metric},t.prototype.plotted=function(){return this.isValid()&&this.data()},t.prototype.shouldRevisualize=function(){return this.isValid()&&!this.data()},t.prototype.domain=function(){var t,e=this,n=e.data();if(n&&e.metric)return t=K.h(n,function(t){return t[e.metric.id]}),t[0]>0?t[0]=0:t[0]<0&&console.warn("negative domain start for metric",t,e.metric),t},t.prototype.draw=function(t){var e,n,r,i,o,a,s=this,l=s.data(),c=[[]];if(t.selectAll("path.curve.curve-"+s.id).remove(),t.selectAll("circle.curve-point.curve-point-"+s.id).remove(),l&&l.length){for(r=0;r<l.length;r++)i=l[r],o=r+1<l.length?l[r+1]:void 0,c[c.length-1].push(i),o&&o.start_doy!==i.end_doy+1&&c.push([]);e=s.x(),n=s.y();var u=function(t){return e(t.start_doy+Math.round((t.end_doy-t.start_doy)/2))},p=function(t){return n(t[s.metric.id])};switch(a=K.j(),s.interpolate){case jt.monotone:console.log("MONOTONE"),a.curve(K.e);break;case jt.stepAfter:console.log("STEP AFTER"),a.curve(K.f);break;case jt.linear:console.log("LINEAR"),a.curve(K.d)}a.x(u),a.y(p),console.debug("ActivityCurve.draw",s.species,s.phenophase,s.year,s.metric,s.domain(),n.domain()),console.debug("draw.datas",c),c.forEach(function(e,n){(1===e.length||s.dataPoints)&&e.forEach(function(e){t.append("circle").attr("class","curve-point curve-point-"+s.id).attr("r",3).attr("fill",s.color).attr("cx",u(e)).attr("cy",p(e))}),e.length>1&&t.append("path").attr("class","curve curve-"+s.id).attr("fill","none").attr("stroke",s.color).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",1.5).attr("d",a(e))})}},t}();Dt([I(),kt("design:type",Number)],Ct.prototype,"id",void 0),Dt([I(),kt("design:type","function"==typeof(At=void 0!==L.l&&L.l)&&At||Object)],Ct.prototype,"_species",void 0),Dt([I(),kt("design:type",Object)],Ct.prototype,"_metric",void 0),Dt([I(),kt("design:type","function"==typeof(Lt=void 0!==L.k&&L.k)&&Lt||Object)],Ct.prototype,"_phenophase",void 0),Dt([I(),kt("design:type",Number)],Ct.prototype,"_year",void 0),Dt([I(),kt("design:type",String)],Ct.prototype,"color",void 0);var jt;!function(t){t[t.linear=0]="linear",t[t.stepAfter=1]="stepAfter",t[t.monotone=2]="monotone"}(jt||(jt={}));var At,Lt,Mt=function(t){return t.toFixed(2)},Rt=function(t){return t},Ft=new L.m,zt=function(t,e){return Ft.transform(t,e)},Tt=new L.b,Et=function(t,e){return Tt.transform(t,e)},It=[{id:"num_yes_records",sampleSize:"status_records_sample_size",label:"Total Yes Records"},{id:"proportion_yes_records",sampleSize:"status_records_sample_size",label:"Proportion Yes Records",valueFormat:Mt,proportion:!0}],Ut={Plantae:It.concat([{id:"numindividuals_with_yes_record",sampleSize:"individuals_sample_size",label:"Total Individuals with Yes Records"},{id:"proportion_individuals_with_yes_record",sampleSize:"individuals_sample_size",label:"Proportion Individuals with Yes Records",valueFormat:Mt,proportion:!0}]),Animalia:It.concat([{id:"numsites_with_yes_record",sampleSize:"sites_sample_size",label:"Total Sites with Yes Records"},{id:"proportion_sites_with_yes_record",sampleSize:"sites_sample_size",label:"Proportion Sites with Yes Records",valueFormat:Mt,proportion:!0},{id:"total_numanimals_in-phase",sampleSize:"in-phase_site_visits_sample_size",label:"Total Animals In Phase"},{id:"mean_numanimals_in-phase",sampleSize:"in-phase_per_hr_sites_sample_size",label:"Animals In Phase",valueFormat:Mt},{id:"mean_numanimals_in-phase_per_hr",sampleSize:"in-phase_per_hr_sites_sample_size",label:"Animals In Phase per Hour",valueFormat:Mt},{id:"mean_numanimals_in-phase_per_hr_per_acre",sampleSize:"phase_per_hr_per_acre_sites_sample_size",label:"Animals In Phase per Hour per Acre",valueFormat:Mt}])},Bt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nt=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},qt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Vt=function(){function t(){}return t}(),Yt={value:"months",label:"Monthly"},Wt={value:14,label:"Bi-weekly"},Gt={value:7,label:"Weekly"},$t=[Yt,Wt,Gt],Kt=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.http=e,o.cacheService=n,o.datePipe=r,o.config=i,o.$class="ActivityCurvesSelection",o.headers=new A.d({"Content-Type":"application/x-www-form-urlencoded"}),o._interpolate=jt.monotone,o._dataPoints=!0,o._frequency=$t[0],o.curves=[{color:"#0000ff",orient:"left"},{color:"orange",orient:"right"}].map(function(t,e){var n=new Ct;return n.id=e,n.color=t.color,n.orient=t.orient,n}),o}return Bt(e,t),e.prototype.isValid=function(){return this.curves[0].isValid()},e.prototype.updateCheck=function(t){var e=this.curves[0].isValid()||this.curves[1].isValid(),n=this.curves[0].plotted()||this.curves[1].plotted();t?e&&this.update():e&&n?this.redraw():e&&this.update()},Object.defineProperty(e.prototype,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency=t,(this._curves||[]).forEach(function(t){return t.data(null)}),this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interpolate",{get:function(){return this._interpolate},set:function(t){this._interpolate=t,(this._curves||[]).forEach(function(e){return e.interpolate=t}),this.updateCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataPoints",{set:function(t){this._dataPoints=t,(this._curves||[]).forEach(function(e){return e.dataPoints=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curves",{get:function(){return this._curves},set:function(t){var e=this;this._curves=t,t.forEach(function(t){t.selection=e,t.interpolate=e._interpolate,t.dataPoints=e._dataPoints})},enumerable:!0,configurable:!0}),e.prototype.endDate=function(t){var e=new Date;return t===e.getFullYear()?this.datePipe.transform(e,"yyyy-MM-dd"):t+"-12-31"},e.prototype.loadCurveData=function(){var t=this;return new Promise(function(e){t.working=!0;var n=t.curves.filter(function(t){return t.data(null).isValid()}).map(function(e){return new Promise(function(n){var r=new A.i;r.set("request_src","npn-vis-activity-curves"),r.set("start_date",e.year+"-01-01"),r.set("end_date",t.endDate(e.year)),r.set("frequency",""+t.frequency.value),r.set("species_id[0]",""+e.species.species_id),r.set("phenophase_id[0]",""+e.phenophase.phenophase_id),t.addNetworkParams(r);var i=t.config.apiRoot+"/npn_portal/observations/getMagnitudeData.json",o={u:i,params:r.toString()},a=t.cacheService.get(o);a?n(e.data(a)):t.http.post(i,r.toString(),{headers:t.headers}).toPromise().then(function(r){var i=r.json();t.cacheService.set(o,i),n(e.data(i))}).catch(t.handleError)})});Promise.all(n).then(function(){t.working=!1,e()})})},e.prototype.handleError=function(t){console.error("ERROR",t)},e}(V);Nt([I(),qt("design:type",String)],Kt.prototype,"$class",void 0),Nt([I(),qt("design:type","function"==typeof(Ht=void 0!==jt&&jt)&&Ht||Object)],Kt.prototype,"_interpolate",void 0),Nt([I(),qt("design:type",Boolean)],Kt.prototype,"_dataPoints",void 0),Nt([I(),qt("design:type",Vt)],Kt.prototype,"_frequency",void 0),Nt([I({ser:function(t){return t.external},des:function(t){var e=new Ct;return e.external=t,e}}),qt("design:type",Array)],Kt.prototype,"_curves",void 0);var Ht,Jt=n("qbdv"),Xt=function(){function t(t,e,n,r){this.http=t,this.cacheService=e,this.datePipe=n,this.config=r}return t.prototype.newSelection=function(){return new Kt(this.http,this.cacheService,this.datePipe,this.config)},t.ctorParameters=function(){return[{type:A.e},{type:L.a},{type:Jt.d},{type:L.i,decorators:[{type:D.s,args:[L.f]}]}]},t}(),Zt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qt=new Date(2010,0),te=K.n("%m/%d"),ee=function(t){var e=864e5*(t-1)+Qt.getTime(),n=new Date(e);return te(n)},ne=function(t,e){return t&&2===t.length&&(t=[t[0],1.05*t[1]],e&&e.proportion&&t[1]>1&&(t[1]=1)),t},re=function(t){for(var e=1,n=[];e<=365;)n.push(e),e+=t;return n},ie={7:{rotate:45,values:re(14)},14:{rotate:45,values:re(28)},months:{values:[1,32,60,91,121,152,182,213,244,274,305,335]}},oe=(function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o.window=e,o.rootElement=n,o.media=r,o.legendDoyPipe=i,o.filename="activity-curves.png",o.margins={top:80,left:80,right:80,bottom:80},o}Zt(e,t),e.prototype.usingCommonMetric=function(){var t=this.selection;if(t.curves[0].isValid()&&!t.curves[1].isValid()||t.curves[0].isValid()&&t.curves[1].isValid()&&t.curves[0].metricId()===t.curves[1].metricId())return t.curves[0].metric},e.prototype.newY=function(){var t=this.sizing;return Object(ct.b)().range([t.height,0]).domain([0,100])},e.prototype.updateLegend=function(){var t=this,e=this.chart;e.select(".legend").remove();var n=this.sizing,r=this.selection,i=this.usingCommonMetric(),o=e.append("g").attr("class","legend").attr("transform","translate(150,-"+(n.margin.top-10)+")").style("font-size","1em");r.curves.reduce(function(e,n){var r;return n.plotted()&&(r=o.append("g").attr("class","legend-item curve-"+n.id).attr("transform","translate(10,"+((e+1)*t.baseFontSize()+4*e)+")"),r.append("circle").attr("r",5).attr("fill",n.color),r.append("text").style("font-size",t.baseFontSize(!0)).attr("x",10).attr("y",2.5).text(n.legendLabel(!i)),e++),e},0)},e.prototype.hover=function(){function t(){var t=K.k(this),e=t[0],n=(t[1],Math.round(a.invert(e))),i=r.curves.reduce(function(t,e){return!t&&e.plotted()&&(t=e.data().reduce(function(t,e){return t||(n>=e.start_doy&&n<=e.end_doy?e:void 0)},void 0)),t},void 0);l.attr("transform","translate("+e+")"),c.style("text-anchor",n<324?"start":"end").attr("x",e+10*(n<324?1:-1)).text(i?o.legendDoyPipe.transform(i.start_doy)+" - "+o.legendDoyPipe.transform(i.end_doy):o.legendDoyPipe.transform(n)),r.curves.forEach(function(t){t.doyFocus=n}),o.updateLegend()}var e=this,n=this.svg,r=this.selection,i=this.sizing,o=this,a=this.x,s=n.append("g").attr("transform","translate("+i.margin.left+","+i.margin.top+")").style("display","none"),l=s.append("line").attr("class","focus").attr("fill","none").attr("stroke","green").attr("stroke-width",1).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",i.height),c=s.append("text").attr("class","focus-doy").attr("y",10).attr("x",0).text("hover doy"),u=function(){r.curves.forEach(function(t){delete t.doyFocus}),s.style("display","none"),e.updateLegend()},p=function(){r.curves.reduce(function(t,e){return t||e.plotted()},!1)&&s.style("display",null)};n.append("rect").attr("class","overlay").attr("transform","translate("+this.margins.left+","+this.margins.top+")").style("fill","none").style("pointer-events","all").attr("x",0).attr("y",0).attr("width",i.width).attr("height",i.height).on("mouseover",p).on("mouseout",u).on("mousemove",t)},e.prototype.reset=function(){var e=this;t.prototype.reset.call(this);var n=this.chart,r=this.sizing,i=this.selection;this.x=Object(ct.b)().range([0,r.width]).domain([1,365]),this.xAxis=Object(lt.a)(this.x).tickFormat(ee),i.curves.forEach(function(t){return t.x(e.x).y(e.newY())}),n.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x","0").style("text-anchor","start").style("font-size","18px").text("Activity Curves"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.loadCurveData().then(function(){t.redraw()})},e.prototype.redrawSvg=function(){var t=this,e=this.chart,n=this.sizing,r=this.selection,i=this.usingCommonMetric();if(e.selectAll("g .axis").remove(),i){var o=K.h(r.curves.reduce(function(t,e){return e.isValid()&&(t=t.concat(e.domain())),t},[])),a=this.newY().domain(ne(o,i));console.debug("ActivityCurves.common domain",o),r.curves.forEach(function(t){t.y(a)})}else r.curves.forEach(function(e){e.isValid()&&e.y(t.newY().domain(ne(e.domain(),e.metric)))});e.append("g").attr("class","y axis left").call(r.curves[0].axis()).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y","0").attr("dy","-4em").attr("x",n.height/2*-1).attr("fill","#000").style("text-anchor","middle").text(r.curves[0].axisLabel()),!i&&r.curves[1].isValid()&&(r.curves[1].orient="right",e.append("g").attr("class","y axis right").attr("transform","translate("+n.width+")").call(r.curves[1].axis()).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y","0").attr("dy","4em").attr("x",n.height/2*-1).style("text-anchor","middle").text(r.curves[1].axisLabel()));var s=ie[r.frequency.value];this.xAxis.tickValues(s.values),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis).append("text").attr("y","0").attr("dy","3em").attr("x",n.width/2).attr("class","axis-label").style("text-anchor","middle").text("Date"),s.rotate&&(e.selectAll("g.x.axis g.tick text").style("text-anchor","end").attr("transform","rotate(-"+s.rotate+")"),e.selectAll("g.x.axis .axis-label").attr("dy","4em")),i||(e.selectAll("g.y.axis.left g.tick text").style("fill",r.curves[0].color),e.selectAll("g.y.axis.left text.axis-title").style("fill",r.curves[0].color),e.selectAll("g.y.axis.right g.tick text").style("fill",r.curves[1].color),e.selectAll("g.y.axis.right text.axis-title").style("fill",r.curves[1].color)),this.commonUpdates(),r.curves.forEach(function(t){t.draw(e)}),this.updateLegend(),this.hover()},e.ctorParameters=function(){return[{type:L.n},{type:D.o},{type:nt.j},{type:L.d}]}}(st),function(){function t(){this.frequencies=$t,this.interpolates=[{value:jt.linear,label:"Linear"},{value:jt.monotone,label:"Monotone"},{value:jt.stepAfter,label:"Step after"}]}}(),n("bm2B")),ae=(function(){function t(){var t=this;this.required=!0,this.disabled=!1,this.yearControl=new oe.f(null,function(e){return t.required&&!e.value?{required:!0}:null}),this.validYears=function(){for(var t=(new Date).getFullYear(),e=[],n=2010;n<t;)e.push(n++);return e}()}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),se=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},le=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ce=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ue=function(t){function e(e){var n=t.call(this)||this;return n.serviceUtils=e,n.$class="ObserverActivitySelection",n.dataCnt=0,n}return ae(e,t),e.prototype.isMultiStation=function(){return this.stationIds&&this.stationIds.length>1},e.prototype.isSingleStation=function(){return this.stationIds&&1===this.stationIds.length},e.prototype.isValid=function(){return!!this.year},e.prototype.getData=function(){var t=this,e=this.serviceUtils.apiUrl("/npn_portal/networks/getObserversByMonth.json"),n={year:this.year,network_id:this.networkIds[0]};return new Promise(function(r,i){t.working=!0,t.serviceUtils.cachedGet(e,n).then(function(e){var n=[1,2,3,4,5,6,7,8,9,10,11,12].map(function(t){return se({month:t},e.months[t])});e.months=n,t.working=!1,r(e)}).catch(i)})},e}(q);le([I(),ce("design:type",String)],ue.prototype,"$class",void 0),le([I(),ce("design:type",Number)],ue.prototype,"year",void 0);var pe=function(){function t(t){this.serviceUtils=t}return t.prototype.newSelection=function(){return new ue(this.serviceUtils)},t.ctorParameters=function(){return[{type:L.j}]},t}(),de=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fe=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},he=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.keyLabels=["New observers","Active observers"],e.keys=["number_new_observers","number_active_observers"],e.z=Object(ct.c)().domain(e.keys).range(["#98abc5","#d0743c"]),e.zDarker=Object(ct.c)().domain(e.keys).range(e.z.range().map(function(t){return K.c(t).darker().toString()})),e.filename="observer-activity.png",e.margins=fe({},at,{top:100,left:80}),e}de(e,t),e.prototype.getMonthFormat=function(){return this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){t.prototype.reset.call(this);var e=this.chart,n=this.sizing,r=K.n(this.getMonthFormat()),i=this.baseFontSize();this.title=e.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-4.2em").attr("x","0").style("text-anchor","start").style("font-size","18px");var o=this.legend=e.append("g").attr("class","legend").attr("transform","translate(0,-"+(n.margin.top-10)+")").attr("text-anchor","start").style("font-size",i).selectAll("g").data(this.keyLabels).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(22*e+24)+")"});o.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("fill",this.z),o.append("text").attr("x",24).attr("y",i-.5).attr("dy","0.32em").text(function(t){return t}),this.x=Object(ct.a)().rangeRound([0,n.width]).padding(.05).domain(K.l(0,12)),this.xAxis=Object(lt.a)(this.x).tickFormat(function(t){return r(new Date(1900,t))}),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis),this.y=Object(ct.b)().range([n.height,0]).domain([0,20]),this.yAxis=Object(lt.b)(this.y).tickFormat(K.i(".0d")),e.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",n.height/2*-1).style("text-anchor","middle").text("New/Active Observers"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;if(this.data){this.title.text("New/Active Observers, "+this.data.network_name+", "+this.selection.year),console.debug("ObserverActivityComponent:data",this.data);var e=this.sizing,n=this.data.months.slice(),r=(this.chart,n.reduce(function(t,e){return t+e.number_new_observers},0)),i=n.reduce(function(t,e){return t+e.number_active_observers},0),o=n.reduce(function(t,e){return e.number_new_observers>t&&(t=e.number_new_observers),e.number_active_observers>t&&(t=e.number_active_observers),t},0);console.debug("ObserverActivityComponent:vis data (max="+o+")",n),this.x.domain(K.l(0,n.length)),this.chart.selectAll("g .x.axis").call(this.xAxis),this.y.domain([0,o]),this.yAxis.ticks(o<11?o:10),this.chart.selectAll("g .y.axis").call(this.yAxis);var a=function(r,i){var o=t.x.bandwidth()/2;t.chart.selectAll("g .bars."+r).remove(),t.chart.append("g").attr("class","bars "+r).attr("fill",function(e){return t.z(r)}).selectAll("rect").data(n).enter().append("rect").attr("x",function(e,n){return t.x(n)+o*i}).attr("y",function(e){return t.y(e[r])}).attr("title",function(t){return""+t[r]}).attr("height",function(n){return e.height-t.y(n[r])}).attr("width",o),t.chart.selectAll("g .bar-labels."+r).remove(),t.chart.append("g").attr("class","bar-labels "+r).attr("fill",function(e){return t.z(r)}).selectAll("text").data(n).enter().append("text").attr("text-anchor","middle").attr("dy","-0.25em").attr("x",function(e,n){return t.x(n)+o*i+o/2}).attr("y",function(e){return t.y(e[r])}).text(function(t){return""+t[r]})};this.keys.forEach(function(t,e){return a(t,e)}),this.legend.selectAll("text").each(function(t,e,n){return function(r,i){var o=K.m(this),a=r===n[0]?t:e;o.text(r+" [Total: "+a+"]")}}(r,i,this.keyLabels)),this.commonUpdates()}}}(st),function(){function t(){this.validYears=function(){for(var t=(new Date).getFullYear()+1,e=2e3,n=[];e<t;)n.push(e++);return n.reverse()}()}t.prototype.ngOnInit=function(){}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ye=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ge=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},me=function(t){function e(e,n){var r=t.call(this)||this;return r.serviceUtils=e,r.networkService=n,r.$class="ObservationFrequencySelection",r.dataCnt=0,r}return he(e,t),Object.defineProperty(e.prototype,"year",{get:function(){return this._year},set:function(t){this._year=t,delete this.defaultStation},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!!this.year&&1===this.networkIds.length},e.prototype.getData=function(){var t=this;return new Promise(function(e,n){var r=t.serviceUtils.apiUrl("/npn_portal/networks/getSiteVisitFrequency.json"),i={year:t.year,network_id:t.networkIds[0]};t.working=!0,t.serviceUtils.cachedGet(r,i).then(function(n){t.working=!1,e(n)}).catch(n)})},e}(q);ye([I(),ge("design:type",String)],me.prototype,"$class",void 0),ye([I(),ge("design:type",Number)],me.prototype,"_year",void 0),ye([I(),ge("design:type",Number)],me.prototype,"defaultStation",void 0);var _e=function(){function t(t,e){this.serviceUtils=t,this.networkService=e}return t.prototype.newSelection=function(){return new me(this.serviceUtils,this.networkService)},t.ctorParameters=function(){return[{type:L.j},{type:L.g}]},t}(),ve=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),be=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},xe=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="observation-frequency.png",e.margins=be({},at,{top:80,left:80}),e}ve(e,t),Object.defineProperty(e.prototype,"station",{get:function(){return this._station},set:function(t){this._station=t,this.selection.editMode&&(delete this.selection.defaultStation,this._station&&(this.selection.defaultStation=this._station.station_id))},enumerable:!0,configurable:!0}),e.prototype.getMonthFormat=function(){return this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){console.debug("ObservationFrequencyComponent.reset"),t.prototype.reset.call(this);var e=this.chart,n=this.sizing,r=K.n(this.getMonthFormat());this.baseFontSize();this.title=e.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x","0").style("text-anchor","start").style("font-size","18px"),this.x=Object(ct.a)().rangeRound([0,n.width]).padding(.05).domain(K.l(0,12)),this.xAxis=Object(lt.a)(this.x).tickFormat(function(t){return r(new Date(1900,t))}),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis),this.y=Object(ct.b)().range([n.height,0]).domain([0,20]),this.yAxis=Object(lt.b)(this.y).tickFormat(K.i(".0d")),e.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",n.height/2*-1).style("text-anchor","middle").text("Site visits"),this.commonUpdates()},e.prototype.update=function(){var t=this;console.debug("ObservationFrequencyComponent.update"),this.reset(),delete this.data,delete this.stations,delete this.station,this.selection.getData().then(function(e){t.data=e,t.stations=e.stations,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;console.debug("ObservationFrequencyComponent.redrawSvg:data",this.data),this.stations&&this.stations.length&&(this.station||(this.selection.defaultStation&&(this.station=this.stations.reduce(function(e,n){return e||(n.station_id===t.selection.defaultStation?n:void 0)},void 0)),this.station||(this.station=this.stations[0])),this.redrawStation(),this.commonUpdates())},e.prototype.redrawStation=function(){var t=this;if(this.title.text('Site visits by month, "TODO: Refuge Name", '+this.selection.year),this.station){var e=this.station;if(console.debug("ObservationFrequencyComponent.redrawStation:station",e),e){var n=this.sizing,r=e.months.slice(),i=r.reduce(function(t,e){return t+e},0),o=r.reduce(function(t,e){return e>t?e:t},0);this.title.text("Site visits by month ("+this.selection.year+') "'+e.station_name+'" Total: '+i),console.debug("ObservationFrequencyComponent.redrawStation:bars",r),this.x.domain(K.l(0,r.length)),this.chart.selectAll("g .x.axis").call(this.xAxis),this.y.domain([0,o]),this.yAxis.ticks(o<11?o:10),this.chart.selectAll("g .y.axis").call(this.yAxis),this.chart.selectAll("g .bars").remove(),this.chart.append("g").attr("class","bars").attr("fill","#98abc5").selectAll("rect").data(r).enter().append("rect").attr("x",function(e,n){return t.x(n)}).attr("y",function(e){return t.y(e)}).attr("title",function(t){return t}).attr("height",function(e){return n.height-t.y(e)}).attr("width",this.x.bandwidth()),this.chart.selectAll("g .bar-labels").remove(),this.chart.append("g").attr("class","bar-labels").attr("fill","#000000").selectAll("text").data(r).enter().append("text").attr("text-anchor","middle").attr("dy","-0.25em").attr("x",function(e,n){return t.x(n)+t.x.bandwidth()/2}).attr("y",function(e){return t.y(e)}).text(function(t){return t})}}}}(st),function(){function t(){this.stationChange=new D.q,this.onStationChange=new D.q}Object.defineProperty(t.prototype,"station",{get:function(){return this.stationValue},set:function(t){if(t!==this.stationValue){var e=this.stationValue;this.stationChange.emit(this.stationValue=t),this.onStationChange.emit({oldValue:e,newValue:this.stationValue})}},enumerable:!0,configurable:!0}),t.prototype.prev=function(){var t=this.stations.indexOf(this.station);this.station=t>0?this.stations[t-1]:this.stations[this.stations.length-1]},t.prototype.next=function(){var t=this.stations.indexOf(this.station);t<this.stations.length-1?this.station=this.stations[t+1]:this.station=this.stations[0]}}(),function(){function t(){this.validYears=function(){for(var t=(new Date).getFullYear()+1,e=2e3,n=[];e<t;)n.push(e++);return n.reverse()}()}t.prototype.ngOnInit=function(){}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),we=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Se=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pe=[{id:"current",label:"Current Si-x leaf index",layerName:"si-x:average_leaf_ncep",clippingService:"si-x/area/clippedImage",statisticsService:"si-x/area/statistics"},{id:"forecast",label:"6-day forecast",layerName:"si-x:average_leaf_ncep",clippingService:"si-x/area/clippedImage",statisticsService:"si-x/area/statistics",forecast:!0},{id:"anomaly",label:"Anomaly",layerName:"si-x:leaf_anomaly",clippingService:"si-x/anomaly/area/clippedImage",statisticsService:"si-x/anomaly/area/statistics"}],Oe=[{id:"current",label:"Current AGDD",layerName:"gdd:agdd",clippingService:"agdd/area/clippedImage",statisticsService:"agdd/area/statistics"},{id:"forecast",label:"6-day forecast",layerName:"gdd:agdd",clippingService:"agdd/area/clippedImage",statisticsService:"agdd/area/statistics",forecast:!0},{id:"anomaly",label:"Anomaly",layerName:"gdd:agdd_anomaly",clippingService:"agdd/anomaly/area/clippedImage",statisticsService:"agdd/anomaly/area/statistics"}],De=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.serviceUtils=e,o.datePipe=n,o.mapLegendService=r,o.config=i,o.$class="ClippedWmsMapSelection",o.service="si-x",o.layer=Pe[0],o.useBufferedBoundary=!1,o.forecastDays=6,o}return xe(e,t),e.prototype.isValid=function(){return!("si-x"!==this.service&&"agdd"!==this.service||!this.layer||!this.fwsBoundary)},Object.defineProperty(e.prototype,"validServices",{get:function(){return[{value:"si-x",label:"Spring index"},{value:"agdd",label:"Accumulated growing degree days"}]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validLayers",{get:function(){switch(this.service){case"si-x":return Pe;case"agdd":return Oe}return[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiDate",{get:function(){var t=this.explicitDate?new Date(this.explicitDate.getTime()):new Date;return this.layer&&this.layer.forecast&&t.setTime(t.getTime()+864e5*this.forecastDays),this.datePipe.transform(t,"y-MM-dd")},enumerable:!0,configurable:!0}),e.prototype.getBoundary=function(){var t=this;return new Promise(function(e,n){var r=t.config.dataApiRoot+"/v0/si-x/area/boundary",i={format:"geojson",fwsBoundary:t.fwsBoundary};t.serviceUtils.cachedGet(r,i).then(function(r){r&&r.boundary?t.serviceUtils.cachedGet(r.boundary,{}).then(e).catch(n):n("missing boundary in response.")}).catch(n)})},e.prototype.getData=function(){var t=this.config.dataApiRoot+"/v0/"+this.layer.clippingService,e={layerName:this.layer.layerName,fwsBoundary:this.fwsBoundary,date:this.apiDate,useBufferedBoundary:this.useBufferedBoundary,style:!0,fileFormat:"png"};return this.serviceUtils.cachedGet(t,e)},e.prototype.getStatistics=function(){var t=this;return new Promise(function(e,n){var r=t.config.dataApiRoot+"/v0/"+t.layer.statisticsService,i={layerName:t.layer.layerName,fwsBoundary:t.fwsBoundary,date:t.apiDate,useBufferedBoundary:t.useBufferedBoundary,useCache:!0};i.useCache="boolean"==typeof t.config.dataApiUseStatisticsCache&&t.config.dataApiUseStatisticsCache,t.serviceUtils.cachedGet(r,i).then(function(t){var n=/^(\d{4})-(\d{2})-(\d{2})/.exec(t.date);t.date=new Date(parseInt(n[1]),parseInt(n[2])-1,parseInt(n[3])),e(t)}).catch(n)})},e.prototype.getAllData=function(){var t=this;return new Promise(function(e,n){Promise.all([t.getData(),t.getBoundary(),t.getStatistics()]).then(function(t){e({data:t[0],boundary:t[1],statistics:t[2]})}).catch(n)})},e.prototype.resizeMap=function(t){var e=this;return new Promise(function(n){if(e.data){var r=e.toBounds(e.data.data.bbox);r&&t.fitBounds(r)}n()})},e.prototype.removeFrom=function(t){var e=this;return new Promise(function(n){e.overlay&&e.overlay.remove(),(e.features||[]).forEach(function(e){t.data.remove(e)}),e.data=void 0,e.features=void 0,e.overlay=void 0,e.legend=void 0,n()})},e.prototype.addTo=function(t){var e=this;return new Promise(function(n,r){e.working=!0;var i=function(t){e.working=!1,n(t)},o=function(t){e.working=!1,r(t)};if(e.overlay&&e.features)return o("already added to map, call removeFrom");e.getAllData().then(function(n){if(e.overlay&&e.features)return console.log("in promise, already have overlay and features"),i();e.data=n;var r=n.data,a=e.toBounds(r.bbox),l=r.clippedImage;if(a){t.panTo(a.getCenter()),t.fitBounds(a),s(),e.overlay=new ke(a,l,t),e.overlay.add();var c=n.boundary;console.log("MAP boundary resonse",c),e.features=t.data.addGeoJson(c),t.data.setStyle(function(t){return{strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0}})}e.mapLegendService.getLegend(r.layerClippedFrom).then(function(t){console.debug("ClippedWmsMapSelection.legend:",t),e.legend=t,i()}).catch(o)}).catch(o)})},e.prototype.toBounds=function(t){if(t&&4===t.length){var e=t[0],n=t[1],r=t[2],i=t[3];return new google.maps.LatLngBounds(new google.maps.LatLng(n,e),new google.maps.LatLng(i,r))}return null},e}(q);we([I(),Se("design:type",String)],De.prototype,"$class",void 0),we([I(),Se("design:type",String)],De.prototype,"service",void 0),we([I(),Se("design:type",Object)],De.prototype,"layer",void 0),we([I(),Se("design:type",String)],De.prototype,"fwsBoundary",void 0),we([I(),Se("design:type",Boolean)],De.prototype,"useBufferedBoundary",void 0);var ke,Ce=n("S4Bb"),je=/^(\d\d\d\d)-0?(\d+)-0?(\d+)/,Ae=function(){function t(){}return t.prototype.parse=function(t){var e=je.exec(t.replace(/T.*$/,"")),n=parseInt(e[1]),r=parseInt(e[2])-1,i=parseInt(e[3]);return new Date(n,r,i)},t}(),Le={geo_server:{url:"//geoserver-dev.usanpn.org/geoserver"},description:"",categories:[{name:"Temperature Accumulations, Daily 30-year Average",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_default_filter:{name:"agddDefaultTodayElevation"},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,layers:[{name:"gdd:30yr_avg_agdd"},{name:"gdd:30yr_avg_agdd_50f"}]},{name:"Temperature Accumulations, Current Day",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_default_filter:{name:"agddDefaultTodayTime"},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,supports_time_series:!0,layers:[{name:"gdd:agdd"},{name:"gdd:agdd_50f"}]},{name:"Temperature Accumulations, Current Day, Alaska",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_values_filter:{name:"extentDates",args:[null,"today"]},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,layers:[{name:"gdd:agdd_alaska"},{name:"gdd:agdd_alaska_50f"}]},{name:"Temperature Accumulations, Daily Anomaly",supports_data:!1,legend_label_filter:{name:"legendAgddAnomaly",args:[!1]},gridded_label_filter:{name:"legendAgddAnomaly",args:[!0]},extent_default_filter:{name:"agddDefaultTodayTime"},legend_units:"Growing Degree Days",legend_delimiter_every:100,layers:[{name:"gdd:agdd_anomaly"},{name:"gdd:agdd_anomaly_50f"}]},{name:"Spring Indices, Historical Annual",legend_label_filter:{name:"legendDoy"},current_year_only:!0,layers:[{name:"si-x:average_leaf_prism"},{name:"si-x:average_bloom_prism"},{name:"si-x:arnoldred_leaf_prism"},{name:"si-x:arnoldred_bloom_prism"},{name:"si-x:lilac_leaf_prism"},{name:"si-x:lilac_bloom_prism"},{name:"si-x:zabelli_leaf_prism"},{name:"si-x:zabelli_bloom_prism"}]},{name:"Spring Indices, Current Year",legend_label_filter:{name:"legendDoy"},extent_default_filter:{name:"agddDefaultTodayTime"},current_year_only:!0,layers:[{name:"si-x:average_leaf_ncep"},{name:"si-x:average_bloom_ncep"},{name:"si-x:arnoldred_leaf_ncep"},{name:"si-x:arnoldred_bloom_ncep"},{name:"si-x:lilac_leaf_ncep"},{name:"si-x:lilac_bloom_ncep"},{name:"si-x:zabelli_leaf_ncep"},{name:"si-x:zabelli_bloom_ncep"}]},{name:"Spring Indices, Current Year, Alaska",legend_label_filter:{name:"legendDoy"},extent_values_filter:{name:"extentDates",args:[null,"today"]},current_year_only:!0,layers:[{name:"si-x:average_leaf_ncep_alaska"},{name:"si-x:average_bloom_ncep_alaska"},{name:"si-x:arnoldred_leaf_ncep_alaska"},{name:"si-x:arnoldred_bloom_ncep_alaska"},{name:"si-x:lilac_leaf_ncep_alaska"},{name:"si-x:lilac_bloom_ncep_alaska"},{name:"si-x:zabelli_leaf_ncep_alaska"},{name:"si-x:zabelli_bloom_ncep_alaska"}]},{name:"Spring Indices, Daily Anomaly",supports_data:!1,legend_label_filter:{name:"legendSixAnomaly"},extent_default_filter:{name:"agddDefaultTodayTime"},layers:[{name:"si-x:leaf_anomaly"},{name:"si-x:bloom_anomaly"}]},{name:"Spring Indices, 30-Year Average",legend_label_filter:{name:"legendDoy"},extent_default_filter:{name:"agddDefaultTodayElevation"},layers:[{name:"si-x:30yr_avg_six_leaf"},{name:"si-x:30yr_avg_six_bloom"}]}]},Me="1.1.1",Re=256,Fe={service:"WMS",request:"GetMap",version:Me,layers:void 0,styles:"",format:"image/png",transparent:!0,height:Re,width:Re,srs:"EPSG:3857"},ze=function(){function t(t){this.config=t,this.geoServerUrl=t.geoServerRoot,this.wmsBaseUrl=this.geoServerUrl+"/wms",this.wmsCapabilitiesUrl=this.wmsBaseUrl+"?service=wms&version="+Me+"&request=GetCapabilities"}return t.ctorParameters=function(){return[{type:L.i,decorators:[{type:D.s,args:[L.f]}]}]},t}(),Te=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ee=function(){function t(t,e,n){var r=this;if(this.map=t,this.layer_def=e,this.wmsBaseUrl=n,e.extent_values_filter){console.debug("layer "+e.name+" has an extent_values_filter, processing",e.extent_values_filter);var i,o=l(e.extent_values_filter.name),a=e.extent.values.map(function(t){return t.value}),s=[a].concat(e.extent_values_filter.args||[]);i=o.apply(void 0,s),console.debug("filteredValues",i.length>1?i[0]+"..."+i[i.length-1]:i),e.extent.values=e.extent.values.filter(function(t){return-1!==i.indexOf(t.value)}),e.extent.current&&-1===i.indexOf(e.extent.current.value)&&(console.debug("current extent value has become invalid, replacing with last option"),e.extent.current=e.extent.values.length?e.extent.values[e.extent.values.length-1]:void 0)}if(e.extent_default_filter){console.debug("layer "+e.name+" has an extent_default_filter, processing",e.extent_default_filter);var p=l(e.extent_default_filter.name),d=[e.extent.values].concat(e.extent_default_filter.values||[]);e.extent.current=p.apply(void 0,d)||e.extent.current,console.debug("resulting default value",e.extent.current)}this.wmsArgs=Te({},Fe,{layers:e.name}),this.googleLayer=new google.maps.ImageMapType({getTileUrl:function(e,n){var i=t.getProjection(),o=Math.pow(2,n),a=i.fromPointToLatLng(new google.maps.Point(e.x*Re/o,e.y*Re/o)),s=i.fromPointToLatLng(new google.maps.Point((e.x+1)*Re/o,(e.y+1)*Re/o)),l=u(a),p=u(s),d={};r.extent&&r.extent.current&&r.extent.current.addToWmsParams(d);var f={bbox:[l.lng,p.lat,p.lng,l.lat].join(",")};r.sldBody&&(f.sld_body=r.sldBody);var h=Te({},d,r.wmsArgs,f);return r.wmsBaseUrl+"?"+c(h)},tileSize:new google.maps.Size(Re,Re),name:e.title||e.name}),Object.keys(e).forEach(function(t){r[t]=e[t]})}return t}(),Ie=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ue=function(t){return JSON.parse(JSON.stringify(t))},Be=function(){function t(t,e,n){this.serviceUtils=t,this.dateExtentUtil=e,this.urls=n}return t.prototype.getLayers=function(t){var e=this;return new Promise(function(n,r){e.getLayerDefinitions().then(function(r){var i=Ue(r);i.categories.forEach(function(n){n.layers=n.layers.map(function(n){return new Ee(t,n,e.urls.wmsBaseUrl)})}),n(i)}).catch(r)})},t.prototype.getLayerDefinitions=function(){function t(t){var e=Ue(Le),n=e.description;return e.categories.forEach(function(e){var r=Ue(e);delete r.name,delete r.layers,r.description=r.description||n,e.layers=e.layers.map(function(e){var n=Ue(r);return Ie({},n,t[e.name],e)})}),e}var e=this;return new Promise(function(n,r){e.layerDefs?n(e.layerDefs):e.serviceUtils.cachedGet(e.urls.wmsCapabilitiesUrl,null,!0).then(function(r){var i=Ce(Ce.parseXML(r));console.debug("WmsMapLayerService:capabilities",i);var o=e._getLayers(i.find("Layer"));console.debug("WmsMapLayerService:wms layer definitions",o),e.layerDefs=t(o),console.debug("WmsMapLayerService:layer definitions",e.layerDefs),n(e.layerDefs)}).catch(r)})},t.prototype.getLayerDefinition=function(t){var e=this;return new Promise(function(n,r){e.getLayerDefinitions().then(function(e){var r=e.categories.reduce(function(t,e){return e.layers.forEach(function(e){t[e.name]=e}),t},{});n(r[t])}).catch(r)})},t.prototype._getLayers=function(t){var e=this;if(t&&!(t.length<2)){var n=[];return t.slice(1).each(function(t,e){n.push(e)}),n.map(function(t){return e._layerToObject(t)}).reduce(function(t,e){return t[e.name]=e,t},{})}},t.prototype._layerToObject=function(t){var e=Ce(t),n={name:e.find("Name").first().text(),title:e.find("Title").first().text().replace(/\((.+?)\)/g,""),abstract:e.find("Abstract").first().text(),bbox:this._parseBoundingBox(e.find("EX_GeographicBoundingBox").first()),style:this._parseStyle(e.find("Style").first())};return n.bbox||(n.bbox=this._parseLatLonBoundingBox(e.find("LatLonBoundingBox").first())),n},t.prototype._parseStyle=function(t){var e=Ce(t);return{name:e.find("Name").first().text(),title:e.find("Title").first().text().replace(/\((.+?)\)/g,""),legend:e.find("OnlineResource").attr("xlink:href")}},t.prototype._parseLatLonBoundingBox=function(t){if(t.length){var e={westBoundLongitude:parseFloat(t.attr("minx")),eastBoundLongitude:parseFloat(t.attr("maxx")),southBoundLatitude:parseFloat(t.attr("miny")),northBoundLatitude:parseFloat(t.attr("maxy")),getBounds:function(){return new google.maps.LatLngBounds(new google.maps.LatLng(e.southBoundLatitude,e.westBoundLongitude),new google.maps.LatLng(e.northBoundLatitude,e.eastBoundLongitude))}};return e}},t.prototype._parseBoundingBox=function(t){if(t.length){var e={westBoundLongitude:parseFloat(t.find("westBoundLongitude").text()),eastBoundLongitude:parseFloat(t.find("eastBoundLongitude").text()),southBoundLatitude:parseFloat(t.find("southBoundLatitude").text()),northBoundLatitude:parseFloat(t.find("northBoundLatitude").text()),getBounds:function(){return new google.maps.LatLngBounds(new google.maps.LatLng(e.southBoundLatitude,e.westBoundLongitude),new google.maps.LatLng(e.northBoundLatitude,e.eastBoundLongitude))}};return[e.westBoundLongitude,e.eastBoundLongitude,e.southBoundLatitude,e.northBoundLatitude].reduce(function(t,e){return t||0===e||-1===e},!1)?void 0:e}},t.ctorParameters=function(){return[{type:L.j},{type:Ae},{type:ze}]},t}(),Ne=function(t){return t},qe=function(){function t(t,e,n,r){var i=this;this.wmsPipeFactory=t,this.color_map=e,this.ldef=n,this.styleDefinition=r,console.log("WmsMapLegend.color_map",e),console.log("WmsMapLegend.ldef",n),console.log("WmsMapLegend.styleDefinition",r);var o=function(t){var e=i.wmsPipeFactory.getPipe(t.name);return e||console.error("WmsMapLegend: Unable to find pipe named "+t.name),function(n,r){var i=[r];return t.args&&(i=i.concat(t.args)),e.transform.apply(e,i)}};this.lformat=n.legend_label_filter?o(n.legend_label_filter):Ne,this.gformat=n.gridded_label_filter?o(n.gridded_label_filter):void 0;var a=e.find("ColorMapEntry");0===a.length&&(a=e.find("sld\\:ColorMapEntry"));var s=a.toArray().reduce(function(t,e,n){var r=Ce(e),o=parseFloat(r.attr("quantity")),a=r.attr("label");return t.push({color:r.attr("color"),quantity:o,original_label:a,label:0===n?a:i.lformat(a,o)}),t},[]);this.title_data=s[0],this.data=s.slice(1),this.length=this.data.length}return t.prototype.setLayer=function(t){return this.layer=t,this},t.prototype.getData=function(){return this.data},t.prototype.getStyleDefinition=function(){return this.styleDefinition},t.prototype.getTitle=function(){return this.title_data.label},t.prototype.getColors=function(){return this.data.map(function(t){return t.color})},t.prototype.getQuantities=function(){return this.data.map(function(t){return t.quantity})},t.prototype.getLabels=function(){return this.data.map(function(t){return t.label})},t.prototype.getOriginalLabels=function(){return this.data.map(function(t){return t.original_label})},t.prototype.formatPointData=function(t){return(this.gformat||this.lformat)(t,t)},t.prototype.getPointData=function(t){var e,n,r;for(e=0;e<this.data.length;e++){if(n=this.data[e],r=e+1<this.data.length?this.data[e+1]:void 0,t==n.quantity)return n;if(r&&t>=n.quantity&&t<r.quantity)return n}},t}(),Ve=new Date(2010,0),Ye=new Date((new Date).getFullYear(),0),We=function(){function t(t){this.decimalPipe=t}return t.prototype.transform=function(t,e){return this.decimalPipe.transform(t,"1.0")+(e?" AGDD":"")},t.ctorParameters=function(){return[{type:Jt.e}]},t}(),Ge=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t){var e=this.datePipe.transform(new Date,"MMMM d");return(t||[]).reduce(function(t,n){return t||(n.label==e?n:void 0)},void 0)},t.ctorParameters=function(){return[{type:Jt.d}]},t}(),$e=function(){function t(t){this.decimalPipe=t}return t.prototype.transform=function(t,e){if(0===t)return"No Difference";var n=t<0;return this.decimalPipe.transform(Math.abs(t),"1.0")+(e?" AGDD ":" ")+(n?"<":">")+" Avg"},t.ctorParameters=function(){return[{type:Jt.e}]},t}(),Ke=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t){var e=this.datePipe.transform(new Date,"MMMM d, y");return(t||[]).reduce(function(t,n){return t||(n.label==e?n:void 0)},void 0)},t.ctorParameters=function(){return[{type:Jt.d}]},t}(),He=function(){function t(){}return t.prototype.transform=function(t){if(0===t)return"No Difference";var e=t<0;return Math.abs(t)+" Days "+(e?"Early":"Late")},t}(),Je=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t,e,n){return t=Math.round(t),0===t&&(t=1),e=e||"MMM d",this.datePipe.transform(new Date((n?Ye:Ve).getTime()+864e5*(t-1)),e)},t.ctorParameters=function(){return[{type:Jt.d}]},t}(),Xe=function(){function t(t,e){this.datePipe=t,this.dateExtentUtil=e}return t.prototype.toTime=function(t){var e=new Date;return"yesterday"===t||"today"===t||"tomorrow"===t?("yesterday"===t?e.setTime(e.getTime()-864e5):"tomorrow"===t&&e.setTime(e.getTime()+864e5),t=this.datePipe.transform(e,"yyyy-MM-dd 00:00:00")):-1===t.indexOf("T")&&(t=e.getFullYear()+"-"+t+" 00:00:00"),this.dateExtentUtil.parse(t).getTime()},t.prototype.transform=function(t,e,n){var r=this,i=e?this.toTime(e):void 0,o=n?this.toTime(n):void 0;return(i||o)&&(t=t.filter(function(t){var e=r.dateExtentUtil.parse(t).getTime();return(!i||i&&e>i)&&(!o||o&&e<o)})),t},t.ctorParameters=function(){return[{type:Jt.d},{type:Ae}]},t}(),Ze=function(){function t(t,e,n,r,i,o,a){this.legendGddUnits=t,this.agddDefaultTodayElevation=e,this.legendAgddAnomaly=n,this.agddDefaultTodayTime=r,this.legendSixAnomaly=i,this.legendDoy=o,this.extentDates=a,this.pipes={},this.pipes.legendGddUnits=t,this.pipes.agddDefaultTodayElevation=e,this.pipes.legendAgddAnomaly=n,this.pipes.agddDefaultTodayTime=r,this.pipes.legendSixAnomaly=i,this.pipes.legendDoy=o,this.pipes.extentDates=a}return t.prototype.getPipe=function(t){return this.pipes[t]},t.ctorParameters=function(){return[{type:We},{type:Ge},{type:$e},{type:Ke},{type:He},{type:Je},{type:Xe}]},t}(),Qe=function(){function t(t,e,n,r){this.wmsPipeFactory=t,this.serviceUtils=e,this.layerService=n,this.urls=r,this.legends={}}return t.prototype.getLegend=function(t){var e=this;return new Promise(function(n,r){if(e.legends[t])return n(e.legends[t]);e.layerService.getLayerDefinition(t).then(function(i){if(!i)return r("layer definition for "+t+" not found.");e.serviceUtils.cachedGet(e.urls.wmsBaseUrl,{service:"wms",request:"GetStyles",version:Me,layers:t},!0).then(function(r){var o=Ce(Ce.parseXML(r)),a=o.find("ColorMap");0===a.length&&(a=o.find("sld\\:ColorMap"));var s=0!==a.length?new qe(e.wmsPipeFactory,Ce(a.toArray()[0]),i,o):void 0;e.legends[t]=s,n(s)}).catch(r)})})},t.ctorParameters=function(){return[{type:Ze},{type:L.j},{type:Be},{type:ze}]},t}(),tn=(function(){function t(){this.opacity=100}t.prototype.opacityChanged=function(){this.supportsOpacity&&this.supportsOpacity.setOpacity(this.opacity/100)},t.prototype.ngOnChanges=function(t){console.log("WmsMapOpacityControl.ngOnchanges",t),t.supportsOpacity&&t.supportsOpacity.currentValue&&(this.opacity=Math.round(100*t.supportsOpacity.currentValue.getOpacity()))}}(),function(){function t(){}return t}()),en=function(){function t(t,e,n,r){this.serviceUtils=t,this.datePipe=e,this.mapLegendService=n,this.config=r}return t.prototype.newSelection=function(){return new De(this.serviceUtils,this.datePipe,this.mapLegendService,this.config)},t.ctorParameters=function(){return[{type:L.j},{type:Jt.d},{type:Qe},{type:L.i,decorators:[{type:D.s,args:[L.f]}]}]},t}(),nn=(function(){function t(){}t.prototype.serviceChange=function(){this.validLayers=this.selection.validLayers;var t=this.selection,e=this.selection.validLayers;t.layer=e.length?e[0]:void 0,this.layerChange()},t.prototype.layerChange=function(){var t=this.selection;t.isValid()?t.update():t.reset()},t.prototype.ngOnInit=function(){this.validServices=this.selection.validServices,this.serviceChange()}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),rn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.latitude=38.8402805,e.longitude=-97.61142369999999,e.zoom=4,e.getMapPromise=new Promise(function(t){e.getMapResolver=t}),e.mapStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"off"}]}],e}return nn(e,t),e.prototype.mapReady=function(t){var e=this;t.addListener("resize",function(){console.log("resize happened"),console.log("panning to center"),t.setZoom(3),setTimeout(function(){t.panTo(new google.maps.LatLng(e.latitude,e.longitude)),t.setZoom(e.zoom)},500)}),this.getMapResolver(t)},e.prototype.getMap=function(){return this.getMapPromise},e.prototype.resize=function(){var t=this;this.getMap().then(function(e){var n=t.getSizeInfo(),r=t.rootElement.nativeElement,i=r.querySelector("agm-map");i.style.width=n.width+"px",i.style.height=n.height+"px",google.maps.event.trigger(e,"resize")})},e.prototype.reset=function(){var t=this;this.getMap().then(function(e){console.log("Map reset",e),e.panTo(new google.maps.LatLng(t.latitude,t.longitude)),e.setZoom(t.zoom)})},e.prototype.redraw=function(){this.getMap().then(function(t){console.log("Map redraw",t)})},e.prototype.update=function(){this.resize(),this.getMap().then(function(t){console.log("Map update",t)})},e}(it),on=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),an=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}on(e,t),e.prototype.mapReady=function(t){this.getMapResolver(t)},e.prototype.reset=function(){var e=this;this.getMap().then(function(n){e.selection.removeFrom(n).then(function(){t.prototype.reset.call(e)})})},e.prototype.update=function(){var t=this;this.resize(),this.getMap().then(function(e){t.selection.removeFrom(e).then(function(){t.selection.addTo(e)})})},e.prototype.resize=function(){var e=this;t.prototype.resize.call(this),this.getMap().then(function(t){return e.selection.resizeMap(t)})}}(rn),n("T3r2")),sn=function(){function t(t,e,n,r,i,o){this.calendar=t,this.scatter=e,this.activity=n,this.observer=r,this.observationFreq=i,this.clippedWmsMap=o,this.factoryMap={},this.factoryMap.CalendarSelection=t,this.factoryMap.ScatterPlotSelection=e,this.factoryMap.ActivityCurvesSelection=n,this.factoryMap.ObserverActivitySelection=r,this.factoryMap.ObservationFrequencySelection=i,this.factoryMap.ClippedWmsMapSelection=o}return t.prototype.newCalendarSelection=function(){return this.calendar.newSelection()},t.prototype.newScatterPlotSelection=function(){return this.scatter.newSelection()},t.prototype.newActivityCurvesSelection=function(){return this.activity.newSelection()},t.prototype.newObserverActivitySelection=function(){return this.observer.newSelection()},t.prototype.newObservationFrequencySelection=function(){return this.observationFreq.newSelection()},t.prototype.newClippedWmsMapSelection=function(){return this.clippedWmsMap.newSelection()},t.prototype.cloneSelection=function(t){return this.newSelection(t.external)},t.prototype.newSelections=function(t){var e=this;return t.map(function(t){return e.newSelection(t)})},t.prototype.newSelection=function(t){if(!this.factoryMap[t.$class])throw new Error('Unknown selection type "'+t.$class+'"');var e=this.factoryMap[t.$class].newSelection();return e.external=t,e},t.ctorParameters=function(){return[{type:wt},{type:et},{type:Xt},{type:pe},{type:_e},{type:en}]},t}(),ln=function(){function t(){}return t}(),cn=function(){function t(){}return t}(),un=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},pn=new A.d({"Content-Type":"application/json"}),dn=function(){function t(t,e,n){this.http=t,this.cacheService=e,this.selectionFactory=n}return t.prototype.parseSelections=function(t){return this.selectionFactory.newSelections(JSON.parse(t))},t.prototype.refugeUrl=function(t){return"/api/refuge/"+t},t.prototype.castRefuge=function(t,e){e.id=t;var n=(e.selections||[]).map(function(t){return JSON.parse(t)});return e.selections=this.selectionFactory.newSelections(n),e},t.prototype.refugeList=function(t){return this.http.get("/api/refuge",{params:{terse:t}}).map(function(t){return t.json()}).map(function(t){return Object.keys(t).map(function(e){return t[e]})})},t.prototype.getRefuge=function(t){var e=this;return new Promise(function(n,r){e.http.get(e.refugeUrl(t)).toPromise().then(function(r){n(e.castRefuge(t,r.json()))}).catch(r)})},t.prototype.saveRefuge=function(t){var e=this;return new Promise(function(n,r){var i=un({},t);i.selections=(i.selections||[]).map(function(t){return JSON.stringify(t.external)});var o=JSON.stringify(i);console.log("JSON "+o),e.http.put(e.refugeUrl(t.id),o,{headers:pn}).toPromise().then(function(r){n(e.castRefuge(t.id,r.json()))}).catch(r)})},t.ctorParameters=function(){return[{type:A.e},{type:L.a},{type:sn}]},t}(),fn=(function(){function t(){}}(),function(){function t(){}}(),function(){function t(t,e){this.element=t,this.refugeService=e,this.userIsLoggedIn=!1;var n=t.nativeElement;this.userIsLoggedIn=null!==n.getAttribute("user_is_logged_in")}return t.prototype.ngOnInit=function(){},t.prototype.selectedTabChange=function(t){console.debug("selectedTabChange",t)},t.ctorParameters=function(){return[{type:D.o},{type:dn}]},t}()),hn=n("O00e"),yn=[""],gn=n("j5BN"),mn=["agm-map[_ngcontent-%COMP%]{height:500px}.control-form[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-line-pack:start;align-content:flex-start}.control-form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:5px}.control-form[_ngcontent-%COMP%]   .refuges-input[_ngcontent-%COMP%]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;max-width:60%}.map-wrapper[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]     .gridded-legend{margin-top:10px;border-bottom:1px solid #aaa}@media (min-width:992px){.map-wrapper[_ngcontent-%COMP%]   clipped-wms-map-statistics[_ngcontent-%COMP%], .map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]{position:absolute;left:10px;padding:8px;border:1px solid #aaa;background-color:hsla(0,0%,100%,.5);border-radius:5px}.map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]{bottom:25px;width:60%}.map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]     .gridded-legend{margin-top:0;border-bottom:none;width:100%;height:125px;border:none}.map-wrapper[_ngcontent-%COMP%]   clipped-wms-map-statistics[_ngcontent-%COMP%]{top:10px}}"],_n=n("8oXs"),vn=n("6OSA"),bn=n("Lpd/"),xn=n("1ini"),wn=n("OFGE"),Sn=n("l6RC"),Pn=n("fc+i"),On=n("SlD5"),Dn=n("V8+5"),kn=n("Elun"),Cn=n("EPfU"),jn=n("gOiy"),An=n("4jwp"),Ln=n("wjk8"),Mn=n("ghl+"),Rn=n("8Xfy"),Fn=n("jk5D"),zn=n("OBOK"),Tn=n("0bRs"),En=n("57RD"),In=n("dY6p"),Un=n("RH9C"),Bn=n("kuH+"),Nn=n("xs7O"),qn=n("6Lcc"),Vn=n("Dqrr"),Yn=function(){function t(){var t=this;this.getMap=new Promise(function(e){return t.mapResolver=e}),this.latitude=41.13576,this.longitude=-99.157679,this.zoom=4,this.mapStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"off"}]}]}return t.prototype.configureMap=function(t){},t.prototype.mapReady=function(t){this.configureMap(t),this.mapResolver(t)},t}(),Wn=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gn=function(t){function e(e,n){var r=t.call(this)||this;return r.refugeService=e,r.selectionFactory=n,r.componentDestroyed=new Vn.Subject,r.refugeFormControl=new oe.f,r.selectionFormControl=new oe.f,r}return Wn(e,t),e.prototype._filterRefuges=function(t){return this.refuges?(t=t.toLowerCase(),this.refuges.filter(function(e){return-1!==e.title.toLowerCase().indexOf(t)})):[]},e.prototype.ngOnInit=function(){var t=this;this.refugeService.refugeList(!0).map(function(t){return t.filter(function(t){return!!t.location})}).subscribe(function(e){return t.refuges=e}),this.refugeFormControl.valueChanges.takeUntil(this.componentDestroyed).filter(function(t){return!t||"object"==typeof t}).map(function(t){return"object"==typeof t?t:null}).subscribe(function(e){return t.focusRefuge(e)}),this.filteredRefuges=this.refugeFormControl.valueChanges.filter(function(t){return"string"==typeof t}).map(function(e){return e?t._filterRefuges(e):t.refuges?t.refuges.slice():[]}),this.selectionFormControl.valueChanges.takeUntil(this.componentDestroyed).filter(function(t){return"object"==typeof t}).subscribe(function(e){return t.setSelection(e)})},e.prototype.ngOnDestroy=function(){this.componentDestroyed.next()},e.prototype.newSelection=function(t,e,n){var r=this.selectionFactory.newSelection();return r.networkIds=[t.network_id],r.fwsBoundary=t.boundary_id,r.service=e,r.layer=r.validLayers.reduce(function(t,e){return t||(e.id===n?e:void 0)},void 0),r},e.prototype.refugeTitle=function(t){return t?t.title:""},e.prototype.refugeClick=function(t){this.refugeFormControl.setValue(t)},e.prototype.reset=function(){this.refugeFormControl.setValue(null)},e.prototype.focusRefuge=function(t){var e=this;if(console.debug("focusRefuge",t),this.focused=t,!t)return this.selections=null,this.selectionFormControl.setValue(null),void this.getMap.then(function(t){t.setCenter(new google.maps.LatLng(e.latitude,e.longitude)),t.setZoom(e.zoom)});this.getMap.then(function(e){e.panTo(new google.maps.LatLng(t.location.lat,t.location.lng)),e.setZoom(8)}),console.log("focusRefuge",t);var n,r=[],i=new Date(2017,4,2,0,0,0,0),o=new Date(i.getTime()-864e5);n=this.newSelection(t,"si-x","current"),n.explicitDate=o,r.push({label:"Where has Spring Arrived?",selection:n}),n=this.newSelection(t,"si-x","forecast"),n.explicitDate=i,n.forecastDays=3,r.push({label:"Spring Forecast",selection:n}),n=this.newSelection(t,"si-x","anomaly"),n.explicitDate=o,r.push({label:"How does this year stack up?",selection:n}),this.selections=r,this.selectionFormControl.setValue(this.selections[0].selection)},e.prototype.setSelection=function(t){var e=this;console.debug("setSelection",t?t.external:"NULL"),this.getMap.then(function(n){var r=function(){(e.selection=t)&&t.addTo(n).then(function(){return console.debug("added selection",t.external)})};e.selection?e.selection.removeFrom(n).then(r):r()})},e.ctorParameters=function(){return[{type:dn},{type:en}]},e}(Yn),$n=n("9U4N"),Kn=n("BfPg"),Hn=n("KdOF"),Jn=n("DCX4"),Xn=n("Ds4W"),Zn=n("9fk+"),Qn=n("mECe"),tr=n("7PDj"),er=n("wW3n"),nr=n("t+Rn"),rr=[mn],ir=D._13({encapsulation:0,styles:rr,data:{}}),or=(D._11("status-of-spring",Gn,w,{},{},[]),[yn]),ar=D._13({encapsulation:0,styles:or,data:{}}),sr=D._11("spring-dashboard",fn,O,{},{},[]),lr=n("f9zQ"),cr=n("fL27"),ur=n("EyWH"),pr=n("gdRU"),dr=n("8aeK"),fr=n("YcBH"),hr=n("Zyxv"),yr=n("vHGP"),gr=n("Mxwl"),mr=n("BcUv"),_r=n("Pp7C"),vr=n("ppgG"),br=n("ka8K"),xr=n("vgc3"),wr=n("niyx"),Sr=n("wvx+"),Pr=n("0cZJ"),Or=n("CZgk"),Dr=n("RXNa"),kr=n("kMVV"),Cr=n("cC+T"),jr=n("q+Vp"),Ar=D._12(C,[fn],function(t){return D._27([D._28(512,D.k,D._8,[[8,[hn.a,sr]],[3,D.k],D.B]),D._28(5120,D.z,D._26,[[3,D.z]]),D._28(4608,Jt.j,Jt.i,[D.z]),D._28(4608,D.i,D.i,[]),D._28(5120,D.a,D._17,[]),D._28(5120,D.x,D._23,[]),D._28(5120,D.y,D._24,[]),D._28(4608,Pn.c,Pn.t,[Jt.c]),D._28(6144,D.P,null,[Pn.c]),D._28(4608,Pn.f,gn.d,[]),D._28(5120,Pn.d,function(t,e,n,r){return[new Pn.l(t),new Pn.p(e),new Pn.o(n,r)]},[Jt.c,Jt.c,Jt.c,Pn.f]),D._28(4608,Pn.e,Pn.e,[Pn.d,D.D]),D._28(135680,Pn.n,Pn.n,[Jt.c]),D._28(4608,Pn.m,Pn.m,[Pn.e,Pn.n]),D._28(5120,lr.a,cr.d,[]),D._28(5120,lr.c,cr.e,[]),D._28(4608,lr.b,cr.c,[lr.a,lr.c]),D._28(5120,D.N,cr.f,[Pn.m,lr.b,D.D]),D._28(6144,Pn.q,null,[Pn.n]),D._28(4608,D.V,D.V,[D.D]),D._28(4608,Pn.h,Pn.h,[Jt.c]),D._28(4608,Pn.j,Pn.j,[Jt.c]),D._28(4608,ur.b,cr.b,[D.N,Pn.b]),D._28(4608,oe.s,oe.s,[]),D._28(4608,oe.e,oe.e,[]),D._28(4608,pr.a,pr.a,[dr.a]),D._28(4608,A.c,A.c,[]),D._28(4608,A.h,A.b,[]),D._28(5120,A.k,A.l,[]),D._28(4608,A.j,A.j,[A.c,A.h,A.k]),D._28(4608,A.g,A.a,[]),D._28(5120,A.e,A.m,[A.j,A.g]),D._28(4608,Jt.d,Jt.d,[D.z]),D._28(4608,fr.a,fr.a,[A.e,pr.a,Jt.d,dr.a]),D._28(4608,hr.a,hr.a,[A.e,pr.a,dr.a]),D._28(4608,yr.a,yr.a,[A.e,pr.a,dr.a]),D._28(4608,gr.a,gr.a,[]),D._28(4608,mr.a,mr.a,[]),D._28(4608,_r.a,_r.a,[Jt.d]),D._28(4608,Dn.a,Dn.a,[]),D._28(6144,Sn.b,null,[Pn.b]),D._28(4608,Sn.c,Sn.c,[[2,Sn.b]]),D._28(4608,Rn.i,Rn.i,[Dn.a]),D._28(4608,Rn.h,Rn.h,[Rn.i,Dn.a,D.D]),D._28(136192,Rn.e,Rn.c,[[3,Rn.e],Dn.a]),D._28(5120,Rn.l,Rn.k,[[3,Rn.l],[2,Rn.j],Dn.a]),D._28(5120,Rn.g,Rn.f,[[3,Rn.g],D.D,Dn.a]),D._28(4608,vr.a,vr.a,[]),D._28(5120,An.c,An.a,[[3,An.c],D.D,Dn.a]),D._28(5120,An.f,An.e,[[3,An.f],Dn.a,D.D,An.c]),D._28(4608,wn.g,wn.g,[An.c,An.f]),D._28(5120,wn.d,wn.i,[[3,wn.d]]),D._28(4608,wn.l,wn.l,[An.f]),D._28(4608,wn.b,wn.b,[wn.g,wn.d,D.k,wn.l,D.e,D.v,D.D]),D._28(5120,wn.j,wn.k,[wn.b]),D._28(5120,jn.a,jn.b,[wn.b]),D._28(4608,gn.c,gn.c,[]),D._28(5120,br.c,br.d,[[3,br.c]]),D._28(5120,xn.a,xn.b,[wn.b]),D._28(5120,Fn.a,Fn.b,[wn.b]),D._28(5120,nt.a,nt.c,[]),D._28(4608,nt.b,nt.b,[nt.a]),D._28(4608,nt.f,nt.f,[D.D,Jt.c]),D._28(5120,nt.g,nt.e,[[3,nt.g],nt.b,nt.f]),D._28(5120,nt.j,nt.i,[[3,nt.j],nt.f,nt.b]),D._28(4608,Jt.e,Jt.e,[D.z]),D._28(4608,Ae,Ae,[]),D._28(4608,We,We,[Jt.e]),D._28(4608,Ge,Ge,[Jt.d]),D._28(4608,$e,$e,[Jt.e]),D._28(4608,Ke,Ke,[Jt.d]),D._28(4608,He,He,[]),D._28(4608,Je,Je,[Jt.d]),D._28(4608,Xe,Xe,[Jt.d,Ae]),D._28(4608,Ze,Ze,[We,Ge,$e,Ke,He,Je,Xe]),D._28(4608,ze,ze,[dr.a]),D._28(4608,Be,Be,[yr.a,Ae,ze]),D._28(4608,Qe,Qe,[Ze,yr.a,Be,ze]),D._28(4608,et,et,[A.e,pr.a,dr.a]),D._28(4608,wt,wt,[A.e,pr.a,gr.a,dr.a]),D._28(4608,en,en,[yr.a,Jt.d,Qe,dr.a]),D._28(4608,Xt,Xt,[A.e,pr.a,Jt.d,dr.a]),D._28(4608,pe,pe,[yr.a]),D._28(4608,_e,_e,[yr.a,hr.a]),D._28(4608,sn,sn,[wt,et,Xt,pe,_e,en]),D._28(5120,xr.c,xr.a,[[3,xr.c],[2,A.e],Pn.c]),D._28(4608,wr.c,wr.c,[]),D._28(4608,wr.b,wr.b,[]),D._28(4608,er.a,Sr.b,[Sr.a,wr.c,wr.b]),D._28(4608,dn,dn,[A.e,pr.a,sn]),D._28(512,Jt.b,Jt.b,[]),D._28(1024,D.p,Pn.r,[]),D._28(1024,D.b,function(t,e){return[Pn.s(t,e)]},[[2,Pn.i],[2,D.C]]),D._28(512,D.c,D.c,[[2,D.b]]),D._28(131584,D._15,D._15,[D.D,D._9,D.v,D.p,D.k,D.c]),D._28(2048,D.e,null,[D._15]),D._28(512,D.d,D.d,[D.e]),D._28(512,Pn.a,Pn.a,[[3,Pn.a]]),D._28(512,cr.a,cr.a,[]),D._28(512,oe.q,oe.q,[]),D._28(512,oe.i,oe.i,[]),D._28(512,oe.p,oe.p,[]),D._28(512,L.h,L.h,[]),D._28(512,Dn.b,Dn.b,[]),D._28(512,bn.c,bn.c,[]),D._28(512,gn.a,gn.a,[]),D._28(512,Sn.a,Sn.a,[]),D._28(256,gn.e,!0,[]),D._28(512,gn.k,gn.k,[[2,gn.e]]),D._28(512,gn.u,gn.u,[]),D._28(512,Rn.a,Rn.a,[]),D._28(512,Mn.c,Mn.c,[]),D._28(512,vr.b,vr.b,[]),D._28(512,Pr.a,Pr.a,[]),D._28(512,Or.c,Or.c,[]),D._28(512,An.b,An.b,[]),D._28(512,wn.e,wn.e,[]),D._28(512,gn.s,gn.s,[]),D._28(512,gn.p,gn.p,[]),D._28(512,jn.d,jn.d,[]),D._28(512,Tn.b,Tn.b,[]),D._28(512,Dr.a,Dr.a,[]),D._28(512,xn.d,xn.d,[]),D._28(512,On.b,On.b,[]),D._28(512,kr.a,kr.a,[]),D._28(512,Cr.a,Cr.a,[]),D._28(512,Fn.d,Fn.d,[]),D._28(512,jr.a,jr.a,[]),D._28(512,nt.h,nt.h,[]),D._28(512,nt.d,nt.d,[]),D._28(512,tn,tn,[]),D._28(512,ln,ln,[]),D._28(512,A.f,A.f,[]),D._28(512,cn,cn,[]),D._28(512,xr.b,xr.b,[]),D._28(512,C,C,[]),D._28(1024,dr.a,i,[]),D._28(1024,L.e,r,[]),D._28(256,Nn.a,void 0,[]),D._28(256,Sr.a,{apiKey:"AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE"},[])])});k.a.production&&Object(D._2)(),Object(Pn.k)().bootstrapModuleFactory(Ar)},gFIY:function(t,e){function n(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="gFIY"},gdRU:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("/oeL"),i=n("8aeK"),o=n("XXyR"),a=(n.n(o),function(){function t(t){this.config=t,this.ttl=36e5,"number"==typeof t.cacheTTL&&(this.ttl=60*t.cacheTTL*1e3),console.log("CacheService Time To Live "+this.ttl/6e4+" minutes"),0===this.ttl&&(console.log("Caching disabled clearing local session storage"),sessionStorage.clear())}return t.prototype.cacheKey=function(t){return"string"!=typeof t&&(t=JSON.stringify(t)),o.Md5.hashStr(t).toString()},t.prototype.get=function(t){if(this.ttl<=0)return null;var e=this.cacheKey(t),n=sessionStorage.getItem(e);if(n){if(n=JSON.parse(n),Date.now()<n.expiry)return console.log("cache hit",e,t),n.data;console.log("cache expired",e),window.sessionStorage.removeItem(e)}else console.log("cache miss",e);return null},t.prototype.set=function(t,e){if(this.ttl<=0)return null;var n=this.cacheKey(t);if(e){var r={expiry:Date.now()+this.ttl,data:e};console.log("caching",n,e);try{sessionStorage.setItem(n,JSON.stringify(r))}catch(t){console.log("error storing item in cache",t),console.log("clearing"),sessionStorage.clear();try{sessionStorage.setItem(n,JSON.stringify(r))}catch(t){console.log("error on second store attempt (giving up).",t)}}}else console.log("removing from cache",n),sessionStorage.removeItem(n)},t.ctorParameters=function(){return[{type:i.b,decorators:[{type:r.s,args:[i.a]}]}]},t}());!function(){function t(){}}()},"kuH+":function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=n("/oeL"),i=n("4Y6l"),o=n("bKpL"),a=(n.n(o),n("Xtvq")),s=(n.n(a),n("azLz")),l=(n.n(s),n("ckYf")),c=function(){function t(t,e){this.window=t,this.rootElement=e}return t.prototype.ngAfterViewInit=function(){var t=this;console.debug("WmsMapLegendComponent.ngAfterViewInit"),this.resizeSubscription=o.Observable.fromEvent(window,"resize").debounceTime(500).subscribe(function(e){return t.redraw()}),this.svg=l.m(this.rootElement.nativeElement).select("svg"),console.debug("WmsMapLegendComponent:SVG",this.svg)},t.prototype.ngOnChanges=function(t){var e=this;console.debug("WmsMapLegendComponent.ngOnChanges",t),setTimeout(function(){return e.redraw()})},t.prototype.ngOnDestroy=function(){console.debug("WmsMapLegendComponent.ngOnDestroy"),this.resizeSubscription&&this.resizeSubscription.unsubscribe()},t.prototype.redraw=function(){function t(t,e,n){var r=u+c+b;t.append("line").attr("x1",s/2).attr("y1",r).attr("x2",s/2).attr("y2",r+v).attr("stroke","black").attr("stroke-width","1"),t.append("text").attr("dx",s/2).attr("dy","4em").style("text-anchor",n).text(e)}console.debug("WmsMapLegendComponent.redraw");var e=this.svg,n=this.legend;if(e&&e.selectAll("g").remove(),n&&e){var r=parseFloat(e.style("width").replace("px","")),i=parseFloat(e.style("height").replace("px","")),o=n.getData(),a=Math.floor(o.length/2),s=r/o.length,c=30,u=2;console.debug("WmsMapLegendComponent.svg dimensions",r,i),console.debug("WmsMapLegendComponent.legend cell width",s);var p=e.append("g"),d=p.selectAll("g.cell").data(o).enter().append("g").attr("class",function(t,e){return"cell"+(0===e?" first":e===a?" middle":e===o.length-1?" last":"")}).attr("transform",function(t,e){return"translate("+e*s+","+u+")"}).append("rect").attr("height",c).attr("width",s).style("stroke","black").style("stroke-width","1px").style("fill",function(t,e){return t.color});if(n.ldef.legend_delimiter_every){var f=n.ldef.legend_delimiter_every,h=0,y=o.map(function(t,e){return e+1===o.length||(h+=o[e+1].quantity-o[e].quantity)>=f&&(h=0,!0)}),g=[s+1,c,s+1,c].join(","),m=[2*s+c,c].join(","),_=[s+1,c,s+c+1,0].join(",");console.debug("WmsMapLegendComponent.legend_delimiter_every",f),d.style("stroke-dasharray",function(t,e){return 0===e?y[e]?void 0:_:y[e]?m:g}).attr("width",function(t,e){var n=parseFloat(l.m(this).attr("width"));return y[e]?n:n+1}),p.selectAll("g.cell").append("line").attr("stroke",function(t,e){return y[e]?"black":"none"}).attr("stroke-width",2).attr("x1",s-1).attr("x2",s-1).attr("y1",0).attr("y2",c)}d.append("title").text(function(t){return t.label});var v=5,b=3;t(e.select("g.cell.first"),o[0].label,"start"),t(e.select("g.cell.middle"),o[a].label,"middle"),t(e.select("g.cell.last"),o[o.length-1].label,"end"),n.ldef.legend_units&&e.append("g").append("text").attr("dx",r/2).attr("dy",75+u).attr("text-anchor","middle").text(n.ldef.legend_units);var x=n.ldef.title;n.ldef.extent&&n.ldef.extent.current&&(x+=", "+n.ldef.extent.current.label),e.append("g").append("text").attr("dx",5).attr("dy",100+u).attr("font-size","18px").attr("text-anchor","right").text(x),e.append("g").append("text").attr("dx",5).attr("dy",118+u).attr("font-size","11px").attr("text-anchor","right").text("USA National Phenology Network, www.usanpn.org")}},t.ctorParameters=function(){return[{type:i.n},{type:r.o}]},t}()},vHGP:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n("/oeL"),i=n("CPp0"),o=n("82j9"),a=(n.n(o),n("gdRU")),s=n("8aeK"),l=function(){function t(t,e,n){this.http=t,this.cache=e,this.config=n}return t.prototype.apiUrl=function(t){return""+this.config.apiRoot+t},t.prototype.dataApiUrl=function(t){return""+this.config.dataApiRoot+t},t.prototype.cachedGet=function(t,e,n){var r=this;return e=e||{},new Promise(function(i,o){var a={u:t,params:e},s=r.cache.get(a);s?i(s):r.http.get(t,{params:e}).toPromise().then(function(t){s=n?t.text():t.json(),r.cache.set(a,s),i(s)}).catch(o)})},t.ctorParameters=function(){return[{type:i.e},{type:a.a},{type:s.b,decorators:[{type:r.s,args:[s.a]}]}]},t}()},xs7O:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(){}return t}()}},[0]);