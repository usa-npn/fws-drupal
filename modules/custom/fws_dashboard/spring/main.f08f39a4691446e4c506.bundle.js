webpackJsonp([1],{0:function(t,e,n){t.exports=n("cDNt")},"4Y6l":function(t,e,n){"use strict";function r(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)}var i=n("/oeL"),o=function(){function t(){}return t}(),a=function(){function t(){}return t}(),s=n("gdRU"),l=n("YcBH"),c=n("Zyxv"),u=n("xs7O"),p=n("Mxwl"),d=n("BcUv"),f=n("Pp7C"),h=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t}(),g=n("8aeK"),y=n("vHGP");n.d(e,"e",function(){return m}),n.d(e,"h",function(){return _}),e.o=r,n.d(e,"l",function(){return o}),n.d(e,"k",function(){return a}),n.d(e,"a",function(){return s.a}),n.d(e,!1,function(){return l.a}),n.d(e,"g",function(){return c.a}),n.d(e,"n",function(){return u.a}),n.d(e,"m",function(){return p.a}),n.d(e,"b",function(){return d.a}),n.d(e,"d",function(){return f.a}),n.d(e,"c",function(){return h}),n.d(e,"i",function(){return g.b}),n.d(e,"f",function(){return g.a}),n.d(e,"j",function(){return y.a});var m=new i.u("npnBaseHref"),_=function(){function t(){}return t}()},"8aeK":function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o});var r=n("/oeL"),i=function(){function t(){}return t}(),o=new r.u("NpnConfiguration")},BcUv:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(){}return t.prototype.transform=function(t,e){if("string"==typeof t){var n=t.split("-");if(3===n.length){var r=parseInt(n[0]),i=parseInt(n[1]),o=parseInt(n[2]);!isNaN(r)&&!isNaN(i)&&!isNaN(o)&&i<13&&o<32&&(t=new Date(r,i-1,o))}}if(t instanceof Date){t=new Date(t.getTime()),e&&t.setFullYear(2010);for(var a=t.getDate();t.getMonth()>0;)t.setDate(1),t.setTime(t.getTime()-864e5),a+=t.getDate();return a}return t},t}()},Mxwl:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("OpsG"),i=function(){function t(){}return t.prototype.transform=function(t,e){if(t){if("common-name"===(e=e||r.a.appConfig.tagSpeciesTitle)){if(t.common_name){var n=t.common_name.toLowerCase();return n.substring(0,1).toUpperCase()+n.substring(1)}return t.common_name}if("scientific-name"===e)return t.genus+" "+t.species}return t},t}()},OpsG:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r={production:!0,googleMapsApiKey:"AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE",appConfig:{num_days_quality_filter:30,filterLqdSummary:!0,filterLqdDisclaimer:"For quality assurance purposes, only onset dates that are preceded by negative records are included in the visualization.",tagSpeciesTitle:"common-name"}}},Pp7C:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("qbdv"),i=new Date(2010,0),o=new Date((new Date).getFullYear(),0),a=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t,e,n){return t=Math.round(t),0===t&&(t=1),e=e||"MMM d",this.datePipe.transform(new Date((n?o:i).getTime()+864e5*(t-1)),e)},t.ctorParameters=function(){return[{type:r.d}]},t}()},T3r2:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r="Number of pixels included in the calculations",i={count:r,mean:"Mean day of year of the onset of the first leaf index for the pixels displayed",stdDev:"The standard deviation of the mean day of year of the onset of the first leaf index for the pixels displayed",min:"Minimum day of year of the onset of the first leaf index for the pixels displayed",max:"Maximum day of year of the onset of the first leaf index for the pixels displayed",complete:"Percent of pixels that have reached the requirements for the Spring Index."},o={count:r,mean:"Mean Accumulated Growing Degree Day value for the pixels displayed",stdDev:"The standard deviation of the Accumulated Growing Degree Day value for the pixels displayed",min:"Minimum Accumulated Growing Degree Day value for the pixels displayed",max:"Maximum Accumulated Growing Degree Day value for the pixels displayed"},a=function(){function t(){}return t.prototype.ngDoCheck=function(){this.selection&&this.selection.data&&this.selection.data.statistics&&(this.statistics=this.selection.data.statistics,this.gdd=this.selection&&/^gdd/.test(this.selection.layer.layerName),this.tooltips=this.gdd?o:i)},t}()},YcBH:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n("/oeL"),i=n("qbdv"),o=n("CPp0"),a=n("82j9"),s=(n.n(a),n("gdRU")),l=n("8aeK"),c=new o.d({"Content-Type":"application/x-www-form-urlencoded"}),u=function(){function t(t,e,n,r){this.http=t,this.cache=e,this.datePipe=n,this.config=r}return t.prototype.getAllSpecies=function(t){var e=this;return new Promise(function(n,r){console.log("SpeciesService.getAllSpecies:params",t);var i=e.config.apiRoot+"/npn_portal/species/getSpeciesFilter.json",a={u:i,params:t},s=e.cache.get(a);if(s)n(s);else{var l=new o.i;Object.keys(t).forEach(function(e){return l.set(""+e,""+t[e])}),e.http.post(i,l.toString(),{headers:c}).toPromise().then(function(t){s=t.json(),e.cache.set(a,s),n(s)}).catch(r)}})},t.prototype._getPhenophases=function(t,e){var n=this;return new Promise(function(r,i){var o=n.config.apiRoot+"/npn_portal/phenophases/getPhenophasesForSpecies.json",a={species_id:t.species_id};e?a.date=n.datePipe.transform(e,"y-MM-dd"):a.return_all=!0;var s={u:o,params:a},l=n.cache.get(s);l?r(l):n.http.get(o,{params:a}).toPromise().then(function(t){var e=t.json();l=e[0].phenophases,l=n.removeRedundantPhenophases(l),n.cache.set(s,l),r(l)}).catch(i)})},t.prototype.getAllPhenophases=function(t){return this._getPhenophases(t)},t.prototype.getPhenophasesForDate=function(t,e){return this._getPhenophases(t,e)},t.prototype.getPhenophasesForYear=function(t,e){var n=this;return new Promise(function(r,i){var o=new Date(e,0,1),a=new Date(e,11,31);Promise.all([n.getPhenophasesForDate(t,o),n.getPhenophasesForDate(t,a)]).then(function(t){r(n.mergeRedundantPhenophaseLists(t))}).catch(i)})},t.prototype.getPhenophasesForYears=function(t,e,n){var r=this;if(e&&!n)throw new Error("Missing end year.");if(e>n)throw new Error("start year cannot be greater than end");for(var i=[e],o=e;o++<n;)i.push(o);return new Promise(function(e,n){Promise.all(i.map(function(e){return r.getPhenophasesForYear(t,e)})).then(function(t){e(r.mergeRedundantPhenophaseLists(t))}).catch(n)})},t.prototype.getPhenophases=function(t,e,n){return e?this.getPhenophasesForYears(t,e,n):this.getAllPhenophases(t)},t.prototype.removeRedundantPhenophases=function(t){var e=[];return t.filter(function(t){return!e[t.phenophase_id]&&(e[t.phenophase_id]=t,!0)})},t.prototype.mergeRedundantPhenophaseLists=function(t){return this.removeRedundantPhenophases(t.reduce(function(t,e){return t.concat(e)},[]))},t.ctorParameters=function(){return[{type:o.e},{type:s.a},{type:i.d},{type:l.b,decorators:[{type:r.s,args:[l.a]}]}]},t}()},Zyxv:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n("/oeL"),i=n("CPp0"),o=n("82j9"),a=(n.n(o),n("gdRU")),s=n("8aeK"),l=function(){function t(t,e,n){this.http=t,this.cache=e,this.config=n}return t.prototype.getStations=function(t){var e=this;return new Promise(function(n,r){var i=e.config.apiRoot+"/npn_portal/stations/getStationsForNetwork.json",o={network_id:t},a={u:i,params:o},s=e.cache.get(a);s?n(s):e.http.get(i,{params:o}).toPromise().then(function(t){s=t.json(),e.cache.set(a,s),n(s)}).catch(r)})},t.ctorParameters=function(){return[{type:i.e},{type:a.a},{type:s.b,decorators:[{type:r.s,args:[s.a]}]}]},t}()},cDNt:function(t,e,n){"use strict";function r(){return window.npn_base_href}function i(){return window.npn_configuration}function o(){var t=this,e={};return Object.keys(this).forEach(function(n){var r=q(t,n);if(r){var i=t[n];/^_/.test(n)&&(n=n.substring(1)),Array.isArray(i)?e[n]=i.map(function(t){return r.ser(t)}):e[n]=r.ser(i)}}),e}function a(t){var e=this;Object.keys(t).forEach(function(n){var r=q(e,n);if(r){var i=t[n];void 0!==i?Array.isArray(i)?e[n]=i.map(function(t){return r.des(t)}):e[n]=r.des(i):e[n]=void 0}})}function s(){Ae=function(t){function e(e,n,r){var i=t.call(this)||this;return i.opacity=.75,i.bounds=e,i.image=n,i.map=r,i}return Pe(e,t),e.prototype.add=function(){this.setMap(this.map)},e.prototype.remove=function(){this.setMap(null)},e.prototype.setOpacity=function(t){this.opacity=t,this.div_&&(this.div_.style.opacity=t)},e.prototype.getOpacity=function(){return this.opacity},e.prototype.onAdd=function(){var t=document.createElement("div");t.style.borderStyle="none",t.style.borderWidth="0px",t.style.position="absolute";var e=document.createElement("img");e.src=this.image,e.style.width="100%",e.style.height="100%",e.style.position="absolute",t.appendChild(e),this.div_=t,this.getPanes().overlayLayer.appendChild(t),this.setOpacity(this.opacity)},e.prototype.draw=function(){var t=this.getProjection(),e=t.fromLatLngToDivPixel(this.bounds.getSouthWest()),n=t.fromLatLngToDivPixel(this.bounds.getNorthEast()),r=this.div_;r.style.left=e.x+"px",r.style.top=n.y+"px",r.style.width=n.x-e.x+"px",r.style.height=e.y-n.y+"px"},e.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},e}(google.maps.OverlayView)}function l(t){}function c(t){if(!t)return"";var e=[];return Object.keys(t).forEach(function(n){if(t[n]){var r=encodeURIComponent(n),i=encodeURIComponent(t[n]);e.push(r+"="+i)}}),e.join("&")}function u(t){if(!(Math.abs(t.lng())>180||Math.abs(t.lat())>90)){var e=.017453292519943295*t.lng(),n=6378137*e,r=.017453292519943295*t.lat();return{lng:n,lat:3189068.5*Math.log((1+Math.sin(r))/(1-Math.sin(r)))}}}function p(t){return j._38(0,[(t()(),j._16(0,0,null,null,3,"mat-option",[["class","mat-option"],["role","option"]],[[1,"tabindex",0],[2,"mat-selected",null],[2,"mat-option-multiple",null],[2,"mat-active",null],[8,"id",0],[1,"aria-selected",0],[1,"aria-disabled",0],[2,"mat-option-disabled",null]],[[null,"click"],[null,"keydown"]],function(t,e,n){var r=!0;if("click"===e){r=!1!==j._30(t,2)._selectViaInteraction()&&r}if("keydown"===e){r=!1!==j._30(t,2)._handleKeydown(n)&&r}return r},xn.b,xn.a)),j._14(1,16384,null,0,vn.q,[],null,null),j._14(2,49152,[[7,4]],0,vn.o,[j.o,j.h,[2,vn.n]],{value:[0,"value"]},null),(t()(),j._36(3,0,["",""]))],function(t,e){t(e,2,0,e.context.$implicit)},function(t,e){t(e,0,0,j._30(e,2)._getTabIndex(),j._30(e,2).selected,j._30(e,2).multiple,j._30(e,2).active,j._30(e,2).id,j._30(e,2).selected.toString(),j._30(e,2).disabled.toString(),j._30(e,2).disabled),t(e,3,0,e.context.$implicit.title)})}function d(t){return j._38(0,[(t()(),j._16(0,0,null,null,31,"mat-form-field",[["class","refuges-input mat-input-container mat-form-field"]],[[2,"mat-input-invalid",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-focused",null],[2,"mat-primary",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,wn.b,wn.a)),j._14(1,16384,null,0,vn.q,[],null,null),j._14(2,7389184,null,6,Sn.a,[j.o,j.M,j.h,[2,vn.i]],null,null),j._34(335544320,1,{_control:0}),j._34(335544320,2,{_placeholderChild:0}),j._34(603979776,3,{_errorChildren:1}),j._34(603979776,4,{_hintChildren:1}),j._34(603979776,5,{_prefixChildren:1}),j._34(603979776,6,{_suffixChildren:1}),(t()(),j._36(-1,1,["\n            "])),(t()(),j._16(10,16777216,null,1,9,"input",[["aria-autocomplete","list"],["autocomplete","off"],["class","mat-input-element mat-form-field-autofill-control"],["matInput",""],["role","combobox"]],[[1,"aria-activedescendant",0],[1,"aria-expanded",0],[1,"aria-owns",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[1,"id",0],[8,"placeholder",0],[8,"disabled",0],[8,"required",0],[8,"readOnly",0],[1,"aria-describedby",0],[1,"aria-invalid",0]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"focusin"],[null,"keydown"],[null,"focus"]],function(t,e,n){var r=!0;if("input"===e){r=!1!==j._30(t,11)._handleInput(n.target.value)&&r}if("blur"===e){r=!1!==j._30(t,11).onTouched()&&r}if("compositionstart"===e){r=!1!==j._30(t,11)._compositionStart()&&r}if("compositionend"===e){r=!1!==j._30(t,11)._compositionEnd(n.target.value)&&r}if("focusin"===e){r=!1!==j._30(t,12)._handleFocus()&&r}if("blur"===e){r=!1!==j._30(t,12)._onTouched()&&r}if("input"===e){r=!1!==j._30(t,12)._handleInput(n)&&r}if("keydown"===e){r=!1!==j._30(t,12)._handleKeydown(n)&&r}if("blur"===e){r=!1!==j._30(t,18)._focusChanged(!1)&&r}if("focus"===e){r=!1!==j._30(t,18)._focusChanged(!0)&&r}if("input"===e){r=!1!==j._30(t,18)._onInput()&&r}return r},null,null)),j._14(11,16384,null,0,le.d,[j.M,j.o,[2,le.a]],null,null),j._14(12,147456,null,0,Pn.e,[j.o,On.b,j.Y,j.D,j.h,Pn.a,[2,Dn.c],[2,Sn.a],[2,kn.b]],{autocomplete:[0,"autocomplete"]},null),j._33(1024,null,le.k,function(t,e){return[t,e]},[le.d,Pn.e]),j._14(14,540672,null,0,le.g,[[8,null],[8,null],[2,le.k]],{form:[0,"form"]},null),j._33(2048,null,le.l,null,[le.g]),j._14(16,16384,null,0,le.m,[le.l],null,null),j._14(17,16384,null,0,vn.q,[],null,null),j._14(18,933888,null,0,Cn.a,[j.o,j.M,jn.a,[2,le.l],[2,le.o],[2,le.h],vn.c],{placeholder:[0,"placeholder"]},null),j._33(2048,[[1,4]],Sn.b,null,[Cn.a]),(t()(),j._36(-1,1,["\n            "])),(t()(),j._16(21,0,null,1,9,"mat-autocomplete",[["class","mat-autocomplete"]],null,null,null,An.b,An.a)),j._14(22,16384,null,0,vn.q,[],null,null),j._14(23,1097728,[["auto",4]],2,Pn.c,[j.h,j.o],{displayWith:[0,"displayWith"]},null),j._34(603979776,7,{options:1}),j._34(603979776,8,{optionGroups:1}),(t()(),j._36(-1,0,["\n               "])),(t()(),j._10(16777216,null,0,2,null,p)),j._14(28,802816,null,0,Qt.g,[j.Y,j.U,j.x],{ngForOf:[0,"ngForOf"]},null),j._31(131072,Qt.a,[j.h]),(t()(),j._36(-1,0,["\n            "])),(t()(),j._36(-1,1,["\n        "]))],function(t,e){var n=e.component;t(e,12,0,j._30(e,23)),t(e,14,0,n.refugeFormControl),t(e,18,0,n.focused?"Refuge":"Find a refuge"),t(e,23,0,n.refugeTitle),t(e,28,0,j._37(e,28,0,j._30(e,29).transform(n.filteredRefuges)))},function(t,e){t(e,0,1,[j._30(e,2)._control.errorState,j._30(e,2)._control.errorState,j._30(e,2)._canPlaceholderFloat,j._30(e,2)._control.shouldPlaceholderFloat||j._30(e,2)._shouldAlwaysFloat,j._30(e,2)._control.focused,"primary"==j._30(e,2).color,"accent"==j._30(e,2).color,"warn"==j._30(e,2).color,j._30(e,2)._shouldForward("untouched"),j._30(e,2)._shouldForward("touched"),j._30(e,2)._shouldForward("pristine"),j._30(e,2)._shouldForward("dirty"),j._30(e,2)._shouldForward("valid"),j._30(e,2)._shouldForward("invalid"),j._30(e,2)._shouldForward("pending")]),t(e,10,1,[null==j._30(e,12).activeOption?null:j._30(e,12).activeOption.id,j._30(e,12).panelOpen.toString(),null==j._30(e,12).autocomplete?null:j._30(e,12).autocomplete.id,j._30(e,16).ngClassUntouched,j._30(e,16).ngClassTouched,j._30(e,16).ngClassPristine,j._30(e,16).ngClassDirty,j._30(e,16).ngClassValid,j._30(e,16).ngClassInvalid,j._30(e,16).ngClassPending,j._30(e,18).id,j._30(e,18).placeholder,j._30(e,18).disabled,j._30(e,18).required,j._30(e,18).readonly,j._30(e,18)._ariaDescribedby||null,j._30(e,18).errorState])})}function f(t){return j._38(0,[(t()(),j._16(0,0,null,null,3,"mat-option",[["class","mat-option"],["role","option"]],[[1,"tabindex",0],[2,"mat-selected",null],[2,"mat-option-multiple",null],[2,"mat-active",null],[8,"id",0],[1,"aria-selected",0],[1,"aria-disabled",0],[2,"mat-option-disabled",null]],[[null,"click"],[null,"keydown"]],function(t,e,n){var r=!0;if("click"===e){r=!1!==j._30(t,2)._selectViaInteraction()&&r}if("keydown"===e){r=!1!==j._30(t,2)._handleKeydown(n)&&r}return r},xn.b,xn.a)),j._14(1,16384,null,0,vn.q,[],null,null),j._14(2,49152,[[15,4]],0,vn.o,[j.o,j.h,[2,vn.n]],{value:[0,"value"]},null),(t()(),j._36(3,0,["",""]))],function(t,e){t(e,2,0,e.context.$implicit.selection)},function(t,e){t(e,0,0,j._30(e,2)._getTabIndex(),j._30(e,2).selected,j._30(e,2).multiple,j._30(e,2).active,j._30(e,2).id,j._30(e,2).selected.toString(),j._30(e,2).disabled.toString(),j._30(e,2).disabled),t(e,3,0,e.context.$implicit.label)})}function h(t){return j._38(0,[(t()(),j._16(0,0,null,null,24,"mat-form-field",[["class","selection-input mat-input-container mat-form-field"]],[[2,"mat-input-invalid",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-focused",null],[2,"mat-primary",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,wn.b,wn.a)),j._14(1,16384,null,0,vn.q,[],null,null),j._14(2,7389184,null,6,Sn.a,[j.o,j.M,j.h,[2,vn.i]],null,null),j._34(335544320,9,{_control:0}),j._34(335544320,10,{_placeholderChild:0}),j._34(603979776,11,{_errorChildren:1}),j._34(603979776,12,{_hintChildren:1}),j._34(603979776,13,{_prefixChildren:1}),j._34(603979776,14,{_suffixChildren:1}),(t()(),j._36(-1,1,["\n            "])),(t()(),j._16(10,0,null,1,13,"mat-select",[["class","mat-select"],["placeholder","Layer"],["role","listbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[1,"id",0],[1,"tabindex",0],[1,"aria-label",0],[1,"aria-labelledby",0],[1,"aria-required",0],[1,"aria-disabled",0],[1,"aria-invalid",0],[1,"aria-owns",0],[1,"aria-multiselectable",0],[1,"aria-describedby",0],[1,"aria-activedescendant",0],[2,"mat-select-disabled",null],[2,"mat-select-invalid",null],[2,"mat-select-required",null]],[[null,"keydown"],[null,"focus"],[null,"blur"]],function(t,e,n){var r=!0;if("keydown"===e){r=!1!==j._30(t,15)._handleKeydown(n)&&r}if("focus"===e){r=!1!==j._30(t,15)._onFocus()&&r}if("blur"===e){r=!1!==j._30(t,15)._onBlur()&&r}return r},Ln.b,Ln.a)),j._14(11,540672,null,0,le.g,[[8,null],[8,null],[8,null]],{form:[0,"form"]},null),j._33(2048,null,le.l,null,[le.g]),j._14(13,16384,null,0,le.m,[le.l],null,null),j._14(14,16384,null,0,vn.q,[],null,null),j._14(15,1294336,null,3,Mn.c,[Rn.f,j.h,j.D,vn.c,j.M,j.o,[2,Dn.c],[2,le.o],[2,le.h],[2,Sn.a],[2,le.l],[8,null],Mn.a],{placeholder:[0,"placeholder"]},null),j._34(603979776,15,{options:1}),j._34(603979776,16,{optionGroups:1}),j._34(335544320,17,{customTrigger:0}),j._33(2048,[[9,4]],Sn.b,null,[Mn.c]),(t()(),j._36(-1,1,["\n                "])),(t()(),j._10(16777216,null,1,1,null,f)),j._14(22,802816,null,0,Qt.g,[j.Y,j.U,j.x],{ngForOf:[0,"ngForOf"]},null),(t()(),j._36(-1,1,["\n            "])),(t()(),j._36(-1,1,["\n        "]))],function(t,e){var n=e.component;t(e,11,0,n.selectionFormControl);t(e,15,0,"Layer"),t(e,22,0,n.selections)},function(t,e){t(e,0,1,[j._30(e,2)._control.errorState,j._30(e,2)._control.errorState,j._30(e,2)._canPlaceholderFloat,j._30(e,2)._control.shouldPlaceholderFloat||j._30(e,2)._shouldAlwaysFloat,j._30(e,2)._control.focused,"primary"==j._30(e,2).color,"accent"==j._30(e,2).color,"warn"==j._30(e,2).color,j._30(e,2)._shouldForward("untouched"),j._30(e,2)._shouldForward("touched"),j._30(e,2)._shouldForward("pristine"),j._30(e,2)._shouldForward("dirty"),j._30(e,2)._shouldForward("valid"),j._30(e,2)._shouldForward("invalid"),j._30(e,2)._shouldForward("pending")]),t(e,10,1,[j._30(e,13).ngClassUntouched,j._30(e,13).ngClassTouched,j._30(e,13).ngClassPristine,j._30(e,13).ngClassDirty,j._30(e,13).ngClassValid,j._30(e,13).ngClassInvalid,j._30(e,13).ngClassPending,j._30(e,15).id,j._30(e,15).tabIndex,j._30(e,15)._ariaLabel,j._30(e,15).ariaLabelledby,j._30(e,15).required.toString(),j._30(e,15).disabled.toString(),j._30(e,15).errorState,j._30(e,15)._optionIds,j._30(e,15).multiple,j._30(e,15)._ariaDescribedby||null,j._30(e,15)._getAriaActiveDescendant(),j._30(e,15).disabled,j._30(e,15).errorState,j._30(e,15).required])})}function g(t){return j._38(0,[(t()(),j._16(0,16777216,null,null,5,"button",[["class","reset-button mat-icon-button"],["mat-icon-button",""],["matTooltip","Reset map"]],[[8,"disabled",0]],[[null,"click"],[null,"longpress"],[null,"focus"],[null,"blur"],[null,"keydown"],[null,"touchend"]],function(t,e,n){var r=!0,i=t.component;if("longpress"===e){r=!1!==j._30(t,4).show()&&r}if("focus"===e){r=!1!==j._30(t,4).show()&&r}if("blur"===e){r=!1!==j._30(t,4).hide(0)&&r}if("keydown"===e){r=!1!==j._30(t,4)._handleKeydown(n)&&r}if("touchend"===e){r=!1!==j._30(t,4).hide(1500)&&r}if("click"===e){r=!1!==i.reset()&&r}return r},Fn.b,Fn.a)),j._14(1,16384,null,0,vn.q,[],null,null),j._14(2,180224,null,0,zn.b,[j.M,j.o,jn.a,Tn.g],null,null),j._14(3,16384,null,0,zn.d,[],null,null),j._14(4,147456,null,0,En.c,[j.M,On.b,j.o,Rn.c,j.Y,j.D,jn.a,Tn.e,En.a,[2,Dn.c]],{message:[0,"message"]},null),(t()(),j._16(5,0,null,0,0,"i",[["aria-hidden","true"],["class","fa fa-refresh"]],null,null,null,null,null)),(t()(),j._10(0,null,null,0))],function(t,e){t(e,4,0,"Reset map")},function(t,e){t(e,0,0,j._30(e,2).disabled||null)})}function y(t){return j._38(0,[(t()(),j._16(0,0,null,null,4,"div",[["class","vis-working"]],null,null,null,null,null)),(t()(),j._36(-1,null,["\n            "])),(t()(),j._16(2,0,null,null,1,"mat-progress-spinner",[["class","mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[4,"width","px"],[4,"height","px"],[1,"aria-valuemin",0],[1,"aria-valuemax",0],[1,"aria-valuenow",0],[1,"mode",0]],null,null,In.b,In.a)),j._14(3,573440,null,0,Un.a,[j.M,j.o,jn.a,[2,Qt.c]],{mode:[0,"mode"]},null),(t()(),j._36(-1,null,["\n        "]))],function(t,e){t(e,3,0,"indeterminate")},function(t,e){t(e,2,0,j._30(e,3)._elementSize,j._30(e,3)._elementSize,"determinate"===j._30(e,3).mode?0:null,"determinate"===j._30(e,3).mode?100:null,j._30(e,3).value,j._30(e,3).mode)})}function m(t){return j._38(0,[(t()(),j._16(0,0,null,null,2,"agm-marker",[["iconUrl","https://fws.usanpn.org/sites/fws.usanpn.org/libraries/gmap_markers/marker-1.png"]],null,[[null,"markerClick"]],function(t,e,n){var r=!0,i=t.component;if("markerClick"===e){r=!1!==i.refugeClick(t.context.$implicit)&&r}return r},null,null)),j._14(1,1720320,null,1,Nn.a,[Bn.a],{latitude:[0,"latitude"],longitude:[1,"longitude"],title:[2,"title"],iconUrl:[3,"iconUrl"]},{markerClick:"markerClick"}),j._34(603979776,18,{infoWindow:1})],function(t,e){t(e,1,0,e.context.$implicit.location.lat,e.context.$implicit.location.lng,e.context.$implicit.title,"https://fws.usanpn.org/sites/fws.usanpn.org/libraries/gmap_markers/marker-1.png")},null)}function _(t){return j._38(0,[(t()(),j._16(0,0,null,null,4,"span",[],null,null,null,null,null)),(t()(),j._36(-1,null,["\n                "])),(t()(),j._10(16777216,null,null,1,null,m)),j._14(3,802816,null,0,Qt.g,[j.Y,j.U,j.x],{ngForOf:[0,"ngForOf"]},null),(t()(),j._36(-1,null,["\n            "]))],function(t,e){t(e,3,0,e.component.refuges)},null)}function v(t){return j._38(0,[(t()(),j._16(0,0,null,null,1,"wms-map-legend",[],null,null,null,qn.b,qn.a)),j._14(1,4898816,null,0,Vn.a,[Yn.a,j.o],{legend:[0,"legend"]},null)],function(t,e){t(e,1,0,e.component.selection.legend)},null)}function b(t){return j._38(0,[(t()(),j._16(0,0,null,null,1,"clipped-wms-map-statistics",[],null,null,null,Wn.b,Wn.a)),j._14(1,311296,null,0,cn.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.selection)},null)}function x(t){return j._38(0,[(t()(),j._16(0,0,null,null,4,"p",[],null,null,null,null,null)),(t()(),j._36(-1,null,["\n            How is the Status of Spring impacting phenology of plants and animals at your Refuge?\n            Visit the "])),(t()(),j._16(2,0,null,null,1,"a",[],[[8,"href",4],[8,"title",0]],null,null,null,null)),(t()(),j._36(3,null,[""," Dashboard"])),(t()(),j._36(-1,null,[" to find out!"]))],null,function(t,e){var n=e.component;t(e,2,0,n.focused.links.dashboard,n.focused.title+"Dashboard"),t(e,3,0,n.focused.title)})}function w(t){return j._38(0,[(t()(),j._16(0,0,null,null,12,"span",[],null,null,null,null,null)),(t()(),j._36(-1,null,["\n            "])),(t()(),j._16(2,0,null,null,4,"p",[],null,null,null,null,null)),(t()(),j._36(-1,null,["Refuges across the country are using "])),(t()(),j._16(4,0,null,null,1,"a",[["alt","Nature's Notebook"],["href","https://www.usanpn.org/natures_notebook"],["title","Nature's Notebook"]],null,null,null,null,null)),(t()(),j._36(-1,null,["Nature\u2019s Notebook"])),(t()(),j._36(-1,null,[" to learn about how the Status of Spring is impacting phenology of plants and animals at their refuges."])),(t()(),j._36(-1,null,["\n            "])),(t()(),j._16(8,0,null,null,3,"p",[],null,null,null,null,null)),(t()(),j._16(9,0,null,null,1,"a",[["alt","Start a project"],["href","/project"],["title","Start a project"]],null,null,null,null,null)),(t()(),j._36(-1,null,["Start a phenology monitoring project"])),(t()(),j._36(-1,null,[" at your refuge to better understand phenological changes of your species of interest!"])),(t()(),j._36(-1,null,["\n        "]))],null,null)}function S(t){return j._38(0,[(t()(),j._16(0,0,null,null,7,"div",[["class","refuge-statement"]],null,null,null,null,null)),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,x)),j._14(3,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,w)),j._14(6,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,3,0,n.focused.partner),t(e,6,0,!n.focused.partner)},null)}function P(t){return j._38(0,[(t()(),j._36(-1,null,["\n    "])),(t()(),j._16(1,0,null,null,14,"form",[["class","control-form"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(t,e,n){var r=!0;if("submit"===e){r=!1!==j._30(t,3).onSubmit(n)&&r}if("reset"===e){r=!1!==j._30(t,3).onReset()&&r}return r},null,null)),j._14(2,16384,null,0,le.r,[],null,null),j._14(3,16384,null,0,le.o,[[8,null],[8,null]],null,null),j._33(2048,null,le.c,null,[le.o]),j._14(5,16384,null,0,le.n,[le.c],null,null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,d)),j._14(8,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,h)),j._14(11,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,g)),j._14(14,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n    "])),(t()(),j._36(-1,null,["\n\n    "])),(t()(),j._16(17,0,null,null,25,"div",[["class","map-wrapper"]],null,null,null,null,null)),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,y)),j._14(20,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._16(22,0,null,null,13,"agm-map",[],[[2,"sebm-google-map-container",null]],[[null,"mapReady"]],function(t,e,n){var r=!0,i=t.component;if("mapReady"===e){r=!1!==i.mapReady(n)&&r}return r},Jn.b,Jn.a)),j._33(4608,null,Bn.a,Bn.a,[Xn.a,j.D]),j._33(4608,null,Zn.a,Zn.a,[Xn.a,j.D,Bn.a]),j._33(4608,null,Qn.a,Qn.a,[Xn.a,j.D]),j._33(4608,null,tr.a,tr.a,[Xn.a,j.D]),j._33(4608,null,er.a,er.a,[Xn.a,j.D]),j._33(4608,null,nr.a,nr.a,[Xn.a,j.D]),j._33(4608,null,rr.a,rr.a,[Xn.a,j.D]),j._33(512,null,Xn.a,Xn.a,[ir.a,j.D]),j._14(31,770048,null,0,or.a,[j.o,Xn.a],{longitude:[0,"longitude"],latitude:[1,"latitude"],zoom:[2,"zoom"],scrollwheel:[3,"scrollwheel"],styles:[4,"styles"],streetViewControl:[5,"streetViewControl"]},{mapReady:"mapReady"}),(t()(),j._36(-1,0,["\n            "])),(t()(),j._10(16777216,null,0,1,null,_)),j._14(34,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,0,["\n        "])),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,v)),j._14(38,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(16777216,null,null,1,null,b)),j._14(41,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n    "])),(t()(),j._36(-1,null,["\n    "])),(t()(),j._10(16777216,null,null,1,null,S)),j._14(45,16384,null,0,Qt.h,[j.Y,j.U],{ngIf:[0,"ngIf"]},null),(t()(),j._36(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,8,0,n.refuges),t(e,11,0,n.selections),t(e,14,0,n.selection),t(e,20,0,n.selection&&n.selection.working);t(e,31,0,n.longitude,n.latitude,n.zoom,!1,n.mapStyles,!1),t(e,34,0,!n.focused),t(e,38,0,n.selection&&n.selection.legend),t(e,41,0,n.selection&&n.selection.data&&n.selection.data.statistics),t(e,45,0,n.focused)},function(t,e){t(e,1,0,j._30(e,5).ngClassUntouched,j._30(e,5).ngClassTouched,j._30(e,5).ngClassPristine,j._30(e,5).ngClassDirty,j._30(e,5).ngClassValid,j._30(e,5).ngClassInvalid,j._30(e,5).ngClassPending);t(e,22,0,!0)})}function O(t){return j._38(0,[(t()(),j._16(0,0,null,null,1,"status-of-spring",[],null,null,null,P,sr)),j._14(1,245760,null,0,Hn,[gn,on],null,null)],function(t,e){t(e,1,0)},null)}function D(t){return j._38(0,[(t()(),j._36(-1,null,["\n            "])),(t()(),j._16(1,0,null,null,4,"div",[["class","spring-tab-label current-spring"]],null,null,null,null,null)),(t()(),j._36(-1,null,["\n                "])),(t()(),j._16(3,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),j._36(-1,null,["Current Status of Spring"])),(t()(),j._36(-1,null,["\n            "])),(t()(),j._36(-1,null,["\n        "]))],null,null)}function k(t){return j._38(0,[(t()(),j._36(-1,null,["\n  "])),(t()(),j._16(1,0,null,null,14,"mat-tab-group",[["class","spring-dashboard-tabs"]],null,[[null,"selectedTabChange"]],function(t,e,n){var r=!0,i=t.component;if("selectedTabChange"===e){r=!1!==i.selectedTabChange(n)&&r}return r},null,null)),j._14(2,16384,null,0,vn.q,[],null,null),(t()(),j._36(-1,null,["\n    "])),(t()(),j._16(4,0,null,null,10,"mat-tab",[["label","Current Status of Spring"]],null,null,null,null,null)),j._14(5,16384,null,0,vn.q,[],null,null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._10(0,null,null,0,null,D)),(t()(),j._36(-1,null,["\n        "])),(t()(),j._16(9,0,null,null,4,"div",[["class","spring-tab-content"]],null,null,null,null,null)),(t()(),j._36(-1,null,["\n            "])),(t()(),j._16(11,0,null,null,1,"status-of-spring",[],null,null,null,P,sr)),j._14(12,245760,null,0,Hn,[gn,on],null,null),(t()(),j._36(-1,null,["\n        "])),(t()(),j._36(-1,null,["\n    "])),(t()(),j._36(-1,null,["\n  "])),(t()(),j._36(-1,null,["\n  "]))],function(t,e){t(e,12,0)},null)}function C(t){return j._38(0,[(t()(),j._16(0,0,null,null,1,"spring-dashboard",[],null,null,null,k,cr)),j._14(1,114688,null,0,yn,[j.o,gn],null,null)],function(t,e){t(e,1,0)},null)}Object.defineProperty(e,"__esModule",{value:!0});var j=n("/oeL"),A=n("OpsG"),L=function(){function t(){}return t}();A.a.production&&Object(j._2)();var M,R=n("CPp0"),F=(n("82j9"),n("4Y6l")),z=(n("qhHO"),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),T=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},E=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},I=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.RESET=0]="RESET",t[t.REDRAW=1]="REDRAW",t[t.UPDATE=2]="UPDATE",t[t.RESIZE=3]="RESIZE"}(M||(M={}));var U=Symbol("npnSelectionProperty"),N=function(t){return t},B=(function(){function t(){}}(),function(t){var e=T({des:N,ser:N},t||{});return Reflect.metadata(U,e)}),q=function(t,e){var n=Reflect.getMetadata(U,t,e);return n||(n=Reflect.getMetadata(U,t,"_"+e)),n},V="invalid selection",Y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="VisSelection",e.guid=F.c.newGuid(),e.meta={},e.debug=!1,e.working=!1,e.editMode=!1,e.INVALID_SELECTION=V,e.lastEmit={},e.firstSubscriber=new Promise(function(t){e.firstSubscriberResolver=t}),e}return z(e,t),Object.defineProperty(e.prototype,"external",{get:function(){return o.apply(this,arguments)},set:function(t){a.apply(this,arguments)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.emit(M.RESET)},e.prototype.redraw=function(){this.emit(M.REDRAW)},e.prototype.update=function(){this.emit(M.UPDATE)},e.prototype.resize=function(){this.emit(M.RESIZE)},e.prototype.handleError=function(t){console.error(t),this.working=!1},e.prototype.emit=function(e){var n=this,r=arguments,i={value:e,when:Date.now(),ext:JSON.stringify(this.external)};this.lastEmit.value!==i.value||this.lastEmit.ext!==i.ext||this.lastEmit.when<i.when-500?(this.lastEmit=i,console.log("letting event through",i),this.firstSubscriber.then(function(){t.prototype.emit.apply(n,r)})):console.log("pruned out redundant event",i)},e.prototype.subscribe=function(e,n,r){return this.firstSubscriberResolver(),t.prototype.subscribe.apply(this,arguments)},e}(j.q);E([B(),I("design:type",String)],Y.prototype,"$class",void 0),E([B(),I("design:type",String)],Y.prototype,"guid",void 0),E([B(),I("design:type",Object)],Y.prototype,"meta",void 0);var W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.networkIds=[],e}return z(e,t),e.prototype.addNetworkParams=function(t){if(t instanceof R.i){var e=t;(this.networkIds||[]).forEach(function(t,n){return e.set("network_id["+n+"]",""+t)})}else t&&"object"==typeof t&&(this.networkIds||[]).forEach(function(e,n){return t["network_id["+n+"]"]=""+e});return t},e}(Y);E([B(),I("design:type",Array)],W.prototype,"networkIds",void 0);var G=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stationIds=[],e}return z(e,t),e.prototype.addNetworkParams=function(e){if(t.prototype.addNetworkParams.call(this,e),e instanceof R.i){var n=e;(this.stationIds||[]).forEach(function(t,e){return n.set("station_ids["+e+"]",""+t)})}else e&&"object"==typeof e&&(this.stationIds||[]).forEach(function(t,n){return e["station_ids["+n+"]"]=""+t});return e},e}(W);E([B(),I("design:type",Array)],G.prototype,"stationIds",void 0);var $=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),K=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},H=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},J=function(t){function e(e,n,r){var i=t.call(this)||this;return i.http=e,i.cacheService=n,i.config=r,i.headers=new R.d({"Content-Type":"application/x-www-form-urlencoded"}),i.individualPhenometrics=!1,i}return $(e,t),e.prototype.filterSuspectSummaryData=function(t){var e=0===t.latitude||0===t.longitude||t.elevation_in_meters<0;return e&&console.warn("suspect station data",t),!e},e.prototype.filterLqSummaryData=function(t){var e=t.numdays_since_prior_no>=0;return e||console.debug("filtering less precise data from summary output",t),e},e.prototype.filterLqSiteData=function(t){var e=t.mean_numdays_since_prior_no>=0;return e||console.debug("filtering less precise data from site level output",t),e},e.prototype.getData=function(){var t=this;if(!this.isValid())return Promise.reject(this.INVALID_SELECTION);var e=this.toURLSearchParams(),n=this.config.apiRoot+"/npn_portal/observations/"+(this.individualPhenometrics?"getSummarizedData":"getSiteLevelData")+".json",r={u:n,params:e.toString()},i=this.cacheService.get(r),o=this.individualPhenometrics?function(e){var n=e.filter(t.filterSuspectSummaryData),r=A.a.appConfig.filterLqdSummary?n.filter(t.filterLqSummaryData):n,i=r.reduce(function(t,e){var n=e.individual_id+"/"+e.phenophase_id+"/"+e.first_yes_year;return t[n]=t[n]||[],t[n].push(e),t},{}),o=[];console.debug("filtered out "+(e.length-n.length)+"/"+e.length+" suspect records"),console.debug("filtered out "+(n.length-r.length)+"/"+n.length+" LQD records.");for(var a in i){var s=i[a];s.length>1&&s.sort(function(t,e){return t.first_yes_doy-e.first_yes_doy}),o.push(s[0])}return console.debug("filtered out "+(r.length-o.length)+"/"+r.length+" individual records (preferring lowest first_yes_doy)"),t.filterDisclaimer=n.length!==r.length?A.a.appConfig.filterLqdDisclaimer:void 0,r}:function(e){var n=e.filter(t.filterSuspectSummaryData),r=A.a.appConfig.filterLqdSummary?n.filter(t.filterLqSiteData):n;return console.debug("filtered out "+(e.length-n.length)+"/"+e.length+" suspect records"),console.debug("filtered out "+(n.length-r.length)+"/"+n.length+" LQD records."),t.filterDisclaimer=n.length!==r.length?A.a.appConfig.filterLqdDisclaimer:void 0,r};return i?(console.log("found in cache",i),Promise.resolve(o(i))):(this.working=!0,this.http.post(n,e.toString(),{headers:this.headers}).toPromise().then(function(e){var n=e.json();t.cacheService.set(r,n);var i=o(n);return t.working=!1,i}).catch(this.handleError))},e}(G);K([B(),H("design:type",Boolean)],J.prototype,"individualPhenometrics",void 0),K([B(),H("design:type",String)],J.prototype,"filterDisclaimer",void 0);var X=n("ckYf"),Z=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Q=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},tt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},et={daylength:"mean_daylength",acc_prcp:"mean_accum_prcp",gdd:"mean_gdd"},nt=[{key:"latitude",label:"Latitude",axisFmt:X.i(".2f")},{key:"longitude",label:"Longitude",axisFmt:X.i(".2f")},{key:"elevation_in_meters",label:"Elevation (m)"},{key:"fyy",label:"Year"},{key:"prcp_fall",label:"Precip Fall (mm)"},{key:"prcp_spring",label:"Precip Spring (mm)"},{key:"prcp_summer",label:"Precip Summer (mm)"},{key:"prcp_winter",label:"Precip Winter (mm)"},{key:"tmax_fall",label:"Tmax Fall (C\xb0)"},{key:"tmax_spring",label:"Tmax Spring (C\xb0)"},{key:"tmax_summer",label:"Tmax Summer (C\xb0)"},{key:"tmax_winter",label:"Tmax Winter (C\xb0)"},{key:"tmin_fall",label:"Tmin Fall (C\xb0)"},{key:"tmin_spring",label:"Tmin Spring (C\xb0)"},{key:"tmin_summer",label:"Tmin Summer (C\xb0)"},{key:"tmin_winter",label:"Tmin Winter (C\xb0)"},{key:"daylength",label:"Day Length (s)"},{key:"acc_prcp",label:"Accumulated Precip (mm)"},{key:"gdd",label:"AGDD"}],rt=(new Date,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="ScatterPlotSelection",e.start=2010,e.end=(new Date).getFullYear(),e.regressionLines=!1,e.axis=nt[0],e.plots=[],e.d3DateFormat=X.n("%x"),e}return Z(e,t),e.prototype.isValid=function(){return this.start&&this.end&&this.start<this.end&&this.validPlots.length>0},Object.defineProperty(e.prototype,"validPlots",{get:function(){return this.plots.filter(function(t){return t.color&&t.species&&t.phenophase})},enumerable:!0,configurable:!0}),e.prototype.toURLSearchParams=function(){var t=new R.i;return t.set("climate_data","1"),t.set("request_src","npn-vis-scatter-plot"),t.set("start_date",this.start+"-01-01"),t.set("end_date",this.end+"-12-31"),t.set("num_days_quality_filter",""+A.a.appConfig.num_days_quality_filter),this.validPlots.forEach(function(e,n){t.set("species_id["+n+"]",""+e.species.species_id),t.set("phenophase_id["+n+"]",""+e.phenophase.phenophase_id)}),this.addNetworkParams(t),t},e.prototype.doyDateFormat=function(t){var e=new Date(this.start,0,1),n=864e5*(t-1)+e.getTime(),r=new Date(n);return this.d3DateFormat(r)},e.prototype.getDoy=function(t){return this.individualPhenometrics?t.first_yes_doy:t.mean_first_yes_doy},e.prototype.getFirstYesYear=function(t){return this.individualPhenometrics?t.first_yes_year:t.mean_first_yes_year},e.prototype.axisData=function(t){return t[this.axis.key]},e.prototype.axisNonNull=function(t){var e=this;return t.filter(function(t){return-9999!==e.axisData(t)})},e.prototype.postProcessData=function(t){var e=this,n=function(t){return t.species_id+":"+t.phenophase_id},r=this.validPlots.reduce(function(t,e){return t[e.species.species_id+":"+e.phenophase.phenophase_id]=e.color,t},{}),i=this.start,o=t.filter(function(t,o){if(!(t.color=r[n(t)]))return!1;t.id=o,t.fyy=e.getFirstYesYear(t);for(var a in et){var s=et[a];void 0===t[a]&&(t[a]=t[s])}return t.day_in_range=365*(t.fyy-i)+e.getDoy(t),!0});return this.working=!1,o},e}(J));Q([B(),tt("design:type",String)],rt.prototype,"$class",void 0),Q([B(),tt("design:type",Number)],rt.prototype,"start",void 0),Q([B(),tt("design:type",Number)],rt.prototype,"end",void 0),Q([B(),tt("design:type",Boolean)],rt.prototype,"regressionLines",void 0),Q([B(),tt("design:type",Object)],rt.prototype,"axis",void 0),Q([B({ser:function(t){return{color:t.color,species:t.species,phenophase:t.phenophase}}}),tt("design:type",Array)],rt.prototype,"plots",void 0);var it=function(){function t(t,e,n){this.http=t,this.cacheService=e,this.config=n}return t.prototype.newSelection=function(){return new rt(this.http,this.cacheService,this.config)},t.ctorParameters=function(){return[{type:R.e},{type:F.a},{type:F.i,decorators:[{type:j.s,args:[F.f]}]}]},t}(),ot=n("zQfh"),at=n("bKpL"),st=(n("Xtvq"),n("azLz"),function(){function t(t,e,n){var r=this;this.window=t,this.rootElement=e,this.media=n,this.thumbnail=!1,this.id="visualization-"+Math.floor(1e3*Math.random()),this.clazz="visualization "+this.constructor.name,this.margins={top:0,right:0,left:0,bottom:0},this.mobileMode=!1,this.mediaSubscription=this.media.subscribe(function(t){r.mobileMode="xs"===t.mqAlias||"sm"===t.mqAlias}),this.isIE=!!Object(F.o)()}return t.prototype.getSizeInfo=function(t){var e=this.rootElement.nativeElement,n=e.parentElement,r=function(t){return parseInt(t.replace(/px$/,""))},i=getComputedStyle(n,null),o=r(i.paddingLeft)+r(i.borderLeftWidth),a=r(i.paddingRight)+r(i.borderRightWidth),s=n.clientWidth-o-a,l=this.margins,c=Math.floor(s),u=c;t&&c<t&&(c=t);var p=Math.floor(.5376*c),d=c-l.left-l.right,f=p-l.top-l.bottom;return isNaN(d)&&(d=0),isNaN(f)&&(f=0),this.sizing={scaledWidth:u,width:d,height:f,margin:l}},t.prototype.reset=function(){throw new Error("abstract")},t.prototype.redraw=function(){throw new Error("abstract")},t.prototype.update=function(){throw new Error("abstract")},t.prototype.resize=function(){throw new Error("abstract")},t.prototype.ngAfterViewInit=function(){var t=this;console.debug("visualization.ngAfterViewInit"),this.resizeSubscription=at.Observable.fromEvent(window,"resize").debounceTime(500).subscribe(function(e){t.resize()}),this.subscription=this.selection.subscribe(function(e){switch(e){case M.RESET:return t.reset();case M.REDRAW:return t.redraw();case M.UPDATE:return t.update();case M.RESIZE:return t.resize()}})},t.prototype.ngOnDestroy=function(){console.debug("visualization.ngOnDestroy"),this.subscription&&this.subscription.unsubscribe(),this.resizeSubscription&&this.resizeSubscription.unsubscribe(),this.mediaSubscription&&this.mediaSubscription.unsubscribe()},t.prototype.handleError=function(t){t&&t!==V&&console.error(t)},t.ctorParameters=function(){return[{type:F.n},{type:j.o},{type:ot.j}]},t}()),lt=(function(){function t(){}}(),function(){function t(){}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ct={top:20,right:30,bottom:60,left:40},ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="visualization.png",e.margins=ct,e.minWidth=700,e}return lt(e,t),e.prototype.baseFontSize=function(t){return t?"14px":14},e.prototype.commonUpdates=function(){var t=this.chart,e=this.baseFontSize(!0);[".axis path",".axis line"].forEach(function(e){return t.selectAll(e).style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges")}),t.selectAll("text").style("font-family","Arial"),t.selectAll("g .axis text").style("font-size",e)},e.prototype.reset=function(){var t=this.getSizeInfo(),e=this.svg,n=t.width+t.margin.left+t.margin.right,r=t.height+t.margin.top+t.margin.bottom;e.selectAll("*").remove(),e.attr("width",n).attr("height",r).attr("viewBox","0 0 "+n+" "+r).attr("preserveAspectRatio","xMidYMid meet"),e.append("g").attr("class","vis-background").append("rect").attr("width","100%").attr("height","100%").attr("fill","#fff"),this.chart=e.append("g").attr("transform","translate("+t.margin.left+","+t.margin.top+")").attr("class","vis-chart"),e.append("g").attr("transform","translate(10,"+(t.height+t.margin.top+t.margin.bottom-10)+")").append("text").attr("font-size","11px").attr("font-style","italic").attr("text-anchor","right").text("USA National Phenology Network, www.usanpn.org")},e.prototype.resize=function(){this.reset(),this.redraw()},e.prototype.selectElements=function(){this.visRoot=X.m("#"+this.id),this.svg=this.visRoot.select("svg")},e.prototype.getSizeInfo=function(e){return this.selectElements(),t.prototype.getSizeInfo.call(this,this.minWidth)},e.prototype.redraw=function(){this.redrawSvg();var t=this.sizing;if(t.width+t.margin.left+t.margin.right===this.minWidth){var e=this.rootElement.nativeElement,n=e.querySelector("svg.svg-visualization"),r=X.m(n),i=+r.attr("height"),o=t.scaledWidth/this.minWidth;r.attr("width",t.scaledWidth),r.attr("height",Math.round(i*o))}else this.thumbnailSrc=void 0},e.prototype.redrawSvg=function(){throw new Error("abstract")},e.prototype.ngAfterViewInit=function(){this.selectElements(),t.prototype.ngAfterViewInit.call(this)},e}(st),pt=n("Iake"),dt=n("ytvl"),ft=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ht=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},gt=(function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o.window=e,o.rootElement=n,o.media=r,o.speciesTitle=i,o.defaultAxisFormat=X.i("d"),o.dateFormat=X.n("%x"),o.filename="scatter-plot.png",o.margins=ht({},ct,{top:80,left:60}),o}ft(e,t),e.prototype.reset=function(){var e=this;t.prototype.reset.call(this);var n=this.chart,r=this.sizing,i=r.width<this.minWidth?this.sizing.width/3*2:this.sizing.width/2;this.title=n.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x",i).style("text-anchor","middle").style("font-size","18px"),this.x=Object(dt.b)().range([0,r.width]).domain([0,100]),this.xAxis=Object(pt.a)(this.x).tickFormat(function(t){return e.defaultAxisFormat(t)}),this.y=Object(dt.b)().range([r.height,0]).domain([1,365]),this.yAxis=Object(pt.b)(this.y),n.append("g").attr("class","x axis").attr("transform","translate(0,"+r.height+")").call(this.xAxis),n.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",r.height/2*-1).style("text-anchor","middle").text("Onset Day of Year"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(function(e){return t.handleError(e)})},e.prototype.redrawSvg=function(){var t=this;if(this.data){this.disclaimer=this.selection.filterDisclaimer;var e=this.selection.postProcessData(this.data),n=this.selection,r=n.axisNonNull(e),i=function(t){return n.axisData(t)},o=function(t){return n.getDoy(t)},a=X.h(r,i),s=n.axis.axisFmt||this.defaultAxisFormat;this.title.text(n.start+" - "+n.end),this.x.domain([a[0]-1,a[1]+1]),this.xAxis.scale(this.x).tickFormat(X.i(".2f"));var l=this.chart.selectAll("g .x.axis");l.call(this.xAxis.tickFormat(s)),l.selectAll(".axis-label").remove(),l.append("text").attr("class","axis-label").attr("x",this.sizing.width/2).attr("dy","3em").attr("fill","#000").style("text-anchor","middle").style("font-size","12px").text(this.selection.axis.label),this.chart.selectAll(".circle").remove();if(this.chart.selectAll(".circle").data(r,function(t){return t.id}).enter().append("circle").attr("class","circle").style("stroke","#333").style("stroke-width","1").attr("cx",function(e){return t.x(i(e))}).attr("cy",function(e){return t.y(o(e))}).attr("r","5").attr("fill",function(t){return t.color}).on("click",function(e){X.g.defaultPrevented||(t.record=e)}).append("title").text(function(t){return n.doyDateFormat(t.day_in_range)+" ["+t.latitude+","+t.longitude+"]"}),this.chart.selectAll(".regression").remove(),n.validPlots.forEach(function(t){return delete t.regressionLine}),this.selection.regressionLines){var c=[];n.validPlots.forEach(function(t){var e=r.filter(function(e){return e.color===t.color});e.length&&c.push(t.regressionLine=new gt(t.species.species_id+"."+t.phenophase.phenophase_id,t.color,e,i,o))});this.chart.selectAll(".regression").data(c,function(t){return t.id}).enter().append("line").attr("class","regression").attr("x1",function(e){return t.x(e.p1[0])}).attr("y1",function(e){return t.y(e.p1[1])}).attr("x2",function(e){return t.x(e.p2[0])}).attr("y2",function(e){return t.y(e.p2[1])}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.color}).attr("stroke-width",2)}this.chart.select(".legend").remove();var u=this.chart.append("g").attr("class","legend").attr("transform","translate(0,-"+(this.sizing.margin.top-10)+")").style("font-size","1em");this.selection.validPlots.forEach(function(e,n){var r=u.append("g").attr("class","legend-item").attr("transform","translate(10,"+((n+1)*t.baseFontSize()+4*n)+")"),i=t.speciesTitle.transform(e.species)+"/"+e.phenophase.phenophase_name;e.regressionLine&&"number"==typeof e.regressionLine.r2&&(t.isIE?i+=" (R2 "+e.regressionLine.r2.toFixed(2)+")":i+=' (R<tspan style="baseline-shift: super; font-size: 0.65em;">2</tspan> '+e.regressionLine.r2.toFixed(2)+")"),r.append("circle").attr("r",5).attr("fill",e.color);var o=r.append("text").style("font-size",t.baseFontSize(!0)).attr("x",8).attr("y",2.5);t.isIE?o.text(i):o.html(i)}),this.commonUpdates()}},e.ctorParameters=function(){return[{type:F.n},{type:j.o},{type:ot.j},{type:F.m}]}}(ut),function(){function t(t,e,n,r,i){var o=n.sort(function(t,e){return r(t)-r(e)}),a=function(t){return"number"==typeof t},s=o.map(r).filter(a),l=o.map(i).filter(a),c=this.leastSquares(s,l),u=s[0],p=this.approxY(c,u),d=s[s.length-1],f=this.approxY(c,d);this.id=t,this.color=e,this.p1=[u,p],this.p2=[d,f],this.r2=c[2]}return t.prototype.leastSquares=function(t,e){if(0===t.length||0===e.length)return[Number.NaN,Number.NaN,Number.NaN];var n=function(t,e){return t+e},r=1*t.reduce(n)/t.length,i=1*e.reduce(n)/e.length,o=t.map(function(t){return Math.pow(t-r,2)}).reduce(n),a=e.map(function(t){return Math.pow(t-i,2)}).reduce(n),s=t.map(function(t,n){return(t-r)*(e[n]-i)}).reduce(n),l=s/o;return[l,i-r*l,Math.pow(s,2)/(o*a)]},t.prototype.approxY=function(t,e){return t[1]+t[0]*e},t}()),yt=(function(){function t(){this.axis=nt,this.updateSent=!1}t.prototype.ngOnInit=function(){0===this.selection.plots.length&&this.addPlot()},t.prototype.updateChange=function(){this.selection.isValid()&&(this.selection.update(),this.updateSent=!0)},t.prototype.redrawChange=function(t){this.selection.isValid()&&(t&&!t.oldValue&&t.newValue?this.updateChange():this.updateSent?this.selection.redraw():this.updateChange())},t.prototype.addPlot=function(){this.selection.plots.push({})},t.prototype.removePlot=function(t){this.selection.plots.splice(t,1),this.updateChange()},t.prototype.plotsValid=function(){return this.selection.plots.length===this.selection.validPlots.length}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),mt=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_t=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vt=(function(){function t(){}}(),function(){function t(){}}(),function(){function t(){this.labels=[],this.data=[]}return t}()),bt=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.http=e,o.cacheService=n,o.speciesTitle=r,o.config=i,o.headers=new R.d({"Content-Type":"application/x-www-form-urlencoded"}),o.requestSrc="observation-date-vis-selection",o.negative=!1,o.negativeColor="#aaa",o.years=[],o.plots=[],o}return yt(e,t),e.prototype.isValid=function(){return this.years&&this.years.length&&this.validPlots.length>0},Object.defineProperty(e.prototype,"validPlots",{get:function(){return(this.plots||[]).filter(function(t){return t.color&&t.species&&t.phenophase})},enumerable:!0,configurable:!0}),e.prototype.toURLSearchParams=function(){var t=new R.i;return t.set("request_src",this.requestSrc),this.years.forEach(function(e,n){t.set("year["+n+"]",""+e)}),this.validPlots.forEach(function(e,n){t.set("species_id["+n+"]",""+e.species.species_id),t.set("phenophase_id["+n+"]",""+e.phenophase.phenophase_id)}),this.addNetworkParams(t),t},e.prototype.postProcessData=function(t){var e=this;if(!t)return null;var n=new vt,r=this.validPlots,i=r.length*this.years.length-1,o=function(t,e){t.forEach(function(t){n.data.push({y:i,x:t,color:e})})},a=t.reduce(function(t,e){return t[e.species_id]=e,Array.isArray(e.phenophases)&&(e.phenophases=e.phenophases.reduce(function(t,e){return t[e.phenophase_id]=e,t},{})),t},{});return console.log("speciesMap",a),r.forEach(function(t){var r=a[t.species.species_id],s=r.phenophases[t.phenophase.phenophase_id];e.years.forEach(function(a){s&&s.years&&s.years[a]&&(e.negative&&(console.debug("year negative",i,a,r.common_name,s,s.years[a].negative),o(s.years[a].negative,e.negativeColor)),console.debug("year positive",i,a,r.common_name,s,s.years[a].positive),o(s.years[a].positive,t.color)),n.labels.splice(0,0,e.speciesTitle.transform(t.species)+"/"+t.phenophase.phenophase_name+" ("+a+")"),console.debug("y of "+i+" is for "+n.labels[0]),i--})}),console.log("observation data",n),n},e.prototype.getData=function(){var t=this;if(!this.isValid())return Promise.reject(this.INVALID_SELECTION);var e=this.toURLSearchParams(),n=this.config.apiRoot+"/npn_portal/observations/getObservationDates.json",r={u:n,params:e.toString()},i=this.cacheService.get(r);return i?Promise.resolve(i):(this.working=!0,new Promise(function(i){t.http.post(n,e.toString(),{headers:t.headers}).toPromise().then(function(e){var n=e.json();t.cacheService.set(r,n),t.working=!1,i(n)}).catch(t.handleError)}))},e}(G);mt([B(),_t("design:type",Boolean)],bt.prototype,"negative",void 0),mt([B(),_t("design:type",String)],bt.prototype,"negativeColor",void 0),mt([B(),_t("design:type",Array)],bt.prototype,"years",void 0),mt([B(),_t("design:type",Array)],bt.prototype,"plots",void 0);var xt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wt=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},St=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="CalendarSelection",e.labelOffset=4,e.bandPadding=.5,e.fontSizeDelta=0,e}return xt(e,t),e}(bt);wt([B(),St("design:type",String)],Pt.prototype,"$class",void 0),wt([B(),St("design:type",Number)],Pt.prototype,"labelOffset",void 0),wt([B(),St("design:type",Number)],Pt.prototype,"bandPadding",void 0),wt([B(),St("design:type",Number)],Pt.prototype,"fontSizeDelta",void 0),wt([B(),St("design:type",String)],Pt.prototype,"monthFormat",void 0);var Ot=function(){function t(t,e,n,r){this.http=t,this.cacheService=e,this.speciesTitle=n,this.config=r,this.requestSrc="npn-vis-calendar"}return t.prototype.newSelection=function(){return new Pt(this.http,this.cacheService,this.speciesTitle,this.config)},t.ctorParameters=function(){return[{type:R.e},{type:F.a},{type:F.m},{type:F.i,decorators:[{type:j.s,args:[F.f]}]}]},t}(),Dt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),kt=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="calendar.png",e.margins={top:20,right:35,bottom:45,left:35},e}Dt(e,t),e.prototype.xTickValues=function(){var t,e=[1],n=1;for(t=1;t<12;t++){var r=new Date(1900,t);r.setTime(r.getTime()-864e5),n+=r.getDate(),e.push(n)}return this.x.domain().filter(function(t){return-1!==e.indexOf(t)})},e.prototype.commonUpdates=function(){t.prototype.commonUpdates.call(this);var e=this.y.bandwidth(),n=-1*(e/2+this.selection.labelOffset),r=this.baseFontSize()+this.selection.fontSizeDelta;this.chart.selectAll(".y.axis text").attr("x",0).attr("dy",n).attr("style","text-anchor: start; font-size: "+r+"px;")},e.prototype.getMonthFormat=function(){return this.selection.monthFormat?this.selection.monthFormat:this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){var e=this;t.prototype.reset.call(this),this.processed=void 0;var n=this.chart,r=this.sizing,i=X.n(this.getMonthFormat());this.x=Object(dt.a)().range([0,r.width]).domain(X.l(1,366)).paddingInner(-.1).paddingOuter(.5),this.xAxis=Object(pt.a)(this.x).tickValues(this.xTickValues()).tickFormat(function(t){var e=new Date(1900,0);return e.setTime(e.getTime()+864e5*t),i(e)}),this.y=Object(dt.a)().range([r.height,0]).domain(X.l(0,6)).paddingOuter(.5),this.yAxis=Object(pt.c)(this.y).tickSize(r.width).tickFormat(function(t){return e.processed&&e.processed.data&&t<e.processed.labels.length?e.processed.labels[t]:""}),n.append("g").attr("class","x axis").attr("transform","translate(0,"+r.height+")").call(this.xAxis),n.append("g").attr("class","y axis").call(this.yAxis),n.selectAll("g .y.axis line").style("stroke","#777").style("stroke-dasharray","2,2"),n.selectAll("g .y.axis .domain").style("display","none"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;if(this.data){var e=(this.sizing,this.processed=this.selection.postProcessData(this.data));if(this.y.paddingInner(this.selection.bandPadding),e&&e.labels&&this.y.domain(X.l(0,e.labels.length)),this.yAxis.scale(this.y),this.chart.selectAll("g .y.axis").call(this.yAxis),this.chart.selectAll(".doy").remove(),e&&e.data){var n=this.chart.selectAll(".doy").data(e.data,function(t){var e=t;return e.y+"-"+e.x+"-"+e.color});n=n.enter().insert("line",":first-child").attr("class","doy");var r=Math.ceil(this.x.bandwidth()/2),i=this.y.bandwidth()/2;n.attr("x1",function(e){return t.x(e.x)-r}).attr("y1",function(e,n){return t.y(e.y)+i}).attr("x2",function(e){return t.x(e.x)+r}).attr("y2",function(e,n){return t.y(e.y)+i}).attr("doy-point",function(t){return"("+t.x+","+t.y+")"}).attr("stroke",function(t){return t.color}).attr("stroke-width",""+this.y.bandwidth()).append("title").text(function(t){return t.x})}this.commonUpdates()}}}(ut),(new Date).getFullYear()),Ct=function(){for(var t=kt+1,e=1900,n=[];e<t;)n.push(e++);return n}(),jt=(function(){function t(){this.maxYears=5,this.updateSent=!1}t.prototype.selectableYears=function(t){var e=this;return t?Ct.filter(function(n){return n===t||-1===e.selection.years.indexOf(n)}):Ct},t.prototype.ngOnInit=function(){0===this.selection.years.length&&this.addYear(),0===this.selection.plots.length&&this.addPlot()},t.prototype.updateChange=function(){this.selection.isValid()&&(this.selection.update(),this.updateSent=!0)},t.prototype.redrawChange=function(t){this.selection.isValid()&&(t&&!t.oldValue&&t.newValue?this.updateChange():this.updateSent?this.selection.redraw():this.updateChange())},t.prototype.addPlot=function(){this.selection.plots.push({})},t.prototype.removePlot=function(t){this.selection.plots.splice(t,1),this.updateChange()},t.prototype.addYear=function(){for(var t=kt;-1!==this.selection.years.indexOf(t);)t--;this.selection.years.push(t),this.updateChange()},t.prototype.removeYear=function(t){this.selection.years.splice(t,1),this.updateChange()},t.prototype.plotsValid=function(){return this.selection.plots.length===this.selection.validPlots.length}}(),this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}),At=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lt=function(){function t(){this.dataPoints=!0}return Object.defineProperty(t.prototype,"external",{get:function(){return o.apply(this,arguments)},set:function(t){a.apply(this,arguments)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){delete this.$data,delete this.$metricData},t.prototype.updateCheck=function(t){this.selection&&this.isValid()&&(!this.plotted()||t?this.selection.update():this.selection.redraw())},Object.defineProperty(t.prototype,"year",{get:function(){return this._year},set:function(t){this.reset(),this._year=t,this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"phenophase",{get:function(){return this._phenophase},set:function(t){this.reset(),this._phenophase=t,this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metric",{get:function(){return this._metric},set:function(t){this.reset(),this._metric=t,this.updateCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"species",{get:function(){return this._species},set:function(t){this.reset(),this._species=t,this.phenophase=void 0,this._metrics=this._species&&this._species.kingdom?qt[this._species.kingdom]||[]:[],this._metric&&-1===this._metrics.indexOf(this._metric)&&delete this.metric,this._metrics.length&&!this._metric&&(this.metric=this._metrics[0])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validMetrics",{get:function(){return this._metrics||[]},enumerable:!0,configurable:!0}),t.prototype.axisLabel=function(){return this.metric?this.metric.label:"?"},t.prototype.doyDataValue=function(){var t,e,n,r=this,i=r.data();if(r.doyFocus&&i)for(n=0;n<i.length;n++)if(e=i[n],r.doyFocus>=e.start_doy&&r.doyFocus<=e.end_doy)return t=(r.metric.valueFormat||Tt)(e[r.metric.id]),-9999!==e[r.metric.sampleSize]&&(t+=" N:"+e[r.metric.sampleSize]),t},t.prototype.legendLabel=function(t){var e=this.doyDataValue();return this.year+": "+It(this.species)+" - "+this.phenophase.phenophase_name+(t?" ("+this.metric.label+")":"")+(void 0!==e?" ["+e+"]":"")},t.prototype.metricId=function(){return this.metric?this.metric.id:void 0},t.prototype.data=function(t){if(arguments.length)return delete this.$data,delete this.$metricData,t&&(t.forEach(function(t){t.start_doy=Nt(t.start_date),t.end_doy=Nt(t.end_date)}),t.sort(function(t,e){return t.start_doy-e.start_doy}),this.$data=t),this;var e=this,n=e.$data;return n&&e.metric&&(e.$metricData?n=e.$metricData:(e.metric.sampleSize||console.warn("Metric does not define a sampleSize property, cannot filter out invalid data points."),n=n.filter(function(t){return(!e.metric.sampleSize||-9999!==t[e.metric.sampleSize])&&-9999!==t[e.metric.id]}),n.length!==e.$data.length&&console.debug("filtered out "+(e.$data.length-n.length)+"/"+e.$data.length+" of -9999 records for metric ",e.metric),e.$metricData=n)),n},t.prototype.axis=function(){var t=this.y(),e=t.ticks(),n=this.orient||"left",r="left"===n?X.a(t):X.b(t);return e.length&&(e[e.length-1]=t.domain()[1],r.tickValues(e)),r},t.prototype.x=function(t){return arguments.length?(this.$x=t,this):this.$x},t.prototype.y=function(t){return arguments.length?(this.$y=t,this):this.$y},t.prototype.isValid=function(){return this.species&&this.phenophase&&this.year&&this.metric},t.prototype.plotted=function(){return this.isValid()&&this.data()},t.prototype.shouldRevisualize=function(){return this.isValid()&&!this.data()},t.prototype.domain=function(){var t,e=this,n=e.data();if(n&&e.metric)return t=X.h(n,function(t){return t[e.metric.id]}),t[0]>0?t[0]=0:t[0]<0&&console.warn("negative domain start for metric",t,e.metric),t},t.prototype.draw=function(t){var e,n,r,i,o,a,s=this,l=s.data(),c=[[]];if(t.selectAll("path.curve.curve-"+s.id).remove(),t.selectAll("circle.curve-point.curve-point-"+s.id).remove(),l&&l.length){for(r=0;r<l.length;r++)i=l[r],o=r+1<l.length?l[r+1]:void 0,c[c.length-1].push(i),o&&o.start_doy!==i.end_doy+1&&c.push([]);e=s.x(),n=s.y();var u=function(t){return e(t.start_doy+Math.round((t.end_doy-t.start_doy)/2))},p=function(t){return n(t[s.metric.id])};switch(a=X.j(),s.interpolate){case Mt.monotone:console.log("MONOTONE"),a.curve(X.e);break;case Mt.stepAfter:console.log("STEP AFTER"),a.curve(X.f);break;case Mt.linear:console.log("LINEAR"),a.curve(X.d)}a.x(u),a.y(p),console.debug("ActivityCurve.draw",s.species,s.phenophase,s.year,s.metric,s.domain(),n.domain()),console.debug("draw.datas",c),c.forEach(function(e,n){(1===e.length||s.dataPoints)&&e.forEach(function(e){t.append("circle").attr("class","curve-point curve-point-"+s.id).attr("r",3).attr("fill",s.color).attr("cx",u(e)).attr("cy",p(e))}),e.length>1&&t.append("path").attr("class","curve curve-"+s.id).attr("fill","none").attr("stroke",s.color).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",1.5).attr("d",a(e))})}},t}();jt([B(),At("design:type",Number)],Lt.prototype,"id",void 0),jt([B(),At("design:type","function"==typeof(Rt=void 0!==F.l&&F.l)&&Rt||Object)],Lt.prototype,"_species",void 0),jt([B(),At("design:type",Object)],Lt.prototype,"_metric",void 0),jt([B(),At("design:type","function"==typeof(Ft=void 0!==F.k&&F.k)&&Ft||Object)],Lt.prototype,"_phenophase",void 0),jt([B(),At("design:type",Number)],Lt.prototype,"_year",void 0),jt([B(),At("design:type",String)],Lt.prototype,"color",void 0);var Mt;!function(t){t[t.linear=0]="linear",t[t.stepAfter=1]="stepAfter",t[t.monotone=2]="monotone"}(Mt||(Mt={}));var Rt,Ft,zt=function(t){return t.toFixed(2)},Tt=function(t){return t},Et=new F.m,It=function(t,e){return Et.transform(t,e)},Ut=new F.b,Nt=function(t,e){return Ut.transform(t,e)},Bt=[{id:"num_yes_records",sampleSize:"status_records_sample_size",label:"Total Yes Records"},{id:"proportion_yes_records",sampleSize:"status_records_sample_size",label:"Proportion Yes Records",valueFormat:zt,proportion:!0}],qt={Plantae:Bt.concat([{id:"numindividuals_with_yes_record",sampleSize:"individuals_sample_size",label:"Total Individuals with Yes Records"},{id:"proportion_individuals_with_yes_record",sampleSize:"individuals_sample_size",label:"Proportion Individuals with Yes Records",valueFormat:zt,proportion:!0}]),Animalia:Bt.concat([{id:"numsites_with_yes_record",sampleSize:"sites_sample_size",label:"Total Sites with Yes Records"},{id:"proportion_sites_with_yes_record",sampleSize:"sites_sample_size",label:"Proportion Sites with Yes Records",valueFormat:zt,proportion:!0},{id:"total_numanimals_in-phase",sampleSize:"in-phase_site_visits_sample_size",label:"Total Animals In Phase"},{id:"mean_numanimals_in-phase",sampleSize:"in-phase_per_hr_sites_sample_size",label:"Animals In Phase",valueFormat:zt},{id:"mean_numanimals_in-phase_per_hr",sampleSize:"in-phase_per_hr_sites_sample_size",label:"Animals In Phase per Hour",valueFormat:zt},{id:"mean_numanimals_in-phase_per_hr_per_acre",sampleSize:"phase_per_hr_per_acre_sites_sample_size",label:"Animals In Phase per Hour per Acre",valueFormat:zt}])},Vt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yt=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Wt=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Gt=function(){function t(){}return t}(),$t={value:"months",label:"Monthly"},Kt={value:14,label:"Bi-weekly"},Ht={value:7,label:"Weekly"},Jt=[$t,Kt,Ht],Xt=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.http=e,o.cacheService=n,o.datePipe=r,o.config=i,o.$class="ActivityCurvesSelection",o.headers=new R.d({"Content-Type":"application/x-www-form-urlencoded"}),o._interpolate=Mt.monotone,o._dataPoints=!0,o._frequency=Jt[0],o.curves=[{color:"#0000ff",orient:"left"},{color:"orange",orient:"right"}].map(function(t,e){var n=new Lt;return n.id=e,n.color=t.color,n.orient=t.orient,n}),o}return Vt(e,t),e.prototype.isValid=function(){return this.curves[0].isValid()},e.prototype.updateCheck=function(t){var e=this.curves[0].isValid()||this.curves[1].isValid(),n=this.curves[0].plotted()||this.curves[1].plotted();t?e&&this.update():e&&n?this.redraw():e&&this.update()},Object.defineProperty(e.prototype,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency=t,(this._curves||[]).forEach(function(t){return t.data(null)}),this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interpolate",{get:function(){return this._interpolate},set:function(t){this._interpolate=t,(this._curves||[]).forEach(function(e){return e.interpolate=t}),this.updateCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataPoints",{set:function(t){this._dataPoints=t,(this._curves||[]).forEach(function(e){return e.dataPoints=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curves",{get:function(){return this._curves},set:function(t){var e=this;this._curves=t,t.forEach(function(t){t.selection=e,t.interpolate=e._interpolate,t.dataPoints=e._dataPoints})},enumerable:!0,configurable:!0}),e.prototype.endDate=function(t){var e=new Date;return t===e.getFullYear()?this.datePipe.transform(e,"yyyy-MM-dd"):t+"-12-31"},e.prototype.loadCurveData=function(){var t=this;return new Promise(function(e){t.working=!0;var n=t.curves.filter(function(t){return t.data(null).isValid()}).map(function(e){return new Promise(function(n){var r=new R.i;r.set("request_src","npn-vis-activity-curves"),r.set("start_date",e.year+"-01-01"),r.set("end_date",t.endDate(e.year)),r.set("frequency",""+t.frequency.value),r.set("species_id[0]",""+e.species.species_id),r.set("phenophase_id[0]",""+e.phenophase.phenophase_id),t.addNetworkParams(r);var i=t.config.apiRoot+"/npn_portal/observations/getMagnitudeData.json",o={u:i,params:r.toString()},a=t.cacheService.get(o);a?n(e.data(a)):t.http.post(i,r.toString(),{headers:t.headers}).toPromise().then(function(r){var i=r.json();t.cacheService.set(o,i),n(e.data(i))}).catch(t.handleError)})});Promise.all(n).then(function(){t.working=!1,e()})})},e.prototype.handleError=function(t){console.error("ERROR",t)},e}(G);Yt([B(),Wt("design:type",String)],Xt.prototype,"$class",void 0),Yt([B(),Wt("design:type","function"==typeof(Zt=void 0!==Mt&&Mt)&&Zt||Object)],Xt.prototype,"_interpolate",void 0),Yt([B(),Wt("design:type",Boolean)],Xt.prototype,"_dataPoints",void 0),Yt([B(),Wt("design:type",Gt)],Xt.prototype,"_frequency",void 0),Yt([B({ser:function(t){return t.external},des:function(t){var e=new Lt;return e.external=t,e}}),Wt("design:type",Array)],Xt.prototype,"_curves",void 0);var Zt,Qt=n("qbdv"),te=function(){function t(t,e,n,r){this.http=t,this.cacheService=e,this.datePipe=n,this.config=r}return t.prototype.newSelection=function(){return new Xt(this.http,this.cacheService,this.datePipe,this.config)},t.ctorParameters=function(){return[{type:R.e},{type:F.a},{type:Qt.d},{type:F.i,decorators:[{type:j.s,args:[F.f]}]}]},t}(),ee=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ne=new Date(2010,0),re=X.n("%m/%d"),ie=function(t){var e=864e5*(t-1)+ne.getTime(),n=new Date(e);return re(n)},oe=function(t,e){return t&&2===t.length&&(t=[t[0],1.05*t[1]],e&&e.proportion&&t[1]>1&&(t[1]=1)),t},ae=function(t){for(var e=1,n=[];e<=365;)n.push(e),e+=t;return n},se={7:{rotate:45,values:ae(14)},14:{rotate:45,values:ae(28)},months:{values:[1,32,60,91,121,152,182,213,244,274,305,335]}},le=(function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o.window=e,o.rootElement=n,o.media=r,o.legendDoyPipe=i,o.filename="activity-curves.png",o.margins={top:80,left:80,right:80,bottom:80},o}ee(e,t),e.prototype.usingCommonMetric=function(){var t=this.selection;if(t.curves[0].isValid()&&!t.curves[1].isValid()||t.curves[0].isValid()&&t.curves[1].isValid()&&t.curves[0].metricId()===t.curves[1].metricId())return t.curves[0].metric},e.prototype.newY=function(){var t=this.sizing;return Object(dt.b)().range([t.height,0]).domain([0,100])},e.prototype.updateLegend=function(){var t=this,e=this.chart;e.select(".legend").remove();var n=this.sizing,r=this.selection,i=this.usingCommonMetric(),o=e.append("g").attr("class","legend").attr("transform","translate(150,-"+(n.margin.top-10)+")").style("font-size","1em");r.curves.reduce(function(e,n){var r;return n.plotted()&&(r=o.append("g").attr("class","legend-item curve-"+n.id).attr("transform","translate(10,"+((e+1)*t.baseFontSize()+4*e)+")"),r.append("circle").attr("r",5).attr("fill",n.color),r.append("text").style("font-size",t.baseFontSize(!0)).attr("x",10).attr("y",2.5).text(n.legendLabel(!i)),e++),e},0)},e.prototype.hover=function(){function t(){var t=X.k(this),e=t[0],n=(t[1],Math.round(a.invert(e))),i=r.curves.reduce(function(t,e){return!t&&e.plotted()&&(t=e.data().reduce(function(t,e){return t||(n>=e.start_doy&&n<=e.end_doy?e:void 0)},void 0)),t},void 0);l.attr("transform","translate("+e+")"),c.style("text-anchor",n<324?"start":"end").attr("x",e+10*(n<324?1:-1)).text(i?o.legendDoyPipe.transform(i.start_doy)+" - "+o.legendDoyPipe.transform(i.end_doy):o.legendDoyPipe.transform(n)),r.curves.forEach(function(t){t.doyFocus=n}),o.updateLegend()}var e=this,n=this.svg,r=this.selection,i=this.sizing,o=this,a=this.x,s=n.append("g").attr("transform","translate("+i.margin.left+","+i.margin.top+")").style("display","none"),l=s.append("line").attr("class","focus").attr("fill","none").attr("stroke","green").attr("stroke-width",1).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",i.height),c=s.append("text").attr("class","focus-doy").attr("y",10).attr("x",0).text("hover doy"),u=function(){r.curves.forEach(function(t){delete t.doyFocus}),s.style("display","none"),e.updateLegend()},p=function(){r.curves.reduce(function(t,e){return t||e.plotted()},!1)&&s.style("display",null)};n.append("rect").attr("class","overlay").attr("transform","translate("+this.margins.left+","+this.margins.top+")").style("fill","none").style("pointer-events","all").attr("x",0).attr("y",0).attr("width",i.width).attr("height",i.height).on("mouseover",p).on("mouseout",u).on("mousemove",t)},e.prototype.reset=function(){var e=this;t.prototype.reset.call(this);var n=this.chart,r=this.sizing,i=this.selection;this.x=Object(dt.b)().range([0,r.width]).domain([1,365]),this.xAxis=Object(pt.a)(this.x).tickFormat(ie),i.curves.forEach(function(t){return t.x(e.x).y(e.newY())}),n.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x","0").style("text-anchor","start").style("font-size","18px").text("Activity Curves"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.loadCurveData().then(function(){t.redraw()})},e.prototype.redrawSvg=function(){var t=this,e=this.chart,n=this.sizing,r=this.selection,i=this.usingCommonMetric();if(e.selectAll("g .axis").remove(),i){var o=X.h(r.curves.reduce(function(t,e){return e.isValid()&&(t=t.concat(e.domain())),t},[])),a=this.newY().domain(oe(o,i));console.debug("ActivityCurves.common domain",o),r.curves.forEach(function(t){t.y(a)})}else r.curves.forEach(function(e){e.isValid()&&e.y(t.newY().domain(oe(e.domain(),e.metric)))});e.append("g").attr("class","y axis left").call(r.curves[0].axis()).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y","0").attr("dy","-4em").attr("x",n.height/2*-1).attr("fill","#000").style("text-anchor","middle").text(r.curves[0].axisLabel()),!i&&r.curves[1].isValid()&&(r.curves[1].orient="right",e.append("g").attr("class","y axis right").attr("transform","translate("+n.width+")").call(r.curves[1].axis()).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y","0").attr("dy","4em").attr("x",n.height/2*-1).style("text-anchor","middle").text(r.curves[1].axisLabel()));var s=se[r.frequency.value];this.xAxis.tickValues(s.values),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis).append("text").attr("y","0").attr("dy","3em").attr("x",n.width/2).attr("class","axis-label").style("text-anchor","middle").text("Date"),s.rotate&&(e.selectAll("g.x.axis g.tick text").style("text-anchor","end").attr("transform","rotate(-"+s.rotate+")"),e.selectAll("g.x.axis .axis-label").attr("dy","4em")),i||(e.selectAll("g.y.axis.left g.tick text").style("fill",r.curves[0].color),e.selectAll("g.y.axis.left text.axis-title").style("fill",r.curves[0].color),e.selectAll("g.y.axis.right g.tick text").style("fill",r.curves[1].color),e.selectAll("g.y.axis.right text.axis-title").style("fill",r.curves[1].color)),this.commonUpdates(),r.curves.forEach(function(t){t.draw(e)}),this.updateLegend(),this.hover()},e.ctorParameters=function(){return[{type:F.n},{type:j.o},{type:ot.j},{type:F.d}]}}(ut),function(){function t(){this.frequencies=Jt,this.interpolates=[{value:Mt.linear,label:"Linear"},{value:Mt.monotone,label:"Monotone"},{value:Mt.stepAfter,label:"Step after"}]}}(),n("bm2B")),ce=(function(){function t(){var t=this;this.required=!0,this.disabled=!1,this.yearControl=new le.f(null,function(e){return t.required&&!e.value?{required:!0}:null}),this.validYears=function(){for(var t=(new Date).getFullYear(),e=[],n=2010;n<t;)e.push(n++);return e}()}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ue=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},pe=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},de=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},fe=function(t){function e(e){var n=t.call(this)||this;return n.serviceUtils=e,n.$class="ObserverActivitySelection",n.dataCnt=0,n}return ce(e,t),e.prototype.isMultiStation=function(){return this.stationIds&&this.stationIds.length>1},e.prototype.isSingleStation=function(){return this.stationIds&&1===this.stationIds.length},e.prototype.isValid=function(){return!!this.year},e.prototype.getData=function(){var t=this,e=this.serviceUtils.apiUrl("/npn_portal/networks/getObserversByMonth.json"),n={year:this.year,network_id:this.networkIds[0]};return new Promise(function(r,i){t.working=!0,t.serviceUtils.cachedGet(e,n).then(function(e){var n=[1,2,3,4,5,6,7,8,9,10,11,12].map(function(t){return ue({month:t},e.months[t])});e.months=n,t.working=!1,r(e)}).catch(i)})},e}(W);pe([B(),de("design:type",String)],fe.prototype,"$class",void 0),pe([B(),de("design:type",Number)],fe.prototype,"year",void 0);var he=function(){function t(t){this.serviceUtils=t}return t.prototype.newSelection=function(){return new fe(this.serviceUtils)},t.ctorParameters=function(){return[{type:F.j}]},t}(),ge=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ye=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},me=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.keyLabels=["New observers","Active observers"],e.keys=["number_new_observers","number_active_observers"],e.z=Object(dt.c)().domain(e.keys).range(["#98abc5","#d0743c"]),e.zDarker=Object(dt.c)().domain(e.keys).range(e.z.range().map(function(t){return X.c(t).darker().toString()})),e.filename="observer-activity.png",e.margins=ye({},ct,{top:100,left:80}),e}ge(e,t),e.prototype.getMonthFormat=function(){return this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){t.prototype.reset.call(this);var e=this.chart,n=this.sizing,r=X.n(this.getMonthFormat()),i=this.baseFontSize();this.title=e.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-4.2em").attr("x","0").style("text-anchor","start").style("font-size","18px");var o=this.legend=e.append("g").attr("class","legend").attr("transform","translate(0,-"+(n.margin.top-10)+")").attr("text-anchor","start").style("font-size",i).selectAll("g").data(this.keyLabels).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(22*e+24)+")"});o.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("fill",this.z),o.append("text").attr("x",24).attr("y",i-.5).attr("dy","0.32em").text(function(t){return t}),this.x=Object(dt.a)().rangeRound([0,n.width]).padding(.05).domain(X.l(0,12)),this.xAxis=Object(pt.a)(this.x).tickFormat(function(t){return r(new Date(1900,t))}),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis),this.y=Object(dt.b)().range([n.height,0]).domain([0,20]),this.yAxis=Object(pt.b)(this.y).tickFormat(X.i(".0d")),e.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",n.height/2*-1).style("text-anchor","middle").text("New/Active Observers"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;if(this.data){this.title.text("New/Active Observers, "+this.data.network_name+", "+this.selection.year),console.debug("ObserverActivityComponent:data",this.data);var e=this.sizing,n=this.data.months.slice(),r=(this.chart,n.reduce(function(t,e){return t+e.number_new_observers},0)),i=n.reduce(function(t,e){return t+e.number_active_observers},0),o=n.reduce(function(t,e){return e.number_new_observers>t&&(t=e.number_new_observers),e.number_active_observers>t&&(t=e.number_active_observers),t},0);console.debug("ObserverActivityComponent:vis data (max="+o+")",n),this.x.domain(X.l(0,n.length)),this.chart.selectAll("g .x.axis").call(this.xAxis),this.y.domain([0,o]),this.yAxis.ticks(o<11?o:10),this.chart.selectAll("g .y.axis").call(this.yAxis);var a=function(r,i){var o=t.x.bandwidth()/2;t.chart.selectAll("g .bars."+r).remove(),t.chart.append("g").attr("class","bars "+r).attr("fill",function(e){return t.z(r)}).selectAll("rect").data(n).enter().append("rect").attr("x",function(e,n){return t.x(n)+o*i}).attr("y",function(e){return t.y(e[r])}).attr("title",function(t){return""+t[r]}).attr("height",function(n){return e.height-t.y(n[r])}).attr("width",o),t.chart.selectAll("g .bar-labels."+r).remove(),t.chart.append("g").attr("class","bar-labels "+r).attr("fill",function(e){return t.z(r)}).selectAll("text").data(n).enter().append("text").attr("text-anchor","middle").attr("dy","-0.25em").attr("x",function(e,n){return t.x(n)+o*i+o/2}).attr("y",function(e){return t.y(e[r])}).text(function(t){return""+t[r]})};this.keys.forEach(function(t,e){return a(t,e)}),this.legend.selectAll("text").each(function(t,e,n){return function(r,i){var o=X.m(this),a=r===n[0]?t:e;o.text(r+" [Total: "+a+"]")}}(r,i,this.keyLabels)),this.commonUpdates()}}}(ut),function(){function t(){this.validYears=function(){for(var t=(new Date).getFullYear()+1,e=2e3,n=[];e<t;)n.push(e++);return n.reverse()}()}t.prototype.ngOnInit=function(){}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),_e=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ve=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},be=function(t){function e(e,n){var r=t.call(this)||this;return r.serviceUtils=e,r.networkService=n,r.$class="ObservationFrequencySelection",r.dataCnt=0,r}return me(e,t),Object.defineProperty(e.prototype,"year",{get:function(){return this._year},set:function(t){this._year=t,delete this.defaultStation},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!!this.year&&1===this.networkIds.length},e.prototype.getData=function(){var t=this;return new Promise(function(e,n){var r=t.serviceUtils.apiUrl("/npn_portal/networks/getSiteVisitFrequency.json"),i={year:t.year,network_id:t.networkIds[0]};t.working=!0,t.serviceUtils.cachedGet(r,i).then(function(n){t.working=!1,e(n)}).catch(n)})},e}(W);_e([B(),ve("design:type",String)],be.prototype,"$class",void 0),_e([B(),ve("design:type",Number)],be.prototype,"_year",void 0),_e([B(),ve("design:type",Number)],be.prototype,"defaultStation",void 0);var xe=function(){function t(t,e){this.serviceUtils=t,this.networkService=e}return t.prototype.newSelection=function(){return new be(this.serviceUtils,this.networkService)},t.ctorParameters=function(){return[{type:F.j},{type:F.g}]},t}(),we=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Se=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Pe=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="observation-frequency.png",e.margins=Se({},ct,{top:80,left:80}),e}we(e,t),Object.defineProperty(e.prototype,"station",{get:function(){return this._station},set:function(t){this._station=t,this.selection.editMode&&(delete this.selection.defaultStation,this._station&&(this.selection.defaultStation=this._station.station_id))},enumerable:!0,configurable:!0}),e.prototype.getMonthFormat=function(){return this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){console.debug("ObservationFrequencyComponent.reset"),t.prototype.reset.call(this);var e=this.chart,n=this.sizing,r=X.n(this.getMonthFormat());this.baseFontSize();this.title=e.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x","0").style("text-anchor","start").style("font-size","18px"),this.x=Object(dt.a)().rangeRound([0,n.width]).padding(.05).domain(X.l(0,12)),this.xAxis=Object(pt.a)(this.x).tickFormat(function(t){return r(new Date(1900,t))}),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis),this.y=Object(dt.b)().range([n.height,0]).domain([0,20]),this.yAxis=Object(pt.b)(this.y).tickFormat(X.i(".0d")),e.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",n.height/2*-1).style("text-anchor","middle").text("Site visits"),this.commonUpdates()},e.prototype.update=function(){var t=this;console.debug("ObservationFrequencyComponent.update"),this.reset(),delete this.data,delete this.stations,delete this.station,this.selection.getData().then(function(e){t.data=e,t.stations=e.stations,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;console.debug("ObservationFrequencyComponent.redrawSvg:data",this.data),this.stations&&this.stations.length&&(this.station||(this.selection.defaultStation&&(this.station=this.stations.reduce(function(e,n){return e||(n.station_id===t.selection.defaultStation?n:void 0)},void 0)),this.station||(this.station=this.stations[0])),this.redrawStation(),this.commonUpdates())},e.prototype.redrawStation=function(){var t=this;if(this.title.text('Site visits by month, "TODO: Refuge Name", '+this.selection.year),this.station){var e=this.station;if(console.debug("ObservationFrequencyComponent.redrawStation:station",e),e){var n=this.sizing,r=e.months.slice(),i=r.reduce(function(t,e){return t+e},0),o=r.reduce(function(t,e){return e>t?e:t},0);this.title.text("Site visits by month ("+this.selection.year+') "'+e.station_name+'" Total: '+i),console.debug("ObservationFrequencyComponent.redrawStation:bars",r),this.x.domain(X.l(0,r.length)),this.chart.selectAll("g .x.axis").call(this.xAxis),this.y.domain([0,o]),this.yAxis.ticks(o<11?o:10),this.chart.selectAll("g .y.axis").call(this.yAxis),this.chart.selectAll("g .bars").remove(),this.chart.append("g").attr("class","bars").attr("fill","#98abc5").selectAll("rect").data(r).enter().append("rect").attr("x",function(e,n){return t.x(n)}).attr("y",function(e){return t.y(e)}).attr("title",function(t){return t}).attr("height",function(e){return n.height-t.y(e)}).attr("width",this.x.bandwidth()),this.chart.selectAll("g .bar-labels").remove(),this.chart.append("g").attr("class","bar-labels").attr("fill","#000000").selectAll("text").data(r).enter().append("text").attr("text-anchor","middle").attr("dy","-0.25em").attr("x",function(e,n){return t.x(n)+t.x.bandwidth()/2}).attr("y",function(e){return t.y(e)}).text(function(t){return t})}}}}(ut),function(){function t(){this.stationChange=new j.q,this.onStationChange=new j.q}Object.defineProperty(t.prototype,"station",{get:function(){return this.stationValue},set:function(t){if(t!==this.stationValue){var e=this.stationValue;this.stationChange.emit(this.stationValue=t),this.onStationChange.emit({oldValue:e,newValue:this.stationValue})}},enumerable:!0,configurable:!0}),t.prototype.prev=function(){var t=this.stations.indexOf(this.station);this.station=t>0?this.stations[t-1]:this.stations[this.stations.length-1]},t.prototype.next=function(){var t=this.stations.indexOf(this.station);t<this.stations.length-1?this.station=this.stations[t+1]:this.station=this.stations[0]}}(),function(){function t(){this.validYears=function(){for(var t=(new Date).getFullYear()+1,e=2e3,n=[];e<t;)n.push(e++);return n.reverse()}()}t.prototype.ngOnInit=function(){}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Oe=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},De=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ke=[{id:"current",label:"Current Si-x leaf index",layerName:"si-x:average_leaf_ncep",clippingService:"si-x/area/clippedImage",statisticsService:"si-x/area/statistics"},{id:"forecast",label:"6-day forecast",layerName:"si-x:average_leaf_ncep",clippingService:"si-x/area/clippedImage",statisticsService:"si-x/area/statistics",forecast:!0},{id:"anomaly",label:"Anomaly",layerName:"si-x:leaf_anomaly",clippingService:"si-x/anomaly/area/clippedImage",statisticsService:"si-x/anomaly/area/statistics"}],Ce=[{id:"current",label:"Current AGDD",layerName:"gdd:agdd",clippingService:"agdd/area/clippedImage",statisticsService:"agdd/area/statistics"},{id:"forecast",label:"6-day forecast",layerName:"gdd:agdd",clippingService:"agdd/area/clippedImage",statisticsService:"agdd/area/statistics",forecast:!0},{id:"anomaly",label:"Anomaly",layerName:"gdd:agdd_anomaly",clippingService:"agdd/anomaly/area/clippedImage",statisticsService:"agdd/anomaly/area/statistics"}],je=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.serviceUtils=e,o.datePipe=n,o.mapLegendService=r,o.config=i,o.$class="ClippedWmsMapSelection",o.service="si-x",o.layer=ke[0],o.useBufferedBoundary=!1,o.forecastDays=6,o}return Pe(e,t),e.prototype.isValid=function(){return!("si-x"!==this.service&&"agdd"!==this.service||!this.layer||!this.fwsBoundary)},Object.defineProperty(e.prototype,"validServices",{get:function(){return[{value:"si-x",label:"Spring index"},{value:"agdd",label:"Accumulated growing degree days"}]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validLayers",{get:function(){switch(this.service){case"si-x":return ke;case"agdd":return Ce}return[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiDate",{get:function(){var t=this.explicitDate?new Date(this.explicitDate.getTime()):new Date;return this.layer&&this.layer.forecast&&t.setTime(t.getTime()+864e5*this.forecastDays),this.datePipe.transform(t,"y-MM-dd")},enumerable:!0,configurable:!0}),e.prototype.getBoundary=function(){var t=this;return new Promise(function(e,n){var r=t.config.dataApiRoot+"/v0/si-x/area/boundary",i={format:"geojson",fwsBoundary:t.fwsBoundary};t.serviceUtils.cachedGet(r,i).then(function(r){r&&r.boundary?t.serviceUtils.cachedGet(r.boundary,{}).then(e).catch(n):n("missing boundary in response.")}).catch(n)})},e.prototype.getData=function(){var t=this.config.dataApiRoot+"/v0/"+this.layer.clippingService,e={layerName:this.layer.layerName,fwsBoundary:this.fwsBoundary,date:this.apiDate,useBufferedBoundary:this.useBufferedBoundary,style:!0,fileFormat:"png"};return this.serviceUtils.cachedGet(t,e)},e.prototype.getStatistics=function(){var t=this;return new Promise(function(e,n){var r=t.config.dataApiRoot+"/v0/"+t.layer.statisticsService,i={layerName:t.layer.layerName,fwsBoundary:t.fwsBoundary,date:t.apiDate,useBufferedBoundary:t.useBufferedBoundary,useCache:!0};i.useCache="boolean"==typeof t.config.dataApiUseStatisticsCache&&t.config.dataApiUseStatisticsCache,t.serviceUtils.cachedGet(r,i).then(function(t){var n=/^(\d{4})-(\d{2})-(\d{2})/.exec(t.date);t.date=new Date(parseInt(n[1]),parseInt(n[2])-1,parseInt(n[3])),e(t)}).catch(n)})},e.prototype.getAllData=function(){var t=this;return new Promise(function(e,n){Promise.all([t.getData(),t.getBoundary(),t.getStatistics()]).then(function(t){e({data:t[0],boundary:t[1],statistics:t[2]})}).catch(n)})},e.prototype.resizeMap=function(t){var e=this;return new Promise(function(n){if(e.data){var r=e.toBounds(e.data.data.bbox);r&&t.fitBounds(r)}n()})},e.prototype.removeFrom=function(t){var e=this;return new Promise(function(n){e.overlay&&e.overlay.remove(),(e.features||[]).forEach(function(e){t.data.remove(e)}),e.data=void 0,e.features=void 0,e.overlay=void 0,e.legend=void 0,n()})},e.prototype.addTo=function(t){var e=this;return new Promise(function(n,r){e.working=!0;var i=function(t){e.working=!1,n(t)},o=function(t){e.working=!1,r(t)};if(e.overlay&&e.features)return o("already added to map, call removeFrom");e.getAllData().then(function(n){if(e.overlay&&e.features)return console.log("in promise, already have overlay and features"),i();e.data=n;var r=n.data,a=e.toBounds(r.bbox),l=r.clippedImage;if(a){t.panTo(a.getCenter()),t.fitBounds(a),s(),e.overlay=new Ae(a,l,t),e.overlay.add();var c=n.boundary;console.log("MAP boundary resonse",c),e.features=t.data.addGeoJson(c),t.data.setStyle(function(t){return{strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0}})}e.mapLegendService.getLegend(r.layerClippedFrom).then(function(t){console.debug("ClippedWmsMapSelection.legend:",t),e.legend=t,i()}).catch(o)}).catch(o)})},e.prototype.toBounds=function(t){if(t&&4===t.length){var e=t[0],n=t[1],r=t[2],i=t[3];return new google.maps.LatLngBounds(new google.maps.LatLng(n,e),new google.maps.LatLng(i,r))}return null},e}(W);Oe([B(),De("design:type",String)],je.prototype,"$class",void 0),Oe([B(),De("design:type",String)],je.prototype,"service",void 0),Oe([B(),De("design:type",Object)],je.prototype,"layer",void 0),Oe([B(),De("design:type",String)],je.prototype,"fwsBoundary",void 0),Oe([B(),De("design:type",Boolean)],je.prototype,"useBufferedBoundary",void 0);var Ae,Le=n("S4Bb"),Me=/^(\d\d\d\d)-0?(\d+)-0?(\d+)/,Re=function(){function t(){}return t.prototype.parse=function(t){var e=Me.exec(t.replace(/T.*$/,"")),n=parseInt(e[1]),r=parseInt(e[2])-1,i=parseInt(e[3]);return new Date(n,r,i)},t}(),Fe={geo_server:{url:"//geoserver-dev.usanpn.org/geoserver"},description:"",categories:[{name:"Temperature Accumulations, Daily 30-year Average",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_default_filter:{name:"agddDefaultTodayElevation"},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,layers:[{name:"gdd:30yr_avg_agdd"},{name:"gdd:30yr_avg_agdd_50f"}]},{name:"Temperature Accumulations, Current Day",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_default_filter:{name:"agddDefaultTodayTime"},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,supports_time_series:!0,layers:[{name:"gdd:agdd"},{name:"gdd:agdd_50f"}]},{name:"Temperature Accumulations, Current Day, Alaska",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_values_filter:{name:"extentDates",args:[null,"today"]},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,layers:[{name:"gdd:agdd_alaska"},{name:"gdd:agdd_alaska_50f"}]},{name:"Temperature Accumulations, Daily Anomaly",supports_data:!1,legend_label_filter:{name:"legendAgddAnomaly",args:[!1]},gridded_label_filter:{name:"legendAgddAnomaly",args:[!0]},extent_default_filter:{name:"agddDefaultTodayTime"},legend_units:"Growing Degree Days",legend_delimiter_every:100,layers:[{name:"gdd:agdd_anomaly"},{name:"gdd:agdd_anomaly_50f"}]},{name:"Spring Indices, Historical Annual",legend_label_filter:{name:"legendDoy"},current_year_only:!0,layers:[{name:"si-x:average_leaf_prism"},{name:"si-x:average_bloom_prism"},{name:"si-x:arnoldred_leaf_prism"},{name:"si-x:arnoldred_bloom_prism"},{name:"si-x:lilac_leaf_prism"},{name:"si-x:lilac_bloom_prism"},{name:"si-x:zabelli_leaf_prism"},{name:"si-x:zabelli_bloom_prism"}]},{name:"Spring Indices, Current Year",legend_label_filter:{name:"legendDoy"},extent_default_filter:{name:"agddDefaultTodayTime"},current_year_only:!0,layers:[{name:"si-x:average_leaf_ncep"},{name:"si-x:average_bloom_ncep"},{name:"si-x:arnoldred_leaf_ncep"},{name:"si-x:arnoldred_bloom_ncep"},{name:"si-x:lilac_leaf_ncep"},{name:"si-x:lilac_bloom_ncep"},{name:"si-x:zabelli_leaf_ncep"},{name:"si-x:zabelli_bloom_ncep"}]},{name:"Spring Indices, Current Year, Alaska",legend_label_filter:{name:"legendDoy"},extent_values_filter:{name:"extentDates",args:[null,"today"]},current_year_only:!0,layers:[{name:"si-x:average_leaf_ncep_alaska"},{name:"si-x:average_bloom_ncep_alaska"},{name:"si-x:arnoldred_leaf_ncep_alaska"},{name:"si-x:arnoldred_bloom_ncep_alaska"},{name:"si-x:lilac_leaf_ncep_alaska"},{name:"si-x:lilac_bloom_ncep_alaska"},{name:"si-x:zabelli_leaf_ncep_alaska"},{name:"si-x:zabelli_bloom_ncep_alaska"}]},{name:"Spring Indices, Daily Anomaly",supports_data:!1,legend_label_filter:{name:"legendSixAnomaly"},extent_default_filter:{name:"agddDefaultTodayTime"},layers:[{name:"si-x:leaf_anomaly"},{name:"si-x:bloom_anomaly"}]},{name:"Spring Indices, 30-Year Average",legend_label_filter:{name:"legendDoy"},extent_default_filter:{name:"agddDefaultTodayElevation"},layers:[{name:"si-x:30yr_avg_six_leaf"},{name:"si-x:30yr_avg_six_bloom"}]}]},ze="1.1.1",Te=256,Ee={service:"WMS",request:"GetMap",version:ze,layers:void 0,styles:"",format:"image/png",transparent:!0,height:Te,width:Te,srs:"EPSG:3857"},Ie=function(){function t(t){this.config=t,this.geoServerUrl=t.geoServerRoot,this.wmsBaseUrl=this.geoServerUrl+"/wms",this.wmsCapabilitiesUrl=this.wmsBaseUrl+"?service=wms&version="+ze+"&request=GetCapabilities"}return t.ctorParameters=function(){return[{type:F.i,decorators:[{type:j.s,args:[F.f]}]}]},t}(),Ue=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ne=function(){function t(t,e,n){var r=this;if(this.map=t,this.layer_def=e,this.wmsBaseUrl=n,e.extent_values_filter){console.debug("layer "+e.name+" has an extent_values_filter, processing",e.extent_values_filter);var i,o=l(e.extent_values_filter.name),a=e.extent.values.map(function(t){return t.value}),s=[a].concat(e.extent_values_filter.args||[]);i=o.apply(void 0,s),console.debug("filteredValues",i.length>1?i[0]+"..."+i[i.length-1]:i),e.extent.values=e.extent.values.filter(function(t){return-1!==i.indexOf(t.value)}),e.extent.current&&-1===i.indexOf(e.extent.current.value)&&(console.debug("current extent value has become invalid, replacing with last option"),e.extent.current=e.extent.values.length?e.extent.values[e.extent.values.length-1]:void 0)}if(e.extent_default_filter){console.debug("layer "+e.name+" has an extent_default_filter, processing",e.extent_default_filter);var p=l(e.extent_default_filter.name),d=[e.extent.values].concat(e.extent_default_filter.values||[]);e.extent.current=p.apply(void 0,d)||e.extent.current,console.debug("resulting default value",e.extent.current)}this.wmsArgs=Ue({},Ee,{layers:e.name}),this.googleLayer=new google.maps.ImageMapType({getTileUrl:function(e,n){var i=t.getProjection(),o=Math.pow(2,n),a=i.fromPointToLatLng(new google.maps.Point(e.x*Te/o,e.y*Te/o)),s=i.fromPointToLatLng(new google.maps.Point((e.x+1)*Te/o,(e.y+1)*Te/o)),l=u(a),p=u(s),d={};r.extent&&r.extent.current&&r.extent.current.addToWmsParams(d);var f={bbox:[l.lng,p.lat,p.lng,l.lat].join(",")};r.sldBody&&(f.sld_body=r.sldBody);var h=Ue({},d,r.wmsArgs,f);return r.wmsBaseUrl+"?"+c(h)},tileSize:new google.maps.Size(Te,Te),name:e.title||e.name}),Object.keys(e).forEach(function(t){r[t]=e[t]})}return t}(),Be=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},qe=function(t){return JSON.parse(JSON.stringify(t))},Ve=function(){function t(t,e,n){this.serviceUtils=t,this.dateExtentUtil=e,this.urls=n}return t.prototype.getLayers=function(t){var e=this;return new Promise(function(n,r){e.getLayerDefinitions().then(function(r){var i=qe(r);i.categories.forEach(function(n){n.layers=n.layers.map(function(n){return new Ne(t,n,e.urls.wmsBaseUrl)})}),n(i)}).catch(r)})},t.prototype.getLayerDefinitions=function(){function t(t){var e=qe(Fe),n=e.description;return e.categories.forEach(function(e){var r=qe(e);delete r.name,delete r.layers,r.description=r.description||n,e.layers=e.layers.map(function(e){var n=qe(r);return Be({},n,t[e.name],e)})}),e}var e=this;return new Promise(function(n,r){e.layerDefs?n(e.layerDefs):e.serviceUtils.cachedGet(e.urls.wmsCapabilitiesUrl,null,!0).then(function(r){var i=Le(Le.parseXML(r));console.debug("WmsMapLayerService:capabilities",i);var o=e._getLayers(i.find("Layer"));console.debug("WmsMapLayerService:wms layer definitions",o),e.layerDefs=t(o),console.debug("WmsMapLayerService:layer definitions",e.layerDefs),n(e.layerDefs)}).catch(r)})},t.prototype.getLayerDefinition=function(t){var e=this;return new Promise(function(n,r){e.getLayerDefinitions().then(function(e){var r=e.categories.reduce(function(t,e){return e.layers.forEach(function(e){t[e.name]=e}),t},{});n(r[t])}).catch(r)})},t.prototype._getLayers=function(t){var e=this;if(t&&!(t.length<2)){var n=[];return t.slice(1).each(function(t,e){n.push(e)}),n.map(function(t){return e._layerToObject(t)}).reduce(function(t,e){return t[e.name]=e,t},{})}},t.prototype._layerToObject=function(t){var e=Le(t),n={name:e.find("Name").first().text(),title:e.find("Title").first().text().replace(/\((.+?)\)/g,""),abstract:e.find("Abstract").first().text(),bbox:this._parseBoundingBox(e.find("EX_GeographicBoundingBox").first()),style:this._parseStyle(e.find("Style").first())};return n.bbox||(n.bbox=this._parseLatLonBoundingBox(e.find("LatLonBoundingBox").first())),n},t.prototype._parseStyle=function(t){var e=Le(t);return{name:e.find("Name").first().text(),title:e.find("Title").first().text().replace(/\((.+?)\)/g,""),legend:e.find("OnlineResource").attr("xlink:href")}},t.prototype._parseLatLonBoundingBox=function(t){if(t.length){var e={westBoundLongitude:parseFloat(t.attr("minx")),eastBoundLongitude:parseFloat(t.attr("maxx")),southBoundLatitude:parseFloat(t.attr("miny")),northBoundLatitude:parseFloat(t.attr("maxy")),getBounds:function(){return new google.maps.LatLngBounds(new google.maps.LatLng(e.southBoundLatitude,e.westBoundLongitude),new google.maps.LatLng(e.northBoundLatitude,e.eastBoundLongitude))}};return e}},t.prototype._parseBoundingBox=function(t){if(t.length){var e={westBoundLongitude:parseFloat(t.find("westBoundLongitude").text()),eastBoundLongitude:parseFloat(t.find("eastBoundLongitude").text()),southBoundLatitude:parseFloat(t.find("southBoundLatitude").text()),northBoundLatitude:parseFloat(t.find("northBoundLatitude").text()),getBounds:function(){return new google.maps.LatLngBounds(new google.maps.LatLng(e.southBoundLatitude,e.westBoundLongitude),new google.maps.LatLng(e.northBoundLatitude,e.eastBoundLongitude))}};return[e.westBoundLongitude,e.eastBoundLongitude,e.southBoundLatitude,e.northBoundLatitude].reduce(function(t,e){return t||0===e||-1===e},!1)?void 0:e}},t.ctorParameters=function(){return[{type:F.j},{type:Re},{type:Ie}]},t}(),Ye=function(t){return t},We=function(){function t(t,e,n,r){var i=this;this.wmsPipeFactory=t,this.color_map=e,this.ldef=n,this.styleDefinition=r,console.log("WmsMapLegend.color_map",e),console.log("WmsMapLegend.ldef",n),console.log("WmsMapLegend.styleDefinition",r);var o=function(t){var e=i.wmsPipeFactory.getPipe(t.name);return e||console.error("WmsMapLegend: Unable to find pipe named "+t.name),function(n,r){var i=[r];return t.args&&(i=i.concat(t.args)),e.transform.apply(e,i)}};this.lformat=n.legend_label_filter?o(n.legend_label_filter):Ye,this.gformat=n.gridded_label_filter?o(n.gridded_label_filter):void 0;var a=e.find("ColorMapEntry");0===a.length&&(a=e.find("sld\\:ColorMapEntry"));var s=a.toArray().reduce(function(t,e,n){var r=Le(e),o=parseFloat(r.attr("quantity")),a=r.attr("label");return t.push({color:r.attr("color"),quantity:o,original_label:a,label:0===n?a:i.lformat(a,o)}),t},[]);this.title_data=s[0],this.data=s.slice(1),this.length=this.data.length}return t.prototype.setLayer=function(t){return this.layer=t,this},t.prototype.getData=function(){return this.data},t.prototype.getStyleDefinition=function(){return this.styleDefinition},t.prototype.getTitle=function(){return this.title_data.label},t.prototype.getColors=function(){return this.data.map(function(t){return t.color})},t.prototype.getQuantities=function(){return this.data.map(function(t){return t.quantity})},t.prototype.getLabels=function(){return this.data.map(function(t){return t.label})},t.prototype.getOriginalLabels=function(){return this.data.map(function(t){return t.original_label})},t.prototype.formatPointData=function(t){return(this.gformat||this.lformat)(t,t)},t.prototype.getPointData=function(t){var e,n,r;for(e=0;e<this.data.length;e++){if(n=this.data[e],r=e+1<this.data.length?this.data[e+1]:void 0,t==n.quantity)return n;if(r&&t>=n.quantity&&t<r.quantity)return n}},t}(),Ge=new Date(2010,0),$e=new Date((new Date).getFullYear(),0),Ke=function(){function t(t){this.decimalPipe=t}return t.prototype.transform=function(t,e){return this.decimalPipe.transform(t,"1.0")+(e?" AGDD":"")},t.ctorParameters=function(){return[{type:Qt.e}]},t}(),He=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t){var e=this.datePipe.transform(new Date,"MMMM d");return(t||[]).reduce(function(t,n){return t||(n.label==e?n:void 0)},void 0)},t.ctorParameters=function(){return[{type:Qt.d}]},t}(),Je=function(){function t(t){this.decimalPipe=t}return t.prototype.transform=function(t,e){if(0===t)return"No Difference";var n=t<0;return this.decimalPipe.transform(Math.abs(t),"1.0")+(e?" AGDD ":" ")+(n?"<":">")+" Avg"},t.ctorParameters=function(){return[{type:Qt.e}]},t}(),Xe=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t){var e=this.datePipe.transform(new Date,"MMMM d, y");return(t||[]).reduce(function(t,n){return t||(n.label==e?n:void 0)},void 0)},t.ctorParameters=function(){return[{type:Qt.d}]},t}(),Ze=function(){function t(){}return t.prototype.transform=function(t){if(0===t)return"No Difference";var e=t<0;return Math.abs(t)+" Days "+(e?"Early":"Late")},t}(),Qe=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t,e,n){return t=Math.round(t),0===t&&(t=1),e=e||"MMM d",this.datePipe.transform(new Date((n?$e:Ge).getTime()+864e5*(t-1)),e)},t.ctorParameters=function(){return[{type:Qt.d}]},t}(),tn=function(){function t(t,e){this.datePipe=t,this.dateExtentUtil=e}return t.prototype.toTime=function(t){var e=new Date;return"yesterday"===t||"today"===t||"tomorrow"===t?("yesterday"===t?e.setTime(e.getTime()-864e5):"tomorrow"===t&&e.setTime(e.getTime()+864e5),t=this.datePipe.transform(e,"yyyy-MM-dd 00:00:00")):-1===t.indexOf("T")&&(t=e.getFullYear()+"-"+t+" 00:00:00"),this.dateExtentUtil.parse(t).getTime()},t.prototype.transform=function(t,e,n){var r=this,i=e?this.toTime(e):void 0,o=n?this.toTime(n):void 0;return(i||o)&&(t=t.filter(function(t){var e=r.dateExtentUtil.parse(t).getTime();return(!i||i&&e>i)&&(!o||o&&e<o)})),t},t.ctorParameters=function(){return[{type:Qt.d},{type:Re}]},t}(),en=function(){function t(t,e,n,r,i,o,a){this.legendGddUnits=t,this.agddDefaultTodayElevation=e,this.legendAgddAnomaly=n,this.agddDefaultTodayTime=r,this.legendSixAnomaly=i,this.legendDoy=o,this.extentDates=a,this.pipes={},this.pipes.legendGddUnits=t,this.pipes.agddDefaultTodayElevation=e,this.pipes.legendAgddAnomaly=n,this.pipes.agddDefaultTodayTime=r,this.pipes.legendSixAnomaly=i,this.pipes.legendDoy=o,this.pipes.extentDates=a}return t.prototype.getPipe=function(t){return this.pipes[t]},t.ctorParameters=function(){return[{type:Ke},{type:He},{type:Je},{type:Xe},{type:Ze},{type:Qe},{type:tn}]},t}(),nn=function(){function t(t,e,n,r){this.wmsPipeFactory=t,this.serviceUtils=e,this.layerService=n,this.urls=r,this.legends={}}return t.prototype.getLegend=function(t){var e=this;return new Promise(function(n,r){if(e.legends[t])return n(e.legends[t]);e.layerService.getLayerDefinition(t).then(function(i){if(!i)return r("layer definition for "+t+" not found.");e.serviceUtils.cachedGet(e.urls.wmsBaseUrl,{service:"wms",request:"GetStyles",version:ze,layers:t},!0).then(function(r){var o=Le(Le.parseXML(r)),a=o.find("ColorMap");0===a.length&&(a=o.find("sld\\:ColorMap"));var s=0!==a.length?new We(e.wmsPipeFactory,Le(a.toArray()[0]),i,o):void 0;e.legends[t]=s,n(s)}).catch(r)})})},t.ctorParameters=function(){return[{type:en},{type:F.j},{type:Ve},{type:Ie}]},t}(),rn=(function(){function t(){this.opacity=100}t.prototype.opacityChanged=function(){this.supportsOpacity&&this.supportsOpacity.setOpacity(this.opacity/100)},t.prototype.ngOnChanges=function(t){console.log("WmsMapOpacityControl.ngOnchanges",t),t.supportsOpacity&&t.supportsOpacity.currentValue&&(this.opacity=Math.round(100*t.supportsOpacity.currentValue.getOpacity()))}}(),function(){function t(){}return t}()),on=function(){function t(t,e,n,r){this.serviceUtils=t,this.datePipe=e,this.mapLegendService=n,this.config=r}return t.prototype.newSelection=function(){return new je(this.serviceUtils,this.datePipe,this.mapLegendService,this.config)},t.ctorParameters=function(){return[{type:F.j},{type:Qt.d},{type:nn},{type:F.i,decorators:[{type:j.s,args:[F.f]}]}]},t}(),an=(function(){function t(){}t.prototype.serviceChange=function(){this.validLayers=this.selection.validLayers;var t=this.selection,e=this.selection.validLayers;t.layer=e.length?e[0]:void 0,this.layerChange()},t.prototype.layerChange=function(){var t=this.selection;t.isValid()?t.update():t.reset()},t.prototype.ngOnInit=function(){this.validServices=this.selection.validServices,this.serviceChange()}}(),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),sn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.latitude=38.8402805,e.longitude=-97.61142369999999,e.zoom=4,e.getMapPromise=new Promise(function(t){e.getMapResolver=t}),e.mapStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"off"}]}],e}return an(e,t),e.prototype.mapReady=function(t){var e=this;t.addListener("resize",function(){console.log("resize happened"),console.log("panning to center"),t.setZoom(3),setTimeout(function(){t.panTo(new google.maps.LatLng(e.latitude,e.longitude)),t.setZoom(e.zoom)},500)}),this.getMapResolver(t)},e.prototype.getMap=function(){return this.getMapPromise},e.prototype.resize=function(){var t=this;this.getMap().then(function(e){var n=t.getSizeInfo(),r=t.rootElement.nativeElement,i=r.querySelector("agm-map");i.style.width=n.width+"px",i.style.height=n.height+"px",google.maps.event.trigger(e,"resize")})},e.prototype.reset=function(){var t=this;this.getMap().then(function(e){console.log("Map reset",e),e.panTo(new google.maps.LatLng(t.latitude,t.longitude)),e.setZoom(t.zoom)})},e.prototype.redraw=function(){this.getMap().then(function(t){console.log("Map redraw",t)})},e.prototype.update=function(){this.resize(),this.getMap().then(function(t){console.log("Map update",t)})},e}(st),ln=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cn=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}ln(e,t),e.prototype.mapReady=function(t){this.getMapResolver(t)},e.prototype.reset=function(){var e=this;this.getMap().then(function(n){e.selection.removeFrom(n).then(function(){t.prototype.reset.call(e)})})},e.prototype.update=function(){var t=this;this.resize(),this.getMap().then(function(e){t.selection.removeFrom(e).then(function(){t.selection.addTo(e)})})},e.prototype.resize=function(){var e=this;t.prototype.resize.call(this),this.getMap().then(function(t){return e.selection.resizeMap(t)})}}(sn),n("T3r2")),un=function(){function t(t,e,n,r,i,o){this.calendar=t,this.scatter=e,this.activity=n,this.observer=r,this.observationFreq=i,this.clippedWmsMap=o,this.factoryMap={},this.factoryMap.CalendarSelection=t,this.factoryMap.ScatterPlotSelection=e,this.factoryMap.ActivityCurvesSelection=n,this.factoryMap.ObserverActivitySelection=r,this.factoryMap.ObservationFrequencySelection=i,this.factoryMap.ClippedWmsMapSelection=o}return t.prototype.newCalendarSelection=function(){return this.calendar.newSelection()},t.prototype.newScatterPlotSelection=function(){return this.scatter.newSelection()},t.prototype.newActivityCurvesSelection=function(){return this.activity.newSelection()},t.prototype.newObserverActivitySelection=function(){return this.observer.newSelection()},t.prototype.newObservationFrequencySelection=function(){return this.observationFreq.newSelection()},t.prototype.newClippedWmsMapSelection=function(){return this.clippedWmsMap.newSelection()},t.prototype.cloneSelection=function(t){return this.newSelection(t.external)},t.prototype.newSelections=function(t){var e=this;return t.map(function(t){return e.newSelection(t)})},t.prototype.newSelection=function(t){if(!this.factoryMap[t.$class])throw new Error('Unknown selection type "'+t.$class+'"');var e=this.factoryMap[t.$class].newSelection();return e.external=t,e},t.ctorParameters=function(){return[{type:Ot},{type:it},{type:te},{type:he},{type:xe},{type:on}]},t}(),pn=function(){function t(){}return t}(),dn=function(){function t(){}return t}(),fn=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},hn=new R.d({"Content-Type":"application/json"}),gn=function(){function t(t,e,n){this.http=t,this.cacheService=e,this.selectionFactory=n}return t.prototype.parseSelections=function(t){return this.selectionFactory.newSelections(JSON.parse(t))},t.prototype.refugeUrl=function(t){return"/api/refuge/"+t},t.prototype.castRefuge=function(t,e){e.id=t;var n=(e.selections||[]).map(function(t){return JSON.parse(t)});return e.selections=this.selectionFactory.newSelections(n),e},t.prototype.refugeList=function(t){return this.http.get("/api/refuge",{params:{terse:t}}).map(function(t){return t.json()}).map(function(t){return Object.keys(t).map(function(e){return t[e]})})},t.prototype.getRefuge=function(t){var e=this;return new Promise(function(n,r){e.http.get(e.refugeUrl(t)).toPromise().then(function(r){n(e.castRefuge(t,r.json()))}).catch(r)})},t.prototype.saveRefuge=function(t){var e=this;return new Promise(function(n,r){var i=fn({},t);i.selections=(i.selections||[]).map(function(t){return JSON.stringify(t.external)});var o=JSON.stringify(i);console.log("JSON "+o),e.http.put(e.refugeUrl(t.id),o,{headers:hn}).toPromise().then(function(r){n(e.castRefuge(t.id,r.json()))}).catch(r)})},t.ctorParameters=function(){return[{type:R.e},{type:F.a},{type:un}]},t}(),yn=(function(){function t(){}}(),function(){function t(){}}(),function(){function t(t,e){this.element=t,this.refugeService=e,this.userIsLoggedIn=!1;var n=t.nativeElement;this.userIsLoggedIn=null!==n.getAttribute("user_is_logged_in")}return t.prototype.ngOnInit=function(){},t.prototype.selectedTabChange=function(t){console.debug("selectedTabChange",t)},t.ctorParameters=function(){return[{type:j.o},{type:gn}]},t}()),mn=n("O00e"),_n=[""],vn=n("j5BN"),bn=["agm-map[_ngcontent-%COMP%]{height:500px}.control-form[_ngcontent-%COMP%]{margin:0!important;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-line-pack:start;align-content:flex-start}.control-form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:5px}.control-form[_ngcontent-%COMP%]   .refuges-input[_ngcontent-%COMP%]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}@media (min-width:992px){.control-form[_ngcontent-%COMP%]   .refuges-input[_ngcontent-%COMP%]{max-width:60%}}.map-wrapper[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]     .gridded-legend{margin-top:10px;border-bottom:1px solid #aaa}@media (min-width:992px){.map-wrapper[_ngcontent-%COMP%]   clipped-wms-map-statistics[_ngcontent-%COMP%], .map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]{position:absolute;left:10px;padding:8px;border:1px solid #aaa;background-color:hsla(0,0%,100%,.5);border-radius:5px}.map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]{bottom:25px;width:60%}.map-wrapper[_ngcontent-%COMP%]   wms-map-legend[_ngcontent-%COMP%]     .gridded-legend{margin-top:0;border-bottom:none;width:100%;height:125px;border:none}.map-wrapper[_ngcontent-%COMP%]   clipped-wms-map-statistics[_ngcontent-%COMP%]{top:10px}}.refuge-statement[_ngcontent-%COMP%]{margin-top:15px}"],xn=n("8oXs"),wn=n("6OSA"),Sn=n("Lpd/"),Pn=n("1ini"),On=n("OFGE"),Dn=n("l6RC"),kn=n("fc+i"),Cn=n("SlD5"),jn=n("V8+5"),An=n("Elun"),Ln=n("EPfU"),Mn=n("gOiy"),Rn=n("4jwp"),Fn=n("wjk8"),zn=n("ghl+"),Tn=n("8Xfy"),En=n("jk5D"),In=n("OBOK"),Un=n("0bRs"),Nn=n("57RD"),Bn=n("dY6p"),qn=n("RH9C"),Vn=n("kuH+"),Yn=n("xs7O"),Wn=n("6Lcc"),Gn=n("Dqrr"),$n=function(){function t(){var t=this;this.getMap=new Promise(function(e){return t.mapResolver=e}),this.latitude=41.13576,this.longitude=-99.157679,this.zoom=4,this.mapStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"off"}]}]}return t.prototype.configureMap=function(t){},t.prototype.mapReady=function(t){this.configureMap(t),this.mapResolver(t)},t}(),Kn=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Hn=function(t){function e(e,n){var r=t.call(this)||this;return r.refugeService=e,r.selectionFactory=n,r.componentDestroyed=new Gn.Subject,r.refugeFormControl=new le.f,r.selectionFormControl=new le.f,r}return Kn(e,t),e.prototype._filterRefuges=function(t){return this.refuges?(t=t.toLowerCase(),this.refuges.filter(function(e){return-1!==e.title.toLowerCase().indexOf(t)})):[]},e.prototype.ngOnInit=function(){var t=this;this.refugeService.refugeList(!0).map(function(t){return t.filter(function(t){return!!t.location})}).subscribe(function(e){return t.refuges=e}),this.refugeFormControl.valueChanges.takeUntil(this.componentDestroyed).filter(function(t){return!t||"object"==typeof t}).map(function(t){return"object"==typeof t?t:null}).subscribe(function(e){return t.focusRefuge(e)}),this.filteredRefuges=this.refugeFormControl.valueChanges.filter(function(t){return"string"==typeof t}).map(function(e){return e?t._filterRefuges(e):t.refuges?t.refuges.slice():[]}),this.selectionFormControl.valueChanges.takeUntil(this.componentDestroyed).filter(function(t){return"object"==typeof t}).subscribe(function(e){return t.setSelection(e)})},e.prototype.ngOnDestroy=function(){this.componentDestroyed.next()},e.prototype.newSelection=function(t,e,n){var r=this.selectionFactory.newSelection();return r.networkIds=[t.network_id],r.fwsBoundary=t.boundary_id,r.service=e,r.layer=r.validLayers.reduce(function(t,e){return t||(e.id===n?e:void 0)},void 0),r},e.prototype.refugeTitle=function(t){return t?t.title:""},e.prototype.refugeClick=function(t){this.refugeFormControl.setValue(t)},e.prototype.reset=function(){this.refugeFormControl.setValue(null)},e.prototype.focusRefuge=function(t){var e=this;if(console.debug("focusRefuge",t),this.focused=t,!t)return this.selections=null,this.selectionFormControl.setValue(null),void this.getMap.then(function(t){t.setCenter(new google.maps.LatLng(e.latitude,e.longitude)),t.setZoom(e.zoom)});this.getMap.then(function(e){e.panTo(new google.maps.LatLng(t.location.lat,t.location.lng)),e.setZoom(8)}),console.log("focusRefuge",t);var n,r=[],i=new Date(2017,4,2,0,0,0,0),o=new Date(i.getTime()-864e5);n=this.newSelection(t,"si-x","current"),n.explicitDate=o,r.push({label:"Where has Spring Arrived?",selection:n}),n=this.newSelection(t,"si-x","forecast"),n.explicitDate=i,n.forecastDays=3,r.push({label:"Spring Forecast",selection:n}),n=this.newSelection(t,"si-x","anomaly"),n.explicitDate=o,r.push({label:"How does this year stack up?",selection:n}),this.selections=r,this.selectionFormControl.setValue(this.selections[0].selection)},e.prototype.setSelection=function(t){var e=this;console.debug("setSelection",t?t.external:"NULL"),this.getMap.then(function(n){var r=function(){(e.selection=t)&&t.addTo(n).then(function(){return console.debug("added selection",t.external)})};e.selection?e.selection.removeFrom(n).then(r):r()})},e.ctorParameters=function(){return[{type:gn},{type:on}]},e}($n),Jn=n("9U4N"),Xn=n("BfPg"),Zn=n("KdOF"),Qn=n("DCX4"),tr=n("Ds4W"),er=n("9fk+"),nr=n("mECe"),rr=n("7PDj"),ir=n("wW3n"),or=n("t+Rn"),ar=[bn],sr=j._13({encapsulation:0,styles:ar,data:{}}),lr=(j._11("status-of-spring",Hn,O,{},{},[]),[_n]),cr=j._13({encapsulation:0,styles:lr,data:{}}),ur=j._11("spring-dashboard",yn,C,{},{},[]),pr=n("f9zQ"),dr=n("fL27"),fr=n("EyWH"),hr=n("gdRU"),gr=n("8aeK"),yr=n("YcBH"),mr=n("Zyxv"),_r=n("vHGP"),vr=n("Mxwl"),br=n("BcUv"),xr=n("Pp7C"),wr=n("ppgG"),Sr=n("ka8K"),Pr=n("vgc3"),Or=n("niyx"),Dr=n("wvx+"),kr=n("0cZJ"),Cr=n("CZgk"),jr=n("RXNa"),Ar=n("kMVV"),Lr=n("cC+T"),Mr=n("q+Vp"),Rr=j._12(L,[yn],function(t){return j._27([j._28(512,j.k,j._8,[[8,[mn.a,ur]],[3,j.k],j.B]),j._28(5120,j.z,j._26,[[3,j.z]]),j._28(4608,Qt.j,Qt.i,[j.z]),j._28(4608,j.i,j.i,[]),j._28(5120,j.a,j._17,[]),j._28(5120,j.x,j._23,[]),j._28(5120,j.y,j._24,[]),j._28(4608,kn.c,kn.t,[Qt.c]),j._28(6144,j.P,null,[kn.c]),j._28(4608,kn.f,vn.d,[]),j._28(5120,kn.d,function(t,e,n,r){return[new kn.l(t),new kn.p(e),new kn.o(n,r)]},[Qt.c,Qt.c,Qt.c,kn.f]),j._28(4608,kn.e,kn.e,[kn.d,j.D]),j._28(135680,kn.n,kn.n,[Qt.c]),j._28(4608,kn.m,kn.m,[kn.e,kn.n]),j._28(5120,pr.a,dr.d,[]),j._28(5120,pr.c,dr.e,[]),j._28(4608,pr.b,dr.c,[pr.a,pr.c]),j._28(5120,j.N,dr.f,[kn.m,pr.b,j.D]),j._28(6144,kn.q,null,[kn.n]),j._28(4608,j.V,j.V,[j.D]),j._28(4608,kn.h,kn.h,[Qt.c]),j._28(4608,kn.j,kn.j,[Qt.c]),j._28(4608,fr.b,dr.b,[j.N,kn.b]),j._28(4608,le.s,le.s,[]),j._28(4608,le.e,le.e,[]),j._28(4608,hr.a,hr.a,[gr.a]),j._28(4608,R.c,R.c,[]),j._28(4608,R.h,R.b,[]),j._28(5120,R.k,R.l,[]),j._28(4608,R.j,R.j,[R.c,R.h,R.k]),j._28(4608,R.g,R.a,[]),j._28(5120,R.e,R.m,[R.j,R.g]),j._28(4608,Qt.d,Qt.d,[j.z]),j._28(4608,yr.a,yr.a,[R.e,hr.a,Qt.d,gr.a]),j._28(4608,mr.a,mr.a,[R.e,hr.a,gr.a]),j._28(4608,_r.a,_r.a,[R.e,hr.a,gr.a]),j._28(4608,vr.a,vr.a,[]),j._28(4608,br.a,br.a,[]),j._28(4608,xr.a,xr.a,[Qt.d]),j._28(4608,jn.a,jn.a,[]),j._28(6144,Dn.b,null,[kn.b]),j._28(4608,Dn.c,Dn.c,[[2,Dn.b]]),j._28(4608,Tn.i,Tn.i,[jn.a]),j._28(4608,Tn.h,Tn.h,[Tn.i,jn.a,j.D]),j._28(136192,Tn.e,Tn.c,[[3,Tn.e],jn.a]),j._28(5120,Tn.l,Tn.k,[[3,Tn.l],[2,Tn.j],jn.a]),j._28(5120,Tn.g,Tn.f,[[3,Tn.g],j.D,jn.a]),j._28(4608,wr.a,wr.a,[]),j._28(5120,Rn.c,Rn.a,[[3,Rn.c],j.D,jn.a]),j._28(5120,Rn.f,Rn.e,[[3,Rn.f],jn.a,j.D,Rn.c]),j._28(4608,On.g,On.g,[Rn.c,Rn.f]),j._28(5120,On.d,On.i,[[3,On.d]]),j._28(4608,On.l,On.l,[Rn.f]),j._28(4608,On.b,On.b,[On.g,On.d,j.k,On.l,j.e,j.v,j.D]),j._28(5120,On.j,On.k,[On.b]),j._28(5120,Mn.a,Mn.b,[On.b]),j._28(4608,vn.c,vn.c,[]),j._28(5120,Sr.c,Sr.d,[[3,Sr.c]]),j._28(5120,Pn.a,Pn.b,[On.b]),j._28(5120,En.a,En.b,[On.b]),j._28(5120,ot.a,ot.c,[]),j._28(4608,ot.b,ot.b,[ot.a]),j._28(4608,ot.f,ot.f,[j.D,Qt.c]),j._28(5120,ot.g,ot.e,[[3,ot.g],ot.b,ot.f]),j._28(5120,ot.j,ot.i,[[3,ot.j],ot.f,ot.b]),j._28(4608,Qt.e,Qt.e,[j.z]),j._28(4608,Re,Re,[]),j._28(4608,Ke,Ke,[Qt.e]),j._28(4608,He,He,[Qt.d]),j._28(4608,Je,Je,[Qt.e]),j._28(4608,Xe,Xe,[Qt.d]),j._28(4608,Ze,Ze,[]),j._28(4608,Qe,Qe,[Qt.d]),j._28(4608,tn,tn,[Qt.d,Re]),j._28(4608,en,en,[Ke,He,Je,Xe,Ze,Qe,tn]),j._28(4608,Ie,Ie,[gr.a]),j._28(4608,Ve,Ve,[_r.a,Re,Ie]),j._28(4608,nn,nn,[en,_r.a,Ve,Ie]),j._28(4608,it,it,[R.e,hr.a,gr.a]),j._28(4608,Ot,Ot,[R.e,hr.a,vr.a,gr.a]),j._28(4608,on,on,[_r.a,Qt.d,nn,gr.a]),j._28(4608,te,te,[R.e,hr.a,Qt.d,gr.a]),j._28(4608,he,he,[_r.a]),j._28(4608,xe,xe,[_r.a,mr.a]),j._28(4608,un,un,[Ot,it,te,he,xe,on]),j._28(5120,Pr.c,Pr.a,[[3,Pr.c],[2,R.e],kn.c]),j._28(4608,Or.c,Or.c,[]),j._28(4608,Or.b,Or.b,[]),j._28(4608,ir.a,Dr.b,[Dr.a,Or.c,Or.b]),j._28(4608,gn,gn,[R.e,hr.a,un]),j._28(512,Qt.b,Qt.b,[]),j._28(1024,j.p,kn.r,[]),j._28(1024,j.b,function(t,e){return[kn.s(t,e)]},[[2,kn.i],[2,j.C]]),j._28(512,j.c,j.c,[[2,j.b]]),j._28(131584,j._15,j._15,[j.D,j._9,j.v,j.p,j.k,j.c]),j._28(2048,j.e,null,[j._15]),j._28(512,j.d,j.d,[j.e]),j._28(512,kn.a,kn.a,[[3,kn.a]]),j._28(512,dr.a,dr.a,[]),j._28(512,le.q,le.q,[]),j._28(512,le.i,le.i,[]),j._28(512,le.p,le.p,[]),j._28(512,F.h,F.h,[]),j._28(512,jn.b,jn.b,[]),j._28(512,Sn.c,Sn.c,[]),j._28(512,vn.a,vn.a,[]),j._28(512,Dn.a,Dn.a,[]),j._28(256,vn.e,!0,[]),j._28(512,vn.k,vn.k,[[2,vn.e]]),j._28(512,vn.u,vn.u,[]),j._28(512,Tn.a,Tn.a,[]),j._28(512,zn.c,zn.c,[]),j._28(512,wr.b,wr.b,[]),j._28(512,kr.a,kr.a,[]),j._28(512,Cr.c,Cr.c,[]),j._28(512,Rn.b,Rn.b,[]),j._28(512,On.e,On.e,[]),j._28(512,vn.s,vn.s,[]),j._28(512,vn.p,vn.p,[]),j._28(512,Mn.d,Mn.d,[]),j._28(512,Un.b,Un.b,[]),j._28(512,jr.a,jr.a,[]),j._28(512,Pn.d,Pn.d,[]),j._28(512,Cn.b,Cn.b,[]),j._28(512,Ar.a,Ar.a,[]),j._28(512,Lr.a,Lr.a,[]),j._28(512,En.d,En.d,[]),j._28(512,Mr.a,Mr.a,[]),j._28(512,ot.h,ot.h,[]),j._28(512,ot.d,ot.d,[]),j._28(512,rn,rn,[]),j._28(512,pn,pn,[]),j._28(512,R.f,R.f,[]),j._28(512,dn,dn,[]),j._28(512,Pr.b,Pr.b,[]),j._28(512,L,L,[]),j._28(1024,gr.a,i,[]),j._28(1024,F.e,r,[]),j._28(256,Yn.a,void 0,[]),j._28(256,Dr.a,{apiKey:"AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE"},[])])});A.a.production&&Object(j._2)(),Object(kn.k)().bootstrapModuleFactory(Rr)},gFIY:function(t,e){function n(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="gFIY"},gdRU:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("/oeL"),i=n("8aeK"),o=n("XXyR"),a=(n.n(o),function(){function t(t){this.config=t,this.ttl=36e5,"number"==typeof t.cacheTTL&&(this.ttl=60*t.cacheTTL*1e3),console.log("CacheService Time To Live "+this.ttl/6e4+" minutes"),0===this.ttl&&(console.log("Caching disabled clearing local session storage"),sessionStorage.clear())}return t.prototype.cacheKey=function(t){return"string"!=typeof t&&(t=JSON.stringify(t)),o.Md5.hashStr(t).toString()},t.prototype.get=function(t){if(this.ttl<=0)return null;var e=this.cacheKey(t),n=sessionStorage.getItem(e);if(n){if(n=JSON.parse(n),Date.now()<n.expiry)return console.log("cache hit",e,t),n.data;console.log("cache expired",e),window.sessionStorage.removeItem(e)}else console.log("cache miss",e);return null},t.prototype.set=function(t,e){if(this.ttl<=0)return null;var n=this.cacheKey(t);if(e){var r={expiry:Date.now()+this.ttl,data:e};console.log("caching",n,e);try{sessionStorage.setItem(n,JSON.stringify(r))}catch(t){console.log("error storing item in cache",t),console.log("clearing"),sessionStorage.clear();try{sessionStorage.setItem(n,JSON.stringify(r))}catch(t){console.log("error on second store attempt (giving up).",t)}}}else console.log("removing from cache",n),sessionStorage.removeItem(n)},t.ctorParameters=function(){return[{type:i.b,decorators:[{type:r.s,args:[i.a]}]}]},t}());!function(){function t(){}}()},"kuH+":function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=n("/oeL"),i=n("4Y6l"),o=n("bKpL"),a=(n.n(o),n("Xtvq")),s=(n.n(a),n("azLz")),l=(n.n(s),n("ckYf")),c=function(){function t(t,e){this.window=t,this.rootElement=e}return t.prototype.ngAfterViewInit=function(){var t=this;console.debug("WmsMapLegendComponent.ngAfterViewInit"),this.resizeSubscription=o.Observable.fromEvent(window,"resize").debounceTime(500).subscribe(function(e){return t.redraw()}),this.svg=l.m(this.rootElement.nativeElement).select("svg"),console.debug("WmsMapLegendComponent:SVG",this.svg)},t.prototype.ngOnChanges=function(t){var e=this;console.debug("WmsMapLegendComponent.ngOnChanges",t),setTimeout(function(){return e.redraw()})},t.prototype.ngOnDestroy=function(){console.debug("WmsMapLegendComponent.ngOnDestroy"),this.resizeSubscription&&this.resizeSubscription.unsubscribe()},t.prototype.redraw=function(){function t(t,e,n){var r=u+c+b;t.append("line").attr("x1",s/2).attr("y1",r).attr("x2",s/2).attr("y2",r+v).attr("stroke","black").attr("stroke-width","1"),t.append("text").attr("dx",s/2).attr("dy","4em").style("text-anchor",n).text(e)}console.debug("WmsMapLegendComponent.redraw");var e=this.svg,n=this.legend;if(e&&e.selectAll("g").remove(),n&&e){var r=parseFloat(e.style("width").replace("px","")),i=parseFloat(e.style("height").replace("px","")),o=n.getData(),a=Math.floor(o.length/2),s=r/o.length,c=30,u=2;console.debug("WmsMapLegendComponent.svg dimensions",r,i),console.debug("WmsMapLegendComponent.legend cell width",s);var p=e.append("g"),d=p.selectAll("g.cell").data(o).enter().append("g").attr("class",function(t,e){return"cell"+(0===e?" first":e===a?" middle":e===o.length-1?" last":"")}).attr("transform",function(t,e){return"translate("+e*s+","+u+")"}).append("rect").attr("height",c).attr("width",s).style("stroke","black").style("stroke-width","1px").style("fill",function(t,e){return t.color});if(n.ldef.legend_delimiter_every){var f=n.ldef.legend_delimiter_every,h=0,g=o.map(function(t,e){return e+1===o.length||(h+=o[e+1].quantity-o[e].quantity)>=f&&(h=0,!0)}),y=[s+1,c,s+1,c].join(","),m=[2*s+c,c].join(","),_=[s+1,c,s+c+1,0].join(",");console.debug("WmsMapLegendComponent.legend_delimiter_every",f),d.style("stroke-dasharray",function(t,e){return 0===e?g[e]?void 0:_:g[e]?m:y}).attr("width",function(t,e){var n=parseFloat(l.m(this).attr("width"));return g[e]?n:n+1}),p.selectAll("g.cell").append("line").attr("stroke",function(t,e){return g[e]?"black":"none"}).attr("stroke-width",2).attr("x1",s-1).attr("x2",s-1).attr("y1",0).attr("y2",c)}d.append("title").text(function(t){return t.label});var v=5,b=3;t(e.select("g.cell.first"),o[0].label,"start"),t(e.select("g.cell.middle"),o[a].label,"middle"),t(e.select("g.cell.last"),o[o.length-1].label,"end"),n.ldef.legend_units&&e.append("g").append("text").attr("dx",r/2).attr("dy",75+u).attr("text-anchor","middle").text(n.ldef.legend_units);var x=n.ldef.title;n.ldef.extent&&n.ldef.extent.current&&(x+=", "+n.ldef.extent.current.label),e.append("g").append("text").attr("dx",5).attr("dy",100+u).attr("font-size","18px").attr("text-anchor","right").text(x),e.append("g").append("text").attr("dx",5).attr("dy",118+u).attr("font-size","11px").attr("text-anchor","right").text("USA National Phenology Network, www.usanpn.org")}},t.ctorParameters=function(){return[{type:i.n},{type:r.o}]},t}()},vHGP:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n("/oeL"),i=n("CPp0"),o=n("82j9"),a=(n.n(o),n("gdRU")),s=n("8aeK"),l=function(){function t(t,e,n){this.http=t,this.cache=e,this.config=n}return t.prototype.apiUrl=function(t){return""+this.config.apiRoot+t},t.prototype.dataApiUrl=function(t){return""+this.config.dataApiRoot+t},t.prototype.cachedGet=function(t,e,n){var r=this;return e=e||{},new Promise(function(i,o){var a={u:t,params:e},s=r.cache.get(a);s?i(s):r.http.get(t,{params:e}).toPromise().then(function(t){s=n?t.text():t.json(),r.cache.set(a,s),i(s)}).catch(o)})},t.ctorParameters=function(){return[{type:i.e},{type:a.a},{type:s.b,decorators:[{type:r.s,args:[s.a]}]}]},t}()},xs7O:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(){}return t}()}},[0]);