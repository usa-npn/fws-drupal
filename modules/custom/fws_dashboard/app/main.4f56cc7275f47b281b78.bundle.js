webpackJsonp([1],{"+6ye":function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("tf1B"),r=n("azLz"),o=(n.n(r),function(){function t(){this.axis=i.a,this.updateSent=!1}return t.prototype.ngOnInit=function(){0===this.selection.plots.length&&this.addPlot()},t.prototype.updateChange=function(){this.selection.isValid()&&(this.selection.update(),this.updateSent=!0)},t.prototype.redrawChange=function(t){this.selection.isValid()&&(t&&!t.oldValue&&t.newValue?this.updateChange():this.updateSent?this.selection.redraw():this.updateChange())},t.prototype.addPlot=function(){this.selection.plots.push({})},t.prototype.removePlot=function(t){this.selection.plots.splice(t,1),this.updateChange()},t.prototype.plotsValid=function(){return this.selection.plots.length===this.selection.validPlots.length},t}())},"/3a9":function(t,e,n){"use strict";n.d(e,"a",function(){return d}),n.d(e,"b",function(){return p});var i=n("/oeL"),r=n("5vU8"),o=n("Iake"),l=n("ytvl"),a=n("ckYf"),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),u=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},c="Site visits by month",d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="observation-frequency.png",e.margins=u({},r.a,{top:80,left:80}),e}return s(e,t),Object.defineProperty(e.prototype,"station",{get:function(){return this._station},set:function(t){this._station=t,this.selection.editMode&&(delete this.selection.defaultStation,this._station&&(this.selection.defaultStation=this._station.station_id))},enumerable:!0,configurable:!0}),e.prototype.getMonthFormat=function(){return this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){console.debug("ObservationFrequencyComponent.reset"),t.prototype.reset.call(this);var e=this.chart,n=this.sizing,i=a.n(this.getMonthFormat());this.baseFontSize();this.title=e.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x","0").style("text-anchor","start").style("font-size","18px"),this.x=Object(l.a)().rangeRound([0,n.width]).padding(.05).domain(a.l(0,12)),this.xAxis=Object(o.a)(this.x).tickFormat(function(t){return i(new Date(1900,t))}),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis),this.y=Object(l.b)().range([n.height,0]).domain([0,20]),this.yAxis=Object(o.b)(this.y).tickFormat(a.i(".0d")),e.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",n.height/2*-1).style("text-anchor","middle").text("Site visits"),this.commonUpdates()},e.prototype.update=function(){var t=this;console.debug("ObservationFrequencyComponent.update"),this.reset(),delete this.data,delete this.stations,delete this.station,this.selection.getData().then(function(e){t.data=e,t.stations=e.stations,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;console.debug("ObservationFrequencyComponent.redrawSvg:data",this.data),this.stations&&this.stations.length&&(this.station||(this.selection.defaultStation&&(this.station=this.stations.reduce(function(e,n){return e||(n.station_id===t.selection.defaultStation?n:void 0)},void 0)),this.station||(this.station=this.stations[0])),this.redrawStation(),this.commonUpdates())},e.prototype.redrawStation=function(){var t=this;if(this.title.text(c+', "TODO: Refuge Name", '+this.selection.year),this.station){var e=this.station;if(console.debug("ObservationFrequencyComponent.redrawStation:station",e),e){var n=this.sizing,i=e.months.slice(),r=i.reduce(function(t,e){return t+e},0),o=i.reduce(function(t,e){return e>t?e:t},0);this.title.text(c+" ("+this.selection.year+') "'+e.station_name+'" Total: '+r),console.debug("ObservationFrequencyComponent.redrawStation:bars",i),this.x.domain(a.l(0,i.length)),this.chart.selectAll("g .x.axis").call(this.xAxis),this.y.domain([0,o]),this.yAxis.ticks(o<11?o:10),this.chart.selectAll("g .y.axis").call(this.yAxis),this.chart.selectAll("g .bars").remove(),this.chart.append("g").attr("class","bars").attr("fill","#98abc5").selectAll("rect").data(i).enter().append("rect").attr("x",function(e,n){return t.x(n)}).attr("y",function(e){return t.y(e)}).attr("title",function(t){return t}).attr("height",function(e){return n.height-t.y(e)}).attr("width",this.x.bandwidth()),this.chart.selectAll("g .bar-labels").remove(),this.chart.append("g").attr("class","bar-labels").attr("fill","#000000").selectAll("text").data(i).enter().append("text").attr("text-anchor","middle").attr("dy","-0.25em").attr("x",function(e,n){return t.x(n)+t.x.bandwidth()/2}).attr("y",function(e){return t.y(e)}).text(function(t){return t})}}},e}(r.b),p=function(){function t(){this.stationChange=new i.q,this.onStationChange=new i.q}return Object.defineProperty(t.prototype,"station",{get:function(){return this.stationValue},set:function(t){if(t!==this.stationValue){var e=this.stationValue;this.stationChange.emit(this.stationValue=t),this.onStationChange.emit({oldValue:e,newValue:this.stationValue})}},enumerable:!0,configurable:!0}),t.prototype.prev=function(){var t=this.stations.indexOf(this.station);this.station=t>0?this.stations[t-1]:this.stations[this.stations.length-1]},t.prototype.next=function(){var t=this.stations.indexOf(this.station);t<this.stations.length-1?this.station=this.stations[t+1]:this.station=this.stations[0]},t}()},0:function(t,e,n){t.exports=n("cDNt")},"332T":function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n("5f6/"),r=n("5Q6U"),o=n("C4Zx"),l=n("kZ5P"),a=n("mc75"),s=n("P2lY"),u=function(){function t(){this.thumbnail=!1}return t.prototype.ngOnInit=function(){this.selection instanceof i.a?this.scatter=this.selection:this.selection instanceof r.a?this.calendar=this.selection:this.selection instanceof a.a?this.clippedWmsMap=this.selection:this.selection instanceof o.a?this.activity=this.selection:this.selection instanceof l.a?this.observer=this.selection:this.selection instanceof s.a&&(this.observationFreq=this.selection)},t}()},"4Y6l":function(t,e,n){"use strict";function i(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var i=t.indexOf("Edge/");return i>0&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)}var r=n("/oeL"),o=function(){function t(){}return t}(),l=function(){function t(){}return t}(),a=n("gdRU"),s=n("YcBH"),u=n("Zyxv"),c=n("xs7O"),d=n("Mxwl"),p=n("BcUv"),f=n("Pp7C"),h=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t}(),g=n("8aeK"),_=n("vHGP");n.d(e,"e",function(){return m}),n.d(e,"h",function(){return y}),e.p=i,n.d(e,"l",function(){return o}),n.d(e,"k",function(){return l}),n.d(e,"a",function(){return a.a}),n.d(e,"m",function(){return s.a}),n.d(e,"g",function(){return u.a}),n.d(e,"o",function(){return c.a}),n.d(e,"n",function(){return d.a}),n.d(e,"b",function(){return p.a}),n.d(e,"d",function(){return f.a}),n.d(e,"c",function(){return h}),n.d(e,"i",function(){return g.b}),n.d(e,"f",function(){return g.a}),n.d(e,"j",function(){return _.a});var m=new r.u("npnBaseHref"),y=function(){function t(){}return t}()},"4Z98":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("bm2B"),r=function(){function t(){var t=this;this.required=!0,this.disabled=!1,this.yearControl=new i.e(null,function(e){return t.required&&!e.value?{required:!0}:null}),this.validYears=function(){for(var t=(new Date).getFullYear(),e=[],n=2010;n<=t;)e.push(n++);return e}()}return t}()},"5Q6U":function(t,e,n){"use strict";var i=n("ud2z");n.d(e,"a",function(){return i.a});var r=n("AHCE");n.d(e,"b",function(){return r.a});n("6inH"),n("Hcb1")},"5f6/":function(t,e,n){"use strict";var i=n("tf1B");n.d(e,"a",function(){return i.b});var r=n("CzRk");n.d(e,"b",function(){return r.a});n("9x3I"),n("+6ye")},"5pZx":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("ckYf"),r=function(){function t(){}return t.prototype.download=function(t){var e=this;t.preventDefault();var n=document.querySelector("#"+this.svgWrapperId+" >svg"),r=i.m(n);r.attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg");var o=n.parentNode,l=o.innerHTML,a="data:image/svg+xml;base64,"+window.btoa(l),s=document.querySelector("#dlcanvas-"+this.svgWrapperId),u=document.querySelector("#dllink-"+this.svgWrapperId);s.width=+r.attr("width"),s.height=+r.attr("height");var c=s.getContext("2d"),d=new Image;d.onload=function(){c.drawImage(d,0,0);var t=s.toDataURL("image/png");u.download=e.filename,u.href=t,u.click()},d.src=a},t}()},"5vU8":function(t,e,n){"use strict";n.d(e,"a",function(){return l}),n.d(e,"b",function(){return a});var i=n("yS/9"),r=n("ckYf"),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),l={top:20,right:30,bottom:60,left:40},a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="visualization.png",e.margins=l,e.minWidth=700,e}return o(e,t),e.prototype.baseFontSize=function(t){return t?"14px":14},e.prototype.commonUpdates=function(){var t=this.chart,e=this.baseFontSize(!0);[".axis path",".axis line"].forEach(function(e){return t.selectAll(e).style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges")}),t.selectAll("text").style("font-family","Arial"),t.selectAll("g .axis text").style("font-size",e)},e.prototype.reset=function(){var t=this.getSizeInfo(),e=this.svg,n=t.width+t.margin.left+t.margin.right,i=t.height+t.margin.top+t.margin.bottom;e.selectAll("*").remove(),e.attr("width",n).attr("height",i).attr("viewBox","0 0 "+n+" "+i).attr("preserveAspectRatio","xMidYMid meet"),e.append("g").attr("class","vis-background").append("rect").attr("width","100%").attr("height","100%").attr("fill","#fff"),this.chart=e.append("g").attr("transform","translate("+t.margin.left+","+t.margin.top+")").attr("class","vis-chart"),e.append("g").attr("transform","translate(10,"+(t.height+t.margin.top+t.margin.bottom-10)+")").append("text").attr("font-size","11px").attr("font-style","italic").attr("text-anchor","right").text("USA National Phenology Network, www.usanpn.org")},e.prototype.resize=function(){this.reset(),this.redraw()},e.prototype.selectElements=function(){this.visRoot=r.m("#"+this.id),this.svg=this.visRoot.select("svg")},e.prototype.getSizeInfo=function(e){return this.selectElements(),t.prototype.getSizeInfo.call(this,this.minWidth)},e.prototype.redraw=function(){this.redrawSvg();var t=this.sizing;if(t.width+t.margin.left+t.margin.right===this.minWidth){var e=this.rootElement.nativeElement,n=e.querySelector("svg.svg-visualization"),i=r.m(n),o=+i.attr("height"),l=t.scaledWidth/this.minWidth;i.attr("width",t.scaledWidth),i.attr("height",Math.round(o*l))}else this.thumbnailSrc=void 0},e.prototype.redrawSvg=function(){throw new Error("abstract")},e.prototype.ngAfterViewInit=function(){this.selectElements(),t.prototype.ngAfterViewInit.call(this)},e}(i.a)},"6Ce8":function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("Vxib"),r=n("qufV"),o=function(){function t(){this.frequencies=r.a,this.interpolates=[{value:i.b.linear,label:"Linear"},{value:i.b.monotone,label:"Monotone"},{value:i.b.stepAfter,label:"Step after"}]}return t}()},"6inH":function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n("8FRf"),r=n("5vU8"),o=n("Iake"),l=n("ytvl"),a=n("ckYf"),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filename="calendar.png",e.margins={top:20,right:35,bottom:45,left:35},e}return s(e,t),e.prototype.xTickValues=function(){var t,e=[1],n=1;for(t=1;t<12;t++){var r=new Date(1900,t);r.setTime(r.getTime()-i.d),n+=r.getDate(),e.push(n)}return this.x.domain().filter(function(t){return-1!==e.indexOf(t)})},e.prototype.commonUpdates=function(){t.prototype.commonUpdates.call(this);var e=this.y.bandwidth(),n=-1*(e/2+this.selection.labelOffset),i=this.baseFontSize()+this.selection.fontSizeDelta;this.chart.selectAll(".y.axis text").attr("x",0).attr("dy",n).attr("style","text-anchor: start; font-size: "+i+"px;")},e.prototype.getMonthFormat=function(){return this.selection.monthFormat?this.selection.monthFormat:this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){var e=this;t.prototype.reset.call(this),this.processed=void 0;var n=this.chart,r=this.sizing,s=a.n(this.getMonthFormat());this.x=Object(l.a)().range([0,r.width]).domain(a.l(1,366)).paddingInner(-.1).paddingOuter(.5),this.xAxis=Object(o.a)(this.x).tickValues(this.xTickValues()).tickFormat(function(t){var e=new Date(1900,0);return e.setTime(e.getTime()+i.d*t),s(e)}),this.y=Object(l.a)().range([r.height,0]).domain(a.l(0,6)).paddingOuter(.5),this.yAxis=Object(o.c)(this.y).tickSize(r.width).tickFormat(function(t){return e.processed&&e.processed.data&&t<e.processed.labels.length?e.processed.labels[t]:""}),n.append("g").attr("class","x axis").attr("transform","translate(0,"+r.height+")").call(this.xAxis),n.append("g").attr("class","y axis").call(this.yAxis),n.selectAll("g .y.axis line").style("stroke","#777").style("stroke-dasharray","2,2"),n.selectAll("g .y.axis .domain").style("display","none"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;if(this.data){var e=(this.sizing,this.processed=this.selection.postProcessData(this.data));if(this.y.paddingInner(this.selection.bandPadding),e&&e.labels&&this.y.domain(a.l(0,e.labels.length)),this.yAxis.scale(this.y),this.chart.selectAll("g .y.axis").call(this.yAxis),this.chart.selectAll(".doy").remove(),e&&e.data){var n=this.chart.selectAll(".doy").data(e.data,function(t){var e=t;return e.y+"-"+e.x+"-"+e.color});n=n.enter().insert("line",":first-child").attr("class","doy");var i=Math.ceil(this.x.bandwidth()/2),r=this.y.bandwidth()/2;n.attr("x1",function(e){return t.x(e.x)-i}).attr("y1",function(e,n){return t.y(e.y)+r}).attr("x2",function(e){return t.x(e.x)+i}).attr("y2",function(e,n){return t.y(e.y)+r}).attr("doy-point",function(t){return"("+t.x+","+t.y+")"}).attr("stroke",function(t){return t.color}).attr("stroke-width",""+this.y.bandwidth()).append("title").text(function(t){return t.x})}this.commonUpdates()}},e}(r.b)},"8FRf":function(t,e,n){"use strict";function i(){var t=this,e={};return Object.keys(this).forEach(function(n){var i=v(t,n);if(i){var r=t[n];/^_/.test(n)&&(n=n.substring(1)),Array.isArray(r)?e[n]=r.map(function(t){return i.ser(t)}):e[n]=i.ser(r)}}),e}function r(t){var e=this;Object.keys(t).forEach(function(n){var i=v(e,n);if(i){var r=t[n];void 0!==r?Array.isArray(r)?e[n]=r.map(function(t){return i.des(t)}):e[n]=i.des(r):e[n]=void 0}})}n.d(e,"b",function(){return h}),n.d(e,"d",function(){return g}),n.d(e,"h",function(){return o}),n.d(e,"i",function(){return y}),e.a=i,e.f=r,n.d(e,"e",function(){return b}),n.d(e,"c",function(){return w}),n.d(e,"g",function(){return P});var o,l=n("/oeL"),a=n("CPp0"),s=n("4Y6l"),u=n("qhHO"),c=(n.n(u),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}()),d=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},p=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},f=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=-9999,g=864e5;!function(t){t[t.RESET=0]="RESET",t[t.REDRAW=1]="REDRAW",t[t.UPDATE=2]="UPDATE",t[t.RESIZE=3]="RESIZE"}(o||(o={}));var _=Symbol("npnSelectionProperty"),m=function(t){return t},y=(function(){function t(){}}(),function(t){var e=d({des:m,ser:m},t||{});return Reflect.metadata(_,e)}),v=function(t,e){var n=Reflect.getMetadata(_,t,e);return n||(n=Reflect.getMetadata(_,t,"_"+e)),n},b="invalid selection",x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="VisSelection",e.guid=s.c.newGuid(),e.meta={},e.debug=!1,e.working=!1,e.editMode=!1,e.INVALID_SELECTION=b,e.lastEmit={},e.firstSubscriber=new Promise(function(t){e.firstSubscriberResolver=t}),e}return c(e,t),Object.defineProperty(e.prototype,"external",{get:function(){return i.apply(this,arguments)},set:function(t){r.apply(this,arguments)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.emit(o.RESET)},e.prototype.redraw=function(){this.emit(o.REDRAW)},e.prototype.update=function(){this.emit(o.UPDATE)},e.prototype.resize=function(){this.emit(o.RESIZE)},e.prototype.handleError=function(t){console.error(t),this.working=!1},e.prototype.emit=function(e){var n=this,i=arguments,r={value:e,when:Date.now(),ext:JSON.stringify(this.external)};this.lastEmit.value!==r.value||this.lastEmit.ext!==r.ext||this.lastEmit.when<r.when-500?(this.lastEmit=r,console.log("letting event through",r),this.firstSubscriber.then(function(){t.prototype.emit.apply(n,i)})):console.log("pruned out redundant event",r)},e.prototype.subscribe=function(e,n,i){return this.firstSubscriberResolver(),t.prototype.subscribe.apply(this,arguments)},e}(l.q);p([y(),f("design:type",String)],x.prototype,"$class",void 0),p([y(),f("design:type",String)],x.prototype,"guid",void 0),p([y(),f("design:type",Object)],x.prototype,"meta",void 0);var w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.networkIds=[],e}return c(e,t),e.prototype.addNetworkParams=function(t){if(t instanceof a.i){var e=t;(this.networkIds||[]).forEach(function(t,n){return e.set("network_id["+n+"]",""+t)})}else t&&"object"==typeof t&&(this.networkIds||[]).forEach(function(e,n){return t["network_id["+n+"]"]=""+e});return t},e}(x);p([y(),f("design:type",Array)],w.prototype,"networkIds",void 0);var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stationIds=[],e}return c(e,t),e.prototype.addNetworkParams=function(e){if(t.prototype.addNetworkParams.call(this,e),e instanceof a.i){var n=e;(this.stationIds||[]).forEach(function(t,e){return n.set("station_ids["+e+"]",""+t)})}else e&&"object"==typeof e&&(this.stationIds||[]).forEach(function(t,n){return e["station_ids["+n+"]"]=""+t});return e},e}(w);p([y(),f("design:type",Array)],P.prototype,"stationIds",void 0)},"8aeK":function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return o});var i=n("/oeL"),r=function(){function t(){}return t}(),o=new i.u("NpnConfiguration")},"9Wky":function(t,e,n){"use strict";n.d(e,"f",function(){return a}),n.d(e,"a",function(){return s}),n.d(e,"d",function(){return u}),n.d(e,"b",function(){return c}),n.d(e,"g",function(){return d}),n.d(e,"e",function(){return p}),n.d(e,"c",function(){return f});var i=n("qbdv"),r=n("Ewpo"),o=new Date(2010,0),l=new Date((new Date).getFullYear(),0),a=function(){function t(t){this.decimalPipe=t}return t.prototype.transform=function(t,e){return this.decimalPipe.transform(t,"1.0")+(e?" AGDD":"")},t.ctorParameters=function(){return[{type:i.e}]},t}(),s=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t){var e=this.datePipe.transform(new Date,"MMMM d");return(t||[]).reduce(function(t,n){return t||(n.label==e?n:void 0)},void 0)},t.ctorParameters=function(){return[{type:i.d}]},t}(),u=function(){function t(t){this.decimalPipe=t}return t.prototype.transform=function(t,e){if(0===t)return"No Difference";var n=t<0;return this.decimalPipe.transform(Math.abs(t),"1.0")+(e?" AGDD ":" ")+(n?"<":">")+" Avg"},t.ctorParameters=function(){return[{type:i.e}]},t}(),c=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t){var e=this.datePipe.transform(new Date,"MMMM d, y");return(t||[]).reduce(function(t,n){return t||(n.label==e?n:void 0)},void 0)},t.ctorParameters=function(){return[{type:i.d}]},t}(),d=function(){function t(){}return t.prototype.transform=function(t){if(0===t)return"No Difference";var e=t<0;return Math.abs(t)+" Days "+(e?"Early":"Late")},t}(),p=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t,e,n){return t=Math.round(t),0===t&&(t=1),e=e||"MMM d",this.datePipe.transform(new Date((n?l:o).getTime()+864e5*(t-1)),e)},t.ctorParameters=function(){return[{type:i.d}]},t}(),f=function(){function t(t,e){this.datePipe=t,this.dateExtentUtil=e}return t.prototype.toTime=function(t){var e=new Date;return"yesterday"===t||"today"===t||"tomorrow"===t?("yesterday"===t?e.setTime(e.getTime()-864e5):"tomorrow"===t&&e.setTime(e.getTime()+864e5),t=this.datePipe.transform(e,"yyyy-MM-dd 00:00:00")):-1===t.indexOf("T")&&(t=e.getFullYear()+"-"+t+" 00:00:00"),this.dateExtentUtil.parse(t).getTime()},t.prototype.transform=function(t,e,n){var i=this,r=e?this.toTime(e):void 0,o=n?this.toTime(n):void 0;return(r||o)&&(t=t.filter(function(t){var e=i.dateExtentUtil.parse(t).getTime();return(!r||r&&e>r)&&(!o||o&&e<o)})),t},t.ctorParameters=function(){return[{type:i.d},{type:r.a}]},t}()},"9x3I":function(t,e,n){"use strict";n.d(e,"a",function(){return p});var i=n("/oeL"),r=n("zQfh"),o=n("4Y6l"),l=n("5vU8"),a=n("Iake"),s=n("ytvl"),u=n("ckYf"),c=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),d=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},p=function(t){function e(e,n,i,r){var o=t.call(this,e,n,i)||this;return o.window=e,o.rootElement=n,o.media=i,o.speciesTitle=r,o.defaultAxisFormat=u.i("d"),o.dateFormat=u.n("%x"),o.filename="scatter-plot.png",o.margins=d({},l.a,{top:80,left:60}),o}return c(e,t),e.prototype.reset=function(){var e=this;t.prototype.reset.call(this);var n=this.chart,i=this.sizing,r=i.width<this.minWidth?this.sizing.width/3*2:this.sizing.width/2;this.title=n.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x",r).style("text-anchor","middle").style("font-size","18px"),this.x=Object(s.b)().range([0,i.width]).domain([0,100]),this.xAxis=Object(a.a)(this.x).tickFormat(function(t){return e.defaultAxisFormat(t)}),this.y=Object(s.b)().range([i.height,0]).domain([1,365]),this.yAxis=Object(a.b)(this.y),n.append("g").attr("class","x axis").attr("transform","translate(0,"+i.height+")").call(this.xAxis),n.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",i.height/2*-1).style("text-anchor","middle").text("Onset Day of Year"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(function(e){return t.handleError(e)})},e.prototype.redrawSvg=function(){var t=this;if(this.data){this.disclaimer=this.selection.filterDisclaimer;var e=this.selection.postProcessData(this.data),n=this.selection,i=n.axisNonNull(e),r=function(t){return n.axisData(t)},o=function(t){return n.getDoy(t)},l=u.h(i,r),a=n.axis.axisFmt||this.defaultAxisFormat;this.title.text(n.start+" - "+n.end),this.x.domain([l[0]-1,l[1]+1]),this.xAxis.scale(this.x).tickFormat(u.i(".2f"));var s=this.chart.selectAll("g .x.axis");s.call(this.xAxis.tickFormat(a)),s.selectAll(".axis-label").remove(),s.append("text").attr("class","axis-label").attr("x",this.sizing.width/2).attr("dy","3em").attr("fill","#000").style("text-anchor","middle").style("font-size","12px").text(this.selection.axis.label),this.chart.selectAll(".circle").remove();if(this.chart.selectAll(".circle").data(i,function(t){return t.id}).enter().append("circle").attr("class","circle").style("stroke","#333").style("stroke-width","1").attr("cx",function(e){return t.x(r(e))}).attr("cy",function(e){return t.y(o(e))}).attr("r","5").attr("fill",function(t){return t.color}).on("click",function(e){u.g.defaultPrevented||(t.record=e)}).append("title").text(function(t){return n.doyDateFormat(t.day_in_range)+" ["+t.latitude+","+t.longitude+"]"}),this.chart.selectAll(".regression").remove(),n.validPlots.forEach(function(t){return delete t.regressionLine}),this.selection.regressionLines){var c=[];n.validPlots.forEach(function(t){var e=i.filter(function(e){return e.color===t.color});e.length&&c.push(t.regressionLine=new f(t.species.species_id+"."+t.phenophase.phenophase_id,t.color,e,r,o))});this.chart.selectAll(".regression").data(c,function(t){return t.id}).enter().append("line").attr("class","regression").attr("x1",function(e){return t.x(e.p1[0])}).attr("y1",function(e){return t.y(e.p1[1])}).attr("x2",function(e){return t.x(e.p2[0])}).attr("y2",function(e){return t.y(e.p2[1])}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.color}).attr("stroke-width",2)}this.chart.select(".legend").remove();var d=this.chart.append("g").attr("class","legend").attr("transform","translate(0,-"+(this.sizing.margin.top-10)+")").style("font-size","1em");this.selection.validPlots.forEach(function(e,n){var i=d.append("g").attr("class","legend-item").attr("transform","translate(10,"+((n+1)*t.baseFontSize()+4*n)+")"),r=t.speciesTitle.transform(e.species)+"/"+e.phenophase.phenophase_name;e.regressionLine&&"number"==typeof e.regressionLine.r2&&(t.isIE?r+=" (R2 "+e.regressionLine.r2.toFixed(2)+")":r+=' (R<tspan style="baseline-shift: super; font-size: 0.65em;">2</tspan> '+e.regressionLine.r2.toFixed(2)+")"),i.append("circle").attr("r",5).attr("fill",e.color);var o=i.append("text").style("font-size",t.baseFontSize(!0)).attr("x",8).attr("y",2.5);t.isIE?o.text(r):o.html(r)}),this.commonUpdates()}},e.ctorParameters=function(){return[{type:o.o},{type:i.o},{type:r.j},{type:o.n}]},e}(l.b),f=function(){function t(t,e,n,i,r){var o=n.sort(function(t,e){return i(t)-i(e)}),l=function(t){return"number"==typeof t},a=o.map(i).filter(l),s=o.map(r).filter(l),u=this.leastSquares(a,s),c=a[0],d=this.approxY(u,c),p=a[a.length-1],f=this.approxY(u,p);this.id=t,this.color=e,this.p1=[c,d],this.p2=[p,f],this.r2=u[2]}return t.prototype.leastSquares=function(t,e){if(0===t.length||0===e.length)return[Number.NaN,Number.NaN,Number.NaN];var n=function(t,e){return t+e},i=1*t.reduce(n)/t.length,r=1*e.reduce(n)/e.length,o=t.map(function(t){return Math.pow(t-i,2)}).reduce(n),l=e.map(function(t){return Math.pow(t-r,2)}).reduce(n),a=t.map(function(t,n){return(t-i)*(e[n]-r)}).reduce(n),s=a/o;return[s,r-i*s,Math.pow(a,2)/(o*l)]},t.prototype.approxY=function(t,e){return t[1]+t[0]*e},t}()},A9JI:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("/oeL"),r=function(){function t(){this.startChange=new i.q,this.onStartChange=new i.q,this.endChange=new i.q,this.onEndChange=new i.q,this.maxSpan=10,this.validStarts=function(){for(var t=(new Date).getFullYear(),e=1900,n=[];e<t;)n.push(e++);return n}(),this.validEnds=[]}return Object.defineProperty(t.prototype,"start",{get:function(){return this.startValue},set:function(t){if("string"==typeof t&&(t=+t),t!==this.startValue){var e=this.startValue;if(this.startChange.emit(this.startValue=t),this.onStartChange.emit({oldValue:e,newValue:this.startValue}),t){var n=(new Date).getFullYear(),i=t+1,r=i+this.maxSpan,o=[];for(r>n&&(r=n+1);i<r;)o.push(i++);this.validEnds=o,this.end>r&&(this.end=void 0)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this.endValue},set:function(t){if("string"==typeof t&&(t=+t),t!==this.endValue){var e=this.endValue;this.endChange.emit(this.endValue=t),this.onEndChange.emit({oldValue:e,newValue:this.endValue})}},enumerable:!0,configurable:!0}),t}()},AB7d:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("4Y6l"),r=n("QBBO"),o=function(){function t(t,e){this.serviceUtils=t,this.networkService=e}return t.prototype.newSelection=function(){return new r.a(this.serviceUtils,this.networkService)},t.ctorParameters=function(){return[{type:i.j},{type:i.g}]},t}()},AHCE:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("/oeL"),r=n("CPp0"),o=n("4Y6l"),l=n("ud2z"),a=function(){function t(t,e,n,i){this.http=t,this.cacheService=e,this.speciesTitle=n,this.config=i,this.requestSrc="npn-vis-calendar"}return t.prototype.newSelection=function(){return new l.a(this.http,this.cacheService,this.speciesTitle,this.config)},t.ctorParameters=function(){return[{type:r.e},{type:o.a},{type:o.n},{type:o.i,decorators:[{type:i.s,args:[o.f]}]}]},t}()},ARiO:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("S4Bb"),r=(n.n(i),function(t){return t}),o=function(){function t(t,e,n,o){var l=this;this.wmsPipeFactory=t,this.color_map=e,this.ldef=n,this.styleDefinition=o,console.log("WmsMapLegend.color_map",e),console.log("WmsMapLegend.ldef",n),console.log("WmsMapLegend.styleDefinition",o);var a=function(t){var e=l.wmsPipeFactory.getPipe(t.name);return e||console.error("WmsMapLegend: Unable to find pipe named "+t.name),function(n,i){var r=[i];return t.args&&(r=r.concat(t.args)),e.transform.apply(e,r)}};this.lformat=n.legend_label_filter?a(n.legend_label_filter):r,this.gformat=n.gridded_label_filter?a(n.gridded_label_filter):void 0;var s=e.find("ColorMapEntry");0===s.length&&(s=e.find("sld\\:ColorMapEntry"));var u=s.toArray().reduce(function(t,e,n){var r=i(e),o=parseFloat(r.attr("quantity")),a=r.attr("label");return t.push({color:r.attr("color"),quantity:o,original_label:a,label:0===n?a:l.lformat(a,o)}),t},[]);this.title_data=u[0],this.data=u.slice(1),this.length=this.data.length}return t.prototype.setLayer=function(t){return this.layer=t,this},t.prototype.getData=function(){return this.data},t.prototype.getStyleDefinition=function(){return this.styleDefinition},t.prototype.getTitle=function(){return this.title_data.label},t.prototype.getColors=function(){return this.data.map(function(t){return t.color})},t.prototype.getQuantities=function(){return this.data.map(function(t){return t.quantity})},t.prototype.getLabels=function(){return this.data.map(function(t){return t.label})},t.prototype.getOriginalLabels=function(){return this.data.map(function(t){return t.original_label})},t.prototype.formatPointData=function(t){return(this.gformat||this.lformat)(t,t)},t.prototype.getPointData=function(t){var e,n,i;for(e=0;e<this.data.length;e++){if(n=this.data[e],i=e+1<this.data.length?this.data[e+1]:void 0,t==n.quantity)return n;if(i&&t>=n.quantity&&t<i.quantity)return n}},t}()},BcUv:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){function t(){}return t.prototype.transform=function(t,e){if("string"==typeof t){var n=t.split("-");if(3===n.length){var i=parseInt(n[0]),r=parseInt(n[1]),o=parseInt(n[2]);!isNaN(i)&&!isNaN(r)&&!isNaN(o)&&r<13&&o<32&&(t=new Date(i,r-1,o))}}if(t instanceof Date){t=new Date(t.getTime()),e&&t.setFullYear(2010);for(var l=t.getDate();t.getMonth()>0;)t.setDate(1),t.setTime(t.getTime()-864e5),l+=t.getDate();return l}return t},t}()},C4Zx:function(t,e,n){"use strict";var i=(n("Vxib"),n("qufV"));n.d(e,"a",function(){return i.b});var r=n("MxFf");n.d(e,"b",function(){return r.a});n("CJBW"),n("6Ce8"),n("4Z98")},CJBW:function(t,e,n){"use strict";n.d(e,"a",function(){return y});var i=n("/oeL"),r=n("zQfh"),o=n("4Y6l"),l=n("8FRf"),a=n("5vU8"),s=n("Iake"),u=n("ytvl"),c=n("ckYf"),d=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=new Date(2010,0),f=c.n("%m/%d"),h=function(t){var e=(t-1)*l.d+p.getTime(),n=new Date(e);return f(n)},g=function(t,e){return t&&2===t.length&&(t=[t[0],1.05*t[1]],e&&e.proportion&&t[1]>1&&(t[1]=1)),t},_=function(t){for(var e=1,n=[];e<=365;)n.push(e),e+=t;return n},m={7:{rotate:45,values:_(14)},14:{rotate:45,values:_(28)},months:{values:[1,32,60,91,121,152,182,213,244,274,305,335]}},y=function(t){function e(e,n,i,r){var o=t.call(this,e,n,i)||this;return o.window=e,o.rootElement=n,o.media=i,o.legendDoyPipe=r,o.filename="activity-curves.png",o.margins={top:80,left:80,right:80,bottom:80},o}return d(e,t),e.prototype.usingCommonMetric=function(){var t=this.selection;if(t.curves[0].isValid()&&!t.curves[1].isValid()||t.curves[0].isValid()&&t.curves[1].isValid()&&t.curves[0].metricId()===t.curves[1].metricId())return t.curves[0].metric},e.prototype.newY=function(){var t=this.sizing;return Object(u.b)().range([t.height,0]).domain([0,100])},e.prototype.updateLegend=function(){var t=this,e=this.chart;e.select(".legend").remove();var n=this.sizing,i=this.selection,r=this.usingCommonMetric(),o=e.append("g").attr("class","legend").attr("transform","translate(150,-"+(n.margin.top-10)+")").style("font-size","1em");i.curves.reduce(function(e,n){var i;return n.plotted()&&(i=o.append("g").attr("class","legend-item curve-"+n.id).attr("transform","translate(10,"+((e+1)*t.baseFontSize()+4*e)+")"),i.append("circle").attr("r",5).attr("fill",n.color),i.append("text").style("font-size",t.baseFontSize(!0)).attr("x",10).attr("y",2.5).text(n.legendLabel(!r)),e++),e},0)},e.prototype.hover=function(){function t(){var t=c.k(this),e=t[0],n=(t[1],Math.round(l.invert(e))),r=i.curves.reduce(function(t,e){return!t&&e.plotted()&&(t=e.data().reduce(function(t,e){return t||(n>=e.start_doy&&n<=e.end_doy?e:void 0)},void 0)),t},void 0);s.attr("transform","translate("+e+")"),u.style("text-anchor",n<324?"start":"end").attr("x",e+10*(n<324?1:-1)).text(r?o.legendDoyPipe.transform(r.start_doy)+" - "+o.legendDoyPipe.transform(r.end_doy):o.legendDoyPipe.transform(n)),i.curves.forEach(function(t){t.doyFocus=n}),o.updateLegend()}var e=this,n=this.svg,i=this.selection,r=this.sizing,o=this,l=this.x,a=n.append("g").attr("transform","translate("+r.margin.left+","+r.margin.top+")").style("display","none"),s=a.append("line").attr("class","focus").attr("fill","none").attr("stroke","green").attr("stroke-width",1).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",r.height),u=a.append("text").attr("class","focus-doy").attr("y",10).attr("x",0).text("hover doy"),d=function(){i.curves.forEach(function(t){delete t.doyFocus}),a.style("display","none"),e.updateLegend()},p=function(){i.curves.reduce(function(t,e){return t||e.plotted()},!1)&&a.style("display",null)};n.append("rect").attr("class","overlay").attr("transform","translate("+this.margins.left+","+this.margins.top+")").style("fill","none").style("pointer-events","all").attr("x",0).attr("y",0).attr("width",r.width).attr("height",r.height).on("mouseover",p).on("mouseout",d).on("mousemove",t)},e.prototype.reset=function(){var e=this;t.prototype.reset.call(this);var n=this.chart,i=this.sizing,r=this.selection;this.x=Object(u.b)().range([0,i.width]).domain([1,365]),this.xAxis=Object(s.a)(this.x).tickFormat(h),r.curves.forEach(function(t){return t.x(e.x).y(e.newY())}),n.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-3em").attr("x","0").style("text-anchor","start").style("font-size","18px").text("Activity Curves"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.loadCurveData().then(function(){t.redraw()})},e.prototype.redrawSvg=function(){var t=this,e=this.chart,n=this.sizing,i=this.selection,r=this.usingCommonMetric();if(e.selectAll("g .axis").remove(),r){var o=c.h(i.curves.reduce(function(t,e){return e.isValid()&&(t=t.concat(e.domain())),t},[])),l=this.newY().domain(g(o,r));console.debug("ActivityCurves.common domain",o),i.curves.forEach(function(t){t.y(l)})}else i.curves.forEach(function(e){e.isValid()&&e.y(t.newY().domain(g(e.domain(),e.metric)))});e.append("g").attr("class","y axis left").call(i.curves[0].axis()).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y","0").attr("dy","-4em").attr("x",n.height/2*-1).attr("fill","#000").style("text-anchor","middle").text(i.curves[0].axisLabel()),!r&&i.curves[1].isValid()&&(i.curves[1].orient="right",e.append("g").attr("class","y axis right").attr("transform","translate("+n.width+")").call(i.curves[1].axis()).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y","0").attr("dy","4em").attr("x",n.height/2*-1).style("text-anchor","middle").text(i.curves[1].axisLabel()));var a=m[i.frequency.value];this.xAxis.tickValues(a.values),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis).append("text").attr("y","0").attr("dy","3em").attr("x",n.width/2).attr("class","axis-label").style("text-anchor","middle").text("Date"),a.rotate&&(e.selectAll("g.x.axis g.tick text").style("text-anchor","end").attr("transform","rotate(-"+a.rotate+")"),e.selectAll("g.x.axis .axis-label").attr("dy","4em")),r||(e.selectAll("g.y.axis.left g.tick text").style("fill",i.curves[0].color),e.selectAll("g.y.axis.left text.axis-title").style("fill",i.curves[0].color),e.selectAll("g.y.axis.right g.tick text").style("fill",i.curves[1].color),e.selectAll("g.y.axis.right text.axis-title").style("fill",i.curves[1].color)),this.commonUpdates(),i.curves.forEach(function(t){t.draw(e)}),this.updateLegend(),this.hover()},e.ctorParameters=function(){return[{type:o.o},{type:i.o},{type:r.j},{type:o.d}]},e}(a.b)},CzRk:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("/oeL"),r=n("CPp0"),o=n("4Y6l"),l=n("tf1B"),a=function(){function t(t,e,n){this.http=t,this.cacheService=e,this.config=n}return t.prototype.newSelection=function(){return new l.b(this.http,this.cacheService,this.config)},t.ctorParameters=function(){return[{type:r.e},{type:o.a},{type:o.i,decorators:[{type:i.s,args:[o.f]}]}]},t}()},DyKV:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n("5vU8"),r=n("Iake"),o=n("ytvl"),l=n("ckYf"),a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.keyLabels=["New observers","Active observers"],e.keys=["number_new_observers","number_active_observers"],e.z=Object(o.c)().domain(e.keys).range(["#98abc5","#d0743c"]),e.zDarker=Object(o.c)().domain(e.keys).range(e.z.range().map(function(t){return l.c(t).darker().toString()})),e.filename="observer-activity.png",e.margins=s({},i.a,{top:100,left:80}),e}return a(e,t),e.prototype.getMonthFormat=function(){return this.sizing&&this.sizing.width<800?"%b":"%B"},e.prototype.reset=function(){t.prototype.reset.call(this);var e=this.chart,n=this.sizing,i=l.n(this.getMonthFormat()),a=this.baseFontSize();this.title=e.append("g").attr("class","chart-title").append("text").attr("y","0").attr("dy","-4.2em").attr("x","0").style("text-anchor","start").style("font-size","18px");var s=this.legend=e.append("g").attr("class","legend").attr("transform","translate(0,-"+(n.margin.top-10)+")").attr("text-anchor","start").style("font-size",a).selectAll("g").data(this.keyLabels).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(22*e+24)+")"});s.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("fill",this.z),s.append("text").attr("x",24).attr("y",a-.5).attr("dy","0.32em").text(function(t){return t}),this.x=Object(o.a)().rangeRound([0,n.width]).padding(.05).domain(l.l(0,12)),this.xAxis=Object(r.a)(this.x).tickFormat(function(t){return i(new Date(1900,t))}),e.append("g").attr("class","x axis").attr("transform","translate(0,"+n.height+")").call(this.xAxis),this.y=Object(o.b)().range([n.height,0]).domain([0,20]),this.yAxis=Object(r.b)(this.y).tickFormat(l.i(".0d")),e.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y","0").attr("dy","-3em").attr("x",n.height/2*-1).style("text-anchor","middle").text("New/Active Observers"),this.commonUpdates()},e.prototype.update=function(){var t=this;this.reset(),this.selection.getData().then(function(e){t.data=e,t.redraw()}).catch(this.handleError)},e.prototype.redrawSvg=function(){var t=this;if(this.data){this.title.text("New/Active Observers, "+this.data.network_name+", "+this.selection.year),console.debug("ObserverActivityComponent:data",this.data);var e=this.sizing,n=this.data.months.slice(),i=(this.chart,n.reduce(function(t,e){return t+e.number_new_observers},0)),r=n.reduce(function(t,e){return t+e.number_active_observers},0),o=n.reduce(function(t,e){return e.number_new_observers>t&&(t=e.number_new_observers),e.number_active_observers>t&&(t=e.number_active_observers),t},0);console.debug("ObserverActivityComponent:vis data (max="+o+")",n),this.x.domain(l.l(0,n.length)),this.chart.selectAll("g .x.axis").call(this.xAxis),this.y.domain([0,o]),this.yAxis.ticks(o<11?o:10),this.chart.selectAll("g .y.axis").call(this.yAxis);var a=function(i,r){var o=t.x.bandwidth()/2;t.chart.selectAll("g .bars."+i).remove(),t.chart.append("g").attr("class","bars "+i).attr("fill",function(e){return t.z(i)}).selectAll("rect").data(n).enter().append("rect").attr("x",function(e,n){return t.x(n)+o*r}).attr("y",function(e){return t.y(e[i])}).attr("title",function(t){return""+t[i]}).attr("height",function(n){return e.height-t.y(n[i])}).attr("width",o),t.chart.selectAll("g .bar-labels."+i).remove(),t.chart.append("g").attr("class","bar-labels "+i).attr("fill",function(e){return t.z(i)}).selectAll("text").data(n).enter().append("text").attr("text-anchor","middle").attr("dy","-0.25em").attr("x",function(e,n){return t.x(n)+o*r+o/2}).attr("y",function(e){return t.y(e[i])}).text(function(t){return""+t[i]})};this.keys.forEach(function(t,e){return a(t,e)}),this.legend.selectAll("text").each(function(t,e,n){return function(i,r){var o=l.m(this),a=i===n[0]?t:e;o.text(i+" [Total: "+a+"]")}}(i,r,this.keyLabels)),this.commonUpdates()}},e}(i.b)},EFcQ:function(t,e,n){"use strict";var i=n("yS/9"),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.latitude=38.8402805,e.longitude=-97.61142369999999,e.zoom=4,e.getMapPromise=new Promise(function(t){e.getMapResolver=t}),e.mapStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"off"}]}],e}return r(e,t),e.prototype.mapReady=function(t){var e=this;t.addListener("resize",function(){console.log("resize happened"),console.log("panning to center"),t.setZoom(3),setTimeout(function(){t.panTo(new google.maps.LatLng(e.latitude,e.longitude)),t.setZoom(e.zoom)},500)}),this.getMapResolver(t)},e.prototype.getMap=function(){return this.getMapPromise},e.prototype.resize=function(){var t=this;this.getMap().then(function(e){var n=t.getSizeInfo(),i=t.rootElement.nativeElement,r=i.querySelector("agm-map");r.style.width=n.width+"px",r.style.height=n.height+"px",google.maps.event.trigger(e,"resize")})},e.prototype.reset=function(){var t=this;this.getMap().then(function(e){console.log("Map reset",e),e.panTo(new google.maps.LatLng(t.latitude,t.longitude)),e.setZoom(t.zoom)})},e.prototype.redraw=function(){this.getMap().then(function(t){console.log("Map redraw",t)})},e.prototype.update=function(){this.resize(),this.getMap().then(function(t){console.log("Map update",t)})},e}(i.a);n.d(e,"a",function(){return a});var l=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.mapReady=function(t){this.getMapResolver(t)},e.prototype.reset=function(){var e=this;this.getMap().then(function(n){e.selection.removeFrom(n).then(function(){t.prototype.reset.call(e)})})},e.prototype.update=function(){var t=this;this.resize(),this.getMap().then(function(e){t.selection.removeFrom(e).then(function(){t.selection.addTo(e)})})},e.prototype.resize=function(){var e=this;t.prototype.resize.call(this),this.getMap().then(function(t){return e.selection.resizeMap(t)})},e}(o)},Ewpo:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=/^(\d\d\d\d)-0?(\d+)-0?(\d+)/,r=function(){function t(){}return t.prototype.parse=function(t){var e=i.exec(t.replace(/T.*$/,"")),n=parseInt(e[1]),r=parseInt(e[2])-1,o=parseInt(e[3]);return new Date(n,r,o)},t}()},Hcb1:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=(new Date).getFullYear(),r=function(){for(var t=i+1,e=1900,n=[];e<t;)n.push(e++);return n}(),o=function(){function t(){this.maxYears=5,this.updateSent=!1}return t.prototype.selectableYears=function(t){var e=this;return t?r.filter(function(n){return n===t||-1===e.selection.years.indexOf(n)}):r},t.prototype.ngOnInit=function(){0===this.selection.years.length&&this.addYear(),0===this.selection.plots.length&&this.addPlot()},t.prototype.updateChange=function(){this.selection.isValid()&&(this.selection.update(),this.updateSent=!0)},t.prototype.redrawChange=function(t){this.selection.isValid()&&(t&&!t.oldValue&&t.newValue?this.updateChange():this.updateSent?this.selection.redraw():this.updateChange())},t.prototype.addPlot=function(){this.selection.plots.push({})},t.prototype.removePlot=function(t){this.selection.plots.splice(t,1),this.updateChange()},t.prototype.addYear=function(){for(var t=i;-1!==this.selection.years.indexOf(t);)t--;this.selection.years.push(t),this.updateChange()},t.prototype.removeYear=function(t){this.selection.years.splice(t,1),this.updateChange()},t.prototype.plotsValid=function(){return this.selection.plots.length===this.selection.validPlots.length},t}()},KYKA:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("/oeL"),r=n("qbdv"),o=n("4Y6l"),l=n("s9VF"),a=n("Pkw6"),s=function(){function t(t,e,n,i){this.serviceUtils=t,this.datePipe=e,this.mapLegendService=n,this.config=i}return t.prototype.newSelection=function(){return new a.a(this.serviceUtils,this.datePipe,this.mapLegendService,this.config)},t.ctorParameters=function(){return[{type:o.j},{type:r.d},{type:l.b},{type:o.i,decorators:[{type:i.s,args:[o.f]}]}]},t}()},LAnB:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){function t(){this.opacity=100}return t.prototype.opacityChanged=function(){this.supportsOpacity&&this.supportsOpacity.setOpacity(this.opacity/100)},t.prototype.ngOnChanges=function(t){console.log("WmsMapOpacityControl.ngOnchanges",t),t.supportsOpacity&&t.supportsOpacity.currentValue&&(this.opacity=Math.round(100*t.supportsOpacity.currentValue.getOpacity()))},t}()},MxFf:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("/oeL"),r=n("CPp0"),o=n("qbdv"),l=n("4Y6l"),a=n("qufV"),s=function(){function t(t,e,n,i){this.http=t,this.cacheService=e,this.datePipe=n,this.config=i}return t.prototype.newSelection=function(){return new a.b(this.http,this.cacheService,this.datePipe,this.config)},t.ctorParameters=function(){return[{type:r.e},{type:l.a},{type:o.d},{type:l.i,decorators:[{type:i.s,args:[l.f]}]}]},t}()},Mxwl:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("OpsG"),r=function(){function t(){}return t.prototype.transform=function(t,e){if(t){if("common-name"===(e=e||i.a.appConfig.tagSpeciesTitle)){if(t.common_name){var n=t.common_name.toLowerCase();return n.substring(0,1).toUpperCase()+n.substring(1)}return t.common_name}if("scientific-name"===e)return t.genus+" "+t.species}return t},t}()},NWGx:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("4Y6l"),r=n("gDKM"),o=function(){function t(t){this.serviceUtils=t}return t.prototype.newSelection=function(){return new r.a(this.serviceUtils)},t.ctorParameters=function(){return[{type:i.j}]},t}()},OpsG:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i={production:!0,googleMapsApiKey:"AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE",appConfig:{num_days_quality_filter:30,filterLqdSummary:!0,filterLqdDisclaimer:"For quality assurance purposes, only onset dates that are preceded by negative records are included in the visualization.",tagSpeciesTitle:"common-name"}}},P2lY:function(t,e,n){"use strict";var i=n("QBBO");n.d(e,"a",function(){return i.a});var r=n("AB7d");n.d(e,"b",function(){return r.a});n("/3a9"),n("c1PR")},Pkw6:function(t,e,n){"use strict";function i(){d=function(t){function e(e,n,i){var r=t.call(this)||this;return r.opacity=.75,r.bounds=e,r.image=n,r.map=i,r}return o(e,t),e.prototype.add=function(){this.setMap(this.map)},e.prototype.remove=function(){this.setMap(null)},e.prototype.setOpacity=function(t){this.opacity=t,this.div_&&(this.div_.style.opacity=t)},e.prototype.getOpacity=function(){return this.opacity},e.prototype.onAdd=function(){var t=document.createElement("div");t.style.borderStyle="none",t.style.borderWidth="0px",t.style.position="absolute";var e=document.createElement("img");e.src=this.image,e.style.width="100%",e.style.height="100%",e.style.position="absolute",t.appendChild(e),this.div_=t,this.getPanes().overlayLayer.appendChild(t),this.setOpacity(this.opacity)},e.prototype.draw=function(){var t=this.getProjection(),e=t.fromLatLngToDivPixel(this.bounds.getSouthWest()),n=t.fromLatLngToDivPixel(this.bounds.getNorthEast()),i=this.div_;i.style.left=e.x+"px",i.style.top=n.y+"px",i.style.width=n.x-e.x+"px",i.style.height=e.y-n.y+"px"},e.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},e}(google.maps.OverlayView)}n.d(e,"a",function(){return c});var r=n("8FRf"),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),l=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},a=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=[{label:"Current Si-x leaf index",layerName:"si-x:average_leaf_ncep",clippingService:"si-x/area/clippedImage",statisticsService:"si-x/area/statistics"},{label:"6-day forecast",layerName:"si-x:average_leaf_ncep",clippingService:"si-x/area/clippedImage",statisticsService:"si-x/area/statistics",forecast:!0},{label:"Anomaly",layerName:"si-x:leaf_anomaly",clippingService:"si-x/anomaly/area/clippedImage",statisticsService:"si-x/anomaly/area/statistics"}],u=[{label:"Current AGDD",layerName:"gdd:agdd",clippingService:"agdd/area/clippedImage",statisticsService:"agdd/area/statistics"},{label:"6-day forecast",layerName:"gdd:agdd",clippingService:"agdd/area/clippedImage",statisticsService:"agdd/area/statistics",forecast:!0},{label:"Anomaly",layerName:"gdd:agdd_anomaly",clippingService:"agdd/anomaly/area/clippedImage",statisticsService:"agdd/anomaly/area/statistics"}],c=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.serviceUtils=e,o.datePipe=n,o.mapLegendService=i,o.config=r,o.$class="ClippedWmsMapSelection",o.service="si-x",o.layer=s[0],o.useBufferedBoundary=!1,o}return o(e,t),e.prototype.isValid=function(){return!("si-x"!==this.service&&"agdd"!==this.service||!this.layer||!this.fwsBoundary)},Object.defineProperty(e.prototype,"validServices",{get:function(){return[{value:"si-x",label:"Spring index"},{value:"agdd",label:"Accumulated growing degree days"}]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validLayers",{get:function(){switch(this.service){case"si-x":return s;case"agdd":return u}return[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiDate",{get:function(){var t=new Date;return this.layer&&this.layer.forecast&&t.setTime(t.getTime()+6*r.d),this.datePipe.transform(t,"y-MM-dd")},enumerable:!0,configurable:!0}),e.prototype.getBoundary=function(){var t=this;return new Promise(function(e,n){var i=t.config.dataApiRoot+"/v0/si-x/area/boundary",r={format:"geojson",fwsBoundary:t.fwsBoundary};t.serviceUtils.cachedGet(i,r).then(function(i){i&&i.boundary?t.serviceUtils.cachedGet(i.boundary,{}).then(e).catch(n):n("missing boundary in response.")}).catch(n)})},e.prototype.getData=function(){var t=this.config.dataApiRoot+"/v0/"+this.layer.clippingService,e={layerName:this.layer.layerName,fwsBoundary:this.fwsBoundary,date:this.apiDate,useBufferedBoundary:this.useBufferedBoundary,style:!0,fileFormat:"png"};return this.serviceUtils.cachedGet(t,e)},e.prototype.getStatistics=function(){var t=this;return new Promise(function(e,n){var i=t.config.dataApiRoot+"/v0/"+t.layer.statisticsService,r={layerName:t.layer.layerName,fwsBoundary:t.fwsBoundary,date:t.apiDate,useBufferedBoundary:t.useBufferedBoundary,useCache:!0};r.useCache="boolean"==typeof t.config.dataApiUseStatisticsCache&&t.config.dataApiUseStatisticsCache,t.serviceUtils.cachedGet(i,r).then(function(t){var n=/^(\d{4})-(\d{2})-(\d{2})/.exec(t.date);t.date=new Date(parseInt(n[1]),parseInt(n[2])-1,parseInt(n[3])),e(t)}).catch(n)})},e.prototype.getAllData=function(){var t=this;return new Promise(function(e,n){Promise.all([t.getData(),t.getBoundary(),t.getStatistics()]).then(function(t){e({data:t[0],boundary:t[1],statistics:t[2]})}).catch(n)})},e.prototype.resizeMap=function(t){var e=this;return new Promise(function(n){if(e.data){var i=e.toBounds(e.data.data.bbox);i&&t.fitBounds(i)}n()})},e.prototype.removeFrom=function(t){var e=this;return new Promise(function(n){e.overlay&&e.overlay.remove(),(e.features||[]).forEach(function(e){t.data.remove(e)}),e.data=void 0,e.features=void 0,e.overlay=void 0,e.legend=void 0,n()})},e.prototype.addTo=function(t){var e=this;return new Promise(function(n,r){e.working=!0;var o=function(t){e.working=!1,n(t)},l=function(t){e.working=!1,r(t)};if(e.overlay&&e.features)return l("already added to map, call removeFrom");e.getAllData().then(function(n){if(e.overlay&&e.features)return console.log("in promise, already have overlay and features"),o();e.data=n;var r=n.data,a=e.toBounds(r.bbox),s=r.clippedImage;if(a){t.panTo(a.getCenter()),t.fitBounds(a),i(),e.overlay=new d(a,s,t),e.overlay.add();var u=n.boundary;console.log("MAP boundary resonse",u),e.features=t.data.addGeoJson(u),t.data.setStyle(function(t){return{strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0}})}e.mapLegendService.getLegend(r.layerClippedFrom).then(function(t){console.debug("ClippedWmsMapSelection.legend:",t),e.legend=t,o()}).catch(l)}).catch(l)})},e.prototype.toBounds=function(t){if(t&&4===t.length){var e=t[0],n=t[1],i=t[2],r=t[3];return new google.maps.LatLngBounds(new google.maps.LatLng(n,e),new google.maps.LatLng(r,i))}return null},e}(r.c);l([Object(r.i)(),a("design:type",String)],c.prototype,"$class",void 0),l([Object(r.i)(),a("design:type",String)],c.prototype,"service",void 0),l([Object(r.i)(),a("design:type",Object)],c.prototype,"layer",void 0),l([Object(r.i)(),a("design:type",String)],c.prototype,"fwsBoundary",void 0),l([Object(r.i)(),a("design:type",Boolean)],c.prototype,"useBufferedBoundary",void 0);var d},Pp7C:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var i=n("qbdv"),r=new Date(2010,0),o=new Date((new Date).getFullYear(),0),l=function(){function t(t){this.datePipe=t}return t.prototype.transform=function(t,e,n){return t=Math.round(t),0===t&&(t=1),e=e||"MMM d",this.datePipe.transform(new Date((n?o:r).getTime()+864e5*(t-1)),e)},t.ctorParameters=function(){return[{type:i.d}]},t}()},QBBO:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("8FRf"),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},l=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=function(t){function e(e,n){var i=t.call(this)||this;return i.serviceUtils=e,i.networkService=n,i.$class="ObservationFrequencySelection",i.dataCnt=0,i}return r(e,t),Object.defineProperty(e.prototype,"year",{get:function(){return this._year},set:function(t){this._year=t,delete this.defaultStation},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!!this.year&&1===this.networkIds.length},e.prototype.getData=function(){var t=this;return new Promise(function(e,n){var i=t.serviceUtils.apiUrl("/npn_portal/networks/getSiteVisitFrequency.json"),r={year:t.year,network_id:t.networkIds[0]};t.working=!0,t.serviceUtils.cachedGet(i,r).then(function(n){t.working=!1,e(n)}).catch(n)})},e}(i.c);o([Object(i.i)(),l("design:type",String)],a.prototype,"$class",void 0),o([Object(i.i)(),l("design:type",Number)],a.prototype,"_year",void 0),o([Object(i.i)(),l("design:type",Number)],a.prototype,"defaultStation",void 0)},T3r2:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var i="Number of pixels included in the calculations",r={count:i,mean:"Mean day of year of the onset of the first leaf index for the pixels displayed",stdDev:"The standard deviation of the mean day of year of the onset of the first leaf index for the pixels displayed",min:"Minimum day of year of the onset of the first leaf index for the pixels displayed",max:"Maximum day of year of the onset of the first leaf index for the pixels displayed",complete:"Percent of pixels that have reached the requirements for the Spring Index."},o={count:i,mean:"Mean Accumulated Growing Degree Day value for the pixels displayed",stdDev:"The standard deviation of the Accumulated Growing Degree Day value for the pixels displayed",min:"Minimum Accumulated Growing Degree Day value for the pixels displayed",max:"Maximum Accumulated Growing Degree Day value for the pixels displayed"},l=function(){function t(){}return t.prototype.ngDoCheck=function(){this.selection&&this.selection.data&&this.selection.data.statistics&&(this.statistics=this.selection.data.statistics,this.gdd=this.selection&&/^gdd/.test(this.selection.layer.layerName),this.tooltips=this.gdd?o:r)},t}()},VGYb:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("9Wky"),r=function(){function t(t,e,n,i,r,o,l){this.legendGddUnits=t,this.agddDefaultTodayElevation=e,this.legendAgddAnomaly=n,this.agddDefaultTodayTime=i,this.legendSixAnomaly=r,this.legendDoy=o,this.extentDates=l,this.pipes={},this.pipes.legendGddUnits=t,this.pipes.agddDefaultTodayElevation=e,this.pipes.legendAgddAnomaly=n,this.pipes.agddDefaultTodayTime=i,this.pipes.legendSixAnomaly=r,this.pipes.legendDoy=o,this.pipes.extentDates=l}return t.prototype.getPipe=function(t){return this.pipes[t]},t.ctorParameters=function(){return[{type:i.f},{type:i.a},{type:i.d},{type:i.b},{type:i.g},{type:i.e},{type:i.c}]},t}()},Vxib:function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"b",function(){return u});var i=n("8FRf"),r=n("4Y6l"),o=n("ckYf"),l=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},a=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(){this.dataPoints=!0}return Object.defineProperty(t.prototype,"external",{get:function(){return i.a.apply(this,arguments)},set:function(t){i.f.apply(this,arguments)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){delete this.$data,delete this.$metricData},t.prototype.updateCheck=function(t){this.selection&&this.isValid()&&(!this.plotted()||t?this.selection.update():this.selection.redraw())},Object.defineProperty(t.prototype,"year",{get:function(){return this._year},set:function(t){this.reset(),this._year=t,this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"phenophase",{get:function(){return this._phenophase},set:function(t){this.reset(),this._phenophase=t,this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metric",{get:function(){return this._metric},set:function(t){this.reset(),this._metric=t,this.updateCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"species",{get:function(){return this._species},set:function(t){this.reset(),this._species=t,this.phenophase=void 0,this._metrics=this._species&&this._species.kingdom?v[this._species.kingdom]||[]:[],this._metric&&-1===this._metrics.indexOf(this._metric)&&delete this.metric,this._metrics.length&&!this._metric&&(this.metric=this._metrics[0])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validMetrics",{get:function(){return this._metrics||[]},enumerable:!0,configurable:!0}),t.prototype.axisLabel=function(){return this.metric?this.metric.label:"?"},t.prototype.doyDataValue=function(){var t,e,n,i=this,r=i.data();if(i.doyFocus&&r)for(n=0;n<r.length;n++)if(e=r[n],i.doyFocus>=e.start_doy&&i.doyFocus<=e.end_doy)return t=(i.metric.valueFormat||f)(e[i.metric.id]),-9999!==e[i.metric.sampleSize]&&(t+=" N:"+e[i.metric.sampleSize]),t},t.prototype.legendLabel=function(t){var e=this.doyDataValue();return this.year+": "+g(this.species)+" - "+this.phenophase.phenophase_name+(t?" ("+this.metric.label+")":"")+(void 0!==e?" ["+e+"]":"")},t.prototype.metricId=function(){return this.metric?this.metric.id:void 0},t.prototype.data=function(t){if(arguments.length)return delete this.$data,delete this.$metricData,t&&(t.forEach(function(t){t.start_doy=m(t.start_date),t.end_doy=m(t.end_date)}),t.sort(function(t,e){return t.start_doy-e.start_doy}),this.$data=t),this;var e=this,n=e.$data;return n&&e.metric&&(e.$metricData?n=e.$metricData:(e.metric.sampleSize||console.warn("Metric does not define a sampleSize property, cannot filter out invalid data points."),n=n.filter(function(t){return(!e.metric.sampleSize||-9999!==t[e.metric.sampleSize])&&-9999!==t[e.metric.id]}),n.length!==e.$data.length&&console.debug("filtered out "+(e.$data.length-n.length)+"/"+e.$data.length+" of -9999 records for metric ",e.metric),e.$metricData=n)),n},t.prototype.axis=function(){var t=this.y(),e=t.ticks(),n=this.orient||"left",i="left"===n?o.a(t):o.b(t);return e.length&&(e[e.length-1]=t.domain()[1],i.tickValues(e)),i},t.prototype.x=function(t){return arguments.length?(this.$x=t,this):this.$x},t.prototype.y=function(t){return arguments.length?(this.$y=t,this):this.$y},t.prototype.isValid=function(){return this.species&&this.phenophase&&this.year&&this.metric},t.prototype.plotted=function(){return this.isValid()&&this.data()},t.prototype.shouldRevisualize=function(){return this.isValid()&&!this.data()},t.prototype.domain=function(){var t,e=this,n=e.data();if(n&&e.metric)return t=o.h(n,function(t){return t[e.metric.id]}),t[0]>0?t[0]=0:t[0]<0&&console.warn("negative domain start for metric",t,e.metric),t},t.prototype.draw=function(t){var e,n,i,r,l,a,s=this,c=s.data(),d=[[]];if(t.selectAll("path.curve.curve-"+s.id).remove(),t.selectAll("circle.curve-point.curve-point-"+s.id).remove(),c&&c.length){for(i=0;i<c.length;i++)r=c[i],l=i+1<c.length?c[i+1]:void 0,d[d.length-1].push(r),l&&l.start_doy!==r.end_doy+1&&d.push([]);e=s.x(),n=s.y();var p=function(t){return e(t.start_doy+Math.round((t.end_doy-t.start_doy)/2))},f=function(t){return n(t[s.metric.id])};switch(a=o.j(),s.interpolate){case u.monotone:console.log("MONOTONE"),a.curve(o.e);break;case u.stepAfter:console.log("STEP AFTER"),a.curve(o.f);break;case u.linear:console.log("LINEAR"),a.curve(o.d)}a.x(p),a.y(f),console.debug("ActivityCurve.draw",s.species,s.phenophase,s.year,s.metric,s.domain(),n.domain()),console.debug("draw.datas",d),d.forEach(function(e,n){(1===e.length||s.dataPoints)&&e.forEach(function(e){t.append("circle").attr("class","curve-point curve-point-"+s.id).attr("r",3).attr("fill",s.color).attr("cx",p(e)).attr("cy",f(e))}),e.length>1&&t.append("path").attr("class","curve curve-"+s.id).attr("fill","none").attr("stroke",s.color).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",1.5).attr("d",a(e))})}},t}();l([Object(i.i)(),a("design:type",Number)],s.prototype,"id",void 0),l([Object(i.i)(),a("design:type","function"==typeof(c=void 0!==r.l&&r.l)&&c||Object)],s.prototype,"_species",void 0),l([Object(i.i)(),a("design:type",Object)],s.prototype,"_metric",void 0),l([Object(i.i)(),a("design:type","function"==typeof(d=void 0!==r.k&&r.k)&&d||Object)],s.prototype,"_phenophase",void 0),l([Object(i.i)(),a("design:type",Number)],s.prototype,"_year",void 0),l([Object(i.i)(),a("design:type",String)],s.prototype,"color",void 0);var u;!function(t){t[t.linear=0]="linear",t[t.stepAfter=1]="stepAfter",t[t.monotone=2]="monotone"}(u||(u={}));var c,d,p=function(t){return t.toFixed(2)},f=function(t){return t},h=new r.n,g=function(t,e){return h.transform(t,e)},_=new r.b,m=function(t,e){return _.transform(t,e)},y=[{id:"num_yes_records",sampleSize:"status_records_sample_size",label:"Total Yes Records"},{id:"proportion_yes_records",sampleSize:"status_records_sample_size",label:"Proportion Yes Records",valueFormat:p,proportion:!0}],v={Plantae:y.concat([{id:"numindividuals_with_yes_record",sampleSize:"individuals_sample_size",label:"Total Individuals with Yes Records"},{id:"proportion_individuals_with_yes_record",sampleSize:"individuals_sample_size",label:"Proportion Individuals with Yes Records",valueFormat:p,proportion:!0}]),Animalia:y.concat([{id:"numsites_with_yes_record",sampleSize:"sites_sample_size",label:"Total Sites with Yes Records"},{id:"proportion_sites_with_yes_record",sampleSize:"sites_sample_size",label:"Proportion Sites with Yes Records",valueFormat:p,proportion:!0},{id:"total_numanimals_in-phase",sampleSize:"in-phase_site_visits_sample_size",label:"Total Animals In Phase"},{id:"mean_numanimals_in-phase",sampleSize:"in-phase_per_hr_sites_sample_size",label:"Animals In Phase",valueFormat:p},{id:"mean_numanimals_in-phase_per_hr",sampleSize:"in-phase_per_hr_sites_sample_size",label:"Animals In Phase per Hour",valueFormat:p},{id:"mean_numanimals_in-phase_per_hr_per_acre",sampleSize:"phase_per_hr_per_acre_sites_sample_size",label:"Animals In Phase per Hour per Acre",valueFormat:p}])}},YPxi:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){function t(){}return t.prototype.serviceChange=function(){this.validLayers=this.selection.validLayers;var t=this.selection,e=this.selection.validLayers;t.layer=e.length?e[0]:void 0,this.layerChange()},t.prototype.layerChange=function(){var t=this.selection;t.isValid()?t.update():t.reset()},t.prototype.ngOnInit=function(){this.validServices=this.selection.validServices,this.serviceChange()},t}()},YcBH:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var i=n("/oeL"),r=n("qbdv"),o=n("CPp0"),l=n("82j9"),a=(n.n(l),n("gdRU")),s=n("8aeK"),u=new o.d({"Content-Type":"application/x-www-form-urlencoded"}),c=function(){function t(t,e,n,i){this.http=t,this.cache=e,this.datePipe=n,this.config=i}return t.prototype.getAllSpecies=function(t){var e=this;return new Promise(function(n,i){console.log("SpeciesService.getAllSpecies:params",t);var r=e.config.apiRoot+"/npn_portal/species/getSpeciesFilter.json",l={u:r,params:t},a=e.cache.get(l);if(a)n(a);else{var s=new o.i;Object.keys(t).forEach(function(e){return s.set(""+e,""+t[e])}),e.http.post(r,s.toString(),{headers:u}).toPromise().then(function(t){a=t.json(),e.cache.set(l,a),n(a)}).catch(i)}})},t.prototype._getPhenophases=function(t,e){var n=this;return new Promise(function(i,r){var o=n.config.apiRoot+"/npn_portal/phenophases/getPhenophasesForSpecies.json",l={species_id:t.species_id};e?l.date=n.datePipe.transform(e,"y-MM-dd"):l.return_all=!0;var a={u:o,params:l},s=n.cache.get(a);s?i(s):n.http.get(o,{params:l}).toPromise().then(function(t){var e=t.json();s=e[0].phenophases,s=n.removeRedundantPhenophases(s),n.cache.set(a,s),i(s)}).catch(r)})},t.prototype.getAllPhenophases=function(t){return this._getPhenophases(t)},t.prototype.getPhenophasesForDate=function(t,e){return this._getPhenophases(t,e)},t.prototype.getPhenophasesForYear=function(t,e){var n=this;return new Promise(function(i,r){var o=new Date(e,0,1),l=new Date(e,11,31);Promise.all([n.getPhenophasesForDate(t,o),n.getPhenophasesForDate(t,l)]).then(function(t){i(n.mergeRedundantPhenophaseLists(t))}).catch(r)})},t.prototype.getPhenophasesForYears=function(t,e,n){var i=this;if(e&&!n)throw new Error("Missing end year.");if(e>n)throw new Error("start year cannot be greater than end");for(var r=[e],o=e;o++<n;)r.push(o);return new Promise(function(e,n){Promise.all(r.map(function(e){return i.getPhenophasesForYear(t,e)})).then(function(t){e(i.mergeRedundantPhenophaseLists(t))}).catch(n)})},t.prototype.getPhenophases=function(t,e,n){return e?this.getPhenophasesForYears(t,e,n):this.getAllPhenophases(t)},t.prototype.removeRedundantPhenophases=function(t){var e=[];return t.filter(function(t){return!e[t.phenophase_id]&&(e[t.phenophase_id]=t,!0)})},t.prototype.mergeRedundantPhenophaseLists=function(t){return this.removeRedundantPhenophases(t.reduce(function(t,e){return t.concat(e)},[]))},t.ctorParameters=function(){return[{type:o.e},{type:a.a},{type:r.d},{type:s.b,decorators:[{type:i.s,args:[s.a]}]}]},t}()},Zyxv:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("/oeL"),r=n("CPp0"),o=n("82j9"),l=(n.n(o),n("gdRU")),a=n("8aeK"),s=function(){function t(t,e,n){this.http=t,this.cache=e,this.config=n}return t.prototype.getStations=function(t){var e=this;return new Promise(function(n,i){var r=e.config.apiRoot+"/npn_portal/stations/getStationsForNetwork.json",o={network_id:t},l={u:r,params:o},a=e.cache.get(l);a?n(a):e.http.get(r,{params:o}).toPromise().then(function(t){a=t.json(),e.cache.set(l,a),n(a)}).catch(i)})},t.ctorParameters=function(){return[{type:r.e},{type:l.a},{type:a.b,decorators:[{type:i.s,args:[a.a]}]}]},t}()},c1PR:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){function t(){this.validYears=function(){for(var t=(new Date).getFullYear()+1,e=2e3,n=[];e<t;)n.push(e++);return n.reverse()}()}return t.prototype.ngOnInit=function(){},t}()},cDNt:function(t,e,n){"use strict";function i(){return window.npn_base_href}function r(){return window.npn_configuration}function o(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"activity-curves-control",[],null,null,null,Ot.b,Ot.a)),nt._15(1,49152,null,0,Ct.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.activity)},null)}function l(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"scatter-plot-control",[],null,null,null,St.b,St.a)),nt._15(1,114688,null,0,kt.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.scatter)},null)}function a(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"calendar-control",[],null,null,null,Mt.b,Mt.a)),nt._15(1,114688,null,0,jt.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.calendar)},null)}function s(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"observer-activity-control",[],null,null,null,Dt.b,Dt.a)),nt._15(1,114688,null,0,zt.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.observer)},null)}function u(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"observation-frequency-control",[],null,null,null,At.b,At.a)),nt._15(1,114688,null,0,Lt.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.observationFreq)},null)}function c(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"clipped-wms-map-control",[],null,null,null,It.b,It.a)),nt._15(1,114688,null,0,Ft.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.clipped)},null)}function d(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"npn-visualization",[],null,null,null,Rt.b,Rt.a)),nt._15(1,114688,null,0,Et.a,[],{selection:[0,"selection"]},null)],function(t,e){t(e,1,0,e.component.selection)},null)}function p(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,o)),nt._15(2,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,l)),nt._15(5,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,a)),nt._15(8,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,s)),nt._15(11,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,u)),nt._15(14,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,c)),nt._15(17,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n\n    "])),(t()(),nt._11(16777216,null,null,1,null,d)),nt._15(20,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,2,0,n.activity),t(e,5,0,n.scatter),t(e,8,0,n.calendar),t(e,11,0,n.observer),t(e,14,0,n.observationFreq),t(e,17,0,n.clipped),t(e,20,0,n.selection)},null)}function f(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"new-visualization-builder",[],null,null,null,p,pe)),nt._15(1,114688,null,0,qt,[],null,null)],function(t,e){t(e,1,0)},null)}function h(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"mat-progress-spinner",[["class","mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[4,"width","px"],[4,"height","px"],[1,"aria-valuemin",0],[1,"aria-valuemax",0],[1,"aria-valuenow",0],[1,"mode",0]],null,null,Yt.b,Yt.a)),nt._15(1,573440,null,0,$t.a,[nt.M,nt.o,Zt.a,[2,Tt.c]],{mode:[0,"mode"]},null)],function(t,e){t(e,1,0,"indeterminate")},function(t,e){t(e,0,0,nt._31(e,1)._elementSize,nt._31(e,1)._elementSize,"determinate"===nt._31(e,1).mode?0:null,"determinate"===nt._31(e,1).mode?100:null,nt._31(e,1).value,nt._31(e,1).mode)})}function g(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,7,"mat-checkbox",[["class","station-input mat-checkbox"]],[[8,"id",0],[2,"mat-checkbox-indeterminate",null],[2,"mat-checkbox-checked",null],[2,"mat-checkbox-disabled",null],[2,"mat-checkbox-label-before",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"change"]],function(t,e,n){var i=!0,r=t.component;if("ngModelChange"===e){i=!1!==(t.context.$implicit.selected=n)&&i}if("change"===e){i=!1!==r.stationChange()&&i}return i},Wt.b,Wt.a)),nt._15(1,4374528,null,0,Gt.a,[nt.M,nt.o,nt.h,Kt.h,[8,null]],null,{change:"change"}),nt._36(1024,null,Ut.j,function(t){return[t]},[Gt.a]),nt._15(3,671744,null,0,Ut.n,[[8,null],[8,null],[8,null],[2,Ut.j]],{model:[0,"model"]},{update:"ngModelChange"}),nt._36(2048,null,Ut.k,null,[Ut.n]),nt._15(5,16384,null,0,Ut.l,[Ut.k],null,null),nt._15(6,16384,null,0,Ht.u,[],null,null),(t()(),nt._39(7,0,["",""]))],function(t,e){t(e,3,0,e.context.$implicit.selected)},function(t,e){t(e,0,1,[nt._31(e,1).id,nt._31(e,1).indeterminate,nt._31(e,1).checked,nt._31(e,1).disabled,"before"==nt._31(e,1).labelPosition,nt._31(e,5).ngClassUntouched,nt._31(e,5).ngClassTouched,nt._31(e,5).ngClassPristine,nt._31(e,5).ngClassDirty,nt._31(e,5).ngClassValid,nt._31(e,5).ngClassInvalid,nt._31(e,5).ngClassPending]),t(e,7,0,e.context.$implicit.station_name)})}function _(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n        "])),(t()(),nt._11(16777216,null,null,1,null,g)),nt._15(3,802816,null,0,Tt.i,[nt.Z,nt.U,nt.x],{ngForOf:[0,"ngForOf"]},null),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){t(e,3,0,e.component.stations)},null)}function m(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._17(1,0,null,null,19,"mat-radio-group",[["class","vis-scope-input mat-radio-group"],["name","visScope"],["role","radiogroup"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"change"]],function(t,e,n){var i=!0,r=t.component;if("ngModelChange"===e){i=!1!==(r.visScope=n)&&i}if("change"===e){i=!1!==r.scopeChanged()&&i}return i},null,null)),nt._15(2,1064960,null,1,Jt.b,[nt.h],{name:[0,"name"]},{change:"change"}),nt._37(603979776,1,{_radios:1}),nt._36(1024,null,Ut.j,function(t){return[t]},[Jt.b]),nt._15(5,671744,null,0,Ut.n,[[8,null],[8,null],[8,null],[2,Ut.j]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),nt._36(2048,null,Ut.k,null,[Ut.n]),nt._15(7,16384,null,0,Ut.l,[Ut.k],null,null),nt._15(8,16384,null,0,Ht.u,[],null,null),(t()(),nt._39(-1,null,["\n      "])),(t()(),nt._39(-1,null,["\n      "])),(t()(),nt._17(11,0,null,null,3,"mat-radio-button",[["class","vis-scope-radio mat-radio-button"]],[[2,"mat-radio-checked",null],[2,"mat-radio-disabled",null],[1,"id",0]],[[null,"focus"]],function(t,e,n){var i=!0;if("focus"===e){i=!1!==nt._31(t,13)._inputElement.nativeElement.focus()&&i}return i},Qt.b,Qt.a)),nt._15(12,16384,null,0,Ht.u,[],null,null),nt._15(13,4440064,[[1,4]],0,Jt.a,[[2,Jt.b],nt.o,nt.M,nt.h,Kt.h,Xt.c],{value:[0,"value"]},null),(t()(),nt._39(14,0,['Show data for all sites at "','"'])),(t()(),nt._39(-1,null,["\n      "])),(t()(),nt._17(16,0,null,null,3,"mat-radio-button",[["class","vis-scope-radio mat-radio-button"]],[[2,"mat-radio-checked",null],[2,"mat-radio-disabled",null],[1,"id",0]],[[null,"focus"]],function(t,e,n){var i=!0;if("focus"===e){i=!1!==nt._31(t,18)._inputElement.nativeElement.focus()&&i}return i},Qt.b,Qt.a)),nt._15(17,16384,null,0,Ht.u,[],null,null),nt._15(18,4440064,[[1,4]],0,Jt.a,[[2,Jt.b],nt.o,nt.M,nt.h,Kt.h,Xt.c],{value:[0,"value"]},null),(t()(),nt._39(19,0,['Show data for select sites at "','"'])),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,h)),nt._15(23,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,_)),nt._15(26,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,2,0,"visScope");t(e,5,0,"visScope",n.visScope);t(e,13,0,"refuge");t(e,18,0,"station"),t(e,23,0,n.stationFetch),t(e,26,0,"station"===n.visScope&&n.stations&&n.stations.length)},function(t,e){var n=e.component;t(e,1,0,nt._31(e,7).ngClassUntouched,nt._31(e,7).ngClassTouched,nt._31(e,7).ngClassPristine,nt._31(e,7).ngClassDirty,nt._31(e,7).ngClassValid,nt._31(e,7).ngClassInvalid,nt._31(e,7).ngClassPending),t(e,11,0,nt._31(e,13).checked,nt._31(e,13).disabled,nt._31(e,13).id),t(e,14,0,n.refuge.title),t(e,16,0,nt._31(e,18).checked,nt._31(e,18).disabled,nt._31(e,18).id),t(e,19,0,n.refuge.title)})}function y(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"visualization-scope-selection",[],null,null,null,m,he)),nt._15(1,49152,null,0,Nt,[te.a],null,null)],null,null)}function v(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,31,"mat-step",[["label","Select sites"]],null,null,null,ee.d,ee.b)),nt._36(6144,null,Ht.e,null,[ne.b]),nt._15(2,16384,null,0,Ht.u,[],null,null),nt._15(3,573440,[[1,4]],1,ne.b,[ne.d,[1,Ht.e]],{stepControl:[0,"stepControl"],label:[1,"label"]},null),nt._37(335544320,2,{stepLabel:0}),(t()(),nt._39(-1,0,["\n            "])),(t()(),nt._17(6,0,null,0,24,"div",[["class","step-wrapper"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(8,0,null,null,4,"div",[["class","step-content"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(10,0,null,null,1,"visualization-scope-selection",[],null,null,null,m,he)),nt._15(11,49152,null,0,Nt,[te.a],{selection:[0,"selection"],refuge:[1,"refuge"]},null),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(14,0,null,null,15,"div",[["class","step-nav"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(16,0,null,null,4,"button",[["class","mat-raised-button"],["mat-raised-button",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0,r=t.component;if("click"===e){i=!1!==r.dialogRef.close()&&i}return i},ie.d,ie.b)),nt._15(17,16384,null,0,Ht.u,[],null,null),nt._15(18,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(19,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Cancel"])),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(22,0,null,null,6,"button",[["class","mat-raised-button"],["mat-raised-button",""],["matStepperNext",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,25)._stepper.next()&&i}return i},ie.d,ie.b)),nt._15(23,16384,null,0,Ht.u,[],null,null),nt._36(2048,null,oe.c,null,[ne.d]),nt._15(25,16384,null,0,ne.g,[oe.c],null,null),nt._15(26,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(27,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Next"])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._39(-1,0,["\n        "]))],function(t,e){var n=e.component;t(e,3,0,n.step1FormGroup,"Select sites"),t(e,11,0,n.selection,n.refuge)},function(t,e){t(e,16,0,nt._31(e,18).disabled||null),t(e,22,0,nt._31(e,26).disabled||null)})}function b(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,6,"button",[["class","mat-raised-button"],["mat-raised-button",""],["matStepperPrevious",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,3)._stepper.previous()&&i}return i},ie.d,ie.b)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._36(2048,null,oe.c,null,[ne.d]),nt._15(3,16384,null,0,ne.h,[oe.c],null,null),nt._15(4,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(5,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Back"]))],null,function(t,e){t(e,0,0,nt._31(e,4).disabled||null)})}function x(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,27,"div",[["class","step-wrapper"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(2,0,null,null,4,"div",[["class","step-content"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(4,0,null,null,1,"new-visualization-builder",[],null,null,null,p,pe)),nt._15(5,114688,null,0,qt,[],{selection:[0,"selection"],refuge:[1,"refuge"]},null),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(8,0,null,null,18,"div",[["class","step-nav"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(10,0,null,null,4,"button",[["class","mat-raised-button"],["mat-raised-button",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0,r=t.component;if("click"===e){i=!1!==r.dialogRef.close()&&i}return i},ie.d,ie.b)),nt._15(11,16384,null,0,Ht.u,[],null,null),nt._15(12,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(13,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Cancel"])),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._11(16777216,null,null,1,null,b)),nt._15(17,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(19,0,null,null,6,"button",[["class","mat-raised-button"],["mat-raised-button",""],["matStepperNext",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,22)._stepper.next()&&i}return i},ie.d,ie.b)),nt._15(20,16384,null,0,Ht.u,[],null,null),nt._36(2048,null,oe.c,null,[ne.d]),nt._15(22,16384,null,0,ne.g,[oe.c],null,null),nt._15(23,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(24,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Next"])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._39(-1,null,["\n            "]))],function(t,e){var n=e.component;t(e,5,0,n.selection,n.refuge),t(e,17,0,n.stationAware)},function(t,e){t(e,10,0,nt._31(e,12).disabled||null),t(e,19,0,nt._31(e,23).disabled||null)})}function w(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,74,"div",[["class","step-wrapper"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(2,0,null,null,48,"div",[["class","step-content"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(4,0,null,null,21,"mat-form-field",[["class","visualization-title mat-input-container mat-form-field"]],[[2,"mat-input-invalid",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-focused",null],[2,"mat-primary",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,le.b,le.a)),nt._15(5,16384,null,0,Ht.u,[],null,null),nt._15(6,7389184,null,6,ae.b,[nt.o,nt.M,nt.h,[2,Ht.k]],null,null),nt._37(335544320,5,{_control:0}),nt._37(335544320,6,{_placeholderChild:0}),nt._37(603979776,7,{_errorChildren:1}),nt._37(603979776,8,{_hintChildren:1}),nt._37(603979776,9,{_prefixChildren:1}),nt._37(603979776,10,{_suffixChildren:1}),(t()(),nt._39(-1,1,["\n                        "])),(t()(),nt._17(14,0,null,1,10,"input",[["class","mat-input-element mat-form-field-autofill-control"],["matInput",""],["placeholder","Visualization title"],["required",""]],[[1,"required",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[1,"id",0],[8,"placeholder",0],[8,"disabled",0],[8,"required",0],[8,"readOnly",0],[1,"aria-describedby",0],[1,"aria-invalid",0]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"focus"]],function(t,e,n){var i=!0,r=t.component;if("input"===e){i=!1!==nt._31(t,15)._handleInput(n.target.value)&&i}if("blur"===e){i=!1!==nt._31(t,15).onTouched()&&i}if("compositionstart"===e){i=!1!==nt._31(t,15)._compositionStart()&&i}if("compositionend"===e){i=!1!==nt._31(t,15)._compositionEnd(n.target.value)&&i}if("blur"===e){i=!1!==nt._31(t,23)._focusChanged(!1)&&i}if("focus"===e){i=!1!==nt._31(t,23)._focusChanged(!0)&&i}if("input"===e){i=!1!==nt._31(t,23)._onInput()&&i}if("ngModelChange"===e){i=!1!==(r.selection.meta.title=n)&&i}return i},null,null)),nt._15(15,16384,null,0,Ut.c,[nt.M,nt.o,[2,Ut.a]],null,null),nt._15(16,16384,null,0,Ut.p,[],{required:[0,"required"]},null),nt._36(1024,null,Ut.i,function(t){return[t]},[Ut.p]),nt._36(1024,null,Ut.j,function(t){return[t]},[Ut.c]),nt._15(19,671744,null,0,Ut.n,[[8,null],[2,Ut.i],[8,null],[2,Ut.j]],{model:[0,"model"]},{update:"ngModelChange"}),nt._36(2048,null,Ut.k,null,[Ut.n]),nt._15(21,16384,null,0,Ut.l,[Ut.k],null,null),nt._15(22,16384,null,0,Ht.u,[],null,null),nt._15(23,933888,null,0,se.a,[nt.o,nt.M,Zt.a,[2,Ut.k],[2,Ut.m],[2,Ut.g],Ht.e],{placeholder:[0,"placeholder"],required:[1,"required"]},null),nt._36(2048,[[5,4]],ae.c,null,[se.a]),(t()(),nt._39(-1,1,["\n                    "])),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(27,0,null,null,19,"mat-form-field",[["class","visualization-description mat-input-container mat-form-field"]],[[2,"mat-input-invalid",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-focused",null],[2,"mat-primary",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,le.b,le.a)),nt._15(28,16384,null,0,Ht.u,[],null,null),nt._15(29,7389184,null,6,ae.b,[nt.o,nt.M,nt.h,[2,Ht.k]],null,null),nt._37(335544320,11,{_control:0}),nt._37(335544320,12,{_placeholderChild:0}),nt._37(603979776,13,{_errorChildren:1}),nt._37(603979776,14,{_hintChildren:1}),nt._37(603979776,15,{_prefixChildren:1}),nt._37(603979776,16,{_suffixChildren:1}),(t()(),nt._39(-1,1,["\n                        "])),(t()(),nt._17(37,0,null,1,8,"textarea",[["class","mat-input-element mat-form-field-autofill-control"],["matInput",""],["placeholder","Visualization description"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[1,"id",0],[8,"placeholder",0],[8,"disabled",0],[8,"required",0],[8,"readOnly",0],[1,"aria-describedby",0],[1,"aria-invalid",0]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"focus"]],function(t,e,n){var i=!0,r=t.component;if("input"===e){i=!1!==nt._31(t,38)._handleInput(n.target.value)&&i}if("blur"===e){i=!1!==nt._31(t,38).onTouched()&&i}if("compositionstart"===e){i=!1!==nt._31(t,38)._compositionStart()&&i}if("compositionend"===e){i=!1!==nt._31(t,38)._compositionEnd(n.target.value)&&i}if("blur"===e){i=!1!==nt._31(t,44)._focusChanged(!1)&&i}if("focus"===e){i=!1!==nt._31(t,44)._focusChanged(!0)&&i}if("input"===e){i=!1!==nt._31(t,44)._onInput()&&i}if("ngModelChange"===e){i=!1!==(r.selection.meta.description=n)&&i}return i},null,null)),nt._15(38,16384,null,0,Ut.c,[nt.M,nt.o,[2,Ut.a]],null,null),nt._36(1024,null,Ut.j,function(t){return[t]},[Ut.c]),nt._15(40,671744,null,0,Ut.n,[[8,null],[8,null],[8,null],[2,Ut.j]],{model:[0,"model"]},{update:"ngModelChange"}),nt._36(2048,null,Ut.k,null,[Ut.n]),nt._15(42,16384,null,0,Ut.l,[Ut.k],null,null),nt._15(43,16384,null,0,Ht.u,[],null,null),nt._15(44,933888,null,0,se.a,[nt.o,nt.M,Zt.a,[2,Ut.k],[2,Ut.m],[2,Ut.g],Ht.e],{placeholder:[0,"placeholder"]},null),nt._36(2048,[[11,4]],ae.c,null,[se.a]),(t()(),nt._39(-1,1,["\n                    "])),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(48,0,null,null,1,"p",[["class","step-instructions"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["Add a title and a description that will accompany this visualization on your Refuge Dashboard. The description can help explain the visualization to visitors to your Refuge Dashboard, and provide other background information that will assist with interpretation."])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(52,0,null,null,21,"div",[["class","step-nav"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(54,0,null,null,4,"button",[["class","mat-raised-button"],["mat-raised-button",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0,r=t.component;if("click"===e){i=!1!==r.dialogRef.close()&&i}return i},ie.d,ie.b)),nt._15(55,16384,null,0,Ht.u,[],null,null),nt._15(56,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(57,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Cancel"])),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(60,0,null,null,6,"button",[["class","mat-raised-button"],["mat-raised-button",""],["matStepperPrevious",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,63)._stepper.previous()&&i}return i},ie.d,ie.b)),nt._15(61,16384,null,0,Ht.u,[],null,null),nt._36(2048,null,oe.c,null,[ne.d]),nt._15(63,16384,null,0,ne.h,[oe.c],null,null),nt._15(64,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(65,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Back"])),(t()(),nt._39(-1,null,["\n                    "])),(t()(),nt._17(68,0,null,null,4,"button",[["class","mat-raised-button"],["mat-raised-button",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0,r=t.component;if("click"===e){i=!1!==r.dialogRef.close(r.selection)&&i}return i},ie.d,ie.b)),nt._15(69,16384,null,0,Ht.u,[],null,null),nt._15(70,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],{disabled:[0,"disabled"]},null),nt._15(71,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Add"])),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._39(-1,null,["\n            "]))],function(t,e){var n=e.component;t(e,16,0,""),t(e,19,0,n.selection.meta.title);t(e,23,0,"Visualization title",""),t(e,40,0,n.selection.meta.description);t(e,44,0,"Visualization description"),t(e,70,0,!n.selection.meta.title||!n.selection.isValid())},function(t,e){t(e,4,1,[nt._31(e,6)._control.errorState,nt._31(e,6)._control.errorState,nt._31(e,6)._canPlaceholderFloat,nt._31(e,6)._control.shouldPlaceholderFloat||nt._31(e,6)._shouldAlwaysFloat,nt._31(e,6)._control.focused,"primary"==nt._31(e,6).color,"accent"==nt._31(e,6).color,"warn"==nt._31(e,6).color,nt._31(e,6)._shouldForward("untouched"),nt._31(e,6)._shouldForward("touched"),nt._31(e,6)._shouldForward("pristine"),nt._31(e,6)._shouldForward("dirty"),nt._31(e,6)._shouldForward("valid"),nt._31(e,6)._shouldForward("invalid"),nt._31(e,6)._shouldForward("pending")]),t(e,14,1,[nt._31(e,16).required?"":null,nt._31(e,21).ngClassUntouched,nt._31(e,21).ngClassTouched,nt._31(e,21).ngClassPristine,nt._31(e,21).ngClassDirty,nt._31(e,21).ngClassValid,nt._31(e,21).ngClassInvalid,nt._31(e,21).ngClassPending,nt._31(e,23).id,nt._31(e,23).placeholder,nt._31(e,23).disabled,nt._31(e,23).required,nt._31(e,23).readonly,nt._31(e,23)._ariaDescribedby||null,nt._31(e,23).errorState]),t(e,27,1,[nt._31(e,29)._control.errorState,nt._31(e,29)._control.errorState,nt._31(e,29)._canPlaceholderFloat,nt._31(e,29)._control.shouldPlaceholderFloat||nt._31(e,29)._shouldAlwaysFloat,nt._31(e,29)._control.focused,"primary"==nt._31(e,29).color,"accent"==nt._31(e,29).color,"warn"==nt._31(e,29).color,nt._31(e,29)._shouldForward("untouched"),nt._31(e,29)._shouldForward("touched"),nt._31(e,29)._shouldForward("pristine"),nt._31(e,29)._shouldForward("dirty"),nt._31(e,29)._shouldForward("valid"),nt._31(e,29)._shouldForward("invalid"),nt._31(e,29)._shouldForward("pending")]),t(e,37,1,[nt._31(e,42).ngClassUntouched,nt._31(e,42).ngClassTouched,nt._31(e,42).ngClassPristine,nt._31(e,42).ngClassDirty,nt._31(e,42).ngClassValid,nt._31(e,42).ngClassInvalid,nt._31(e,42).ngClassPending,nt._31(e,44).id,nt._31(e,44).placeholder,nt._31(e,44).disabled,nt._31(e,44).required,nt._31(e,44).readonly,nt._31(e,44)._ariaDescribedby||null,nt._31(e,44).errorState]),t(e,54,0,nt._31(e,56).disabled||null),t(e,60,0,nt._31(e,64).disabled||null),t(e,68,0,nt._31(e,70).disabled||null)})}function P(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._17(2,0,null,null,28,"mat-horizontal-stepper",[["class","mat-stepper-horizontal"],["role","tablist"]],null,[[null,"selectionChange"]],function(t,e,n){var i=!0,r=t.component;if("selectionChange"===e){i=!1!==r.stepChanged(n)&&i}return i},ee.c,ee.a)),nt._36(6144,null,ne.d,null,[ne.a]),nt._15(4,16384,null,0,Ht.u,[],null,null),nt._15(5,49152,null,1,ne.a,[[2,ue.c],nt.h],null,{selectionChange:"selectionChange"}),nt._37(603979776,1,{_steps:1}),(t()(),nt._39(-1,null,["\n        "])),(t()(),nt._11(16777216,null,null,1,null,v)),nt._15(9,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n\n        "])),(t()(),nt._17(11,0,null,null,8,"mat-step",[["label","Build visualization"]],null,null,null,ee.d,ee.b)),nt._36(6144,null,Ht.e,null,[ne.b]),nt._15(13,16384,null,0,Ht.u,[],null,null),nt._15(14,573440,[[1,4]],1,ne.b,[ne.d,[1,Ht.e]],{stepControl:[0,"stepControl"],label:[1,"label"]},null),nt._37(335544320,3,{stepLabel:0}),(t()(),nt._39(-1,0,["\n            "])),(t()(),nt._11(16777216,null,0,1,null,x)),nt._15(18,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._39(-1,null,["\n\n        "])),(t()(),nt._17(21,0,null,null,8,"mat-step",[["label","Enter visualization details"]],null,null,null,ee.d,ee.b)),nt._36(6144,null,Ht.e,null,[ne.b]),nt._15(23,16384,null,0,Ht.u,[],null,null),nt._15(24,573440,[[1,4]],1,ne.b,[ne.d,[1,Ht.e]],{stepControl:[0,"stepControl"],label:[1,"label"]},null),nt._37(335544320,4,{stepLabel:0}),(t()(),nt._39(-1,0,["\n            "])),(t()(),nt._11(16777216,null,0,1,null,w)),nt._15(28,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,9,0,n.stationAware);t(e,14,0,n.step2FormGroup,"Build visualization"),t(e,18,0,n.showVis);t(e,24,0,n.step3FormGroup,"Enter visualization details"),t(e,28,0,n.showDetails)},null)}function O(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"new-vis-dialog",[],null,null,null,P,_e)),nt._15(1,114688,null,0,Bt,[Ut.d,ce.g,ce.a],null,null)],function(t,e){t(e,1,0)},null)}function C(t){return nt._41(0,[(t()(),nt._17(0,16777216,null,null,10,"mat-list-item",[["class","vis-template mat-list-item"],["dnd-draggable",""],["matTooltipPosition","right"],["role","listitem"]],null,[[null,"mouseenter"],[null,"mouseleave"],[null,"focus"],[null,"blur"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],function(t,e,n){var i=!0,r=t.component;if("focus"===e){i=!1!==nt._31(t,2)._handleFocus()&&i}if("blur"===e){i=!1!==nt._31(t,2)._handleBlur()&&i}if("longpress"===e){i=!1!==nt._31(t,5).show()&&i}if("focus"===e){i=!1!==nt._31(t,5).show()&&i}if("blur"===e){i=!1!==nt._31(t,5).hide(0)&&i}if("keydown"===e){i=!1!==nt._31(t,5)._handleKeydown(n)&&i}if("touchend"===e){i=!1!==nt._31(t,5).hide(1500)&&i}if("mouseenter"===e){i=!1!=(r.lookAtVisDrop=!0)&&i}if("mouseleave"===e){i=!1!=(r.lookAtVisDrop=!1)&&i}return i},be.c,be.b)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,1097728,null,2,xe.c,[nt.M,nt.o,[2,xe.a],[2,xe.f]],null,null),nt._37(603979776,1,{_lines:1}),nt._37(335544320,2,{_hasAvatar:0}),nt._15(5,147456,null,0,we.c,[nt.M,Pe.b,nt.o,Oe.c,nt.Z,nt.D,Zt.a,Kt.e,we.a,[2,ue.c]],{position:[0,"position"],message:[1,"message"]},null),nt._15(6,16384,null,0,Ce.a,[nt.o,Se.a,ke.a,nt.h],{dragData:[0,"dragData"],dropzones:[1,"dropzones"]},null),nt._32(7,1),(t()(),nt._39(-1,2,["\n    "])),(t()(),nt._17(9,0,null,2,0,"img",[["class","new-vis-thumbnail"]],[[8,"src",4]],null,null,null,null)),(t()(),nt._39(-1,2,["\n  "])),(t()(),nt._11(0,null,null,0))],function(t,e){t(e,5,0,"right",e.context.$implicit.$tooltip),t(e,6,0,e.context.$implicit,t(e,7,0,"newvis-dropZone"))},function(t,e){var n=e.component;t(e,9,0,nt._20(2,"",n.baseHref,"",e.context.$implicit.$thumbnail,""))})}function S(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["*"]))],null,null)}function k(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,44,"mat-list",[["class","new-vis-list mat-list"],["role","list"]],null,null,null,be.d,be.a)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,49152,null,0,xe.a,[],null,null),nt._15(3,16384,null,0,xe.b,[],null,null),(t()(),nt._39(-1,0,["\n  "])),(t()(),nt._17(5,0,null,0,10,"div",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._17(7,0,null,null,4,"button",[["class","toggle-admin-mode mat-icon-button"],["mat-icon-button",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var i=!0,r=t.component;if("click"===e){i=!1!==r.toggleAdminMode()&&i}return i},ie.d,ie.b)),nt._15(8,16384,null,0,Ht.u,[],null,null),nt._15(9,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],null,null),nt._15(10,16384,null,0,re.e,[],null,null),(t()(),nt._17(11,0,null,0,0,"i",[["aria-hidden","true"],["class","fa fa-2x fa-times-circle"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._17(13,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["Click and drag the visualizations below onto your Refuge Dashboard. You can have up to 10 visualizations on your Dashboard at one time. You can have multiple versions of each visualization type."])),(t()(),nt._39(-1,null,["\n  "])),(t()(),nt._39(-1,0,["\n  "])),(t()(),nt._11(16777216,null,0,1,null,C)),nt._15(18,802816,null,0,Tt.i,[nt.Z,nt.U,nt.x],{ngForOf:[0,"ngForOf"]},null),(t()(),nt._39(-1,0,["\n  "])),(t()(),nt._17(20,16777216,null,0,7,"mat-list-item",[["class","trash mat-list-item"],["dnd-droppable",""],["matTooltip","Drag and drop visualization here to remove"],["matTooltipPosition","right"],["role","listitem"]],null,[[null,"onDropSuccess"],[null,"focus"],[null,"blur"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],function(t,e,n){var i=!0,r=t.component;if("focus"===e){i=!1!==nt._31(t,22)._handleFocus()&&i}if("blur"===e){i=!1!==nt._31(t,22)._handleBlur()&&i}if("longpress"===e){i=!1!==nt._31(t,25).show()&&i}if("focus"===e){i=!1!==nt._31(t,25).show()&&i}if("blur"===e){i=!1!==nt._31(t,25).hide(0)&&i}if("keydown"===e){i=!1!==nt._31(t,25)._handleKeydown(n)&&i}if("touchend"===e){i=!1!==nt._31(t,25).hide(1500)&&i}if("onDropSuccess"===e){i=!1!==r.trashVisualization(n)&&i}return i},be.c,be.b)),nt._15(21,16384,null,0,Ht.u,[],null,null),nt._15(22,1097728,null,2,xe.c,[nt.M,nt.o,[2,xe.a],[2,xe.f]],null,null),nt._37(603979776,3,{_lines:1}),nt._37(335544320,4,{_hasAvatar:0}),nt._15(25,147456,null,0,we.c,[nt.M,Pe.b,nt.o,Oe.c,nt.Z,nt.D,Zt.a,Kt.e,we.a,[2,ue.c]],{position:[0,"position"],message:[1,"message"]},null),nt._15(26,16384,null,0,Me.a,[nt.o,Se.a,ke.a,nt.h],{dropzones:[0,"dropzones"]},{onDropSuccess:"onDropSuccess"}),nt._32(27,1),(t()(),nt._39(-1,0,["\n  "])),(t()(),nt._17(29,0,null,0,14,"mat-list-item",[["class","save mat-list-item"],["role","listitem"]],null,[[null,"focus"],[null,"blur"]],function(t,e,n){var i=!0;if("focus"===e){i=!1!==nt._31(t,31)._handleFocus()&&i}if("blur"===e){i=!1!==nt._31(t,31)._handleBlur()&&i}return i},be.c,be.b)),nt._15(30,16384,null,0,Ht.u,[],null,null),nt._15(31,1097728,null,2,xe.c,[nt.M,nt.o,[2,xe.a],[2,xe.f]],null,null),nt._37(603979776,5,{_lines:1}),nt._37(335544320,6,{_hasAvatar:0}),(t()(),nt._39(-1,2,["\n    "])),(t()(),nt._17(35,16777216,null,2,7,"button",[["aria-labelled","Save"],["class","mat-icon-button"],["mat-icon-button",""],["matTooltip","Save current visualization order"]],[[8,"disabled",0]],[[null,"click"],[null,"longpress"],[null,"focus"],[null,"blur"],[null,"keydown"],[null,"touchend"]],function(t,e,n){var i=!0,r=t.component;if("longpress"===e){i=!1!==nt._31(t,37).show()&&i}if("focus"===e){i=!1!==nt._31(t,37).show()&&i}if("blur"===e){i=!1!==nt._31(t,37).hide(0)&&i}if("keydown"===e){i=!1!==nt._31(t,37)._handleKeydown(n)&&i}if("touchend"===e){i=!1!==nt._31(t,37).hide(1500)&&i}if("click"===e){i=!1!==r.save()&&i}return i},ie.d,ie.b)),nt._15(36,16384,null,0,Ht.u,[],null,null),nt._15(37,147456,null,0,we.c,[nt.M,Pe.b,nt.o,Oe.c,nt.Z,nt.D,Zt.a,Kt.e,we.a,[2,ue.c]],{message:[0,"message"]},null),nt._15(38,180224,null,0,re.b,[nt.M,nt.o,Zt.a,Kt.h],{disabled:[0,"disabled"]},null),nt._15(39,16384,null,0,re.e,[],null,null),(t()(),nt._17(40,0,null,0,0,"i",[["aria-hidden","true"],["class","fa fa-floppy-o"]],null,null,null,null,null)),(t()(),nt._11(16777216,null,0,1,null,S)),nt._15(42,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,2,["\n  "])),(t()(),nt._39(-1,0,["\n"]))],function(t,e){var n=e.component;t(e,18,0,n.visTemplates);t(e,25,0,"right","Drag and drop visualization here to remove"),t(e,26,0,t(e,27,0,"trash-dropZone"));t(e,37,0,"Save current visualization order"),t(e,38,0,!n.isReordered()),t(e,42,0,n.isReordered())},function(t,e){t(e,7,0,nt._31(e,9).disabled||null),t(e,35,0,nt._31(e,38).disabled||null)})}function M(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"div",[["class","cover"]],null,[[null,"click"]],function(t,e,n){var i=!0,r=t.component;if("click"===e){i=!1!==r.makeCurrent(t.parent.context.$implicit)&&i}return i},null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(2,0,null,null,1,"span",[["class","visualization-title"]],null,null,null,null,null)),(t()(),nt._39(3,null,["",""])),(t()(),nt._39(-1,null,["\n        "]))],null,function(t,e){t(e,3,0,e.parent.context.$implicit.meta.title)})}function j(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"p",[["class","visualization-description"]],null,null,null,null,null)),(t()(),nt._39(1,null,["",""]))],null,function(t,e){t(e,1,0,e.parent.parent.context.$implicit.meta.description)})}function D(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,7,"div",[["class","visualization-details"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(2,0,null,null,1,"div",[["class","visualization-title"]],null,null,null,null,null)),(t()(),nt._39(3,null,["",""])),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._11(16777216,null,null,1,null,j)),nt._15(6,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n        "]))],function(t,e){t(e,6,0,e.parent.context.$implicit.meta.description)},function(t,e){t(e,3,0,e.parent.context.$implicit.meta.title)})}function z(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,13,"mat-card",[["class","mat-card"],["dnd-sortable",""]],null,[[null,"onDragStart"],[null,"onDropSuccess"]],function(t,e,n){var i=!0,r=t.component;if("onDragStart"===e){i=!1!==r.dragStart(n)&&i}if("onDropSuccess"===e){i=!1!==r.reorderVisualizations()&&i}return i},je.b,je.a)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,49152,null,0,De.a,[],null,null),nt._15(3,16384,null,0,ze.a,[nt.o,Se.a,ke.a,ze.b,Se.b,nt.h],{index:[0,"index"],draggable:[1,"draggable"],dragData:[2,"dragData"]},{onDragStartCallback:"onDragStart",onDropSuccessCallback:"onDropSuccess"}),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,M)),nt._15(6,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,D)),nt._15(9,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._17(11,0,null,0,1,"npn-visualization",[],null,null,null,Rt.b,Rt.a)),nt._15(12,114688,null,0,Et.a,[],{thumbnail:[0,"thumbnail"],selection:[1,"selection"]},null),(t()(),nt._39(-1,0,["\n    "]))],function(t,e){var n=e.component;t(e,3,0,e.context.index,n.adminMode,e.context.$implicit),t(e,6,0,!e.context.first&&!n.mobileMode),t(e,9,0,e.context.first||n.mobileMode),t(e,12,0,!n.mobileMode&&e.context.index>0,e.context.$implicit)},null)}function A(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,6,"mat-card",[["class","mat-card"],["dnd-droppable",""]],null,[[null,"onDropSuccess"]],function(t,e,n){var i=!0,r=t.component;if("onDropSuccess"===e){i=!1!==r.addVisualization(n)&&i}return i},je.b,je.a)),nt._15(1,278528,null,0,Tt.h,[nt.x,nt.y,nt.o,nt.L],{ngClass:[0,"ngClass"]},null),nt._34(2,{"new-vis-placeholder":0,"look-at-me":1}),nt._15(3,16384,null,0,Ht.u,[],null,null),nt._15(4,49152,null,0,De.a,[],null,null),nt._15(5,16384,null,0,Me.a,[nt.o,Se.a,ke.a,nt.h],{dropzones:[0,"dropzones"]},{onDropSuccess:"onDropSuccess"}),nt._32(6,1)],function(t,e){t(e,1,0,t(e,2,0,!0,e.component.lookAtVisDrop)),t(e,5,0,t(e,6,0,"newvis-dropZone"))},null)}function L(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,9,"div",[["class","visualizations"],["dnd-sortable-container",""]],null,null,null,null,null)),nt._15(1,16384,null,0,ze.b,[nt.o,Se.a,ke.a,nt.h,Se.b],{sortableData:[0,"sortableData"],dropzones:[1,"dropzones"]},null),nt._32(2,2),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,z)),nt._15(5,802816,null,0,Tt.i,[nt.Z,nt.U,nt.x],{ngForOf:[0,"ngForOf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,A)),nt._15(8,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n"]))],function(t,e){var n=e.component;t(e,1,0,n.refuge.selections,t(e,2,0,"list-dropZone","trash-dropZone")),t(e,5,0,n.refuge.selections),t(e,8,0,n.adminMode&&n.refuge.selections.length<n.maxVisualizations)},null)}function I(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"mat-button-toggle",[["class","mat-button-toggle"]],[[2,"mat-button-toggle-standalone",null],[2,"mat-button-toggle-checked",null],[2,"mat-button-toggle-disabled",null],[1,"id",0]],[[null,"change"]],function(t,e,n){var i=!0,r=t.component;if("change"===e){i=!1!==r.toggleAdminMode()&&i}return i},Ae.b,Ae.a)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,245760,null,0,Le.a,[[2,Le.b],[2,Le.c],nt.h,Xt.c,nt.M,nt.o,Kt.h],null,{change:"change"}),(t()(),nt._17(3,0,null,0,1,"span",[["class","admin-toggle"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["Customize"]))],function(t,e){t(e,2,0)},function(t,e){t(e,0,0,!nt._31(e,2).buttonToggleGroup&&!nt._31(e,2).buttonToggleGroupMultiple,nt._31(e,2).checked,nt._31(e,2).disabled,nt._31(e,2).id)})}function F(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n"])),(t()(),nt._11(16777216,null,null,1,null,k)),nt._15(2,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n\n"])),(t()(),nt._11(16777216,null,null,1,null,L)),nt._15(5,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n"])),(t()(),nt._11(16777216,null,null,1,null,I)),nt._15(8,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n  "]))],function(t,e){var n=e.component;t(e,2,0,n.adminMode),t(e,5,0,n.refuge),t(e,8,0,n.userIsAdmin&&!n.mobileMode&&!n.adminMode&&!n.isTouchDevice)},null)}function R(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"refuge-findings",[],[[2,"adminMode",null]],null,null,F,Ve)),nt._15(1,114688,null,0,Re,[vt,ht,ce.d,Ee.b,Ie.j,[2,lt.e]],null,null)],function(t,e){t(e,1,0)},function(t,e){t(e,0,0,nt._31(e,1).adminMode)})}function E(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,6,"li",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(2,0,null,null,3,"a",[["target","_blank"]],[[8,"href",4]],null,null,null,null)),(t()(),nt._39(3,null,[""," (",")"])),nt._35(4,2),nt._35(5,2),(t()(),nt._39(-1,null,["\n            "]))],null,function(t,e){t(e,2,0,"https://usanpn.org/nn/"+e.context.$implicit.genus+"_"+e.context.$implicit.species),t(e,3,0,nt._40(e,3,0,t(e,4,0,nt._31(e.parent.parent.parent,0),e.context.$implicit,"common-name")),nt._40(e,3,1,t(e,5,0,nt._31(e.parent.parent.parent,0),e.context.$implicit,"scientific-name")))})}function T(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"ul",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._11(16777216,null,null,1,null,E)),nt._15(3,802816,null,0,Tt.i,[nt.Z,nt.U,nt.x],{ngForOf:[0,"ngForOf"]},null),(t()(),nt._39(-1,null,["\n        "]))],function(t,e){t(e,3,0,e.component.speciesList)},null)}function V(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,7,"div",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n        "])),(t()(),nt._17(2,0,null,null,1,"h3",[],null,null,null,null,null)),(t()(),nt._39(3,null,["Focal Species for ",""])),(t()(),nt._39(-1,null,["\n        "])),(t()(),nt._11(16777216,null,null,1,null,T)),nt._15(6,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,6,0,n.speciesList&&n.speciesList.length)},function(t,e){t(e,3,0,e.component.refuge.title)})}function U(t){return nt._41(0,[nt._33(0,Ue.a,[]),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,V)),nt._15(3,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){t(e,3,0,e.component.refuge)},null)}function B(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"focal-species",[],null,null,null,U,Ye)),nt._15(1,573440,null,0,Be,[qe.a],null,null)],null,null)}function q(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"a",[["class","mat-raised-button"],["mat-raised-button",""]],[[8,"href",4],[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,2)._haltDisabledEvents(n)&&i}return i},ie.c,ie.a)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,180224,null,0,re.a,[Zt.a,Kt.h,nt.o,nt.M],null,null),nt._15(3,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Register"]))],null,function(t,e){t(e,0,0,"//www.usanpn.org/user/register?default_group_id="+e.component.refuge.network_id,nt._31(e,2).disabled?-1:0,nt._31(e,2).disabled||null,nt._31(e,2).disabled.toString())})}function N(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"a",[["class","mat-raised-button"],["href","/user/login"],["mat-raised-button",""]],[[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,2)._haltDisabledEvents(n)&&i}return i},ie.c,ie.a)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,180224,null,0,re.a,[Zt.a,Kt.h,nt.o,nt.M],null,null),nt._15(3,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["Login"]))],null,function(t,e){t(e,0,0,nt._31(e,2).disabled?-1:0,nt._31(e,2).disabled||null,nt._31(e,2).disabled.toString())})}function Y(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"a",[["class","mat-raised-button"],["href","//mynpn.usanpn.org/npnapps/"],["mat-raised-button",""],["target","_blank"]],[[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0]],[[null,"click"]],function(t,e,n){var i=!0;if("click"===e){i=!1!==nt._31(t,2)._haltDisabledEvents(n)&&i}return i},ie.c,ie.a)),nt._15(1,16384,null,0,Ht.u,[],null,null),nt._15(2,180224,null,0,re.a,[Zt.a,Kt.h,nt.o,nt.M],null,null),nt._15(3,16384,null,0,re.f,[],null,null),(t()(),nt._39(-1,0,["My Observation Deck"]))],null,function(t,e){t(e,0,0,nt._31(e,2).disabled?-1:0,nt._31(e,2).disabled||null,nt._31(e,2).disabled.toString())})}function $(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._17(1,0,null,null,0,"div",[],[[8,"innerHTML",1]],null,null,null,null)),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,q)),nt._15(4,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,N)),nt._15(7,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._11(16777216,null,null,1,null,Y)),nt._15(10,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n    "]))],function(t,e){var n=e.component;t(e,4,0,!n.userIsLoggedIn),t(e,7,0,!n.userIsLoggedIn),t(e,10,0,n.userIsLoggedIn)},function(t,e){var n=e.component;t(e,1,0,n.refuge&&n.refuge.resources?n.refuge.resources:"")})}function Z(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"refuge-resources",[],null,null,null,$,We)),nt._15(1,49152,null,0,$e,[],null,null)],null,null)}function W(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(1,0,null,null,4,"div",[["class","rd-tab-label findings"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(3,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["What we're finding"])),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._39(-1,null,["\n        "]))],null,null)}function G(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"refuge-findings",[],[[2,"adminMode",null]],null,null,F,Ve)),nt._15(1,114688,[[1,4]],0,Re,[vt,ht,ce.d,Ee.b,Ie.j,[2,lt.e]],{refuge:[0,"refuge"],userIsAdmin:[1,"userIsAdmin"]},null)],function(t,e){var n=e.component;t(e,1,0,n.refuge,n.userIsAdmin)},function(t,e){t(e,0,0,nt._31(e,1).adminMode)})}function K(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"div",[["class","rd-tab-content"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._11(16777216,null,null,1,null,G)),nt._15(3,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,null,["\n        "]))],function(t,e){t(e,3,0,e.component.refuge)},null)}function H(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(1,0,null,null,4,"div",[["class","rd-tab-label focal-species"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(3,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["Focal Species"])),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._39(-1,null,["\n        "]))],null,null)}function J(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"div",[["class","rd-tab-content"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(2,0,null,null,1,"focal-species",[],null,null,null,U,Ye)),nt._15(3,573440,null,0,Be,[qe.a],{refuge:[0,"refuge"]},null),(t()(),nt._39(-1,null,["\n        "]))],function(t,e){t(e,3,0,e.component.refuge)},null)}function Q(t){return nt._41(0,[(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(1,0,null,null,4,"div",[["class","rd-tab-label resources"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n                "])),(t()(),nt._17(3,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),nt._39(-1,null,["Resources for observers"])),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._39(-1,null,["\n        "]))],null,null)}function X(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,4,"div",[["class","rd-tab-content"]],null,null,null,null,null)),(t()(),nt._39(-1,null,["\n            "])),(t()(),nt._17(2,0,null,null,1,"refuge-resources",[],null,null,null,$,We)),nt._15(3,49152,null,0,$e,[],{refuge:[0,"refuge"],userIsLoggedIn:[1,"userIsLoggedIn"]},null),(t()(),nt._39(-1,null,["\n        "]))],function(t,e){var n=e.component;t(e,3,0,n.refuge,n.userIsLoggedIn)},null)}function tt(t){return nt._41(0,[nt._37(671088640,1,{findingsComponent:0}),(t()(),nt._39(-1,null,["\n  "])),(t()(),nt._17(2,0,null,null,40,"mat-tab-group",[["class","refuge-dashboard-tabs mat-tab-group"]],[[2,"mat-tab-group-dynamic-height",null],[2,"mat-tab-group-inverted-header",null]],[[null,"selectedTabChange"]],function(t,e,n){var i=!0,r=t.component;if("selectedTabChange"===e){i=!1!==r.selectedTabChange(n)&&i}return i},Ge.c,Ge.b)),nt._15(3,16384,null,0,Ht.u,[],null,null),nt._15(4,11714560,null,1,Ke.d,[nt.M,nt.o,nt.h],null,{selectedTabChange:"selectedTabChange"}),nt._37(603979776,2,{_tabs:1}),(t()(),nt._39(-1,null,["\n    "])),(t()(),nt._17(7,16777216,null,null,10,"mat-tab",[["label","What we're finding"]],null,null,null,Ge.d,Ge.a)),nt._15(8,16384,null,0,Ht.u,[],null,null),nt._15(9,770048,[[2,4]],1,Ke.b,[nt.Z],{textLabel:[0,"textLabel"]},null),nt._37(335544320,3,{templateLabel:0}),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,W)),nt._15(13,16384,[[3,4]],0,Ke.f,[nt.U,nt.Z],null,null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,K)),nt._15(16,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n    "])),(t()(),nt._39(-1,null,["\n\n    "])),(t()(),nt._17(19,16777216,null,null,10,"mat-tab",[["label","Focal Species"]],null,null,null,Ge.d,Ge.a)),nt._15(20,16384,null,0,Ht.u,[],null,null),nt._15(21,770048,[[2,4]],1,Ke.b,[nt.Z],{textLabel:[0,"textLabel"]},null),nt._37(335544320,4,{templateLabel:0}),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,H)),nt._15(25,16384,[[4,4]],0,Ke.f,[nt.U,nt.Z],null,null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,J)),nt._15(28,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n    "])),(t()(),nt._39(-1,null,["\n\n    "])),(t()(),nt._17(31,16777216,null,null,10,"mat-tab",[["label","Resources for observers"]],null,null,null,Ge.d,Ge.a)),nt._15(32,16384,null,0,Ht.u,[],null,null),nt._15(33,770048,[[2,4]],1,Ke.b,[nt.Z],{textLabel:[0,"textLabel"]},null),nt._37(335544320,5,{templateLabel:0}),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,Q)),nt._15(37,16384,[[5,4]],0,Ke.f,[nt.U,nt.Z],null,null),(t()(),nt._39(-1,0,["\n        "])),(t()(),nt._11(16777216,null,0,1,null,X)),nt._15(40,16384,null,0,Tt.j,[nt.Z,nt.U],{ngIf:[0,"ngIf"]},null),(t()(),nt._39(-1,0,["\n    "])),(t()(),nt._39(-1,null,["\n  "])),(t()(),nt._39(-1,null,["\n  "]))],function(t,e){var n=e.component;t(e,9,0,"What we're finding"),t(e,16,0,n.renderVisualizations);t(e,21,0,"Focal Species"),t(e,28,0,n.renderFocalSpecies);t(e,33,0,"Resources for observers"),t(e,40,0,n.renderResources)},function(t,e){t(e,2,0,nt._31(e,4).dynamicHeight,"below"===nt._31(e,4).headerPosition)})}function et(t){return nt._41(0,[(t()(),nt._17(0,0,null,null,1,"refuge-dashboard",[],null,null,null,tt,Je)),nt._15(1,114688,null,0,bt,[nt.o,vt],null,null)],function(t,e){t(e,1,0)},null)}Object.defineProperty(e,"__esModule",{value:!0});var nt=n("/oeL"),it=n("OpsG"),rt=function(){function t(){}return t}();it.a.production&&Object(nt._3)();var ot=n("CPp0"),lt=(n("82j9"),n("4Y6l")),at=n("8FRf"),st=n("5f6/"),ut=n("5Q6U"),ct=n("C4Zx"),dt=n("kZ5P"),pt=n("P2lY"),ft=n("mc75"),ht=function(){function t(t,e,n,i,r,o){this.calendar=t,this.scatter=e,this.activity=n,this.observer=i,this.observationFreq=r,this.clippedWmsMap=o,this.factoryMap={},this.factoryMap.CalendarSelection=t,this.factoryMap.ScatterPlotSelection=e,this.factoryMap.ActivityCurvesSelection=n,this.factoryMap.ObserverActivitySelection=i,this.factoryMap.ObservationFrequencySelection=r,this.factoryMap.ClippedWmsMapSelection=o}return t.prototype.newCalendarSelection=function(){return this.calendar.newSelection()},t.prototype.newScatterPlotSelection=function(){return this.scatter.newSelection()},t.prototype.newActivityCurvesSelection=function(){return this.activity.newSelection()},t.prototype.newObserverActivitySelection=function(){return this.observer.newSelection()},t.prototype.newObservationFrequencySelection=function(){return this.observationFreq.newSelection()},t.prototype.newClippedWmsMapSelection=function(){return this.clippedWmsMap.newSelection()},t.prototype.cloneSelection=function(t){return this.newSelection(t.external)},t.prototype.newSelections=function(t){var e=this;return t.map(function(t){return e.newSelection(t)})},t.prototype.newSelection=function(t){if(!this.factoryMap[t.$class])throw new Error('Unknown selection type "'+t.$class+'"');var e=this.factoryMap[t.$class].newSelection();return e.external=t,e},t.ctorParameters=function(){return[{type:ut.b},{type:st.b},{type:ct.b},{type:dt.b},{type:pt.b},{type:ft.b}]},t}(),gt=function(){function t(){}return t}(),_t=function(){function t(){}return t}(),mt=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},yt=new ot.d({"Content-Type":"application/json"}),vt=function(){function t(t,e,n){this.http=t,this.cacheService=e,this.selectionFactory=n}return t.prototype.parseSelections=function(t){return this.selectionFactory.newSelections(JSON.parse(t))},t.prototype.refugeUrl=function(t){return"/api/refuge/"+t},t.prototype.castRefuge=function(t,e){e.id=t;var n=(e.selections||[]).map(function(t){return JSON.parse(t)});return e.selections=this.selectionFactory.newSelections(n),e},t.prototype.refugeList=function(){var t=this;return new Promise(function(e,n){t.http.get("/api/refuge").toPromise().then(function(t){var n=t.json();e(Object.keys(n).map(function(t){return{id:t,title:n[t].title}}))}).catch(n)})},t.prototype.getRefuge=function(t){var e=this;return new Promise(function(n,i){e.http.get(e.refugeUrl(t)).toPromise().then(function(i){n(e.castRefuge(t,i.json()))}).catch(i)})},t.prototype.saveRefuge=function(t){var e=this;return new Promise(function(n,i){var r=mt({},t);r.selections=(r.selections||[]).map(function(t){return JSON.stringify(t.external)});var o=JSON.stringify(r);console.log("JSON "+o),e.http.put(e.refugeUrl(t.id),o,{headers:yt}).toPromise().then(function(i){n(e.castRefuge(t.id,i.json()))}).catch(i)})},t.ctorParameters=function(){return[{type:ot.e},{type:lt.a},{type:ht}]},t}(),bt=(function(){function t(){}}(),function(){function t(t,e){this.element=t,this.refugeService=e,this.userIsLoggedIn=!1,this.userIsAdmin=!1,this.renderVisualizations=!0,this.renderFocalSpecies=!1,this.renderResources=!1;var n=t.nativeElement;this.refuge_id=n.getAttribute("refuge_id"),this.userIsAdmin=null!==n.getAttribute("user_is_admin"),this.userIsLoggedIn=null!==n.getAttribute("user_is_logged_in")}return t.prototype.ngOnInit=function(){var t=this;this.refugeService.getRefuge(this.refuge_id).then(function(e){return t.refuge=e})},t.prototype.selectedTabChange=function(t){var e=this;this.renderFocalSpecies=this.renderFocalSpecies||1===t.index,this.renderVisualizations=this.renderVisualizations||0===t.index,this.renderResources=this.renderResources||2===t.index,0===t.index&&setTimeout(function(){e.findingsComponent&&e.findingsComponent.resizeAll()})},t.ctorParameters=function(){return[{type:nt.o},{type:vt}]},t}()),xt=n("O00e"),wt=n("8HKE"),Pt=n("kJcM"),Ot=n("Gnba"),Ct=n("6Ce8"),St=n("vlFF"),kt=n("+6ye"),Mt=n("Z4Mu"),jt=n("Hcb1"),Dt=n("zLj1"),zt=n("gKwA"),At=n("PIYP"),Lt=n("c1PR"),It=n("7RS7"),Ft=n("YPxi"),Rt=n("ZLow"),Et=n("332T"),Tt=n("qbdv"),Vt=n("6lRS"),Ut=n("bm2B"),Bt=function(){function t(t,e,n){this.formBuilder=t,this.dialogRef=e,this.data=n,this.step1FormGroup=this.formBuilder.group({firstCtrl:["",Ut.q.required]}),this.step2FormGroup=this.formBuilder.group({secondCtrl:["",Ut.q.required]}),this.step3FormGroup=this.formBuilder.group({thirdCtrl:["",Ut.q.required]}),this.selection=n.selection,this.refuge=n.refuge}return t.prototype.ngOnInit=function(){var t=this.selection;t.editMode=!0,this.stationAware=t instanceof at.g,this.showVis=this.stationAware?0:1,t instanceof at.c&&(t.networkIds=[this.refuge.network_id])},t.prototype.stepChanged=function(t){var e=this,n=this.stationAware?1:0;console.debug("NewVisualizationDialogComponent:stepChanged visIndex="+n,t),t.selectedIndex===n&&(this.showVis++,setTimeout(function(){1!==e.showVis&&e.selection.isValid()?e.selection.update():e.selection.resize()})),this.showDetails=t.selectedIndex===n+1},t.ctorParameters=function(){return[{type:Ut.d},{type:Vt.c},{type:void 0,decorators:[{type:nt.s,args:[Vt.a]}]}]},t}(),qt=function(){function t(){}return t.prototype.ngOnInit=function(){var t=this.selection;t instanceof ct.a?this.activity=t:t instanceof st.a?this.scatter=t:t instanceof ut.a?this.calendar=t:t instanceof dt.a?this.observer=t:t instanceof pt.a?this.observationFreq=t:t instanceof ft.a&&(this.clipped=t,t.fwsBoundary=this.refuge.boundary_id),t.resize()},t}(),Nt=function(){function t(t){this.networkService=t,this.visScope="refuge",this.stationFetch=!1}return t.prototype.scopeChanged=function(){var t=this;switch(this.selection.networkIds=[],this.selection.stationIds=[],this.visScope){case"all":break;case"refuge":this.selection.networkIds=[this.refuge.network_id];break;case"station":this.selection.networkIds=[this.refuge.network_id],this.stations||(this.stationFetch=!0,this.networkService.getStations(this.refuge.network_id).then(function(e){e.forEach(function(t){return t.selected=!0}),t.stations=e,t.stationFetch=!1}).catch(function(e){t.stationFetch=!1,console.error(e)}))}},t.prototype.stationChange=function(){this.selection.stationIds=this.stations.filter(function(t){return t.selected}).map(function(t){return t.station_id})},t.ctorParameters=function(){return[{type:lt.g}]},t}(),Yt=n("OBOK"),$t=n("0bRs"),Zt=n("V8+5"),Wt=n("08D6"),Gt=n("0cZJ"),Kt=n("8Xfy"),Ht=n("j5BN"),Jt=n("9Rbf"),Qt=n("l9NV"),Xt=n("ka8K"),te=n("Zyxv"),ee=n("+2kU"),ne=n("8on4"),ie=n("wjk8"),re=n("ghl+"),oe=n("nYcr"),le=n("6OSA"),ae=n("Lpd/"),se=n("SlD5"),ue=n("l6RC"),ce=n("w24y"),de=["npn-visualization[_ngcontent-%COMP%] {\n            margin-top: 20px;\n            width: 90%; // within stepper o/w horizontal scroll\n        }"],pe=nt._14({encapsulation:0,styles:de,data:{}}),fe=(nt._12("new-visualization-builder",qt,f,{selection:"selection",refuge:"refuge"},{},[]),[".vis-scope-input[_ngcontent-%COMP%] {\n          display: inline-flex;\n          flex-direction: column;\n        }\n        .vis-scope-radio[_ngcontent-%COMP%] {\n          margin: 5px;\n        }\n        .station-input[_ngcontent-%COMP%] {\n            display: block;\n        }"]),he=nt._14({encapsulation:0,styles:fe,data:{}}),ge=(nt._12("visualization-scope-selection",Nt,y,{selection:"selection",refuge:"refuge"},{},[]),["mat-horizontal-stepper[_ngcontent-%COMP%] {\n            height: 100%;\n        }\n        \n          .mat-horizontal-content-container {\n            height: calc(100% - 75px);\n        }\n          .mat-horizontal-content-container .mat-horizontal-stepper-content {\n            height: 100%;\n        }\n        .step-wrapper[_ngcontent-%COMP%] {\n            height: 100%;\n        }\n        .step-nav[_ngcontent-%COMP%] {\n            padding: 5px;\n            height: 46px;\n        }\n        .step-content[_ngcontent-%COMP%] {\n            height: calc(100% - 46px);\n            overflow-y: auto;\n        }\n\n        .step-nav[_ngcontent-%COMP%]    > button[_ngcontent-%COMP%] {\n            margin-right: 5px;\n        }\n\n        .visualization-title[_ngcontent-%COMP%], .visualization-description[_ngcontent-%COMP%] {\n            display: block;\n            width: 100%;\n        }\n        .visualization-description[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%] {\n            height: 5em;\n        }\n        .step-instructions[_ngcontent-%COMP%] {\n            color: #666;\n            font-size: 0.95em;\n            margin-top: 20px;\n        }"]),_e=nt._14({encapsulation:0,styles:ge,data:{}}),me=nt._12("new-vis-dialog",Bt,O,{},{},[]),ye=['[_nghost-%COMP%]{display:block;background-color:transparent;min-height:896px}  .mat-tab-header{border-bottom:none}  .mat-tab-header .mat-ink-bar{display:none}  .mat-tab-header .mat-tab-labels{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap}  .mat-tab-header .mat-tab-labels>.mat-tab-label{width:100%;white-space:normal;display:block;font-size:.9em;height:96px;opacity:1;color:#fff;padding:0;background-color:transparent}@media (min-width:768px){  .mat-tab-header .mat-tab-labels>.mat-tab-label{display:-webkit-box;display:-ms-flexbox;display:flex}}@media (min-width:992px){  .mat-tab-header .mat-tab-labels>.mat-tab-label{font-size:1em}}  .mat-tab-header .mat-tab-labels>.mat-tab-label>.rd-tab-label{width:100%;display:block;padding:0;height:100%}  .mat-tab-header .mat-tab-labels>.mat-tab-label:focus{background-color:transparent}  .mat-tab-header .mat-tab-labels>.mat-tab-label.mat-tab-label-active{color:orange}  .mat-tab-header .mat-tab-labels>.mat-tab-label:first-of-type > .rd-tab-label{background-color:#271614}@media (min-width:768px){  .mat-tab-header .mat-tab-labels>.mat-tab-label:first-of-type > .rd-tab-label{padding-left:24px}}  .mat-tab-header .mat-tab-labels>.mat-tab-label:first-of-type::after{content:"";border-top:48px solid #3f322b;border-right:48px solid #3f322b;border-bottom:48px solid #271614;border-left:48px solid #271614}  .mat-tab-header .mat-tab-labels>.mat-tab-label:nth-of-type(2)>.rd-tab-label{background-color:#3f322b}  .mat-tab-header .mat-tab-labels>.mat-tab-label:nth-of-type(2):after{content:"";border-top:48px solid #574d3f;border-right:48px solid #574d3f;border-bottom:48px solid #3f322b;border-left:48px solid #3f322b}  .mat-tab-header .mat-tab-labels>.mat-tab-label:nth-of-type(3)>.rd-tab-label{background-color:#574d3f}  .mat-tab-header .mat-tab-labels>.mat-tab-label:nth-of-type(3):after{content:"";border-top:48px solid transparent;border-right:48px solid transparent;border-bottom:48px solid #574d3f;border-left:48px solid #574d3f}.rd-tab-label[_ngcontent-%COMP%]{position:relative;text-transform:uppercase}.rd-tab-label[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{color:inherit;margin-top:3.25em}.rd-tab-label[_ngcontent-%COMP%]:before{font-family:FontAwesome;position:absolute;top:.5em;right:45%;-webkit-transform:translateX(-50%);transform:translateX(-50%);font-size:2em}.rd-tab-label.focal-species[_ngcontent-%COMP%]:before{content:"\\F1B0"}.rd-tab-label.findings[_ngcontent-%COMP%]:before{content:"\\F002"}.rd-tab-label.resources[_ngcontent-%COMP%]:before{content:"\\F02D"}.rd-tab-content[_ngcontent-%COMP%]{min-height:800px;padding:20px 5px;color:#000;border-left:2px solid #ddd;border-right:2px solid #ddd;background-color:#fff}@media (min-width:992px){.rd-tab-content[_ngcontent-%COMP%]{padding:20px}}'],ve=['[_nghost-%COMP%]{position:relative;display:block}.adminMode[_nghost-%COMP%]{padding-left:275px}@media (min-width:992px){.adminMode[_nghost-%COMP%]{padding-left:215px}}@media (min-width:1200px){.adminMode[_nghost-%COMP%]{padding-left:200px}}.visualizations[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;flex-flow:row wrap}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin:10px auto;padding:10px;-webkit-box-flex:0;-ms-flex:0 1 95%;flex:0 1 95%;vertical-align:top;position:relative;overflow:hidden}@media (min-width:992px){.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:15px}}@media (min-width:1200px){.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:20px}}@media (min-width:992px){.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{-webkit-box-flex:0;-ms-flex:0 1 44%;flex:0 1 44%}}@media (min-width:1200px){.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{-webkit-box-flex:0;-ms-flex:0 1 28%;flex:0 1 28%}}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]:first-of-type{-webkit-box-flex:0;-ms-flex:0 1 95%;flex:0 1 95%;min-height:200px}@media (min-width:992px){.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]:first-of-type{min-height:400px}}@media (min-width:1200px){.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]:first-of-type{min-height:500px}}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .visualization-title[_ngcontent-%COMP%]{font-size:2em;margin-bottom:10px;text-align:center}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .visualization-description[_ngcontent-%COMP%]{color:#aaa;font-size:.8em;text-align:center}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > .cover[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;text-align:center}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > .cover[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:rgba(0,0,0,.25)}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > .cover[_ngcontent-%COMP%]:hover   .visualization-title[_ngcontent-%COMP%]{display:inherit}.visualizations[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%] > .cover[_ngcontent-%COMP%]   .visualization-title[_ngcontent-%COMP%]{font-size:1.25em;color:#fff;text-shadow:1px 1px 2px #000;display:none;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.visualizations[_ngcontent-%COMP%]   mat-card.new-vis-placeholder[_ngcontent-%COMP%]{height:200px;background-color:#eee}.visualizations[_ngcontent-%COMP%]   mat-card.new-vis-placeholder[_ngcontent-%COMP%]:before{content:"Drop New Visualization Here";position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.visualizations[_ngcontent-%COMP%]   mat-card.new-vis-placeholder.look-at-me[_ngcontent-%COMP%]{border:2px solid #ff0;box-shadow:0 0 10px #ff0;outline:none;-webkit-animation-name:wiggle;-ms-animation-name:wiggle;-ms-animation-duration:.5s;-webkit-animation-duration:.5s;-webkit-animation-iteration-count:1;-ms-animation-iteration-count:1;-webkit-animation-timing-function:ease-in-out;-ms-animation-timing-function:ease-in-out}mat-list.new-vis-list[_ngcontent-%COMP%]{position:fixed;top:0;left:0;padding:65px 0 100px 0;width:320px;background-color:rgba(0,0,0,.25);z-index:5000;height:100vh;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-line-pack:start;align-content:flex-start}@media (max-height:600px){mat-list.new-vis-list[_ngcontent-%COMP%]{width:270px}}@media (max-height:550px){mat-list.new-vis-list[_ngcontent-%COMP%]{width:220px}}mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:#fff}mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after, mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:before{content:" ";display:table}mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{clear:both}mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   button.toggle-admin-mode[_ngcontent-%COMP%]{float:right}mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.5);padding:5px;clear:right;line-height:1.5em}@media (max-height:600px){mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-size:.9em}}@media (max-height:550px){mat-list.new-vis-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-size:.8em}}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media (max-height:600px){mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{width:125px}}@media (max-height:550px){mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{width:100px}}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]:nth-of-type(odd){margin-left:5px}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.vis-template[_ngcontent-%COMP%]{border:1px dotted #000;margin-bottom:10px}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.vis-template[_ngcontent-%COMP%]     .mat-list-item-content{height:auto;padding:0}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.vis-template[_ngcontent-%COMP%]     .mat-list-item-content img{width:100%}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.save[_ngcontent-%COMP%], mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.trash[_ngcontent-%COMP%]{position:relative;margin-top:20px}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.trash[_ngcontent-%COMP%]:before{font-family:FontAwesome;content:"\\F1F8"}mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.save[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-list.new-vis-list[_ngcontent-%COMP%]   mat-list-item.trash[_ngcontent-%COMP%]:before{font-size:2em;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.select-refuge[_ngcontent-%COMP%]{width:400px}.admin-toggle[_ngcontent-%COMP%]:before{font-family:FontAwesome;content:"\\F073";margin-right:5px}@-webkit-keyframes wiggle{0%{-webkit-transform:rotate(5deg)}25%{-webkit-transform:rotate(-5deg)}50%{-webkit-transform:rotate(10deg)}75%{-webkit-transform:rotate(-2.5deg)}to{-webkit-transform:rotate(0deg)}}@keyframes wiggle{0%{-webkit-transform:rotate(5deg);transform:rotate(5deg)}25%{-webkit-transform:rotate(-5deg);transform:rotate(-5deg)}50%{-webkit-transform:rotate(10deg);transform:rotate(10deg)}75%{-webkit-transform:rotate(-2.5deg);transform:rotate(-2.5deg)}to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}'],be=n("0EVt"),xe=n("dYU3"),we=n("jk5D"),Pe=n("OFGE"),Oe=n("4jwp"),Ce=n("G9wC"),Se=n("vOiX"),ke=n("W2RV"),Me=n("C80A"),je=n("z4MQ"),De=n("Ioj9"),ze=n("iuYq"),Ae=n("wMO1"),Le=n("k7z1"),Ie=n("zQfh"),Fe=[{$class:"ActivityCurvesSelection",$thumbnail:"assets/activity-curves.png",$tooltip:"Activity Curves"},{$class:"ScatterPlotSelection",$thumbnail:"assets/scatter-plot.png",$tooltip:"Scatter Plot"},{$class:"CalendarSelection",$thumbnail:"assets/calendar.png",$tooltip:"Calendar"},{$class:"ObserverActivitySelection",$thumbnail:"assets/observer-activity.png",$tooltip:"Observer Activity Metrics"},{$class:"ClippedWmsMapSelection",$thumbnail:"assets/clipped-wms-map.png",$tooltip:"Map"},{$class:"ObservationFrequencySelection",$thumbnail:"assets/observation-frequency.png",$tooltip:"Observation Frequency"}],Re=function(){function t(t,e,n,i,r,o){var l=this;this.refugeService=t,this.selectionFactory=e,this.dialog=n,this.snackBar=i,this.media=r,this.baseHref=o,this.userIsAdmin=!1,this.isTouchDevice=!1,this.trash=[],this.adminMode=!1,this.maxVisualizations=10,this.visTemplates=Fe,this.lookAtVisDrop=!1,this.mobileMode=!1,this.media.subscribe(function(t){l.mobileMode="xs"===t.mqAlias||"sm"===t.mqAlias});var a=document.createElement("div");a.setAttribute("ontouchstart","return;"),this.isTouchDevice="function"==typeof a.ontouchstart,this.isTouchDevice&&console.warn("Touch device detected any administrative functionality will be disabled.")}return t.prototype.toggleAdminMode=function(){this.adminMode=!this.adminMode,this.resizeAllAfterDelay()},t.prototype.setRefuge=function(t){this.refuge=t,t.selections.forEach(function(t,e){t.update()}),this.guidOrder=t.selections.map(function(t){return t.guid})},t.prototype.ngOnInit=function(){this.setRefuge(this.refuge)},t.prototype.resizeAll=function(){this.refuge.selections.forEach(function(t,e){t.resize()})},t.prototype.resizeAllAfterDelay=function(){var t=this;setTimeout(function(){t.resizeAll()})},t.prototype.makeCurrent=function(t){var e=this.refuge.selections,n=e.indexOf(t);n&&(console.log("MAKE CURRENT",n),e[n]=e[0],e[0]=t,this.reorderVisualizations())},t.prototype.addVisualization=function(t){var e=this;console.log("add.$event",t);var n=this.selectionFactory.newSelection(t.dragData);console.log("add.selection",n),this.dialog.open(Bt,{height:"90vh",width:"90vw",disableClose:!0,data:{refuge:this.refuge,selection:n}}).afterClosed().subscribe(function(t){t&&(e.refuge.selections.push(t),e.save())})},t.prototype.isReordered=function(){var t=this;return!(!this.guidOrder||this.guidOrder.length!==this.refuge.selections.length)&&this.refuge.selections.reduce(function(e,n,i){return e||n.guid!==t.guidOrder[i]},!1)},t.prototype.reorderVisualizations=function(){var t=this;setTimeout(function(){t.resizeAll()})},t.prototype.save=function(t){var e=this;this.refugeService.saveRefuge(this.refuge).then(function(n){e.setRefuge(n),t||e.snackBar.open("Visualizations saved",null,{duration:2e3})}).catch(function(t){return e.handleError(t)})},t.prototype.dragStart=function(t){this.dragStartIndex=t?this.refuge.selections.indexOf(t):void 0,console.log("dragStart.$event",t,this.dragStartIndex)},t.prototype.trashVisualization=function(t){var e=this;console.log("trash.$event",t);var n=t.dragData,i=this.refuge.selections.indexOf(n);console.log("trashing selection "+i),this.refuge.selections.splice(i,1),this.refugeService.saveRefuge(this.refuge).then(function(t){e.setRefuge(t),e.snackBar.open("Visualization Deleted","Undo",{duration:5e3}).onAction().subscribe(function(){i=void 0!==e.dragStartIndex?e.dragStartIndex:i,console.log("restoring selection "+i),e.refuge.selections.splice(i,0,e.selectionFactory.cloneSelection(n)),e.save(!0)})}).catch(function(t){return e.handleError(t)})},t.prototype.handleError=function(t){console.error(t),this.snackBar.open("Something went wrong",null,{duration:5e3})},t.ctorParameters=function(){return[{type:vt},{type:ht},{type:Vt.b},{type:Vt.d},{type:Ie.j},{type:null,decorators:[{type:nt.F},{type:nt.s,args:[lt.e]}]}]},t}(),Ee=n("LT5m"),Te=[ve],Ve=nt._14({encapsulation:0,styles:Te,data:{}}),Ue=(nt._12("refuge-findings",Re,R,{refuge:"refuge",userIsAdmin:"userIsAdmin"},{},[]),n("Mxwl")),Be=function(){function t(t){this.speciesService=t}return t.prototype.ngOnChanges=function(t){var e=this;t.refuge&&t.refuge.currentValue&&this.speciesService.getAllSpecies({"network_id[0]":t.refuge.currentValue.network_id}).then(function(t){return e.speciesList=t}).catch(function(t){return console.error(t)})},t.ctorParameters=function(){return[{type:lt.m}]},t}(),qe=n("YcBH"),Ne=["h3[_ngcontent-%COMP%] {\n            font-size: 28px;\n        }"],Ye=nt._14({encapsulation:0,styles:Ne,data:{}}),$e=(nt._12("focal-species",Be,B,{refuge:"refuge"},{},[]),function(){function t(){this.userIsLoggedIn=!1}return t}()),Ze=["a[mat-raised-button][_ngcontent-%COMP%] {\n            margin-right: 5px;\n        }"],We=nt._14({encapsulation:0,styles:Ze,data:{}}),Ge=(nt._12("refuge-resources",$e,Z,{refuge:"refuge",userIsLoggedIn:"userIsLoggedIn"},{},[]),n("Pfd5")),Ke=n("ZFRd"),He=[ye],Je=nt._14({encapsulation:0,styles:He,data:{}}),Qe=nt._12("refuge-dashboard",bt,et,{},{},[]),Xe=n("fc+i"),tn=n("f9zQ"),en=n("fL27"),nn=n("EyWH"),rn=n("gdRU"),on=n("8aeK"),ln=n("vHGP"),an=n("BcUv"),sn=n("Pp7C"),un=n("ppgG"),cn=n("gOiy"),dn=n("1ini"),pn=n("Ewpo"),fn=n("9Wky"),hn=n("VGYb"),gn=n("f5IS"),_n=n("z4z3"),mn=n("d/pT"),yn=n("CzRk"),vn=n("AHCE"),bn=n("KYKA"),xn=n("MxFf"),wn=n("NWGx"),Pn=n("AB7d"),On=n("vgc3"),Cn=n("niyx"),Sn=n("wW3n"),kn=n("wvx+"),Mn=n("CZgk"),jn=n("RXNa"),Dn=n("kMVV"),zn=n("cC+T"),An=n("q+Vp"),Ln=n("s9VF"),In=n("4+t2"),Fn=n("CbiL"),Rn=n("xs7O"),En=nt._13(rt,[bt],function(t){return nt._28([nt._29(512,nt.k,nt._9,[[8,[xt.a,wt.a,wt.b,Pt.a,me,Qe]],[3,nt.k],nt.B]),nt._29(5120,nt.z,nt._27,[[3,nt.z]]),nt._29(4608,Tt.l,Tt.k,[nt.z]),nt._29(4608,nt.i,nt.i,[]),nt._29(5120,nt.a,nt._18,[]),nt._29(5120,nt.x,nt._24,[]),nt._29(5120,nt.y,nt._25,[]),nt._29(4608,Xe.c,Xe.t,[Tt.c]),nt._29(6144,nt.P,null,[Xe.c]),nt._29(4608,Xe.f,Ht.f,[]),nt._29(5120,Xe.d,function(t,e,n,i){return[new Xe.l(t),new Xe.p(e),new Xe.o(n,i)]},[Tt.c,Tt.c,Tt.c,Xe.f]),nt._29(4608,Xe.e,Xe.e,[Xe.d,nt.D]),nt._29(135680,Xe.n,Xe.n,[Tt.c]),nt._29(4608,Xe.m,Xe.m,[Xe.e,Xe.n]),nt._29(5120,tn.a,en.d,[]),nt._29(5120,tn.c,en.e,[]),nt._29(4608,tn.b,en.c,[tn.a,tn.c]),nt._29(5120,nt.N,en.f,[Xe.m,tn.b,nt.D]),nt._29(6144,Xe.q,null,[Xe.n]),nt._29(4608,nt.V,nt.V,[nt.D]),nt._29(4608,Xe.h,Xe.h,[Tt.c]),nt._29(4608,Xe.j,Xe.j,[Tt.c]),nt._29(4608,nn.b,en.b,[nt.N,Xe.b]),nt._29(4608,rn.a,rn.a,[on.a]),nt._29(4608,ot.c,ot.c,[]),nt._29(4608,ot.h,ot.b,[]),nt._29(5120,ot.k,ot.l,[]),nt._29(4608,ot.j,ot.j,[ot.c,ot.h,ot.k]),nt._29(4608,ot.g,ot.a,[]),nt._29(5120,ot.e,ot.m,[ot.j,ot.g]),nt._29(4608,Tt.d,Tt.d,[nt.z]),nt._29(4608,qe.a,qe.a,[ot.e,rn.a,Tt.d,on.a]),nt._29(4608,te.a,te.a,[ot.e,rn.a,on.a]),nt._29(4608,ln.a,ln.a,[ot.e,rn.a,on.a]),nt._29(4608,Ue.a,Ue.a,[]),nt._29(4608,an.a,an.a,[]),nt._29(4608,sn.a,sn.a,[Tt.d]),nt._29(4608,Ut.s,Ut.s,[]),nt._29(4608,Ut.d,Ut.d,[]),nt._29(4608,Zt.a,Zt.a,[]),nt._29(6144,ue.b,null,[Xe.b]),nt._29(4608,ue.c,ue.c,[[2,ue.b]]),nt._29(4608,Kt.j,Kt.j,[Zt.a]),nt._29(4608,Kt.i,Kt.i,[Kt.j,Zt.a,nt.D]),nt._29(136192,Kt.e,Kt.c,[[3,Kt.e],Zt.a]),nt._29(5120,Kt.n,Kt.m,[[3,Kt.n],[2,Kt.k],Zt.a]),nt._29(5120,Kt.h,Kt.f,[[3,Kt.h],nt.D,Zt.a]),nt._29(4608,un.a,un.a,[]),nt._29(5120,Oe.c,Oe.a,[[3,Oe.c],nt.D,Zt.a]),nt._29(5120,Oe.f,Oe.e,[[3,Oe.f],Zt.a,nt.D,Oe.c]),nt._29(4608,Pe.g,Pe.g,[Oe.c,Oe.f]),nt._29(5120,Pe.d,Pe.j,[[3,Pe.d]]),nt._29(4608,Pe.m,Pe.m,[Oe.f]),nt._29(4608,Pe.b,Pe.b,[Pe.g,Pe.d,nt.k,Pe.m,nt.e,nt.v,nt.D]),nt._29(5120,Pe.k,Pe.l,[Pe.b]),nt._29(5120,cn.a,cn.b,[Pe.b]),nt._29(4608,Ht.e,Ht.e,[]),nt._29(5120,Xt.c,Xt.d,[[3,Xt.c]]),nt._29(5120,dn.a,dn.b,[Pe.b]),nt._29(5120,we.a,we.b,[Pe.b]),nt._29(5120,Ie.a,Ie.c,[]),nt._29(4608,Ie.b,Ie.b,[Ie.a]),nt._29(4608,Ie.f,Ie.f,[nt.D,Tt.c]),nt._29(5120,Ie.g,Ie.e,[[3,Ie.g],Ie.b,Ie.f]),nt._29(5120,Ie.j,Ie.i,[[3,Ie.j],Ie.f,Ie.b]),nt._29(4608,Tt.e,Tt.e,[nt.z]),nt._29(4608,pn.a,pn.a,[]),nt._29(4608,fn.f,fn.f,[Tt.e]),nt._29(4608,fn.a,fn.a,[Tt.d]),nt._29(4608,fn.d,fn.d,[Tt.e]),nt._29(4608,fn.b,fn.b,[Tt.d]),nt._29(4608,fn.g,fn.g,[]),nt._29(4608,fn.e,fn.e,[Tt.d]),nt._29(4608,fn.c,fn.c,[Tt.d,pn.a]),nt._29(4608,hn.a,hn.a,[fn.f,fn.a,fn.d,fn.b,fn.g,fn.e,fn.c]),nt._29(4608,gn.c,gn.c,[on.a]),nt._29(4608,_n.a,_n.a,[ln.a,pn.a,gn.c]),nt._29(4608,mn.a,mn.a,[hn.a,ln.a,_n.a,gn.c]),nt._29(4608,yn.a,yn.a,[ot.e,rn.a,on.a]),nt._29(4608,vn.a,vn.a,[ot.e,rn.a,Ue.a,on.a]),nt._29(4608,bn.a,bn.a,[ln.a,Tt.d,mn.a,on.a]),nt._29(4608,xn.a,xn.a,[ot.e,rn.a,Tt.d,on.a]),nt._29(4608,wn.a,wn.a,[ln.a]),nt._29(4608,Pn.a,Pn.a,[ln.a,te.a]),nt._29(4608,ht,ht,[vn.a,yn.a,xn.a,wn.a,Pn.a,bn.a]),nt._29(4608,Ee.b,Ee.b,[Pe.b,Kt.n,nt.v,[3,Ee.b]]),nt._29(5120,ce.b,ce.c,[Pe.b]),nt._29(4608,ce.d,ce.d,[Pe.b,nt.v,[2,Tt.g],ce.b,[3,ce.d]]),nt._29(5120,On.d,On.a,[[3,On.d],[2,ot.e],Xe.c]),nt._29(4608,ne.e,ne.e,[]),nt._29(4608,Cn.c,Cn.c,[]),nt._29(4608,Cn.b,Cn.b,[]),nt._29(4608,Sn.a,kn.b,[kn.a,Cn.c,Cn.b]),nt._29(4608,ke.a,ke.a,[]),nt._29(5120,Se.a,Se.c,[]),nt._29(5120,Se.b,Se.d,[ke.a]),nt._29(4608,vt,vt,[ot.e,rn.a,ht]),nt._29(512,Tt.b,Tt.b,[]),nt._29(1024,nt.p,Xe.r,[]),nt._29(1024,nt.b,function(t,e){return[Xe.s(t,e)]},[[2,Xe.i],[2,nt.C]]),nt._29(512,nt.c,nt.c,[[2,nt.b]]),nt._29(131584,nt._16,nt._16,[nt.D,nt._10,nt.v,nt.p,nt.k,nt.c]),nt._29(2048,nt.e,null,[nt._16]),nt._29(512,nt.d,nt.d,[nt.e]),nt._29(512,Xe.a,Xe.a,[[3,Xe.a]]),nt._29(512,en.a,en.a,[]),nt._29(512,lt.h,lt.h,[]),nt._29(512,Ut.r,Ut.r,[]),nt._29(512,Ut.h,Ut.h,[]),nt._29(512,Ut.o,Ut.o,[]),nt._29(512,Zt.b,Zt.b,[]),nt._29(512,ae.d,ae.d,[]),nt._29(512,Ht.c,Ht.c,[]),nt._29(512,ue.a,ue.a,[]),nt._29(256,Ht.g,!0,[]),nt._29(512,Ht.m,Ht.m,[[2,Ht.g]]),nt._29(512,Ht.y,Ht.y,[]),nt._29(512,Kt.a,Kt.a,[]),nt._29(512,re.d,re.d,[]),nt._29(512,un.c,un.c,[]),nt._29(512,Gt.b,Gt.b,[]),nt._29(512,Mn.f,Mn.f,[]),nt._29(512,Oe.b,Oe.b,[]),nt._29(512,Pe.e,Pe.e,[]),nt._29(512,Ht.w,Ht.w,[]),nt._29(512,Ht.t,Ht.t,[]),nt._29(512,cn.d,cn.d,[]),nt._29(512,$t.b,$t.b,[]),nt._29(512,jn.c,jn.c,[]),nt._29(512,dn.d,dn.d,[]),nt._29(512,se.b,se.b,[]),nt._29(512,Dn.b,Dn.b,[]),nt._29(512,zn.b,zn.b,[]),nt._29(512,we.d,we.d,[]),nt._29(512,An.a,An.a,[]),nt._29(512,Ie.h,Ie.h,[]),nt._29(512,Ie.d,Ie.d,[]),nt._29(512,Ln.a,Ln.a,[]),nt._29(512,gt,gt,[]),nt._29(512,ot.f,ot.f,[]),nt._29(512,_t,_t,[]),nt._29(512,Ht.o,Ht.o,[]),nt._29(512,In.a,In.a,[]),nt._29(512,De.c,De.c,[]),nt._29(512,xe.d,xe.d,[]),nt._29(512,Ee.d,Ee.d,[]),nt._29(512,ce.f,ce.f,[]),nt._29(512,oe.d,oe.d,[]),nt._29(512,On.c,On.c,[]),nt._29(512,ne.f,ne.f,[]),nt._29(512,Jt.c,Jt.c,[]),nt._29(512,Ke.i,Ke.i,[]),nt._29(512,Le.d,Le.d,[]),nt._29(512,Fn.a,Fn.a,[]),nt._29(512,rt,rt,[]),nt._29(1024,on.a,r,[]),nt._29(1024,lt.e,i,[]),nt._29(256,Rn.a,void 0,[]),nt._29(256,kn.a,{apiKey:"AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE"},[])])});it.a.production&&Object(nt._3)(),Object(Xe.k)().bootstrapModuleFactory(En)},"d/pT":function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n("S4Bb"),r=(n.n(i),n("VGYb")),o=n("z4z3"),l=n("4Y6l"),a=n("ARiO"),s=n("f5IS"),u=function(){function t(t,e,n,i){this.wmsPipeFactory=t,this.serviceUtils=e,this.layerService=n,this.urls=i,this.legends={}}return t.prototype.getLegend=function(t){var e=this;return new Promise(function(n,r){if(e.legends[t])return n(e.legends[t]);e.layerService.getLayerDefinition(t).then(function(o){if(!o)return r("layer definition for "+t+" not found.");e.serviceUtils.cachedGet(e.urls.wmsBaseUrl,{service:"wms",request:"GetStyles",version:s.e,layers:t},!0).then(function(r){var l=i(i.parseXML(r)),s=l.find("ColorMap");0===s.length&&(s=l.find("sld\\:ColorMap"));var u=0!==s.length?new a.a(e.wmsPipeFactory,i(s.toArray()[0]),o,l):void 0;e.legends[t]=u,n(u)}).catch(r)})})},t.ctorParameters=function(){return[{type:r.a},{type:l.j},{type:o.a},{type:s.c}]},t}()},f5IS:function(t,e,n){"use strict";n.d(e,"d",function(){return o}),n.d(e,"e",function(){return l}),n.d(e,"b",function(){return a}),n.d(e,"a",function(){return s}),n.d(e,"c",function(){return u});var i=n("/oeL"),r=n("4Y6l"),o={geo_server:{url:"//geoserver-dev.usanpn.org/geoserver"},description:"",categories:[{name:"Temperature Accumulations, Daily 30-year Average",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_default_filter:{name:"agddDefaultTodayElevation"},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,layers:[{name:"gdd:30yr_avg_agdd"},{name:"gdd:30yr_avg_agdd_50f"}]},{name:"Temperature Accumulations, Current Day",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_default_filter:{name:"agddDefaultTodayTime"},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,supports_time_series:!0,layers:[{name:"gdd:agdd"},{name:"gdd:agdd_50f"}]},{name:"Temperature Accumulations, Current Day, Alaska",supports_data:!1,legend_label_filter:{name:"legendGddUnits",args:[!1]},gridded_label_filter:{name:"legendGddUnits",args:[!0]},extent_values_filter:{name:"extentDates",args:[null,"today"]},legend_units:"Growing Degree Days",legend_delimiter_every:2e3,layers:[{name:"gdd:agdd_alaska"},{name:"gdd:agdd_alaska_50f"}]},{name:"Temperature Accumulations, Daily Anomaly",supports_data:!1,legend_label_filter:{name:"legendAgddAnomaly",args:[!1]},gridded_label_filter:{name:"legendAgddAnomaly",args:[!0]},extent_default_filter:{name:"agddDefaultTodayTime"},legend_units:"Growing Degree Days",legend_delimiter_every:100,layers:[{name:"gdd:agdd_anomaly"},{name:"gdd:agdd_anomaly_50f"}]},{name:"Spring Indices, Historical Annual",legend_label_filter:{name:"legendDoy"},current_year_only:!0,layers:[{name:"si-x:average_leaf_prism"},{name:"si-x:average_bloom_prism"},{name:"si-x:arnoldred_leaf_prism"},{name:"si-x:arnoldred_bloom_prism"},{name:"si-x:lilac_leaf_prism"},{name:"si-x:lilac_bloom_prism"},{name:"si-x:zabelli_leaf_prism"},{name:"si-x:zabelli_bloom_prism"}]},{name:"Spring Indices, Current Year",legend_label_filter:{name:"legendDoy"},extent_default_filter:{name:"agddDefaultTodayTime"},current_year_only:!0,layers:[{name:"si-x:average_leaf_ncep"},{name:"si-x:average_bloom_ncep"},{name:"si-x:arnoldred_leaf_ncep"},{name:"si-x:arnoldred_bloom_ncep"},{name:"si-x:lilac_leaf_ncep"},{name:"si-x:lilac_bloom_ncep"},{name:"si-x:zabelli_leaf_ncep"},{name:"si-x:zabelli_bloom_ncep"}]},{name:"Spring Indices, Current Year, Alaska",legend_label_filter:{name:"legendDoy"},extent_values_filter:{name:"extentDates",args:[null,"today"]},current_year_only:!0,layers:[{name:"si-x:average_leaf_ncep_alaska"},{name:"si-x:average_bloom_ncep_alaska"},{name:"si-x:arnoldred_leaf_ncep_alaska"},{name:"si-x:arnoldred_bloom_ncep_alaska"},{name:"si-x:lilac_leaf_ncep_alaska"},{name:"si-x:lilac_bloom_ncep_alaska"},{name:"si-x:zabelli_leaf_ncep_alaska"},{name:"si-x:zabelli_bloom_ncep_alaska"}]},{name:"Spring Indices, Daily Anomaly",supports_data:!1,legend_label_filter:{name:"legendSixAnomaly"},extent_default_filter:{name:"agddDefaultTodayTime"},layers:[{name:"si-x:leaf_anomaly"},{name:"si-x:bloom_anomaly"}]},{name:"Spring Indices, 30-Year Average",legend_label_filter:{name:"legendDoy"},extent_default_filter:{name:"agddDefaultTodayElevation"},layers:[{name:"si-x:30yr_avg_six_leaf"},{name:"si-x:30yr_avg_six_bloom"}]}]},l="1.1.1",a=256,s={service:"WMS",request:"GetMap",version:l,layers:void 0,styles:"",format:"image/png",transparent:!0,height:a,width:a,srs:"EPSG:3857"},u=function(){function t(t){this.config=t,this.geoServerUrl=t.geoServerRoot,this.wmsBaseUrl=this.geoServerUrl+"/wms",this.wmsCapabilitiesUrl=this.wmsBaseUrl+"?service=wms&version="+l+"&request=GetCapabilities"}return t.ctorParameters=function(){return[{type:r.i,decorators:[{type:i.s,args:[r.f]}]}]},t}()},gDKM:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("8FRf"),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},l=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},a=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(t){function e(e){var n=t.call(this)||this;return n.serviceUtils=e,n.$class="ObserverActivitySelection",n.dataCnt=0,n}return r(e,t),e.prototype.isMultiStation=function(){return this.stationIds&&this.stationIds.length>1},e.prototype.isSingleStation=function(){return this.stationIds&&1===this.stationIds.length},e.prototype.isValid=function(){return!!this.year},e.prototype.getData=function(){var t=this,e=this.serviceUtils.apiUrl("/npn_portal/networks/getObserversByMonth.json"),n={year:this.year,network_id:this.networkIds[0]};return new Promise(function(i,r){t.working=!0,t.serviceUtils.cachedGet(e,n).then(function(e){var n=[1,2,3,4,5,6,7,8,9,10,11,12].map(function(t){return o({month:t},e.months[t])});e.months=n,t.working=!1,i(e)}).catch(r)})},e}(i.c);l([Object(i.i)(),a("design:type",String)],s.prototype,"$class",void 0),l([Object(i.i)(),a("design:type",Number)],s.prototype,"year",void 0)},gFIY:function(t,e){function n(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="gFIY"},gKwA:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){function t(){this.validYears=function(){for(var t=(new Date).getFullYear()+1,e=2e3,n=[];e<t;)n.push(e++);return n.reverse()}()}return t.prototype.ngOnInit=function(){},t}()},gdRU:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var i=n("/oeL"),r=n("8aeK"),o=n("XXyR"),l=(n.n(o),function(){function t(t){this.config=t,this.ttl=36e5,"number"==typeof t.cacheTTL&&(this.ttl=60*t.cacheTTL*1e3),console.log("CacheService Time To Live "+this.ttl/6e4+" minutes"),0===this.ttl&&(console.log("Caching disabled clearing local session storage"),sessionStorage.clear())}return t.prototype.cacheKey=function(t){return"string"!=typeof t&&(t=JSON.stringify(t)),o.Md5.hashStr(t).toString()},t.prototype.get=function(t){if(this.ttl<=0)return null;var e=this.cacheKey(t),n=sessionStorage.getItem(e);if(n){if(n=JSON.parse(n),Date.now()<n.expiry)return console.log("cache hit",e,t),n.data;console.log("cache expired",e),window.sessionStorage.removeItem(e)}else console.log("cache miss",e);return null},t.prototype.set=function(t,e){if(this.ttl<=0)return null;var n=this.cacheKey(t);if(e){var i={expiry:Date.now()+this.ttl,data:e};console.log("caching",n,e),sessionStorage.setItem(n,JSON.stringify(i))}else console.log("removing from cache",n),sessionStorage.removeItem(n)},t.ctorParameters=function(){return[{type:r.b,decorators:[{type:i.s,args:[r.a]}]}]},t}());!function(){function t(){}}()},iPkm:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var i=n("/oeL"),r=n("bm2B"),o=n("rlar"),l=(n.n(o),n("/zHi")),a=(n.n(l),n("azLz")),s=(n.n(a),n("9jMf")),u=(n.n(s),n("5v8a")),c=(n.n(u),n("gbhw")),d=(n.n(c),n("4Y6l")),p=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#222299","#c51b8a","#8c564b","#637939","#843c39","#5254a3","#636363","#bcbd22","#7b4173","#e7ba52","#222299","#f03b20","#1b9e77","#e377c2","#ef8a62","#91cf60","#9467bd"],f=function(){function t(t,e){var n=this;this.speciesService=t,this.speciesTitle=e,this.required=!0,this.disabled=!1,this.speciesChange=new i.q,this.onSpeciesChange=new i.q,this.phenophaseChange=new i.q,this.onPhenophaseChange=new i.q,this.gatherColor=!1,this.colorChange=new i.q,this.onColorChange=new i.q,this.colorList=p,this.requiredValidator=function(t){return!n.required||t.disabled||t.value?null:{required:!0}},this.speciesControl=new r.e(null,this.requiredValidator),this.colorControl=new r.e(null,this.requiredValidator),this.phenophaseList=[],this.speciesParams=new o.Subject,this.filteredSpecies=this.speciesControl.valueChanges.debounceTime(500).filter(function(t){return"string"==typeof t}).map(function(t){return t&&n.speciesList?n.filterSpecies(t):n.speciesList?n.speciesList.slice():[]}),this.isIE=!!Object(d.p)()}return t.prototype.ngOnInit=function(){var t=this;this.speciesParams.subscribe(function(e){t.speciesList=void 0,t.speciesService.getAllSpecies(e).then(function(e){t.speciesList=e.sort(function(t,e){return t.number_observations<e.number_observations?1:t.number_observations>e.number_observations?-1:0})})})},t.prototype.ngOnChanges=function(t){t.disabled&&(t.disabled.currentValue?(this.speciesControl.disable(),this.colorControl.disable()):(this.speciesControl.enable(),this.colorControl.enable()))},t.prototype.ngDoCheck=function(){if(this.selection){var t={},e=void 0;(this.selection.networkIds||[]).forEach(function(e,n){return t["network_id["+n+"]"]=""+e}),(this.selection.stationIds||[]).forEach(function(e,n){return t["station_ids["+n+"]"]=""+e}),e=JSON.stringify(t),e!==this.lastSpeciesParams&&(this.lastSpeciesParams=e,this.speciesParams.next(t))}},t.prototype.speciesFocus=function(){!this.isIE&&this.speciesList&&this.speciesControl.setValue(" ")},t.prototype.filterSpecies=function(t){var e=this;return t=t.trim().toLowerCase(),""!==t?(this.speciesList||[]).filter(function(n){return-1!==e.speciesTitle.transform(n).toLowerCase().indexOf(t)}):this.speciesList||[]},t.prototype.displayPhenophase=function(t){return t?t.phenophase_name:t},Object.defineProperty(t.prototype,"species",{get:function(){return this.speciesValue},set:function(t){var e=this;if((!t||"object"==typeof t)&&t!==this.speciesValue){var n=this.speciesValue;this.speciesChange.emit(this.speciesValue=t),this.onSpeciesChange.emit({oldValue:n,newValue:this.speciesValue}),this.phenophase=void 0,this.phenophaseList=[],t&&this.speciesService.getPhenophases(t,this.startYear,this.endYear).then(function(t){e.phenophaseList=t,e.phenophase=e.phenophaseList[0]})}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"phenophase",{get:function(){return this.phenophaseValue},set:function(t){if(t!==this.phenophaseValue){var e=this.phenophaseValue;this.phenophaseChange.emit(this.phenophaseValue=t),this.onPhenophaseChange.emit({oldValue:e,newValue:this.phenophaseValue})}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.colorValue},set:function(t){if(t!==this.colorValue){var e=this.colorValue;this.colorChange.emit(this.colorValue=t),this.onColorChange.emit({oldValue:e,newValue:this.colorValue})}},enumerable:!0,configurable:!0}),t.ctorParameters=function(){return[{type:d.m},{type:d.n}]},t}()},kZ5P:function(t,e,n){"use strict";var i=n("gDKM");n.d(e,"a",function(){return i.a});var r=n("NWGx");n.d(e,"b",function(){return r.a});n("DyKV"),n("gKwA")},"kuH+":function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n("/oeL"),r=n("4Y6l"),o=n("bKpL"),l=(n.n(o),n("Xtvq")),a=(n.n(l),n("azLz")),s=(n.n(a),n("ckYf")),u=function(){function t(t,e){this.window=t,this.rootElement=e}return t.prototype.ngAfterViewInit=function(){var t=this;console.debug("WmsMapLegendComponent.ngAfterViewInit"),this.resizeSubscription=o.Observable.fromEvent(window,"resize").debounceTime(500).subscribe(function(e){return t.redraw()}),this.svg=s.m(this.rootElement.nativeElement).select("svg"),console.debug("WmsMapLegendComponent:SVG",this.svg)},t.prototype.ngOnChanges=function(t){var e=this;console.debug("WmsMapLegendComponent.ngOnChanges",t),setTimeout(function(){return e.redraw()})},t.prototype.ngOnDestroy=function(){console.debug("WmsMapLegendComponent.ngOnDestroy"),this.resizeSubscription&&this.resizeSubscription.unsubscribe()},t.prototype.redraw=function(){function t(t,e,n){var i=c+u+b;t.append("line").attr("x1",a/2).attr("y1",i).attr("x2",a/2).attr("y2",i+v).attr("stroke","black").attr("stroke-width","1"),t.append("text").attr("dx",a/2).attr("dy","4em").style("text-anchor",n).text(e)}console.debug("WmsMapLegendComponent.redraw");var e=this.svg,n=this.legend;if(e&&e.selectAll("g").remove(),n&&e){var i=parseFloat(e.style("width").replace("px","")),r=parseFloat(e.style("height").replace("px","")),o=n.getData(),l=Math.floor(o.length/2),a=i/o.length,u=30,c=2;console.debug("WmsMapLegendComponent.svg dimensions",i,r),console.debug("WmsMapLegendComponent.legend cell width",a);var d=e.append("g"),p=d.selectAll("g.cell").data(o).enter().append("g").attr("class",function(t,e){return"cell"+(0===e?" first":e===l?" middle":e===o.length-1?" last":"")}).attr("transform",function(t,e){return"translate("+e*a+","+c+")"}).append("rect").attr("height",u).attr("width",a).style("stroke","black").style("stroke-width","1px").style("fill",function(t,e){return t.color});if(n.ldef.legend_delimiter_every){var f=n.ldef.legend_delimiter_every,h=0,g=o.map(function(t,e){return e+1===o.length||(h+=o[e+1].quantity-o[e].quantity)>=f&&(h=0,!0)}),_=[a+1,u,a+1,u].join(","),m=[2*a+u,u].join(","),y=[a+1,u,a+u+1,0].join(",");console.debug("WmsMapLegendComponent.legend_delimiter_every",f),p.style("stroke-dasharray",function(t,e){return 0===e?g[e]?void 0:y:g[e]?m:_}).attr("width",function(t,e){var n=parseFloat(s.m(this).attr("width"));return g[e]?n:n+1}),d.selectAll("g.cell").append("line").attr("stroke",function(t,e){return g[e]?"black":"none"}).attr("stroke-width",2).attr("x1",a-1).attr("x2",a-1).attr("y1",0).attr("y2",u)}p.append("title").text(function(t){return t.label});var v=5,b=3;t(e.select("g.cell.first"),o[0].label,"start"),t(e.select("g.cell.middle"),o[l].label,"middle"),t(e.select("g.cell.last"),o[o.length-1].label,"end"),n.ldef.legend_units&&e.append("g").append("text").attr("dx",i/2).attr("dy",75+c).attr("text-anchor","middle").text(n.ldef.legend_units);var x=n.ldef.title;n.ldef.extent&&n.ldef.extent.current&&(x+=", "+n.ldef.extent.current.label),e.append("g").append("text").attr("dx",5).attr("dy",100+c).attr("font-size","18px").attr("text-anchor","right").text(x),e.append("g").append("text").attr("dx",5).attr("dy",118+c).attr("font-size","11px").attr("text-anchor","right").text("USA National Phenology Network, www.usanpn.org")}},t.ctorParameters=function(){return[{type:r.o},{type:i.o}]},t}()},mc75:function(t,e,n){"use strict";var i=n("Pkw6");n.d(e,"a",function(){return i.a});var r=n("KYKA");n.d(e,"b",function(){return r.a});n("YPxi"),n("EFcQ"),n("T3r2")},qufV:function(t,e,n){"use strict";n.d(e,"a",function(){return h}),n.d(e,"b",function(){return g});var i=n("CPp0"),r=n("82j9"),o=(n.n(r),n("Vxib")),l=n("8FRf"),a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},u=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(){}return t}(),d={value:"months",label:"Monthly"},p={value:14,label:"Bi-weekly"},f={value:7,label:"Weekly"},h=[d,p,f],g=function(t){function e(e,n,r,l){var a=t.call(this)||this;return a.http=e,a.cacheService=n,a.datePipe=r,a.config=l,a.$class="ActivityCurvesSelection",a.headers=new i.d({"Content-Type":"application/x-www-form-urlencoded"}),a._interpolate=o.b.monotone,a._dataPoints=!0,a._frequency=h[0],a.curves=[{color:"#0000ff",orient:"left"},{color:"orange",orient:"right"}].map(function(t,e){var n=new o.a;return n.id=e,n.color=t.color,n.orient=t.orient,n}),a}return a(e,t),e.prototype.isValid=function(){return this.curves[0].isValid()},e.prototype.updateCheck=function(t){var e=this.curves[0].isValid()||this.curves[1].isValid(),n=this.curves[0].plotted()||this.curves[1].plotted();t?e&&this.update():e&&n?this.redraw():e&&this.update()},Object.defineProperty(e.prototype,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency=t,(this._curves||[]).forEach(function(t){return t.data(null)}),this.updateCheck(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interpolate",{get:function(){return this._interpolate},set:function(t){this._interpolate=t,(this._curves||[]).forEach(function(e){return e.interpolate=t}),this.updateCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataPoints",{set:function(t){this._dataPoints=t,(this._curves||[]).forEach(function(e){return e.dataPoints=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curves",{get:function(){return this._curves},set:function(t){var e=this;this._curves=t,t.forEach(function(t){t.selection=e,t.interpolate=e._interpolate,t.dataPoints=e._dataPoints})},enumerable:!0,configurable:!0}),e.prototype.endDate=function(t){var e=new Date;return t===e.getFullYear()?this.datePipe.transform(e,"yyyy-MM-dd"):t+"-12-31"},e.prototype.loadCurveData=function(){var t=this;return new Promise(function(e){t.working=!0;var n=t.curves.filter(function(t){return t.data(null).isValid()}).map(function(e){return new Promise(function(n){var r=new i.i;r.set("request_src","npn-vis-activity-curves"),r.set("start_date",e.year+"-01-01"),r.set("end_date",t.endDate(e.year)),r.set("frequency",""+t.frequency.value),r.set("species_id[0]",""+e.species.species_id),r.set("phenophase_id[0]",""+e.phenophase.phenophase_id),t.addNetworkParams(r);var o=t.config.apiRoot+"/npn_portal/observations/getMagnitudeData.json",l={u:o,params:r.toString()},a=t.cacheService.get(l);a?n(e.data(a)):t.http.post(o,r.toString(),{headers:t.headers}).toPromise().then(function(i){var r=i.json();t.cacheService.set(l,r),n(e.data(r))}).catch(t.handleError)})});Promise.all(n).then(function(){t.working=!1,e()})})},e.prototype.handleError=function(t){console.error("ERROR",t)},e}(l.g);s([Object(l.i)(),u("design:type",String)],g.prototype,"$class",void 0),s([Object(l.i)(),u("design:type","function"==typeof(_=void 0!==o.b&&o.b)&&_||Object)],g.prototype,"_interpolate",void 0),s([Object(l.i)(),u("design:type",Boolean)],g.prototype,"_dataPoints",void 0),s([Object(l.i)(),u("design:type",c)],g.prototype,"_frequency",void 0),s([Object(l.i)({ser:function(t){return t.external},des:function(t){var e=new o.a;return e.external=t,e}}),u("design:type",Array)],g.prototype,"_curves",void 0);var _},s9VF:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=(n("z4z3"),n("ARiO"),n("d/pT"));n.d(e,"b",function(){return i.a});var r=(n("LAnB"),function(){function t(){}return t}())},tf1B:function(t,e,n){"use strict";var i=n("OpsG"),r=n("8FRf"),o=n("CPp0"),l=(n("82j9"),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}()),a=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},s=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(t){function e(e,n,i){var r=t.call(this)||this;return r.http=e,r.cacheService=n,r.config=i,r.headers=new o.d({"Content-Type":"application/x-www-form-urlencoded"}),r.individualPhenometrics=!1,r}return l(e,t),e.prototype.filterSuspectSummaryData=function(t){var e=0===t.latitude||0===t.longitude||t.elevation_in_meters<0;return e&&console.warn("suspect station data",t),!e},e.prototype.filterLqSummaryData=function(t){var e=t.numdays_since_prior_no>=0;return e||console.debug("filtering less precise data from summary output",t),e},e.prototype.filterLqSiteData=function(t){var e=t.mean_numdays_since_prior_no>=0;return e||console.debug("filtering less precise data from site level output",t),e},e.prototype.getData=function(){var t=this;if(!this.isValid())return Promise.reject(this.INVALID_SELECTION);var e=this.toURLSearchParams(),n=this.config.apiRoot+"/npn_portal/observations/"+(this.individualPhenometrics?"getSummarizedData":"getSiteLevelData")+".json",r={u:n,params:e.toString()},o=this.cacheService.get(r),l=this.individualPhenometrics?function(e){var n=e.filter(t.filterSuspectSummaryData),r=i.a.appConfig.filterLqdSummary?n.filter(t.filterLqSummaryData):n,o=r.reduce(function(t,e){var n=e.individual_id+"/"+e.phenophase_id+"/"+e.first_yes_year;return t[n]=t[n]||[],t[n].push(e),t},{}),l=[];console.debug("filtered out "+(e.length-n.length)+"/"+e.length+" suspect records"),console.debug("filtered out "+(n.length-r.length)+"/"+n.length+" LQD records.");for(var a in o){var s=o[a];s.length>1&&s.sort(function(t,e){return t.first_yes_doy-e.first_yes_doy}),l.push(s[0])}return console.debug("filtered out "+(r.length-l.length)+"/"+r.length+" individual records (preferring lowest first_yes_doy)"),t.filterDisclaimer=n.length!==r.length?i.a.appConfig.filterLqdDisclaimer:void 0,r}:function(e){var n=e.filter(t.filterSuspectSummaryData),r=i.a.appConfig.filterLqdSummary?n.filter(t.filterLqSiteData):n;return console.debug("filtered out "+(e.length-n.length)+"/"+e.length+" suspect records"),console.debug("filtered out "+(n.length-r.length)+"/"+n.length+" LQD records."),t.filterDisclaimer=n.length!==r.length?i.a.appConfig.filterLqdDisclaimer:void 0,r};return o?(console.log("found in cache",o),Promise.resolve(l(o))):(this.working=!0,this.http.post(n,e.toString(),{headers:this.headers}).toPromise().then(function(e){var n=e.json();t.cacheService.set(r,n);var i=l(n);return t.working=!1,i}).catch(this.handleError))},e}(r.g);a([Object(r.i)(),s("design:type",Boolean)],u.prototype,"individualPhenometrics",void 0),a([Object(r.i)(),s("design:type",String)],u.prototype,"filterDisclaimer",void 0);var c=n("ckYf");n.d(e,"a",function(){return g}),n.d(e,"b",function(){return _});var d=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},f=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h={daylength:"mean_daylength",acc_prcp:"mean_accum_prcp",gdd:"mean_gdd"},g=[{key:"latitude",label:"Latitude",axisFmt:c.i(".2f")},{key:"longitude",label:"Longitude",axisFmt:c.i(".2f")},{key:"elevation_in_meters",label:"Elevation (m)"},{key:"fyy",label:"Year"},{key:"prcp_fall",label:"Precip Fall (mm)"},{key:"prcp_spring",label:"Precip Spring (mm)"},{key:"prcp_summer",label:"Precip Summer (mm)"},{key:"prcp_winter",label:"Precip Winter (mm)"},{key:"tmax_fall",label:"Tmax Fall (C\xb0)"},{key:"tmax_spring",label:"Tmax Spring (C\xb0)"},{key:"tmax_summer",label:"Tmax Summer (C\xb0)"},{key:"tmax_winter",label:"Tmax Winter (C\xb0)"},{key:"tmin_fall",label:"Tmin Fall (C\xb0)"},{key:"tmin_spring",label:"Tmin Spring (C\xb0)"},{key:"tmin_summer",label:"Tmin Summer (C\xb0)"},{key:"tmin_winter",label:"Tmin Winter (C\xb0)"},{key:"daylength",label:"Day Length (s)"},{key:"acc_prcp",label:"Accumulated Precip (mm)"},{key:"gdd",label:"AGDD"}],_=(new Date,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="ScatterPlotSelection",e.start=2010,e.end=(new Date).getFullYear(),e.regressionLines=!1,e.axis=g[0],e.plots=[],e.d3DateFormat=c.n("%x"),e}return d(e,t),e.prototype.isValid=function(){return this.start&&this.end&&this.start<this.end&&this.validPlots.length>0},Object.defineProperty(e.prototype,"validPlots",{get:function(){return this.plots.filter(function(t){return t.color&&t.species&&t.phenophase})},enumerable:!0,configurable:!0}),e.prototype.toURLSearchParams=function(){var t=new o.i;return t.set("climate_data","1"),t.set("request_src","npn-vis-scatter-plot"),t.set("start_date",this.start+"-01-01"),t.set("end_date",this.end+"-12-31"),t.set("num_days_quality_filter",""+i.a.appConfig.num_days_quality_filter),this.validPlots.forEach(function(e,n){t.set("species_id["+n+"]",""+e.species.species_id),t.set("phenophase_id["+n+"]",""+e.phenophase.phenophase_id)}),this.addNetworkParams(t),t},e.prototype.doyDateFormat=function(t){var e=new Date(this.start,0,1),n=(t-1)*r.d+e.getTime(),i=new Date(n);return this.d3DateFormat(i)},e.prototype.getDoy=function(t){return this.individualPhenometrics?t.first_yes_doy:t.mean_first_yes_doy},e.prototype.getFirstYesYear=function(t){return this.individualPhenometrics?t.first_yes_year:t.mean_first_yes_year},e.prototype.axisData=function(t){return t[this.axis.key]},e.prototype.axisNonNull=function(t){var e=this;return t.filter(function(t){return e.axisData(t)!==r.b})},e.prototype.postProcessData=function(t){var e=this,n=function(t){return t.species_id+":"+t.phenophase_id},i=this.validPlots.reduce(function(t,e){return t[e.species.species_id+":"+e.phenophase.phenophase_id]=e.color,t},{}),r=this.start,o=t.filter(function(t,o){if(!(t.color=i[n(t)]))return!1;t.id=o,t.fyy=e.getFirstYesYear(t);for(var l in h){var a=h[l];void 0===t[l]&&(t[l]=t[a])}return t.day_in_range=365*(t.fyy-r)+e.getDoy(t),!0});return this.working=!1,o},e}(u));p([Object(r.i)(),f("design:type",String)],_.prototype,"$class",void 0),p([Object(r.i)(),f("design:type",Number)],_.prototype,"start",void 0),p([Object(r.i)(),f("design:type",Number)],_.prototype,"end",void 0),p([Object(r.i)(),f("design:type",Boolean)],_.prototype,"regressionLines",void 0),p([Object(r.i)(),f("design:type",Object)],_.prototype,"axis",void 0),p([Object(r.i)({ser:function(t){return{color:t.color,species:t.species,phenophase:t.phenophase}}}),f("design:type",Array)],_.prototype,"plots",void 0)},ud2z:function(t,e,n){"use strict";var i=n("CPp0"),r=(n("82j9"),n("8FRf")),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),l=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},a=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=(function(){function t(){}}(),function(){function t(){}return t}()),u=function(){function t(){this.labels=[],this.data=[]}return t}(),c=function(t){function e(e,n,r,o){var l=t.call(this)||this;return l.http=e,l.cacheService=n,l.speciesTitle=r,l.config=o,l.headers=new i.d({"Content-Type":"application/x-www-form-urlencoded"}),l.requestSrc="observation-date-vis-selection",l.negative=!1,l.negativeColor="#aaa",l.years=[],l.plots=[],l}return o(e,t),e.prototype.isValid=function(){return this.years&&this.years.length&&this.validPlots.length>0},Object.defineProperty(e.prototype,"validPlots",{get:function(){return(this.plots||[]).filter(function(t){return t.color&&t.species&&t.phenophase})},enumerable:!0,configurable:!0}),e.prototype.toURLSearchParams=function(){var t=new i.i;return t.set("request_src",this.requestSrc),this.years.forEach(function(e,n){t.set("year["+n+"]",""+e)}),this.validPlots.forEach(function(e,n){t.set("species_id["+n+"]",""+e.species.species_id),t.set("phenophase_id["+n+"]",""+e.phenophase.phenophase_id)}),this.addNetworkParams(t),t},e.prototype.postProcessData=function(t){var e=this;if(!t)return null;var n=new u,i=this.validPlots,r=i.length*this.years.length-1,o=function(t,e){t.forEach(function(t){n.data.push({y:r,x:t,color:e})})},l=t.reduce(function(t,e){return t[e.species_id]=e,Array.isArray(e.phenophases)&&(e.phenophases=e.phenophases.reduce(function(t,e){return t[e.phenophase_id]=e,t},{})),t},{});return console.log("speciesMap",l),i.forEach(function(t){var i=l[t.species.species_id],a=i.phenophases[t.phenophase.phenophase_id];e.years.forEach(function(l){a&&a.years&&a.years[l]&&(e.negative&&(console.debug("year negative",r,l,i.common_name,a,a.years[l].negative),o(a.years[l].negative,e.negativeColor)),console.debug("year positive",r,l,i.common_name,a,a.years[l].positive),o(a.years[l].positive,t.color)),n.labels.splice(0,0,e.speciesTitle.transform(t.species)+"/"+t.phenophase.phenophase_name+" ("+l+")"),console.debug("y of "+r+" is for "+n.labels[0]),r--})}),console.log("observation data",n),n},e.prototype.getData=function(){var t=this;if(!this.isValid())return Promise.reject(this.INVALID_SELECTION);var e=this.toURLSearchParams(),n=this.config.apiRoot+"/npn_portal/observations/getObservationDates.json",i={u:n,params:e.toString()},r=this.cacheService.get(i);return r?Promise.resolve(r):(this.working=!0,new Promise(function(r){t.http.post(n,e.toString(),{headers:t.headers}).toPromise().then(function(e){var n=e.json();t.cacheService.set(i,n),t.working=!1,r(n)}).catch(t.handleError)}))},e}(r.g);l([Object(r.i)(),a("design:type",Boolean)],c.prototype,"negative",void 0),l([Object(r.i)(),a("design:type",String)],c.prototype,"negativeColor",void 0),l([Object(r.i)(),a("design:type",Array)],c.prototype,"years",void 0),l([Object(r.i)(),a("design:type",Array)],c.prototype,"plots",void 0),n.d(e,"a",function(){return h}),n.d(e,!1,function(){return s}),n.d(e,!1,function(){return u});var d=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,l=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(l=(o<3?r(l):o>3?r(e,n,l):r(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l},f=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$class="CalendarSelection",e.labelOffset=4,e.bandPadding=.5,e.fontSizeDelta=0,e}return d(e,t),e}(c);p([Object(r.i)(),f("design:type",String)],h.prototype,"$class",void 0),p([Object(r.i)(),f("design:type",Number)],h.prototype,"labelOffset",void 0),p([Object(r.i)(),f("design:type",Number)],h.prototype,"bandPadding",void 0),p([Object(r.i)(),f("design:type",Number)],h.prototype,"fontSizeDelta",void 0),p([Object(r.i)(),f("design:type",String)],h.prototype,"monthFormat",void 0)},vHGP:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("/oeL"),r=n("CPp0"),o=n("82j9"),l=(n.n(o),n("gdRU")),a=n("8aeK"),s=function(){function t(t,e,n){this.http=t,this.cache=e,this.config=n}return t.prototype.apiUrl=function(t){return""+this.config.apiRoot+t},t.prototype.dataApiUrl=function(t){return""+this.config.dataApiRoot+t},t.prototype.cachedGet=function(t,e,n){var i=this;return e=e||{},new Promise(function(r,o){var l={u:t,params:e},a=i.cache.get(l);a?r(a):i.http.get(t,{params:e}).toPromise().then(function(t){a=n?t.text():t.json(),i.cache.set(l,a),r(a)}).catch(o)})},t.ctorParameters=function(){return[{type:r.e},{type:l.a},{type:a.b,decorators:[{type:i.s,args:[a.a]}]}]},t}()},xs7O:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){function t(){}return t}()},"yS/9":function(t,e,n){"use strict";n.d(e,"a",function(){return c});var i=n("/oeL"),r=n("4Y6l"),o=n("8FRf"),l=n("bKpL"),a=(n.n(l),n("Xtvq")),s=(n.n(a),n("azLz")),u=(n.n(s),n("zQfh")),c=function(){function t(t,e,n){var i=this;this.window=t,this.rootElement=e,this.media=n,this.thumbnail=!1,this.id="visualization-"+Math.floor(1e3*Math.random()),this.clazz="visualization "+this.constructor.name,this.margins={top:0,right:0,left:0,bottom:0},this.mobileMode=!1,this.mediaSubscription=this.media.subscribe(function(t){i.mobileMode="xs"===t.mqAlias||"sm"===t.mqAlias}),this.isIE=!!Object(r.p)()}return t.prototype.getSizeInfo=function(t){var e=this.rootElement.nativeElement,n=e.parentElement,i=function(t){return parseInt(t.replace(/px$/,""))},r=getComputedStyle(n,null),o=i(r.paddingLeft)+i(r.borderLeftWidth),l=i(r.paddingRight)+i(r.borderRightWidth),a=n.clientWidth-o-l,s=this.margins,u=Math.floor(a),c=u;t&&u<t&&(u=t);var d=Math.floor(.5376*u),p=u-s.left-s.right,f=d-s.top-s.bottom;return isNaN(p)&&(p=0),isNaN(f)&&(f=0),this.sizing={scaledWidth:c,width:p,height:f,margin:s}},t.prototype.reset=function(){throw new Error("abstract")},t.prototype.redraw=function(){throw new Error("abstract")},t.prototype.update=function(){throw new Error("abstract")},t.prototype.resize=function(){throw new Error("abstract")},t.prototype.ngAfterViewInit=function(){var t=this;console.debug("visualization.ngAfterViewInit"),this.resizeSubscription=l.Observable.fromEvent(window,"resize").debounceTime(500).subscribe(function(e){t.resize()}),this.subscription=this.selection.subscribe(function(e){switch(e){case o.h.RESET:return t.reset();case o.h.REDRAW:return t.redraw();case o.h.UPDATE:return t.update();case o.h.RESIZE:return t.resize()}})},t.prototype.ngOnDestroy=function(){console.debug("visualization.ngOnDestroy"),this.subscription&&this.subscription.unsubscribe(),this.resizeSubscription&&this.resizeSubscription.unsubscribe(),this.mediaSubscription&&this.mediaSubscription.unsubscribe()},t.prototype.handleError=function(t){t&&t!==o.e&&console.error(t)},t.ctorParameters=function(){return[{type:r.o},{type:i.o},{type:u.j}]},t}();(function(){function t(){}})(),function(){function t(){}}()},z4z3:function(t,e,n){"use strict";function i(t){}function r(t){if(!t)return"";var e=[];return Object.keys(t).forEach(function(n){if(t[n]){var i=encodeURIComponent(n),r=encodeURIComponent(t[n]);e.push(i+"="+r)}}),e.join("&")}function o(t){if(!(Math.abs(t.lng())>180||Math.abs(t.lat())>90)){var e=.017453292519943295*t.lng(),n=6378137*e,i=.017453292519943295*t.lat();return{lng:n,lat:3189068.5*Math.log((1+Math.sin(i))/(1-Math.sin(i)))}}}var l=n("S4Bb"),a=n("Ewpo"),s=n("4Y6l"),u=n("f5IS"),c=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},d=function(){function t(t,e,n){var l=this;if(this.map=t,this.layer_def=e,this.wmsBaseUrl=n,e.extent_values_filter){console.debug("layer "+e.name+" has an extent_values_filter, processing",e.extent_values_filter);var a,s=i(e.extent_values_filter.name),d=e.extent.values.map(function(t){return t.value}),p=[d].concat(e.extent_values_filter.args||[]);a=s.apply(void 0,p),console.debug("filteredValues",a.length>1?a[0]+"..."+a[a.length-1]:a),e.extent.values=e.extent.values.filter(function(t){return-1!==a.indexOf(t.value)}),e.extent.current&&-1===a.indexOf(e.extent.current.value)&&(console.debug("current extent value has become invalid, replacing with last option"),e.extent.current=e.extent.values.length?e.extent.values[e.extent.values.length-1]:void 0)}if(e.extent_default_filter){console.debug("layer "+e.name+" has an extent_default_filter, processing",e.extent_default_filter);var f=i(e.extent_default_filter.name),h=[e.extent.values].concat(e.extent_default_filter.values||[]);e.extent.current=f.apply(void 0,h)||e.extent.current,console.debug("resulting default value",e.extent.current)}this.wmsArgs=c({},u.a,{layers:e.name}),this.googleLayer=new google.maps.ImageMapType({getTileUrl:function(e,n){var i=t.getProjection(),a=Math.pow(2,n),s=i.fromPointToLatLng(new google.maps.Point(e.x*u.b/a,e.y*u.b/a)),d=i.fromPointToLatLng(new google.maps.Point((e.x+1)*u.b/a,(e.y+1)*u.b/a)),p=o(s),f=o(d),h={};l.extent&&l.extent.current&&l.extent.current.addToWmsParams(h);var g={bbox:[p.lng,f.lat,f.lng,p.lat].join(",")};l.sldBody&&(g.sld_body=l.sldBody);var _=c({},h,l.wmsArgs,g);return l.wmsBaseUrl+"?"+r(_)},tileSize:new google.maps.Size(u.b,u.b),name:e.title||e.name}),Object.keys(e).forEach(function(t){l[t]=e[t]})}return t}();n.d(e,"a",function(){return h});var p=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},f=function(t){return JSON.parse(JSON.stringify(t))},h=function(){function t(t,e,n){this.serviceUtils=t,this.dateExtentUtil=e,this.urls=n}return t.prototype.getLayers=function(t){var e=this;return new Promise(function(n,i){e.getLayerDefinitions().then(function(i){var r=f(i);r.categories.forEach(function(n){n.layers=n.layers.map(function(n){return new d(t,n,e.urls.wmsBaseUrl)})}),n(r)}).catch(i)})},t.prototype.getLayerDefinitions=function(){function t(t){var e=f(u.d),n=e.description;return e.categories.forEach(function(e){var i=f(e);delete i.name,delete i.layers,i.description=i.description||n,e.layers=e.layers.map(function(e){var n=f(i);return p({},n,t[e.name],e)})}),e}var e=this;return new Promise(function(n,i){e.layerDefs?n(e.layerDefs):e.serviceUtils.cachedGet(e.urls.wmsCapabilitiesUrl,null,!0).then(function(i){var r=l(l.parseXML(i));console.debug("WmsMapLayerService:capabilities",r);var o=e._getLayers(r.find("Layer"));console.debug("WmsMapLayerService:wms layer definitions",o),e.layerDefs=t(o),console.debug("WmsMapLayerService:layer definitions",e.layerDefs),n(e.layerDefs)}).catch(i)})},t.prototype.getLayerDefinition=function(t){var e=this;return new Promise(function(n,i){e.getLayerDefinitions().then(function(e){var i=e.categories.reduce(function(t,e){return e.layers.forEach(function(e){t[e.name]=e}),t},{});n(i[t])}).catch(i)})},t.prototype._getLayers=function(t){var e=this;if(t&&!(t.length<2)){var n=[];return t.slice(1).each(function(t,e){n.push(e)}),n.map(function(t){return e._layerToObject(t)}).reduce(function(t,e){return t[e.name]=e,t},{})}},t.prototype._layerToObject=function(t){var e=l(t),n={name:e.find("Name").first().text(),title:e.find("Title").first().text().replace(/\((.+?)\)/g,""),abstract:e.find("Abstract").first().text(),bbox:this._parseBoundingBox(e.find("EX_GeographicBoundingBox").first()),style:this._parseStyle(e.find("Style").first())};return n.bbox||(n.bbox=this._parseLatLonBoundingBox(e.find("LatLonBoundingBox").first())),n},t.prototype._parseStyle=function(t){var e=l(t);return{name:e.find("Name").first().text(),title:e.find("Title").first().text().replace(/\((.+?)\)/g,""),legend:e.find("OnlineResource").attr("xlink:href")}},t.prototype._parseLatLonBoundingBox=function(t){if(t.length){var e={westBoundLongitude:parseFloat(t.attr("minx")),eastBoundLongitude:parseFloat(t.attr("maxx")),southBoundLatitude:parseFloat(t.attr("miny")),northBoundLatitude:parseFloat(t.attr("maxy")),getBounds:function(){return new google.maps.LatLngBounds(new google.maps.LatLng(e.southBoundLatitude,e.westBoundLongitude),new google.maps.LatLng(e.northBoundLatitude,e.eastBoundLongitude))}};return e}},t.prototype._parseBoundingBox=function(t){if(t.length){var e={westBoundLongitude:parseFloat(t.find("westBoundLongitude").text()),eastBoundLongitude:parseFloat(t.find("eastBoundLongitude").text()),southBoundLatitude:parseFloat(t.find("southBoundLatitude").text()),northBoundLatitude:parseFloat(t.find("northBoundLatitude").text()),getBounds:function(){return new google.maps.LatLngBounds(new google.maps.LatLng(e.southBoundLatitude,e.westBoundLongitude),new google.maps.LatLng(e.northBoundLatitude,e.eastBoundLongitude))}};return[e.westBoundLongitude,e.eastBoundLongitude,e.southBoundLatitude,e.northBoundLatitude].reduce(function(t,e){return t||0===e||-1===e},!1)?void 0:e}},t.ctorParameters=function(){return[{type:s.j},{type:a.a},{type:u.c}]},t}()}},[0]);
