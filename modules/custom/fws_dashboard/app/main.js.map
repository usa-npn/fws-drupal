{"version":3,"sources":["webpack:///../npn/common/src/lib/common/application-settings.ts","webpack:///../npn/common/src/lib/common/cache.service.ts","webpack:///../npn/common/src/lib/common/config.ts","webpack:///../npn/common/src/lib/common/detect-ie.ts","webpack:///../npn/common/src/lib/common/doy.pipe.ts","webpack:///../npn/common/src/lib/common/guid.ts","webpack:///../npn/common/src/lib/common/index.ts","webpack:///../npn/common/src/lib/common/legend-doy.pipe.ts","webpack:///../npn/common/src/lib/common/monitors-destroy.ts","webpack:///../npn/common/src/lib/common/network.service.ts","webpack:///../npn/common/src/lib/common/npn-common.module.ts","webpack:///../npn/common/src/lib/common/npn-logo.component.ts","webpack:///../npn/common/src/lib/common/npn-service-utils.service.ts","webpack:///../npn/common/src/lib/common/phenophase.ts","webpack:///../npn/common/src/lib/common/public_api.ts","webpack:///../npn/common/src/lib/common/species-title.pipe.ts","webpack:///../npn/common/src/lib/common/species.service.ts","webpack:///../npn/common/src/lib/common/species.ts","webpack:///../npn/common/src/lib/common/static-color.ts","webpack:///../npn/common/src/lib/common/station.service.ts","webpack:///../npn/common/src/lib/gridded/boundary.service.ts","webpack:///../npn/common/src/lib/gridded/default-map-layer-legend.ts","webpack:///../npn/common/src/lib/gridded/google-feature-bounds.ts","webpack:///../npn/common/src/lib/gridded/gridded-common.ts","webpack:///../npn/common/src/lib/gridded/index.ts","webpack:///../npn/common/src/lib/gridded/map-layer-legend.component.scss","webpack:///../npn/common/src/lib/gridded/map-layer-legend.component.ts","webpack:///../npn/common/src/lib/gridded/map-layer-legend.ts","webpack:///../npn/common/src/lib/gridded/map-layer.ts","webpack:///../npn/common/src/lib/gridded/npn-gridded.module.ts","webpack:///../npn/common/src/lib/gridded/npn-map-layer.service.ts","webpack:///../npn/common/src/lib/gridded/pest-map-layer-legend.ts","webpack:///../npn/common/src/lib/gridded/pest-map-layer.ts","webpack:///../npn/common/src/lib/gridded/pipes.ts","webpack:///../npn/common/src/lib/gridded/public_api.ts","webpack:///../npn/common/src/lib/gridded/supports-opacity-control.component.ts","webpack:///../npn/common/src/lib/gridded/wcs-data.service.ts","webpack:///../npn/common/src/lib/gridded/wms-map-layer-legend.ts","webpack:///../npn/common/src/lib/gridded/wms-map-layer.ts","webpack:///../npn/common/src/lib/index.ts","webpack:///../npn/common/src/lib/npn-lib.module.ts","webpack:///../npn/common/src/lib/public_api.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/activity-curve.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/activity-curves-control.component.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/activity-curves-selection-factory.service.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/activity-curves-selection.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/activity-curves.component.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/curve-control.component.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/index.ts","webpack:///../npn/common/src/lib/visualizations/activity-curves/public_api.ts","webpack:///../npn/common/src/lib/visualizations/agdd-time-series/agdd-time-series-selection.factory.ts","webpack:///../npn/common/src/lib/visualizations/agdd-time-series/agdd-time-series-selection.ts","webpack:///../npn/common/src/lib/visualizations/agdd-time-series/agdd-time-series.component.ts","webpack:///../npn/common/src/lib/visualizations/agdd-time-series/agdd-ts-map-layer-control.component.ts","webpack:///../npn/common/src/lib/visualizations/agdd-time-series/index.ts","webpack:///../npn/common/src/lib/visualizations/agdd-time-series/public_api.ts","webpack:///../npn/common/src/lib/visualizations/calendar/calendar-control.component.ts","webpack:///../npn/common/src/lib/visualizations/calendar/calendar-selection-factory.service.ts","webpack:///../npn/common/src/lib/visualizations/calendar/calendar-selection.ts","webpack:///../npn/common/src/lib/visualizations/calendar/calendar.component.ts","webpack:///../npn/common/src/lib/visualizations/calendar/index.ts","webpack:///../npn/common/src/lib/visualizations/calendar/public_api.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map-control.component.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map-selection-factory.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map-selection.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map-statistics.component.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map.component.html","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map.component.scss","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/clipped-wms-map.component.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/index.ts","webpack:///../npn/common/src/lib/visualizations/clipped-wms-map/public_api.ts","webpack:///../npn/common/src/lib/visualizations/common-controls/higher-species-phenophase-input.component.ts","webpack:///../npn/common/src/lib/visualizations/common-controls/index.ts","webpack:///../npn/common/src/lib/visualizations/common-controls/public_api.ts","webpack:///../npn/common/src/lib/visualizations/common-controls/year-range-input.component.ts","webpack:///../npn/common/src/lib/visualizations/index.ts","webpack:///../npn/common/src/lib/visualizations/map-visualization-base.component.ts","webpack:///../npn/common/src/lib/visualizations/map/consolidated-map-layer-control.component.ts","webpack:///../npn/common/src/lib/visualizations/map/extent-controls.ts","webpack:///../npn/common/src/lib/visualizations/map/gridded-range-slider-control.component.ts","webpack:///../npn/common/src/lib/visualizations/map/index.ts","webpack:///../npn/common/src/lib/visualizations/map/map-selection.factory.ts","webpack:///../npn/common/src/lib/visualizations/map/map-selection.ts","webpack:///../npn/common/src/lib/visualizations/map/map-visualization-marker-iw.component.ts","webpack:///../npn/common/src/lib/visualizations/map/map-visualization.component.scss","webpack:///../npn/common/src/lib/visualizations/map/map-visualization.component.ts","webpack:///../npn/common/src/lib/visualizations/map/public_api.ts","webpack:///../npn/common/src/lib/visualizations/observation-date-vis-selection.ts","webpack:///../npn/common/src/lib/visualizations/observation-frequency/index.ts","webpack:///../npn/common/src/lib/visualizations/observation-frequency/observation-frequency-control.component.ts","webpack:///../npn/common/src/lib/visualizations/observation-frequency/observation-frequency-selection-factory.service.ts","webpack:///../npn/common/src/lib/visualizations/observation-frequency/observation-frequency-selection.ts","webpack:///../npn/common/src/lib/visualizations/observation-frequency/observation-frequency.component.ts","webpack:///../npn/common/src/lib/visualizations/observation-frequency/public_api.ts","webpack:///../npn/common/src/lib/visualizations/observer-activity/index.ts","webpack:///../npn/common/src/lib/visualizations/observer-activity/observer-activity-control.component.ts","webpack:///../npn/common/src/lib/visualizations/observer-activity/observer-activity-selection-factory.service.ts","webpack:///../npn/common/src/lib/visualizations/observer-activity/observer-activity-selection.ts","webpack:///../npn/common/src/lib/visualizations/observer-activity/observer-activity.component.html","webpack:///../npn/common/src/lib/visualizations/observer-activity/observer-activity.component.ts","webpack:///../npn/common/src/lib/visualizations/observer-activity/public_api.ts","webpack:///../npn/common/src/lib/visualizations/public_api.ts","webpack:///../npn/common/src/lib/visualizations/scatter-plot/index.ts","webpack:///../npn/common/src/lib/visualizations/scatter-plot/public_api.ts","webpack:///../npn/common/src/lib/visualizations/scatter-plot/scatter-plot-controls.component.ts","webpack:///../npn/common/src/lib/visualizations/scatter-plot/scatter-plot-selection-factory.service.ts","webpack:///../npn/common/src/lib/visualizations/scatter-plot/scatter-plot-selection.ts","webpack:///../npn/common/src/lib/visualizations/scatter-plot/scatter-plot.component.ts","webpack:///../npn/common/src/lib/visualizations/site-or-summary-vis-selection.ts","webpack:///../npn/common/src/lib/visualizations/svg-visualization-base.component.html","webpack:///../npn/common/src/lib/visualizations/svg-visualization-base.component.scss","webpack:///../npn/common/src/lib/visualizations/svg-visualization-base.component.ts","webpack:///../npn/common/src/lib/visualizations/vis-selection.ts","webpack:///../npn/common/src/lib/visualizations/visualization-base.component.ts","webpack:///../npn/common/src/lib/visualizations/visualization-download.component.ts","webpack:///../npn/common/src/lib/visualizations/visualization-selection-factory.service.ts","webpack:///../npn/common/src/lib/visualizations/visualization.component.ts","webpack:///../npn/common/src/lib/visualizations/visualizations.module.ts","webpack:///./$_lazy_route_resource lazy namespace object","webpack:///./src/app/app.module.ts","webpack:///./src/app/entity.service.ts","webpack:///./src/app/findings.component.scss","webpack:///./src/app/findings.component.ts","webpack:///./src/app/focal-species.component.ts","webpack:///./src/app/fws-dashboard.component.scss","webpack:///./src/app/fws-dashboard.component.ts","webpack:///./src/app/new-visualization-dialog.component.ts","webpack:///./src/app/pheno-trail-visualization-scope-group.component.ts","webpack:///./src/app/pheno-trail-visualization-scope-groups.component.ts","webpack:///./src/app/pheno-trail-visualization-scope-selection.component.ts","webpack:///./src/app/pheno-trail-visualization-scope-station-groups.component.ts","webpack:///./src/app/phenology-trail-partners.component.scss","webpack:///./src/app/phenology-trail-partners.component.ts","webpack:///./src/app/refuge-visualization-scope-selection.component.ts","webpack:///./src/app/resources.component.ts","webpack:///./src/environments/environment.ts","webpack:///./src/main.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["/**\r\n * Ways in which a species' title can be displayed.\r\n * @see SpeciesTitlePipe\r\n */\r\nexport enum SpeciesTitleFormat {\r\n    CommonName = 'common-name',\r\n    ScientificName = 'scientific-name'\r\n};\r\n\r\nexport interface AppSettings {\r\n    /** 'common-name' || 'scientific-name */\r\n    speciesTitleFormat?: SpeciesTitleFormat;\r\n}\r\n\r\n/**\r\n * Holds application level settings that can be altered by the user.\r\n * This is just a class and not an `@Injectable` service because it has\r\n * no `@Injectable` dependencies so it's just more simple.\r\n */\r\nclass ApplicationSettings implements AppSettings {\r\n    private settings:AppSettings = {\r\n        speciesTitleFormat: SpeciesTitleFormat.CommonName\r\n    };\r\n\r\n    get speciesTitleFormat():SpeciesTitleFormat { return this.settings.speciesTitleFormat; }\r\n    set speciesTitleFormat(f:SpeciesTitleFormat) { this.settings.speciesTitleFormat = f; }\r\n}\r\n\r\nexport const APPLICATION_SETTINGS = new ApplicationSettings();","import { Injectable, Inject } from '@angular/core';\r\nimport { NpnConfiguration, NPN_CONFIGURATION } from './config';\r\nimport { Md5 } from 'ts-md5/dist/md5';\r\n\r\n@Injectable()\r\nexport class CacheService {\r\n    ttl: number = (60 * 60 * 1000); // default 1 hour\r\n\r\n    // has to inject NpnConfiguration since can't use NpnServiceUtils\r\n    // w/out introducing a circular dependency.\r\n    constructor(@Inject(NPN_CONFIGURATION) public config: NpnConfiguration) {\r\n        if ((typeof (config.cacheTTL)) === 'number') {\r\n            this.ttl = config.cacheTTL * 60 * 1000; // value in minutes\r\n        }\r\n        console.log(`CacheService Time To Live ${this.ttl / 60000} minutes`);\r\n        if (this.ttl === 0) {\r\n            console.log('Caching disabled clearing local session storage');\r\n            sessionStorage.clear();\r\n        }\r\n    }\r\n\r\n    cacheKey(key: any): string {\r\n        if (typeof (key) !== 'string') {\r\n            key = JSON.stringify(key);\r\n        }\r\n        // not sure about the .toString() on the end since Md=5.hashStr returns string Int32Array\r\n        return Md5.hashStr(key).toString();\r\n    }\r\n\r\n    get(key: any): any {\r\n        if (this.ttl <= 0) {\r\n            return null; // caching disabled\r\n        }\r\n        let ck = this.cacheKey(key),\r\n            entry: any = sessionStorage.getItem(ck);\r\n        if (entry) {\r\n            entry = JSON.parse(entry) as CacheEntry;\r\n            if (Date.now() < entry.expiry) {\r\n                console.log('cache hit', ck, key);\r\n                return entry.data;\r\n            }\r\n            console.log('cache expired', ck);\r\n            window.sessionStorage.removeItem(ck);\r\n        } else {\r\n            console.log('cache miss', ck);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    set(key: any, data: any): void {\r\n        if (this.ttl <= 0) {\r\n            return null; // caching disabled\r\n        }\r\n        let ck = this.cacheKey(key);\r\n        if (data) {\r\n            let entry: CacheEntry = {\r\n                expiry: (Date.now() + this.ttl),\r\n                data: data\r\n            };\r\n            console.log('caching', ck, data);\r\n            try {\r\n                sessionStorage.setItem(ck, JSON.stringify(entry));\r\n            } catch (ex) {\r\n                console.log('error storing item in cache', ex);\r\n                // the assumption here is that this has happened because\r\n                // we've stored too much, do the simplest thing\r\n                // wipe it clean and try again.\r\n                console.log('clearing');\r\n                sessionStorage.clear();\r\n                try {\r\n                    sessionStorage.setItem(ck, JSON.stringify(entry));\r\n                } catch (ex) {\r\n                    console.log('error on second store attempt (giving up).', ex);\r\n                }\r\n            }\r\n        } else {\r\n            console.log('removing from cache', ck);\r\n            sessionStorage.removeItem(ck);\r\n        }\r\n    }\r\n}\r\n\r\nclass CacheEntry {\r\n    expiry: number;\r\n    data: any;\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\n\r\n/**\r\n * @todo rename dataApiRoot2 and the corresponding methods in NpnServiceUtils\r\n */\r\nexport class NpnConfiguration {\r\n    cacheTTL?: number; // # of minutes for CacheService\r\n    apiRoot: string; // URL of NPN web services\r\n    dataApiRoot: string; // URL of NPN data web services (e.g. //data-dev.usanpn.org:3006)\r\n    dataApiUseStatisticsCache?: boolean; // the value for the useCache parameter for data statistics calls.\r\n    dataApiRoot2: string; // URL of NPN data2 web services (new, e.g. https://data-dev.usanpn.org/webservices).\r\n    popApiRoot: string;\r\n    geoServerRoot: string; // URL of the NPN geo server\r\n    [x: string]: any; // not going to dictate what else it might have\r\n}\r\n\r\nexport const NPN_CONFIGURATION = new InjectionToken<NpnConfiguration>('NpnConfiguration');\r\n","/**\r\n * detect IE\r\n * returns version of IE or false, if browser is not Internet Explorer\r\n */\r\nexport function detectIE() {\r\n    var ua = window.navigator.userAgent;\r\n  \r\n    // Test values; Uncomment to check result \r\n  \r\n    // IE 10\r\n    // ua = 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)';\r\n  \r\n    // IE 11\r\n    // ua = 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko';\r\n  \r\n    // IE 12 / Spartan\r\n    // ua = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36 Edge/12.0';\r\n  \r\n    // Edge (IE 12+)\r\n    // ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586';\r\n  \r\n    var msie = ua.indexOf('MSIE ');\r\n    if (msie > 0) {\r\n      // IE 10 or older => return version number\r\n      return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\r\n    }\r\n  \r\n    var trident = ua.indexOf('Trident/');\r\n    if (trident > 0) {\r\n      // IE 11 => return version number\r\n      var rv = ua.indexOf('rv:');\r\n      return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\r\n    }\r\n  \r\n    var edge = ua.indexOf('Edge/');\r\n    if (edge > 0) {\r\n      // Edge (IE 12+) => return version number\r\n      return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\r\n    }\r\n  \r\n    // other browser\r\n    return false;\r\n  }\r\n  ","import {Pipe,PipeTransform} from '@angular/core';\r\n\r\nconst ONE_DAY_MILLIS = (24*60*60*1000);\r\n\r\n@Pipe({name: 'doy'})\r\nexport class DoyPipe implements PipeTransform {\r\n    transform(date,ignoreLeapYear?:boolean): any {\r\n        if(typeof(date) === 'string') {\r\n            var parts = date.split('-');\r\n            if(parts.length === 3) {\r\n                var year = parseInt(parts[0]),\r\n                    month = parseInt(parts[1]),\r\n                    day = parseInt(parts[2]);\r\n                if(!isNaN(year) && !isNaN(month) && !isNaN(day) && month < 13 && day < 32) {\r\n                    date = new Date(year,(month-1),day);\r\n                }\r\n            }\r\n        }\r\n        if(date instanceof Date) {\r\n            date = new Date(date.getTime());\r\n            if(ignoreLeapYear) {\r\n                // ignore leap years, using 2010 which is known to be a non-leap year\r\n                date.setFullYear(2010);\r\n            }\r\n            var doy = date.getDate();\r\n            while (date.getMonth() > 0) {\r\n                // back up to the last day of the last month\r\n                date.setDate(1);\r\n                date.setTime(date.getTime()-ONE_DAY_MILLIS);\r\n                doy += date.getDate();\r\n            }\r\n            return doy;\r\n        }\r\n        return date;\r\n    }\r\n}\r\n","// https://stackoverflow.com/questions/26501688/a-typescript-guid-class\r\nexport function newGuid() {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n        var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\r\n        return v.toString(16);\r\n    });\r\n}","export * from './public_api';","import {Pipe,PipeTransform} from '@angular/core';\r\nimport {DatePipe} from '@angular/common';\r\n\r\nconst JAN_ONE_2010 = new Date(2010/*(new Date()).getFullYear()*/,0);\r\nconst JAN_ONE_THIS_YEAR = new Date((new Date()).getFullYear(),0);\r\nconst ONE_DAY = (24*60*60*1000);\r\n\r\n/**\r\n * Simplified version of thirtyYearAvgDayOfYear that simply takes a number day of year\r\n * and returns a formatted date.  The optional second argument defines the date format\r\n * which defaults to 'MMM d'.  The optional third argument defines whether or not the\r\n * current year should be used as oposed to one known to have 365 days (2010).\r\n *\r\n * This filter equates doy 0 with doy 1 since legend scales are inconsistent in this regard.\r\n */\r\n@Pipe({name: 'legendDoy'})\r\nexport class LegendDoyPipe implements PipeTransform {\r\n    constructor(private datePipe: DatePipe) {}\r\n\r\n    transform(doy,fmt?,current_year?): any {\r\n        doy = Math.round(doy);\r\n        if(doy === 0) {\r\n            doy = 1;\r\n        }\r\n        fmt = fmt||'MMM d'; // e.g. Jan 1\r\n        return this.datePipe.transform(new Date((current_year ? JAN_ONE_THIS_YEAR : JAN_ONE_2010).getTime()+((doy-1)*ONE_DAY)),fmt);\r\n    }\r\n}\r\n","import { Subject } from 'rxjs';\r\n\r\n/**\r\n * Simple base class that can be re-used in support of a common pattern where\r\n * Observable subscriptions may outlast the life of a given component.\r\n * Extending classes will have a simple Subject, `componentDestroyed` that will\r\n * emit a single time when the componene is destroyed.\r\n *\r\n * This class implenents `ngOnDestroy` so if an extending class over-rides that\r\n * function it should call the parent implementation or a leak might occur.\r\n *\r\n * E.g.\r\n * ```\r\n * anObservable.pipe(takeUntil(this.componentDestroyed)).subscribe(...);\r\n * ```\r\n */\r\nexport class MonitorsDestroy {\r\n    protected componentDestroyed:Subject<any> = new Subject();\r\n\r\n    ngOnDestroy() {\r\n        this.componentDestroyed.next();\r\n        this.componentDestroyed.complete();\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { NpnServiceUtils } from './npn-service-utils.service';\r\nimport { Station } from './station';\r\nimport { Network } from './network';\r\n\r\n@Injectable()\r\nexport class NetworkService {\r\n\r\n    constructor(private serviceUtils:NpnServiceUtils) {}\r\n\r\n    /**\r\n     * Get all stations for a network or list of networks.\r\n     * \r\n     * @param networkIds A single networkId or an array of networkIds.\r\n     */\r\n    getStations(networkIds:number|number[]): Promise<Station[]> {\r\n        const ids:number[] = Array.isArray(networkIds) ? networkIds : [networkIds];\r\n        const params = ids.reduce((map,id,i) => {\r\n                map[`network_ids[${i}]`] = id;\r\n                return map;\r\n            },{});\r\n        return this.serviceUtils.cachedGet(\r\n            this.serviceUtils.apiUrl('/npn_portal/stations/getAllStations.json'),\r\n            params\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get station ids nearby to a network (functional for only networks with boundaries).\r\n     * \r\n     * @param networkId A single networkId\r\n     * @param radius The radius to constrain the results by.\r\n     */\r\n    getNearbyStationIds(networkId:number,radius:number):Promise<number []> {\r\n        return this.serviceUtils.cachedGet(\r\n            this.serviceUtils.dataApiUrl2(`/v0/stations/nearby_stations/${networkId}/${radius}`)\r\n        ).then(response => response.Station_IDs);\r\n    }\r\n\r\n    /**\r\n     * Get a single Network by id\r\n     * \r\n     * @todo unfortunate that this takes a single networkId and yet returns an array, the function should unwrap the response so callers don't have to.\r\n     * \r\n     * @param networkId The id of the Network to fetch.\r\n     */\r\n    getNetwork(networkId:number): Promise<Network[]> {\r\n        return this.serviceUtils.cachedGet(\r\n            this.serviceUtils.dataApiUrl2(`/v0/networks/${networkId}`)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get a set of Networks by id.\r\n     * \r\n     * @param networkIds The networkIds.\r\n     */\r\n    getNetworks(networkIds:number[]): Promise<Network[]> {\r\n        // ARGH there is a service that can do this in one request but the dataApiUrl2 \r\n        // service doesn't do this and we don't yet have a link to the new services (not sure if they should be used)\r\n        // e.g. curl -X GET \"https://data-dev.usanpn.org:3004/v0/networks?network_id=295,724\" -H \"accept: application/json\"\r\n        // in a development setup dataApiRoot2 is https://data-dev.usanpn.org/webservices (prefixed with /webservices and no 3004)\r\n        /*\r\n        return this.serviceUtils.cachedGet(\r\n            this.serviceUtils.dataApiUrl2('/v0/networks'),\r\n            {network_id:networkIds.join(',')}\r\n        );*/\r\n        // not re-using the getNetwork function because I think it should be fixed to not return an array\r\n        // but currently fetching the networks with one request per which is less efficient than it could be\r\n        return Promise.all(\r\n            networkIds.map(id => this.serviceUtils.cachedGet(this.serviceUtils.dataApiUrl2(`/v0/networks/${id}`)))\r\n        ).then(results => {\r\n            // TODO: What to do when given a bad network id?\r\n            return results.map(result=> result.length == 1 ? result[0] : null).filter(network => !!network);\r\n        });\r\n    }\r\n}\r\n","import { NgModule, InjectionToken } from '@angular/core';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\nimport { CacheService } from './cache.service';\r\nimport { SpeciesService } from './species.service';\r\nimport { NetworkService } from './network.service';\r\nimport { StationService } from './station.service';\r\n\r\nimport { SpeciesTitlePipe, TaxonomicSpeciesTitlePipe } from './species-title.pipe';\r\nimport { DoyPipe } from './doy.pipe';\r\nimport { LegendDoyPipe } from './legend-doy.pipe';\r\n\r\nimport { DatePipe } from '@angular/common';\r\n\r\nimport { NPN_CONFIGURATION } from './config';\r\nimport { NpnServiceUtils } from './npn-service-utils.service';\r\nimport { NpnLogoComponent } from './npn-logo.component';\r\n\r\nexport const NPN_BASE_HREF = new InjectionToken<string>('npnBaseHref');\r\n\r\n@NgModule({\r\n    imports:[\r\n        HttpClientModule\r\n    ],\r\n    declarations: [\r\n        SpeciesTitlePipe,\r\n        TaxonomicSpeciesTitlePipe,\r\n        LegendDoyPipe,\r\n        DoyPipe,\r\n        NpnLogoComponent\r\n    ],\r\n    exports: [\r\n        SpeciesTitlePipe,\r\n        TaxonomicSpeciesTitlePipe,\r\n        LegendDoyPipe,\r\n        DoyPipe,\r\n        NpnLogoComponent\r\n    ],\r\n    providers: [\r\n        CacheService,\r\n        SpeciesService,\r\n        NetworkService,\r\n        StationService,\r\n        NpnServiceUtils,\r\n        SpeciesTitlePipe,\r\n        TaxonomicSpeciesTitlePipe,\r\n        DatePipe,\r\n        DoyPipe,\r\n        LegendDoyPipe,\r\n        { provide: NPN_BASE_HREF, useValue: '/' },\r\n        {\r\n            provide: NPN_CONFIGURATION, useValue: {\r\n                apiRoot: '//www-dev.usanpn.org',\r\n                dataApiRoot: '//data-dev.usanpn.org:3006',\r\n                geoServerRoot: '//geoserver-dev.usanpn.org/geoserver'\r\n            }\r\n        }\r\n    ]\r\n})\r\nexport class NpnCommonModule { }","import { Component, Input, HostBinding } from \"@angular/core\";\r\n\r\n@Component({\r\n    selector: 'npn-logo',\r\n    template: `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 391 391\"><g>\r\n        <path class=\"swirl-top\" d=\"M182,1c-36.3,2.4-68.6,13.4-95.3,32.5c-5.6,4-11.8,8.7-13.7,10.4l-3.5,3L73,46c5.8-1.6,15.6-1.2,22.2,1.1\r\n                c9.4,3.1,19.3,10.1,30.3,21.3C137.1,80.2,145.6,91,168,122c17.1,23.8,26.5,34.3,39.5,44.2c16.2,12.4,28.9,16.3,49.5,15.5\r\n                c21.7-0.9,38.4-7.7,53.2-21.6c17.4-16.3,25.7-36.1,25.8-61c0-10.3,0-10.3-2.2-9.6c-21.5,6.6-48.9,3.2-72.9-9.1\r\n                c-27.3-14.1-51.2-45.7-48.4-64.1c0.7-5.1,6-11,10.6-12c5.3-1,3-2.1-5.8-2.7C199.9,0.4,193.3,0.3,182,1z\"/>\r\n        <path class=\"swirl-top\" d=\"M256.5,5.9c-8.8,0.9-11.6,1.9-13.9,5.3c-2.2,3.1-2,6.5,0.8,12.5c6.1,13.1,19.8,28.5,30.3,34\r\n                c11,5.9,28.3,8.6,41.2,6.4l6.5-1.1l8.2,4.5c4.5,2.5,8.7,4.5,9.3,4.5c2.5,0,0.8-4.1-3.6-9l-4.6-5.2l-0.1-10.2\r\n                c-0.1-9.3-0.4-10.7-3.3-16.7c-5.4-10.8-16-19.1-30-23.2C291.1,5.8,267.9,4.8,256.5,5.9z M315.8,40.2c2.7,2.7,0.7,7.8-2.9,7.8\r\n                c-2.1,0-4.9-2.6-4.9-4.5C308,40,313.3,37.7,315.8,40.2z\"/>\r\n        <path class=\"swirl-top\" d=\"M72.5,50.6c-9.9,2.3-10.4,2.6-18.8,11.3c-4.5,4.7-11.1,12.2-14.6,16.6c-9.7,12.3-26,37.8-23,35.9\r\n                c0.8-0.5,4.6-3,8.6-5.7c9.7-6.4,23.9-13.1,34.8-16.3c8-2.5,10.6-2.7,24-2.7s15.9,0.2,23.8,2.6c4.8,1.5,12.4,4.5,16.9,6.8l8.1,4.1\r\n                l-3.8-6.9c-11.6-20.8-25.7-37.2-36.6-42.2C85.7,51.2,76.8,49.6,72.5,50.6z\"/>\r\n        <path class=\"swirl-left\" d=\"M354.6,81.9c1.3,5,0.7,31.5-1,40.5c-4.6,24.2-16.5,43.5-35.4,57.4c-14.1,10.4-23.8,14.3-55.1,22.2\r\n                c-23.8,6-32.9,8.9-44.6,14.5c-22.7,10.9-35.8,23.3-45,42.6c-5.4,11.5-7.5,21.2-7.5,35.1c0,15.5,1.9,23.6,8.5,37.4\r\n                c10.3,21.3,27.7,35.9,51.2,43c7.6,2.4,10.6,2.7,22.3,2.8c15.3,0,23.2-1.5,34.5-6.7c19-8.6,31.2-17.5,48-34.8\r\n                c17.5-18,28.4-33.6,39.6-56.3c28.1-57.2,26.1-119.5-5.7-181.6C358.2,85.8,353.6,78.3,354.6,81.9z M329.4,194.2\r\n                c-30.6,42.4-63.6,80-84.9,96.8c-13.1,10.3-34,19-49.9,20.6l-6.4,0.7l-0.7-7.7c-1.4-14.8,2.6-33.4,9.7-45.3\r\n                c5-8.5,14.6-17.5,23.6-22.1c8.9-4.7,17.5-7.3,43.7-13.7c10.5-2.6,23.5-6.4,29.1-8.6c10.9-4.2,24.4-12.7,33.4-20.8\r\n                c3-2.8,5.7-5.1,5.8-5.1C333,189,331.5,191.4,329.4,194.2z\"/>\r\n        <path class=\"swirl-right\" d=\"M67.5,108c-17.8,3.8-37.3,16-48,30.2C8.7,152.5,3.6,167,2,187.1C-0.1,215,7.8,248,24.4,280.3\r\n                c34.1,66.3,95.1,104.5,174.1,109.1l9,0.5l-6.5-1.4c-56.1-12.9-106.1-51.7-136.8-106.2c-14.5-25.7-20.6-47.5-20.7-73.8\r\n                c0-23.4,4.2-40,14.8-57.7c4.2-6.9,12.6-17.3,13.4-16.5c0.2,0.3-1.6,4.5-4,9.3C58.6,161.8,55,177.6,55,199c0,37.8,14.2,78,39.4,111.7\r\n                c14.5,19.5,39,42.1,58.8,54.2c14.9,9,31.2,16.2,46.5,20.5c14.6,4,15.2,3.9,5.5-1.4c-45.2-24.2-65.1-62.5-55.7-107.3\r\n                c0.9-4.3,3.9-15.1,6.6-24c9.7-31.5,12.1-43.7,12-63c0-9.1-0.5-14.3-2.1-20.2C154.6,125.4,111.9,98.7,67.5,108z\"/>\r\n    </g></svg>\r\n    `,\r\n    styles:[`\r\n    :host {\r\n        display: block;\r\n    }\r\n    svg {\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    :host.spin > svg {\r\n        animation-name: spin;\r\n        animation-duration: 1250ms;\r\n        animation-iteration-count: infinite;\r\n        animation-timing-function: linear;\r\n    }\r\n    @keyframes spin {\r\n        from { transform: rotate(0deg); }\r\n        to { transform: rotate(360deg); }\r\n    }\r\n    `]\r\n})\r\nexport class NpnLogoComponent {\r\n    @Input() @HostBinding('class.spin') spin:boolean = false;\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { CacheService } from './cache.service';\r\n\r\nimport { NpnConfiguration, NPN_CONFIGURATION } from './config';\r\n\r\n/**\r\n * @todo rename dataApi[2], etc. (along with NpnConfiguration) to be more meaningful.\r\n */\r\n@Injectable()\r\nexport class NpnServiceUtils {\r\n    constructor(public http: HttpClient,\r\n        public cache: CacheService,\r\n        @Inject(NPN_CONFIGURATION) public config: NpnConfiguration) {\r\n    }\r\n\r\n    public apiUrl(suffix: string) {\r\n        return `${this.config.apiRoot}${suffix}`;\r\n    }\r\n\r\n    public dataApiUrl(suffix: string) {\r\n        return `${this.config.dataApiRoot}${suffix}`;\r\n    }\r\n\r\n    public dataApiUrl2(suffix: string) {\r\n        return `${this.config.dataApiRoot2}${suffix}`;\r\n    }\r\n\r\n    public geoServerUrl(suffix: string) {\r\n        return `${this.config.geoServerRoot}${suffix}`;\r\n    }\r\n\r\n    public popApipUrl(suffix:string) {\r\n        return `${this.config.popApiRoot}${suffix}`;\r\n    }\r\n\r\n    get dataApiUseStatisticsCache(): boolean {\r\n        return typeof (this.config.dataApiUseStatisticsCache) === 'boolean' ?\r\n            this.config.dataApiUseStatisticsCache : false;\r\n    }\r\n\r\n    public get(url: string, params?: any, asText?: boolean): Promise<any> {\r\n        params = params || {};\r\n        return asText\r\n            ? this.http.get(url, { params: params, responseType: 'text' }).toPromise()\r\n            : this.http.get<any>(url, { params: params }).toPromise()\r\n    }\r\n\r\n    public cachedGet(url: string, params?: any, asText?: boolean): Promise<any> {\r\n        params = params || {};\r\n        const cacheKey = {\r\n            u: url,\r\n            params: params\r\n        };\r\n        const data = this.cache.get(cacheKey);\r\n        if (data) {\r\n            return Promise.resolve(data);\r\n        }\r\n        return this.get(url, params, asText)\r\n            .then(data => {\r\n                this.cache.set(cacheKey, data);\r\n                return data;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Allows a client to populate the cache with an object as would\r\n     * be done by `cachedGet` or `cachedPost` so that subsequent calls\r\n     * to either return this cached object.  This is useful in cases where\r\n     * an error response from a server should be replaced with a default\r\n     * (e.g. 404 cache a default for some resource).\r\n     * \r\n     * @param url \r\n     * @param data \r\n     * @param paramsOrBody \r\n     */\r\n    public cachedSet(url:string,data:any,paramsOrBody?:any):any {\r\n        paramsOrBody = paramsOrBody || {};\r\n        const cacheKey = {\r\n            u: url,\r\n            params: paramsOrBody\r\n        };\r\n        this.cache.set(cacheKey,data);\r\n        return data;\r\n    }\r\n\r\n    public post<T = any>(url:string,body:string):Promise<T> {\r\n        return <Promise<T>>this.http.post(url,body,{headers: {'Content-Type':'application/x-www-form-urlencoded'}}).toPromise();\r\n    }\r\n\r\n    public cachedPost<T = any>(url:string,body:string):Promise<T> {\r\n        const cacheKey = {\r\n            u: url,\r\n            params: body\r\n        };\r\n        const data = this.cache.get(cacheKey);\r\n        if(data) {\r\n            return Promise.resolve(data);\r\n        }\r\n        return this.post<T>(url,body)\r\n            .then(response => {\r\n                this.cache.set(cacheKey,response);\r\n                return response;\r\n            });\r\n    }\r\n}\r\n","export class Phenophase {\r\n    phenophase_id: number;\r\n    [x: string]: any\r\n}\r\n\r\n// NOTE: property names are inconsistent with how they work for species\r\n// i.e. why not `phenophase_class_id` and `phenophase_class_name` ??\r\nexport interface PhenophaseClass {\r\n    pheno_class_id: number;\r\n    pheno_class_name: string;\r\n    pheno_class_sequence: number;\r\n}\r\n\r\nexport interface TaxonomicPhenophase extends PhenophaseClass,Phenophase {\r\n\r\n}\r\n\r\nexport type TaxonomicPhenophaseType = Phenophase|PhenophaseClass;\r\n\r\nexport enum TaxonomicPhenophaseRank {\r\n    PHENOPHASE = 'phenophase',\r\n    CLASS = 'class'\r\n}\r\n","export { NpnCommonModule, NPN_BASE_HREF } from './npn-common.module';\r\nexport * from './species';\r\nexport * from './phenophase';\r\nexport * from './station';\r\nexport * from './network';\r\nexport * from './static-color';\r\n\r\nexport { CacheService } from './cache.service';\r\nexport * from './species.service';\r\nexport { NetworkService } from './network.service';\r\nexport { StationService } from './station.service';\r\nexport { getStaticColor } from './static-color';\r\n\r\nexport * from './species-title.pipe';\r\nexport { DoyPipe } from './doy.pipe';\r\nexport { LegendDoyPipe } from './legend-doy.pipe';\r\nexport * from './guid';\r\nexport * from './config';\r\nexport { NpnServiceUtils } from './npn-service-utils.service';\r\nexport * from './detect-ie';\r\nexport * from './monitors-destroy';\r\nexport * from './application-settings';","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { SpeciesTitleFormat, APPLICATION_SETTINGS } from './application-settings';\r\nimport { Species, TaxonomicSpeciesType, TaxonomicSpeciesRank, TaxonomicClass, TaxonomicOrder, TaxonomicFamily, TaxonomicGenus } from './species';\r\n\r\n@Pipe({ name: 'speciesTitle' })\r\nexport class SpeciesTitlePipe implements PipeTransform {\r\n    transform(item: Species, format?: SpeciesTitleFormat): any {\r\n        if (item) {\r\n            switch(format || APPLICATION_SETTINGS.speciesTitleFormat) {\r\n                case SpeciesTitleFormat.CommonName:\r\n                    if (item.common_name) {\r\n                        let lower = item.common_name.toLowerCase();\r\n                        return lower.substring(0, 1).toUpperCase() + lower.substring(1);\r\n                    }\r\n                    return item.common_name;\r\n                case SpeciesTitleFormat.ScientificName:\r\n                    return item && item.genus\r\n                        ? `${item.genus} ${item.species}`\r\n                        : undefined;\r\n            }\r\n        }\r\n        return item;\r\n    }\r\n}\r\n\r\n@Pipe({name: 'taxonomicSpeciesTitle'})\r\nexport class TaxonomicSpeciesTitlePipe implements PipeTransform {\r\n    constructor(private speciesTitle:SpeciesTitlePipe) {}\r\n    transform(item:TaxonomicSpeciesType,rank:TaxonomicSpeciesRank = TaxonomicSpeciesRank.SPECIES,format:SpeciesTitleFormat = APPLICATION_SETTINGS.speciesTitleFormat):any {\r\n        if(item && typeof(item) === 'object') {\r\n            let o;\r\n            switch(rank) {\r\n                case TaxonomicSpeciesRank.SPECIES:\r\n                    o = item as Species;\r\n                    return this.speciesTitle.transform(o,format);\r\n                case TaxonomicSpeciesRank.CLASS:\r\n                    o = item as TaxonomicClass;\r\n                    return format === SpeciesTitleFormat.CommonName\r\n                        ? o.class_common_name||`${o.class_name} (Scientific)` // || should not be necessary\r\n                        : o.class_name;\r\n                case TaxonomicSpeciesRank.ORDER:\r\n                    o = item as TaxonomicOrder;\r\n                    return format === SpeciesTitleFormat.CommonName\r\n                        ? o.order_common_name||`${o.order_name} (Scientific)` // || should not be necessary\r\n                        : o.order_name;\r\n                case TaxonomicSpeciesRank.FAMILY:\r\n                    o = item as TaxonomicFamily;\r\n                    return format === SpeciesTitleFormat.CommonName\r\n                        ? o.family_common_name||`${o.family_name} (Scientific)` // || should not be necessary\r\n                        : o.family_name;\r\n                case TaxonomicSpeciesRank.GENUS:\r\n                    o = item as TaxonomicGenus;\r\n                    return format === SpeciesTitleFormat.CommonName\r\n                        ? o.genus_common_name||`${o.genus} (Scientific)` // || should not be necessary\r\n                        : o.genus;\r\n            }\r\n        }\r\n        return item;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { DatePipe } from '@angular/common';\r\n\r\nimport { HttpParams } from '@angular/common/http';\r\n\r\nimport { Species, TaxonomicSpecies, TaxonomicClass, TaxonomicFamily, TaxonomicGenus, TaxonomicOrder, TaxonomicSpeciesRank, TaxonomicSpeciesType } from './species';\r\nimport { Phenophase, TaxonomicPhenophaseRank, PhenophaseClass } from './phenophase';\r\nimport { NpnServiceUtils } from './npn-service-utils.service';\r\n\r\nexport interface SpeciesTaxonomicInfo {\r\n    species: TaxonomicSpecies[];\r\n    classes?: TaxonomicClass[];\r\n    orders?: TaxonomicOrder[];\r\n    families?: TaxonomicFamily[];\r\n    genera?: TaxonomicGenus[];\r\n}\r\n\r\nexport interface PhenophaseTaxonomicInfo {\r\n    phenophases: Phenophase[];\r\n    classes: PhenophaseClass[];\r\n}\r\n\r\n/**\r\n * @todo need utilities that can be used to generate keys from plot and data based on the plot.\r\n */\r\nexport interface SpeciesPlot {\r\n    /** Dictates what IS found in the `species` property.  If not specified defaults to SPECIES (legacy) */\r\n    speciesRank?: TaxonomicSpeciesRank;\r\n    species?: TaxonomicSpeciesType;\r\n    /** Dictates what IS found in the `phenophase` property.  If not specified defaults to PHENOPHASE (legacy) */\r\n    phenophaseRank?: TaxonomicPhenophaseRank;\r\n    phenophase?: Phenophase|PhenophaseClass;\r\n    /** Many plots have colors associated with them */\r\n    color?: string;\r\n    /** Some plots may be for an individual year */\r\n    year?: number;\r\n}\r\n\r\nexport interface SpeciesPlotKeys {\r\n    speciesIdKey: string;\r\n    phenophaseIdKey: string;\r\n}\r\n\r\n/**\r\n * @param plot The plot\r\n * @return {SpeciesPlotKeys} The names of the id keys associated with data records.\r\n */\r\nexport function getSpeciesPlotKeys(plot:SpeciesPlot):SpeciesPlotKeys {\r\n    let speciesIdKey;\r\n    let phenophaseIdKey;\r\n    switch(plot.speciesRank||TaxonomicSpeciesRank.SPECIES) {\r\n        case TaxonomicSpeciesRank.SPECIES:\r\n            speciesIdKey = 'species_id';\r\n            break;\r\n        case TaxonomicSpeciesRank.CLASS:\r\n            speciesIdKey = 'class_id';\r\n            break;\r\n        case TaxonomicSpeciesRank.ORDER:\r\n            speciesIdKey = 'order_id';\r\n            break;\r\n        case TaxonomicSpeciesRank.FAMILY:\r\n            speciesIdKey = 'family_id';\r\n            break;\r\n        case TaxonomicSpeciesRank.GENUS:\r\n            speciesIdKey = 'genus_id';\r\n            break;           \r\n    }\r\n    switch(plot.phenophaseRank||TaxonomicPhenophaseRank.PHENOPHASE) {\r\n        case TaxonomicPhenophaseRank.PHENOPHASE:\r\n            phenophaseIdKey = 'phenophase_id';\r\n            break;\r\n        case TaxonomicPhenophaseRank.CLASS:\r\n            phenophaseIdKey = 'pheno_class_id';\r\n            break;\r\n    }\r\n    return {speciesIdKey,phenophaseIdKey};\r\n}\r\n\r\nfunction mapByNumericId(list,key) {\r\n    return list.reduce((map,o) => {\r\n            if(typeof(o[key]) === 'number') {\r\n                map[o[key]] = o;\r\n            }\r\n            return map;\r\n        },{});\r\n}\r\n@Injectable()\r\nexport class SpeciesService {\r\n    constructor(private serviceUtils:NpnServiceUtils,private datePipe: DatePipe) {}\r\n\r\n    getAllSpecies(params?: any): Promise<Species[]> {\r\n        // NOTE: when there are multiple species phenophase controls on the screen the result can\r\n        // be multiple simultaneous queries...\r\n        //console.log('SpeciesService.getAllSpecies:params', params);\r\n        params = params||{};\r\n        const url = this.serviceUtils.apiUrl('/npn_portal/species/getSpeciesFilter.json');\r\n        let postParams = new HttpParams()\r\n        Object.keys(params).forEach(key => postParams = postParams.set(`${key}`, `${params[key]}`));\r\n        return this.serviceUtils.cachedPost(url,postParams.toString());\r\n    }\r\n\r\n    // all species related results are cached locally but not in the session cache since they can get large\r\n    private higherSpeciesCache = {};\r\n\r\n    private _allSpecies(params:HttpParams = new HttpParams()): Promise<TaxonomicSpecies[]> {\r\n        params = params.set('include_restricted','false');\r\n        const input = params.toString();\r\n        const cacheKey = this.serviceUtils.cache.cacheKey({service:'getSpecies',input});\r\n        if(!this.higherSpeciesCache[cacheKey]) {\r\n            return this.higherSpeciesCache[cacheKey] = this.serviceUtils.post(\r\n                this.serviceUtils.apiUrl('/npn_portal/species/getSpecies.json'),\r\n                input\r\n            );\r\n        }\r\n        return this.higherSpeciesCache[cacheKey].then(results => JSON.parse(JSON.stringify(results)));\r\n    }\r\n\r\n    private _filterSpecies(params:HttpParams = new HttpParams()): Promise<TaxonomicSpecies[]> {\r\n        const input = params.toString();\r\n        const cacheKey = this.serviceUtils.cache.cacheKey({service:'getSpeciesFilter',input});\r\n        if(!this.higherSpeciesCache[cacheKey]) {\r\n            return this.higherSpeciesCache[cacheKey] = this.serviceUtils.post(\r\n                this.serviceUtils.apiUrl('/npn_portal/species/getSpeciesFilter.json'),\r\n                input\r\n            );\r\n        }\r\n        return this.higherSpeciesCache[cacheKey].then(results => JSON.parse(JSON.stringify(results)));\r\n    }\r\n\r\n    /**\r\n     * Creates Promises/requests to get species data for a set of years.  The resulting data will almost\r\n     * certainly contain duplicates.\r\n     * \r\n     * @param params The base HttpParams to use when retrieving species (via /npn_portal/species/getSpeciesFilter.json)\r\n     * @param years The years to request species for.\r\n     */\r\n    private _allSpeciesPromises(params:HttpParams = new HttpParams(),years:number[] = []): Promise<TaxonomicSpecies[]>[] {\r\n        years = years||[]; // in case null is actually passed in\r\n        // if we aren't doing any filtering then use the getSpecies service because\r\n        // it's much faster for that use case, it just doesn't return numbers of observations\r\n        if(!years.length && !params.keys().length) {\r\n            return [this._allSpecies(params)];\r\n        }\r\n        return !years.length\r\n            ? [this._filterSpecies(params)]\r\n            // sets of input request parameters for filtering\r\n            // e.g. [2013,2010,2012] ->\r\n            // [['2010-01-01','2010-12-31'],['2012-01-01','2013-12-31']]\r\n            : years.slice().sort().reduce((rngs,year) => {\r\n                    if(!rngs.length) {\r\n                        rngs[0] = [year,year];\r\n                    } else {\r\n                        const rng = rngs[rngs.length-1];\r\n                        if(rng[1] === year-1) {\r\n                            rng[1] = year;\r\n                        } else {\r\n                            rngs.push([year,year]);\r\n                        }\r\n                    }\r\n                    return rngs;\r\n                },[])\r\n                //.map(range => [`${range[0]}-01-01`,`${range[1]}-12-31`])\r\n                .map(range => this._filterSpecies(params.set('start_date',`${range[0]}-01-01`).set('end_date',`${range[1]}-12-31`)));\r\n    }\r\n\r\n    /**\r\n     * Requests species data for a set of years and consolidates the results into a single array of `TaxonomicSpecies`.\r\n     * \r\n     * @param params The base HttpParams to use when retrieving species (via /npn_portal/species/getSpeciesFilter.json)\r\n     * @param years The years to request species for.\r\n     */\r\n    getAllSpeciesConsolidated(params:HttpParams = new HttpParams(),years:number[] = null): Promise<TaxonomicSpecies[]> {\r\n        return Promise.all(this._allSpeciesPromises(params,years))\r\n            .then((results:TaxonomicSpecies[][]) => {\r\n                console.log('getAllSpeciesConsolidated.results',results.map(r => r.length).join(', '));\r\n                let consolidated:TaxonomicSpecies[];\r\n                if(results.length === 1) {\r\n                    consolidated = results[0]; // nothing to consolidate\r\n                } else {\r\n                    const idMap = {};\r\n                    consolidated = results.reduce((set,list) => {\r\n                        list.forEach(species => {\r\n                            const {species_id} = species;\r\n                            if(idMap[species_id]) {\r\n                                // already in set, bump observation count\r\n                                //console.log(`getAllSpeciesConsolidated.consolidating species observations [${species_id}] ${idMap[species_id].number_observations} + ${species.number_observations}`);\r\n                                idMap[species_id].number_observations += species.number_observations;\r\n                            } else {\r\n                                set.push(idMap[species_id] = species);\r\n                            }\r\n                        });\r\n                        return set;\r\n                    },[])\r\n                }\r\n                if(consolidated.length && typeof(consolidated[0].number_observations) === 'number') {\r\n                    // sort by number_observations\r\n                    consolidated.sort((a,b) => b.number_observations - a.number_observations);\r\n                }\r\n                console.log('getAllSpeciesConsolidated.consolidated',consolidated.length);\r\n                return consolidated;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Requests species data for a set of years and organizes the results into an instance of `SpeciesTaxonomicInfo`.\r\n     * \r\n     * @param params The base HttpParams to use when retrieving species (via /npn_portal/species/getSpeciesFilter.json)\r\n     * @param years The years to request species for.\r\n     */\r\n    getAllSpeciesHigher(params:HttpParams = new HttpParams(),years:number[] = null): Promise<SpeciesTaxonomicInfo> {\r\n        return this.getAllSpeciesConsolidated(params,years)\r\n            .then((species:TaxonomicSpecies[]) => {\r\n                const gatherById = key => mapByNumericId(species,key);\r\n                const classIds = gatherById('class_id');\r\n                const orderIds = gatherById('order_id');\r\n                const familyIds = gatherById('family_id');\r\n                const genusIds = gatherById('genus_id');\r\n\r\n                return {\r\n                    species,\r\n                    classes: Object.keys(classIds).map(id => {\r\n                            const {class_id,class_name,class_common_name,kingdom} = classIds[id];\r\n                            return {class_id,class_name,class_common_name,kingdom}\r\n                        })\r\n                        .filter(r => !!r.class_id && !!r.class_name/* && !!r.class_common_name*/) // keep only complete records\r\n                        /*.sort((a,b) => a.class_common_name.localeCompare(b.class_common_name))*/,\r\n                    orders: Object.keys(orderIds).map(id => {\r\n                            const {order_id,order_name,order_common_name,kingdom} = orderIds[id];\r\n                            return {order_id,order_name,order_common_name,kingdom};\r\n                        })\r\n                        .filter(r => !!r.order_id && !!r.order_name/* && !!r.order_common_name*/) // keep only complete records\r\n                        /*.sort((a,b) => a.order_common_name.localeCompare(b.order_common_name))*/,\r\n                    families: Object.keys(familyIds).map(id => {\r\n                            const {family_id,family_name,family_common_name,kingdom} = familyIds[id];\r\n                            return {family_id,family_name,family_common_name,kingdom};\r\n                        })\r\n                        .filter(r => !!r.family_id && !!r.family_name/* && !!r.family_common_name*/) // keep only complete records\r\n                        /*.sort((a,b) => a.family_common_name.localeCompare(b.family_common_name))*/,\r\n                    genera: Object.keys(genusIds).map(id => {\r\n                        const {genus_id,genus,genus_common_name, kingdom} = genusIds[id];\r\n                        return {genus_id,genus,genus_common_name, kingdom};\r\n                    })\r\n                    .filter(r => !!r.genus_id && !!r.genus/* && !!r.family_common_name*/) // keep only complete records\r\n                    /*.sort((a,b) => a.family_common_name.localeCompare(b.family_common_name))*/\r\n                };\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Flatten a list of SpeciesPlots into the list of species_ids that they constitute.\r\n     * \r\n     * @param plots \r\n     * @return {Promise<number []>} Promise resolved with the set of species_ids.\r\n     */\r\n    getSpeciesIds(plots:SpeciesPlot[]):Promise<number []> {\r\n        return this.getAllSpeciesHigher()\r\n            .then(info => plots.reduce((ids,plot) => {\r\n                const addId = id => {\r\n                    if(ids.indexOf(id) === -1) {\r\n                        ids.push(id);\r\n                    }\r\n                };\r\n                const keys = getSpeciesPlotKeys(plot);\r\n                let taxId;\r\n                switch(plot.speciesRank||TaxonomicSpeciesRank.SPECIES) {\r\n                    case TaxonomicSpeciesRank.SPECIES:\r\n                        taxId = (plot.species as Species).species_id;\r\n                        break;\r\n                    case TaxonomicSpeciesRank.CLASS:\r\n                        taxId = (plot.species as TaxonomicClass).class_id;\r\n                        break;\r\n                    case TaxonomicSpeciesRank.ORDER:\r\n                        taxId = (plot.species as TaxonomicOrder).order_id;\r\n                        break;\r\n                    case TaxonomicSpeciesRank.FAMILY:\r\n                        taxId = (plot.species as TaxonomicFamily).family_id;\r\n                        break;\r\n                    case TaxonomicSpeciesRank.GENUS:\r\n                        taxId = (plot.species as TaxonomicGenus).genus_id;\r\n                        break;\r\n                }\r\n                // pull out all species that match and add them to the set\r\n                info.species.filter(species => species[keys.speciesIdKey] == taxId)\r\n                    .forEach(species => addId(species.species_id));\r\n                return ids;\r\n            },[]));\r\n    }\r\n\r\n    generatePhenophaseTaxonomicInfo(phenophases:Phenophase[]):PhenophaseTaxonomicInfo {\r\n        const phenoClassIds = mapByNumericId(phenophases,'pheno_class_id');\r\n        return {\r\n            phenophases,\r\n            classes: Object.keys(phenoClassIds).map(id => {\r\n                    const {pheno_class_id,pheno_class_name,pheno_class_sequence} = phenoClassIds[id];\r\n                    return {pheno_class_id,pheno_class_name,pheno_class_sequence};\r\n                })\r\n                .filter(r => !!r.pheno_class_id && !!r.pheno_class_name)\r\n                .sort((a,b) => {\r\n                    if(a.pheno_class_sequence > b.pheno_class_sequence) {\r\n                        return 1;\r\n                    } else if(a.pheno_class_sequence < b.pheno_class_sequence) {\r\n                        return -1;\r\n                    } else {\r\n                        return 0;\r\n                    }\r\n                })\r\n        };\r\n    }\r\n\r\n    private _getPhenophases(species: TaxonomicSpeciesType, rank: TaxonomicSpeciesRank, date?: Date): Promise<Phenophase[]> {\r\n        const params: any = {};\r\n        const url = rank === TaxonomicSpeciesRank.SPECIES\r\n            ? this.serviceUtils.apiUrl('/npn_portal/phenophases/getPhenophasesForSpecies.json')\r\n            : this.serviceUtils.apiUrl('/npn_portal/phenophases/getPhenophasesForTaxon.json')\r\n        let o;\r\n        switch(rank) {\r\n            case TaxonomicSpeciesRank.SPECIES:\r\n                o = species as Species;\r\n                params.species_id = o.species_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.CLASS:\r\n                o = species as TaxonomicClass;\r\n                params.class_id = o.class_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.ORDER:\r\n                o = species as TaxonomicOrder;\r\n                params.order_id = o.order_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.FAMILY:\r\n                o = species as TaxonomicFamily;\r\n                params.family_id = o.family_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.GENUS:\r\n                o = species as TaxonomicGenus;\r\n                params.genus_id = o.genus_id;\r\n                break;\r\n        }\r\n        \r\n        if (date) {\r\n            params.date = this.datePipe.transform(date, 'y-MM-dd')\r\n        } else {\r\n            params.return_all = true;\r\n        }\r\n        return this.serviceUtils.cachedGet(url,params)\r\n            .then(phases => phases && phases.length\r\n                ? this.removeRedundantPhenophases(phases[0].phenophases as Phenophase[])\r\n                : []);\r\n    }\r\n\r\n    private _getPhenodefinitions(species: TaxonomicSpeciesType, rank: TaxonomicSpeciesRank, date?: Date): Promise<Phenophase[]> {\r\n        const params: any = {};\r\n        const url = rank === TaxonomicSpeciesRank.SPECIES\r\n            ? this.serviceUtils.apiUrl('/npn_portal/phenophases/getPhenophasesForSpecies.json')\r\n            : this.serviceUtils.apiUrl('/npn_portal/phenophases/getPhenophasesForTaxon.json')\r\n        let o;\r\n        switch(rank) {\r\n            case TaxonomicSpeciesRank.SPECIES:\r\n                o = species as Species;\r\n                params.species_id = o.species_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.CLASS:\r\n                o = species as TaxonomicClass;\r\n                params.class_id = o.class_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.ORDER:\r\n                o = species as TaxonomicOrder;\r\n                params.order_id = o.order_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.FAMILY:\r\n                o = species as TaxonomicFamily;\r\n                params.family_id = o.family_id;\r\n                break;\r\n            case TaxonomicSpeciesRank.GENUS:\r\n                o = species as TaxonomicGenus;\r\n                params.genus_id = o.genus_id;\r\n                break;\r\n        }\r\n        \r\n        if (date) {\r\n            params.date = this.datePipe.transform(date, 'y-MM-dd')\r\n        } else {\r\n            params.return_all = true;\r\n        }\r\n        return this.serviceUtils.cachedGet(url,params)\r\n            .then(phases => phases && phases.length\r\n                ? this.removeRedundantPhenodefinitions(phases[0].phenophases as Phenophase[])\r\n                : []);\r\n    }\r\n\r\n    getAllPhenophases(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank): Promise<Phenophase[]> {\r\n        return this._getPhenophases(species,rank);\r\n    }\r\n\r\n    getAllPhenodefinitions(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank): Promise<Phenophase[]> {\r\n        return this._getPhenodefinitions(species,rank);\r\n    }\r\n\r\n    getPhenophasesForDate(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, date: Date): Promise<Phenophase[]> {\r\n        return this._getPhenophases(species, rank, date);\r\n    }\r\n\r\n    getPhenodefinitionsForDate(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, date: Date): Promise<Phenophase[]> {\r\n        return this._getPhenodefinitions(species, rank, date);\r\n    }\r\n\r\n    getPhenophasesForYear(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, year: number) {\r\n        let jan1 = new Date(year, 0, 1),\r\n            dec31 = new Date(year, 11, 31);\r\n        return Promise.all([\r\n            this.getPhenophasesForDate(species, rank, jan1),\r\n            this.getPhenophasesForDate(species, rank, dec31)\r\n        ]).then(lists => this.mergeRedundantPhenophaseLists(lists));\r\n    }\r\n\r\n    getPhenodefinitionsForYear(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, year: number) {\r\n        let jan1 = new Date(year, 0, 1),\r\n            dec31 = new Date(year, 11, 31);\r\n        return Promise.all([\r\n            this.getPhenodefinitionsForDate(species, rank, jan1),\r\n            this.getPhenodefinitionsForDate(species, rank, dec31)\r\n        ]).then(lists => this.mergeRedundantPhenodefinitionLists(lists));\r\n    }\r\n\r\n    getPhenophasesForYears(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, years:number[]): Promise<Phenophase[]> {\r\n        return Promise.all(years.map(y => this.getPhenophasesForYear(species, rank, y)))\r\n                .then(lists => this.mergeRedundantPhenophaseLists(lists));\r\n    }\r\n\r\n    getPhenodefinitionsForYears(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, years:number[]): Promise<Phenophase[]> {\r\n        return Promise.all(years.map(y => this.getPhenodefinitionsForYear(species, rank, y)))\r\n                .then(lists => this.mergeRedundantPhenodefinitionLists(lists));\r\n    }\r\n\r\n    getPhenophasesContiguousYears(species: TaxonomicSpeciesType, rank:TaxonomicSpeciesRank, startYear?: number, endYear?: number): Promise<Phenophase[]> {\r\n        if(startYear) {\r\n            if (startYear && !endYear) {\r\n                throw new Error('Missing end year.');\r\n            }\r\n            if (startYear > endYear) {\r\n                throw new Error('start year cannot be greater than end');\r\n            }\r\n            let years = [startYear], i = startYear;\r\n            while (i++ < endYear) {\r\n                years.push(i);\r\n            }\r\n            return this.getPhenophasesForYears(species,rank,years);\r\n        }\r\n        return this.getAllPhenophases(species,rank);\r\n    }\r\n\r\n    private removeRedundantPhenophases(list) {\r\n        let seen = [];\r\n        return list.filter(function (pp) {\r\n            if (seen[pp.phenophase_id]) {\r\n                return false;\r\n            }\r\n            seen[pp.phenophase_id] = pp;\r\n            return true;\r\n        });\r\n    }\r\n\r\n    private removeRedundantPhenodefinitions(list){\r\n        let seen = {};\r\n        return list.filter(function (pp) {\r\n            if (seen[pp.phenophase_id]) {\r\n                return false;\r\n            }\r\n            seen[pp.phenophase_id] = pp;\r\n            return true;\r\n        });\r\n    }\r\n    private mergeRedundantPhenophaseLists(lists) {\r\n        return this.removeRedundantPhenophases(\r\n            lists.reduce(function (arr, l) {\r\n                return arr.concat(l);\r\n            }, []));\r\n    }\r\n\r\n    private mergeRedundantPhenodefinitionLists(lists) {\r\n        return this.removeRedundantPhenodefinitions(\r\n            lists.reduce(function (arr, l) {\r\n                return arr.concat(l);\r\n            }, []));\r\n    }\r\n}\r\n","\r\ninterface HasKingdom {\r\n    kingdom?: string;\r\n}\r\n\r\nexport interface Species extends HasKingdom {\r\n    species_id: string;\r\n    [x: string]: any;\r\n}\r\n\r\nexport interface TaxonomicClass extends HasKingdom {\r\n    class_id: number;\r\n    class_name: string;\r\n    class_common_name: string;\r\n}\r\n\r\nexport interface TaxonomicOrder extends HasKingdom {\r\n    order_id:number;\r\n    order_name:string;\r\n    order_common_name:string; // sometimes empty?\r\n}\r\n\r\nexport interface TaxonomicFamily extends HasKingdom {\r\n    family_id:number;\r\n    family_name:string;\r\n    family_common_name:string;\r\n}\r\n\r\nexport interface TaxonomicGenus extends HasKingdom {\r\n    genus_id:number;\r\n    genus:string;\r\n    genus_common_name:string;\r\n}\r\n\r\nexport interface TaxonomicSpecies extends TaxonomicClass,TaxonomicFamily,TaxonomicOrder,TaxonomicGenus,Species {\r\n    genus: string;\r\n    itis_taxonomic_sn: number;\r\n    number_observations?: number; // depends on the service getSpeciesFilter.json returns this\r\n    species_type?:any[]; // has type but not using\r\n}\r\n\r\nexport type TaxonomicSpeciesType = Species|TaxonomicClass|TaxonomicOrder|TaxonomicFamily|TaxonomicGenus;\r\n\r\nexport enum TaxonomicSpeciesRank {\r\n    SPECIES = 'species',\r\n    GENUS = 'genus',\r\n    FAMILY = 'family',\r\n    ORDER = 'order',\r\n    CLASS = 'class'\r\n}","export const STATIC_COLORS  = [\r\n    '#1f77b4','#ff7f0e','#2ca02c','#d62728','#222299', '#c51b8a',  '#8c564b', '#637939', '#843c39',\r\n    '#5254a3','#636363',\r\n    '#bcbd22', '#7b4173','#e7ba52', '#222299',  '#f03b20', '#1b9e77','#e377c2',  '#ef8a62', '#91cf60', '#9467bd'\r\n  ];\r\n/**\r\n * Fetches a color by numeric index.  The domain of colors is finite so if the\r\n * index overflows the array then it will wrap around as necessary.\r\n * I.e. if index=colors.length+1 index=0\r\n * @param index The numeric index to fetch a color for.\r\n */\r\nexport function getStaticColor(index:number):string {\r\n    return STATIC_COLORS[index%STATIC_COLORS.length];\r\n}","import { Injectable } from '@angular/core';\r\nimport { NpnServiceUtils } from './npn-service-utils.service';\r\nimport { Station } from './station';\r\n\r\n@Injectable()\r\nexport class StationService {\r\n    constructor(private serviceUtils:NpnServiceUtils){}\r\n\r\n    getStation(stationId:number):Promise<Station> {\r\n        // fetching an individual station is rather rare, not using the cache\r\n        // since if a user is poking around how likely is it they will click the same\r\n        // station marker repeatedly?\r\n        return this.serviceUtils.get(this.serviceUtils.apiUrl('/npn_portal/stations/getStationDetails.json'),{ids:`${stationId}`})\r\n            .then((results:Station[]) => results && results.length ? results[0] : null);\r\n    }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { NpnServiceUtils } from \"../common\";\r\nimport { Observable, from, of } from \"rxjs\";\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { Geometry } from \"geojson\";\r\n\r\n\r\nexport interface BoundaryType {\r\n    type_id: number;\r\n    name: string;\r\n    description: string;\r\n}\r\n\r\nexport interface FullGeometry {\r\n    geometry: Geometry;\r\n}\r\n\r\nexport interface Boundary {\r\n    boundary_id: number; \r\n    type_id: 1;\r\n    name: string;\r\n    short_name: string;\r\n    full: FullGeometry;\r\n}\r\n\r\nconst BOUNDARY_API_ROOT = '/v0/boundaries';\r\n\r\ninterface BoundaryCache {\r\n    [typeId:string]: Promise<Boundary[]>;\r\n}\r\n\r\n@Injectable()\r\nexport class BoundaryService {\r\n    private _boundaryCache:BoundaryCache = {};\r\n\r\n    constructor(private serviceUtils:NpnServiceUtils){}\r\n\r\n    getBoundaryTypes():Observable<BoundaryType[]> {\r\n        return from(\r\n            this.serviceUtils.cachedGet(this.serviceUtils.dataApiUrl2(`${BOUNDARY_API_ROOT}/types`))\r\n        );\r\n    }\r\n\r\n    getBoundaries(typeId:number):Observable<Boundary[]> {\r\n        if(!this._boundaryCache[typeId]) {\r\n            this._boundaryCache[typeId] = this.serviceUtils.get(\r\n                this.serviceUtils.dataApiUrl2(`${BOUNDARY_API_ROOT}`),\r\n                {type_id:`\"${typeId}\"`}\r\n            )\r\n            .then(boundaries => (boundaries||[]).sort((a,b) => a.name.localeCompare(b.name)));\r\n        }\r\n        return from(this._boundaryCache[typeId]);\r\n    }\r\n\r\n    boundariesToFeatureCollection(boundaries:Boundary[]):any/*<FeatureCollection>*/ {\r\n        return {\r\n            type: 'FeatureCollection',\r\n            features: boundaries.map(b => ({\r\n                type: 'Feature',\r\n                geometry: b.full.geometry,\r\n                properties: {...b,full:undefined}\r\n            }))\r\n        }\r\n    }\r\n}","import { MapLayerLegend } from './map-layer-legend';\r\nimport { GriddedPipeProvider } from './pipes';\r\nimport { WmsMapLayerLegend } from './wms-map-layer-legend';\r\n\r\nexport class DefaultMapLayerLegend extends WmsMapLayerLegend {\r\n    constructor(protected griddedPipes:GriddedPipeProvider) {\r\n        super(\r\n            null, // no corresponding layer so no gridded functionality\r\n            griddedPipes,\r\n            [\r\n                {quantity:-9999, color:'', original_label:'',label:''}, // first data always ignored.\r\n                {quantity: 0, color: 'rgb(62,38,168)', original_label: '', label: 'Jan'},\r\n                {quantity: 32, color: 'rgb(71,64,227)', original_label: '', label: 'Feb'},\r\n                {quantity: 60, color: 'rgb(70,96,252)', original_label: '', label: 'Mar'},\r\n                {quantity: 91, color: 'rgb(47,130,249)', original_label: '', label: 'Apr'},\r\n                {quantity: 121, color: 'rgb(35,160,229)', original_label: '', label: 'May'},\r\n                {quantity: 152, color: 'rgb(2,183,204)', original_label: '', label: 'Jun'},\r\n                {quantity: 182, color: 'rgb(46,196,164)', original_label: '', label: 'Jul'},\r\n                {quantity: 213, color: 'rgb(101,205,110)', original_label: '', label: 'Aug'},\r\n                {quantity: 244, color: 'rgb(182,197,50)', original_label: '', label: 'Sep'},\r\n                {quantity: 274, color: 'rgb(244,186,58)', original_label: '', label: 'Oct'},\r\n\r\n                {quantity: 305, color: 'rgb(249,216,44)', original_label: '', label: 'Nov'},\r\n                {quantity: 335, color: 'rgb(249,251,21)', original_label: '', label: 'Dec'},\r\n            ],{\r\n                name: 'Default',\r\n                legend_label_filter: {\r\n                    name: 'legendDoy'\r\n                }\r\n            },\r\n            null // styleDefinition\r\n        );\r\n    }\r\n\r\n    get layerName():string {\r\n        return 'no-layer';\r\n    }\r\n}\r\n/*\r\nhttps://bl.ocks.org/pstuffa/3393ff2711a53975040077b7453781a9\r\nschemeCategory20\r\nrgb(174,199,232) // light blue\r\nrgb(255,187,120) // light orange\r\nrgb(152,223,138) // light green\r\nrgb(255,152,150) // ligth red\r\nrgb(197,176,213) // light purple\r\nrgb(196,156,148) // light brown\r\nrgb(247, 182, 210) // light pink\r\nrgb(199, 199, 199) // light grey\r\nrgb(219, 219, 141) // light green 2\r\nrgb(158, 218, 229) // light aqua\r\n */","// this may not be the best or final home for this functionality...\r\nexport function googleFeatureBounds(feature) {\r\n    var geo = feature.getGeometry(),\r\n        type = geo.getType();\r\n    /*if(!type || /LineString/.test(type)) {\r\n        // TODO ? generate bounds of a [Multi]LineString?\r\n    } else {*/\r\n    if (type && /Polygon/.test(type)) {\r\n        var bounds = new google.maps.LatLngBounds(),\r\n            arr = geo.getArray(),\r\n            rings = type === 'Polygon' ?\r\n                arr :\r\n                arr.reduce(function (c, p) {\r\n                    c.push(p.getArray()[0]);\r\n                    return c;\r\n                }, []), i, j;\r\n        for (i = 0; i < rings.length; i++) {\r\n            var ringArr = rings[i].getArray();\r\n            for (j = 0; j < ringArr.length; j++) {\r\n                bounds.extend(new google.maps.LatLng(ringArr[j].lat(), ringArr[j].lng()));\r\n            }\r\n        }\r\n        return bounds;\r\n    }\r\n}","import {Inject,Injectable} from '@angular/core';\r\nimport {NPN_CONFIGURATION,NpnConfiguration} from '../common/index';\r\n\r\nexport const MAP_STYLES:any[] = [{\r\n    featureType: 'poi',\r\n    elementType: 'labels',\r\n    stylers: [{ visibility: 'off' }]\r\n}, {\r\n    featureType: 'transit.station',\r\n    elementType: 'labels',\r\n    stylers: [{ visibility: 'off' }]\r\n},\r\n{\r\n    featureType: 'poi.park',\r\n    stylers: [{ visibility: 'off' }]\r\n},\r\n{\r\n    featureType: 'landscape',\r\n    stylers: [{ visibility: 'off' }]\r\n}];\r\n\r\nconst EXTENT_DATE_FMT_REGEX = /^(\\d\\d\\d\\d)-0?(\\d+)-0?(\\d+)/;\r\n\r\nexport function parseExtentDate(s:string):Date {\r\n    let match = EXTENT_DATE_FMT_REGEX.exec(s.replace(/T.*$/, '')),\r\n    year = parseInt(match[1]),\r\n    month = parseInt(match[2]) - 1,\r\n    day = parseInt(match[3]);\r\n    return new Date(year, month, day);\r\n}\r\n\r\nexport interface NpnLayerFilterDef {\r\n    name: string;\r\n    args?: any[];\r\n    // WmsMapLayer stores some stuff here??\r\n    values?: any[];\r\n}\r\n\r\nexport enum MapLayerType {\r\n    STANDARD = 'standard',\r\n    PEST = 'pest'\r\n}\r\n\r\ninterface NpnLayerCommon {\r\n    name: string;\r\n    layerBasis?: string;\r\n    /** contains a description of a given layer.  this value can also be specified at the top level so that it applies to all layers in all categories (as the default). */\r\n    description?: string;\r\n    /** specifies a boolean indicating if a layer supports plotting of data on it or not (default true). */\r\n    supports_data?: boolean;\r\n    /** specifies an angular filter and optional arguments used to translate point data into strings for legends and map info windows. */\r\n    legend_label_filter?: NpnLayerFilterDef;\r\n    /** specifies an angular filter and optional arguments used to translate point data into strings for point data map info windows (if not specified then `legend_label_filter` will be used). */\r\n    gridded_label_filter?: NpnLayerFilterDef;\r\n    /** specifies an angualr filter and optional arguments used to filter extent values for layers. */\r\n    extent_values_filter?: NpnLayerFilterDef;\r\n    /** specifies anangular filter and optional arguments used to select a default value.  (if not specified the default provided by the server will be used). */\r\n    extent_default_filter?: NpnLayerFilterDef;\r\n    /** specifies a string that should be placed on the legend below the cell labels (units separated from legend labels). */\r\n    legend_units?: string;\r\n    legend_delimiter_every?: number;\r\n    /** specifies a boolean indicating if a layer supports plotting of time series data (default false). */\r\n    supports_time_series?: boolean;\r\n    /** if `supports_data` is true (or unspecified) the indicates that a given layer should only support plotting of data for the year of the currently selected extent on it (default false). */\r\n    current_year_only?: boolean;\r\n    /** defaults to `WmsLayerType.STANDARD` */\r\n    type?: MapLayerType;\r\n}\r\n\r\nexport enum MapLayerServiceType {\r\n    WMS = 'wms',\r\n    WCS = 'wcs'\r\n};\r\n\r\nexport interface MapLayerExtentValue {\r\n    /** The raw extent value from the WMS layer definition */\r\n    value: string;\r\n    /** If `value` represents a Date then the parsed Date object. */\r\n    date?: Date;\r\n    /** The value transformed into a readable label. */\r\n    label: string;\r\n    /** Add extent value to a service request's parameters */\r\n    addToParams: (params:any,serviceType:MapLayerServiceType) => void;\r\n}\r\n\r\nexport enum MapLayerExtentType {\r\n    DATE = 'date',\r\n    YEAR = 'year',\r\n    DOY = 'doy'\r\n}\r\n\r\nexport interface MapLayerExtent {\r\n    current?: MapLayerExtentValue;\r\n    label: string;\r\n    type: MapLayerExtentType;\r\n    values?: MapLayerExtentValue[];\r\n}\r\n\r\nexport interface MapLayerBoundingBox {\r\n    westBoundLongitude: number;\r\n    eastBoundLongitude: number;\r\n    southBoundLatitude: number;\r\n    northBoundLatitude: number;\r\n    getBounds: () => google.maps.LatLngBounds;\r\n}\r\n\r\nexport interface MapLayerStyle {\r\n    name: string;\r\n    title: string;\r\n    legend: string; // URL\r\n}\r\n\r\nexport interface MapLayerDefinition extends NpnLayerCommon {\r\n    title?: string;\r\n    abstract?: string;\r\n    /** Minimum width for legend style (e.g. '200px' or '50%') used to set the `min-width` CSS style on the corresponding legend. */\r\n    minLegendWidth?: string;\r\n    extent?: MapLayerExtent;\r\n    bbox?: MapLayerBoundingBox;\r\n    style?: MapLayerStyle;\r\n    /** A place for special map implementations to put special info... */\r\n    meta?: any;\r\n}\r\n\r\n// definition of separate over-rides document\r\nexport interface MapLayerDefinitionMap {\r\n    [name:string]: MapLayerDefinition;\r\n}\r\n\r\nexport interface MapLayerCategory extends NpnLayerCommon {\r\n    layers: MapLayerDefinition[];\r\n}\r\n\r\nexport interface MapLayerDefs {\r\n    description?: string;\r\n    categories: MapLayerCategory[];\r\n}\r\n\r\nexport interface LegendData {\r\n    color: string;\r\n    quantity: number;\r\n    original_label: string;\r\n    label: string;\r\n}\r\n\r\nexport interface GriddedPointData {\r\n    point: number;\r\n    legendData: LegendData;\r\n    formatted: string;\r\n}\r\n\r\nexport const CATEGORY_PEST = 'Phenoforecasts';\r\nexport const CATEGORY_TEMP_ACCUM_30_YR_AVG = 'Temperature Accumulations, Daily 30-year Average';\r\nexport const CATEGORY_TEMP_ACCUM_CURRENT = 'Temperature Accumulations, Current Day';\r\nexport const CATEGORY_TEMP_ACCUM_CURRENT_AK = 'Temperature Accumulations, Current Day, Alaska';\r\nexport const CATEGORY_TEMP_ACCUM_DAILY_ANOM = 'Temperature Accumulations, Daily Anomaly';\r\nexport const CATEGORY_SIX_HIST_ANNUAL = 'Spring Indices, Historical Annual';\r\nexport const CATEGORY_SIX_CURRENT_YEAR = 'Spring Indices, Current Year';\r\nexport const CATEGORY_SIX_CURRENT_YEAR_AK = 'Spring Indices, Current Year, Alaska';\r\nexport const CATEGORY_SIX_DAILY_ANOM = 'Spring Indices, Daily Anomaly';\r\nexport const CATEGORY_SIX_30_YR_AVG = 'Spring Indices, 30-Year Average';\r\n\r\n/**\r\n * Holds all current supported map layers broken down by category.  This structure\r\n * originated with the original visualization tool and is very meaningful in that\r\n * commonality in configuration can be configured on the parent category for a given\r\n * layer and optionally over-ridden below that (for this like pipes to translate values to\r\n * strings, etc.).\r\n * \r\n * IMPORTANT: See `visualizations/map/consolidated-map-layer-control.component.ts`\r\n * for the temp accumulations and six layers that code relies on the order\r\n * of the indexes of the nested layers for those two sets so do NOT change that\r\n * here.\r\n */\r\nexport const MAP_LAYERS:MapLayerDefs = {\r\n    \"description\": \"\",\r\n    \"categories\": [{\r\n        \"name\": CATEGORY_PEST,\r\n        \"supports_data\": false, // TODO they do support data but...\r\n        \"layerBasis\": \"gdd:agdd_50f\",\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [false]\r\n        },\r\n        \"gridded_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [true]\r\n        },\r\n        type: MapLayerType.PEST,\r\n        \"layers\": [{\r\n            name: 'apple_maggot',\r\n            title: 'Apple Maggot',\r\n            abstract: 'Apple maggot larvae cause damage to ripening fruit. If left untreated, these pest insects can spread across the entire tree. These insects primarily affect apple trees, but can also impact plum, apricot, pear, cherry and hawthorn trees. <a href=\"https://www.usanpn.org/data/forecasts/Apple_maggot\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 900\r\n            }\r\n        },{\r\n            name: 'asian_longhorned_beetle',\r\n            title: 'Asian Longhorned Beetle',\r\n            abstract: 'As a generalist pest, Asian longhorned beetle poses a great potential threat to eastern forests. It is currently contained in three small quarantined areas (a fourth was recently eradicated). Burning firewood where you buy it is critical to stopping the spread of this pest. <a href=\"https://www.usanpn.org/data/forecasts/Asian_Longhorned_beetle\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddSupports30YearAvg: false,\r\n                agddDefaultThreshold: 690\r\n            }\r\n        },{\r\n            name: 'bagworm',\r\n            title: 'Bagworm',\r\n            abstract: 'Bagworm caterpillars defoliate over 50 families of evergreen and deciduous trees and shrubs, primarily arborvitae, juniper, pine, and spruce. Stripping of leaves and needles is most noticeable in uppermost parts of plants. If left untreated, these pests are capable of extensive defoliation which can cause branch dieback or death. <a href=\"https://www.usanpn.org/data/forecasts/Bagworm\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 600\r\n            }\r\n        },{\r\n            name: 'bronze_birch_borer',\r\n            title: 'Bronze Birch Borer',\r\n            abstract: 'Bronze birch borer frequently kills birch trees by boring into the wood. <a href=\"https://www.usanpn.org/data/forecasts/Bronze_birch_borer\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 450\r\n            }\r\n        },{\r\n            name: 'eastern_tent_caterpillar',\r\n            title: 'Eastern Tent Caterpillar',\r\n            abstract: 'Eastern Tent Caterpillars are a native moth and while they can defoliate trees, the trees rarely die as a consequence. <a href=\"https://www.usanpn.org/data/forecasts/Eastern_tent_caterpillar\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddSupports30YearAvg: false,\r\n                agddDefaultThreshold: 90\r\n            }\r\n        },{\r\n            name: 'emerald_ash_borer',\r\n            title: 'Emerald Ash Borer',\r\n            abstract: 'Emerald ash borer is a beetle that causes significant harm to ash trees throughout the eastern United States. <a href=\"https://www.usanpn.org/data/forecasts/EAB\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 450\r\n            }\r\n        },{\r\n            name: 'gypsy_moth',\r\n            title: 'Gypsy Moth',\r\n            abstract: 'European gypsy moth caterpillars feed on deciduous trees, causing major defoliation and tree mortality. They are considered one of the worst forest pests in the United States. <a href=\"https://www.usanpn.org/data/forecasts/Gypsy_moth\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddSupports30YearAvg: false,\r\n                agddBaseTemp: 37.4,\r\n                agddDefaultThreshold: 571\r\n            }\r\n        },{\r\n            name: 'hemlock_woolly_adelgid',\r\n            layerBasis: 'gdd:agdd', // based on a different map than the others.\r\n            title: 'Hemlock Woolly Adelgid',\r\n            abstract: 'Hemlock woolly adelgid can be deadly to hemlock trees and, in the eastern United States, lacks enemies that keep their populations in check. Researchers wish to identify the optimal window to release insect predators; you can support this effort by observing hemlock woolly adelgid life cycle stages using Natures Notebook. <a href=\"https://www.usanpn.org/data/forecasts/HWA\" target=\"_blank\">Learn more</a>'\r\n        },{\r\n            name: 'magnolia_scale',\r\n            title: 'Magnolia Scale',\r\n            abstract: 'Magnolia scale is a pest native to the Eastern United States that affects magnolia trees and tulip trees. They cause stress to their host trees by removing sap which can lead to yellowing leaves, twig dieback, and even death. <a href=\"https://www.usanpn.org/data/forecasts/Magnolia_scale\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 1938\r\n            }\r\n        },{\r\n            name: 'lilac_borer',\r\n            title: 'Lilac Borer',\r\n            abstract: 'Lilac borer is a clear-wing moth that can damage lilac, ash, and privet trees and shrubs by burrowing into the heartwood. <a href=\"https://www.usanpn.org/data/forecasts/Lilac_borer\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 500\r\n            }\r\n        },{\r\n            name: 'pine_needle_scale',\r\n            title: 'Pine Needle Scale',\r\n            abstract: 'Pine needle scale is a native pest that affects ornamental pines and Christmas tree plantations. <a href=\"https://www.usanpn.org/data/forecasts/Pine_needle_scale\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddSupports30YearAvg: false,\r\n                agddDefaultThreshold: 298\r\n            }\r\n        },{\r\n            name: 'winter_moth',\r\n            title: 'Winter Moth',\r\n            abstract: 'Winter moth is a non-native insect pest that causes damage to deciduous trees, particularly maples and oaks. <a href=\"https://www.usanpn.org/data/forecasts/Winter_moth\" target=\"_blank\">Learn more</a>',\r\n            meta: {\r\n                agddDefaultThreshold: 20\r\n            }\r\n        }]\r\n    },{\r\n        \"name\": CATEGORY_TEMP_ACCUM_30_YR_AVG,\r\n        \"supports_data\": false,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [false]\r\n        },\r\n        \"gridded_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [true]\r\n        },\r\n        \"extent_default_filter\": {\r\n            \"name\": \"agddDefaultTodayElevation\"\r\n        },\r\n        \"legend_units\" : \"Growing Degree Days\",\r\n        \"legend_delimiter_every\" : 2000,\r\n        \"layers\":[{\r\n                \"name\": \"gdd:30yr_avg_agdd\"\r\n            },{\r\n                \"name\": \"gdd:30yr_avg_agdd_50f\"\r\n            }]\r\n    },{\r\n        \"name\": CATEGORY_TEMP_ACCUM_CURRENT,\r\n        \"supports_data\": false,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [false]\r\n        },\r\n        \"gridded_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [true]\r\n        },\r\n        \"extent_default_filter\": {\r\n            \"name\": \"agddDefaultTodayTime\"\r\n        },\r\n        \"legend_units\" : \"Growing Degree Days\",\r\n        \"legend_delimiter_every\" : 2000,\r\n        \"supports_time_series\": true,\r\n        \"layers\":[{\r\n                \"name\": \"gdd:agdd\"\r\n            },{\r\n                \"name\": \"gdd:agdd_50f\"\r\n            }]\r\n    },{\r\n        \"name\": CATEGORY_TEMP_ACCUM_CURRENT_AK,\r\n        \"supports_data\": false,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [false]\r\n        },\r\n        \"gridded_label_filter\": {\r\n            \"name\": \"legendGddUnits\",\r\n            \"args\": [true]\r\n        },\r\n        \"extent_values_filter\": {\r\n            \"name\": \"extentDates\",\r\n            \"args\": [null,\"today\"]\r\n        },\r\n        \"legend_units\" : \"Growing Degree Days\",\r\n        \"legend_delimiter_every\" : 2000,\r\n        \"layers\":[{\r\n            \"name\": \"gdd:agdd_alaska\"\r\n        },{\r\n            \"name\": \"gdd:agdd_alaska_50f\"\r\n        }]\r\n    },{\r\n        \"name\": CATEGORY_TEMP_ACCUM_DAILY_ANOM,\r\n        \"supports_data\": false,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendAgddAnomaly\",\r\n            \"args\": [false]\r\n        },\r\n        \"gridded_label_filter\": {\r\n            \"name\": \"legendAgddAnomaly\",\r\n            \"args\": [true]\r\n        },\r\n        \"extent_default_filter\": {\r\n            \"name\": \"agddDefaultTodayTime\"\r\n        },\r\n        \"legend_units\" : \"Growing Degree Days\",\r\n        \"legend_delimiter_every\" : 100,\r\n        \"layers\":[{\r\n                \"name\": \"gdd:agdd_anomaly\"\r\n            },{\r\n                \"name\": \"gdd:agdd_anomaly_50f\"\r\n            }]\r\n    },{\r\n        \"name\": CATEGORY_SIX_HIST_ANNUAL,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendDoy\"\r\n        },\r\n        \"current_year_only\": true,\r\n        \"layers\":[{\r\n\t\t\t\t\"name\": \"si-x:average_leaf_prism\"\r\n            },{\r\n\t\t\t\t\"name\": \"si-x:average_bloom_prism\"\r\n            },{\r\n                \"name\": \"si-x:arnoldred_leaf_prism\"\r\n            },{\r\n                \"name\": \"si-x:arnoldred_bloom_prism\"\r\n            },{\r\n                \"name\": \"si-x:lilac_leaf_prism\"\r\n            },{\r\n                \"name\": \"si-x:lilac_bloom_prism\"\r\n            },{\r\n                \"name\": \"si-x:zabelli_leaf_prism\"\r\n            },{\r\n                \"name\": \"si-x:zabelli_bloom_prism\"\r\n            }]\r\n    },{\r\n        \"name\": CATEGORY_SIX_CURRENT_YEAR,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendDoy\"\r\n        },\r\n        \"extent_default_filter\": {\r\n            \"name\": \"agddDefaultTodayTime\"\r\n        },\r\n        \"current_year_only\": true,\r\n        \"layers\": [{\r\n\t\t\t\t\"name\": \"si-x:average_leaf_ncep\"\r\n            },{\r\n\t\t\t\t\"name\": \"si-x:average_bloom_ncep\"\r\n            },{\r\n                \"name\": \"si-x:arnoldred_leaf_ncep\"\r\n            },{\r\n                \"name\": \"si-x:arnoldred_bloom_ncep\"\r\n            },{\r\n                \"name\": \"si-x:lilac_leaf_ncep\"\r\n            },{\r\n                \"name\": \"si-x:lilac_bloom_ncep\"\r\n            },{\r\n                \"name\": \"si-x:zabelli_leaf_ncep\"\r\n            },{\r\n                \"name\": \"si-x:zabelli_bloom_ncep\"\r\n            }]\r\n    },{\r\n        \"name\": CATEGORY_SIX_CURRENT_YEAR_AK,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendDoy\"\r\n        },\r\n        \"extent_values_filter\": {\r\n            \"name\": \"extentDates\",\r\n            \"args\": [null,\"today\"]\r\n        },\r\n        \"current_year_only\": true,\r\n        \"layers\": [{\r\n            \"name\": \"si-x:average_leaf_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:average_bloom_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:arnoldred_leaf_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:arnoldred_bloom_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:lilac_leaf_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:lilac_bloom_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:zabelli_leaf_ncep_alaska\"\r\n        },{\r\n            \"name\": \"si-x:zabelli_bloom_ncep_alaska\"\r\n        }]\r\n    },{\r\n        \"name\": CATEGORY_SIX_DAILY_ANOM,\r\n        \"supports_data\": false,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendSixAnomaly\"\r\n        },\r\n        \"extent_default_filter\": {\r\n            \"name\": \"agddDefaultTodayTime\"\r\n        },\r\n        \"layers\": [{\r\n                \"name\": \"si-x:leaf_anomaly\"\r\n            },{\r\n                \"name\": \"si-x:bloom_anomaly\"\r\n            }]\r\n    },{\r\n        \"name\": CATEGORY_SIX_30_YR_AVG,\r\n        \"legend_label_filter\": {\r\n            \"name\": \"legendDoy\"\r\n        },\r\n        \"extent_default_filter\": {\r\n            \"name\": \"agddDefaultTodayElevation\"\r\n        },\r\n        \"layers\": [{\r\n                \"name\": \"si-x:30yr_avg_six_leaf\"\r\n            },{\r\n                \"name\": \"si-x:30yr_avg_six_bloom\"\r\n            }]\r\n    }]\r\n};\r\n\r\n// not safe to change since the capabilities document format changes based on version\r\n// so a version change -may- require code changes wrt interpreting the document\r\nexport const WMS_VERSION = '1.1.1';\r\nexport const BOX_SIZE = 256;\r\nexport const BASE_WMS_ARGS = {\r\n    service: 'WMS',\r\n    request: 'GetMap',\r\n    version: WMS_VERSION,\r\n    layers: undefined, // gets filled in per layer\r\n    styles: '',\r\n    format: 'image/png',\r\n    transparent: true,\r\n    height: BOX_SIZE,\r\n    width: BOX_SIZE,\r\n    srs: 'EPSG:3857' // 'EPSG:4326'\r\n};\r\n\r\n@Injectable()\r\nexport class GriddedUrls {\r\n    readonly geoServerUrl:string;\r\n    readonly wmsBaseUrl;\r\n    readonly wmsCapabilitiesUrl;\r\n\r\n    constructor(@Inject(NPN_CONFIGURATION) public config:NpnConfiguration) {\r\n        this.geoServerUrl = config.geoServerRoot;\r\n        this.wmsBaseUrl = `${this.geoServerUrl}/wms`;\r\n        this.wmsCapabilitiesUrl = `${this.wmsBaseUrl}?service=wms&version=${WMS_VERSION}&request=GetCapabilities`;\r\n    }\r\n}\r\n","export * from './public_api';\r\n","module.exports = \":host {\\n  display: block; }\\n  :host.standard {\\n    height: 125px; }\\n  :host.pest {\\n    height: 200px;\\n    width: 460px !important; }\\n  :host.pest.emerald_ash_borer {\\n      height: 245px; }\\n  :host.pest.hemlock_woolly_adelgid {\\n      height: 175px; }\\n  :host.no-layer {\\n    height: 95px; }\\n  .gridded-legend {\\n  width: 100%;\\n  height: 100%; }\\n\"","import { Component, Input, ElementRef, SimpleChanges, HostListener, HostBinding } from '@angular/core';\r\n\r\nimport { MapLayerLegend } from './map-layer-legend';\r\n\r\nimport { Selection } from 'd3-selection';\r\nimport * as d3 from 'd3';\r\n\r\n@Component({\r\n    selector: 'map-layer-legend',\r\n    template:`\r\n    <svg class=\"gridded-legend\"></svg>\r\n    `,\r\n    styleUrls:[\r\n        './map-layer-legend.component.scss'\r\n    ]\r\n})\r\nexport class MapLayerLegendComponent {\r\n    @Input()\r\n    legendTitle:string;\r\n    @Input()\r\n    legend:MapLayerLegend;\r\n\r\n    private svg: Selection<any,any,any,any>;\r\n\r\n    constructor(protected rootElement: ElementRef) {}\r\n\r\n    @HostBinding('class')\r\n    get legendClass() {\r\n        const {layerType,layerName} = this.legend;\r\n        return `${layerType||''} ${layerName ? layerName.replace(/:/g,'_') : ''}`;\r\n    }\r\n\r\n    @HostBinding('style.min-width')\r\n    get minLegendWidth():string {\r\n        return this.legend.ldef.minLegendWidth||null;\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        this.svg = d3.select(this.rootElement.nativeElement).select('svg');\r\n    }\r\n\r\n    ngOnChanges(changes:SimpleChanges):void {\r\n        setTimeout(() => this.redraw());\r\n    }\r\n\r\n    @HostListener('window:resize')\r\n    redraw() {\r\n        if(this.svg) {\r\n            this.svg.selectAll('g').remove();\r\n            if(this.legend) {\r\n                this.legend.redraw(this.svg,this.legendTitle);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import * as $jq_ from 'jquery';\r\nconst $jq = $jq_;\r\n\r\nimport { MapLayer } from './map-layer';\r\nimport { GriddedPipeProvider } from './pipes';\r\n\r\nimport { Selection } from 'd3-selection';\r\nimport { MapLayerDefinition, MapLayerServiceType, LegendData, GriddedPointData, MapLayerType } from './gridded-common';\r\nimport { WcsDataService } from './wcs-data.service';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nconst IDENTITY = d => d;\r\n\r\nexport abstract class MapLayerLegend {\r\n    private layer:MapLayer;\r\n    private lformat:Function;\r\n    private gformat:Function;\r\n    private title_data:LegendData;\r\n    private data:LegendData[];\r\n\r\n    constructor(protected wcsDataService:WcsDataService,\r\n                protected griddedPipes:GriddedPipeProvider,\r\n                protected color_map:(any|LegendData[]),\r\n                /*\r\n                NOTE: per the original implementation which binds extents directly into the definition this is public\r\n                may want to later revisit some abstraction, used externally via WmsMapLegendComponent\r\n                 */\r\n                public ldef:MapLayerDefinition,\r\n                protected styleDefinition:any) {\r\n            console.log('MapLayerLegend.color_map',color_map);\r\n            console.log('MapLayerLegend.ldef',ldef);\r\n            console.log('MapLayerLegend.styleDefinition',styleDefinition);\r\n            let get_filter = (filter_def) => {\r\n                let pipe = this.griddedPipes.get(filter_def.name);\r\n                if(!pipe) {\r\n                    console.error(`MapLayerLegend: Unable to find pipe named ${filter_def.name}`);\r\n                }\r\n                return function(l,q) {\r\n                    let args = [q];\r\n                    if(filter_def.args) {\r\n                        args = args.concat(filter_def.args);\r\n                    }\r\n                    return pipe.transform.apply(pipe, args);\r\n                };\r\n            };\r\n            this.lformat = ldef.legend_label_filter ? get_filter(ldef.legend_label_filter) : IDENTITY;\r\n            this.gformat = ldef.gridded_label_filter ? get_filter(ldef.gridded_label_filter) : undefined;\r\n            let data:LegendData[];\r\n            if(Array.isArray(color_map)) {\r\n                data = color_map;\r\n            } else {\r\n                let entries = color_map.find('ColorMapEntry');\r\n                if(entries.length === 0) {\r\n                    entries = color_map.find('sld\\\\:ColorMapEntry');\r\n                }\r\n                data = entries.toArray().reduce((arr,entry,i) => {\r\n                    var e = $jq(entry),\r\n                        q = parseFloat(e.attr('quantity')),\r\n                        l = e.attr('label');\r\n                    arr.push({\r\n                        color: e.attr('color'),\r\n                        quantity: q,\r\n                        original_label: l,\r\n                        label: i === 0 ? l : this.lformat(l,q) // why the special case for index 0?\r\n                    });\r\n                    return arr;\r\n                },[]);\r\n            }\r\n            this.title_data = data[0];\r\n            this.data = data.slice(1);\r\n    }\r\n\r\n    setLayer(l:MapLayer):MapLayerLegend {\r\n        this.layer = l;\r\n        return this;\r\n    }\r\n\r\n    getLayer():MapLayer {\r\n        return this.layer;\r\n    }\r\n\r\n    get layerType():MapLayerType {\r\n        return this.layer\r\n            ? this.layer.layerType\r\n            : null;\r\n    }\r\n\r\n    get layerName():string {\r\n        return this.layer \r\n            ? this.layer.layerName\r\n            : null;\r\n    }\r\n\r\n    getData():LegendData[] {\r\n        return this.data;\r\n    }\r\n\r\n    getStyleDefinition():any {\r\n        return this.styleDefinition;\r\n    }\r\n\r\n    getTitle():string {\r\n        return this.title_data.label;\r\n    }\r\n\r\n    getColors():string[] {\r\n        return this.data.map(d => d.color);\r\n    }\r\n\r\n    getQuantities():number[] {\r\n        return this.data.map(d => d.quantity);\r\n    }\r\n\r\n    getLabels():string[] {\r\n        return this.data.map(d => d.label);\r\n    }\r\n\r\n    getOriginalLabels():string[] {\r\n        return this.data.map(d => d.original_label);\r\n    }\r\n\r\n    formatPointData(q):string {\r\n        return (this.gformat||this.lformat)(q,q);\r\n    }\r\n\r\n    getPointData(q):LegendData {\r\n        var i,d,n;\r\n        for(i = 0; i < this.data.length; i++) {\r\n            d = this.data[i];\r\n            n = (i+1) < this.data.length ? this.data[i+1] : undefined;\r\n            if(q == d.quantity) {\r\n                return d;\r\n            }\r\n            if(n && q >= d.quantity && q < n.quantity) {\r\n                return d;\r\n            }\r\n        }\r\n    }\r\n\r\n    getGriddedPointData(latLng:google.maps.LatLng):Observable<GriddedPointData> {\r\n        const augment = (params:any) => {\r\n            if(this.layer.extent && this.layer.extent.current) {\r\n                this.layer.extent.current.addToParams(params,MapLayerServiceType.WCS)\r\n            }\r\n        };\r\n        return this.wcsDataService.getGriddedData(\r\n            this.layer.layerBasis,\r\n            latLng,\r\n            5,\r\n            augment\r\n        ).pipe(\r\n            map((tuples:number[]) => {\r\n                console.log(`MapLayerLegend: gridded tuples`,tuples);\r\n                const point = tuples && tuples.length ? tuples[0] : undefined;\r\n                if(point === -9999 || isNaN(point)) {\r\n                    return null;\r\n                }\r\n                const legendData = this.getPointData(point);\r\n                const formatted = this.formatPointData(point);\r\n                const result = {point,legendData,formatted};\r\n                console.log('MapLayerLegend: gridded result',result);\r\n                return result;\r\n            })\r\n        );\r\n    }\r\n\r\n    abstract redraw(svg:Selection<any,any,any,any>,legendTitle:string):void;\r\n}\r\n\r\n\r\n","import {MapLayerDefinition, GriddedUrls, MapLayerType, MapLayerExtent, MapLayerExtentType} from './gridded-common';\r\nimport { GriddedPipeProvider } from './pipes';\r\nimport { NpnMapLayerService } from './npn-map-layer.service';\r\nimport { MapLayerLegend } from './map-layer-legend';\r\nimport { SupportsOpacity } from './supports-opacity-control.component';\r\n\r\nexport abstract class MapLayer implements SupportsOpacity {\r\n    protected griddedPipes:GriddedPipeProvider;\r\n    protected griddedUrls:GriddedUrls;\r\n    protected opacity:number = 0.75;\r\n\r\n    constructor(\r\n        protected map:google.maps.Map,\r\n        protected layer_def:MapLayerDefinition,\r\n        protected layerService:NpnMapLayerService\r\n    ) {\r\n        this.griddedPipes = layerService.griddedPipes;\r\n        this.griddedUrls = layerService.griddedUrls;\r\n    }\r\n\r\n    /**\r\n     * Callers are responsible for turning a layer off\r\n     * before switching the underlying map and turning it back on.\r\n     * \r\n     * @param map The new map.\r\n     */\r\n    setMap(map:google.maps.Map) {\r\n        this.map = map;\r\n    }\r\n\r\n    getMap():google.maps.Map {\r\n        return this.map;\r\n    }\r\n\r\n    get layerDefinition():MapLayerDefinition { return this.layer_def; }\r\n\r\n    get layerBasis():string {\r\n        return this.layer_def && this.layer_def.layerBasis\r\n            ? this.layer_def.layerBasis\r\n            : this.layerName;\r\n    }\r\n    get layerName():string {\r\n        return this.layer_def\r\n            ? this.layer_def.name\r\n            : null;\r\n    }\r\n    get layerType():MapLayerType {\r\n        return  this.layer_def && this.layer_def.type\r\n            ? this.layer_def.type\r\n            : MapLayerType.STANDARD;\r\n    }\r\n    get extent():MapLayerExtent {\r\n        return this.layer_def\r\n            ? this.layer_def.extent\r\n            : null;\r\n    }\r\n    get extentType():MapLayerExtentType { \r\n        return (this.layer_def && this.layer_def.extent)\r\n            ? this.layer_def.extent.type\r\n            : null;\r\n    }\r\n    get title():string {\r\n        return (this.layer_def && this.layer_def.title)\r\n            ? this.layer_def.title // this.layer_def.title.replace(/^(.*?)\\s+-\\s+(.*)$/,'$2')\r\n            : undefined;\r\n    }\r\n\r\n    hasAbstract() {\r\n        return this.layer_def\r\n            ? !!this.layer_def.abstract\r\n            : false;\r\n    }\r\n\r\n    getAbstract() {\r\n        return (this.layer_def && this.layer_def.abstract)\r\n            ? this.layer_def.abstract.replace(/\\s*developer notes.*$/i,'')\r\n            : undefined;\r\n    }\r\n    \r\n    getLegend():Promise<MapLayerLegend> {\r\n        return this.layer_def\r\n            ? this.layerService.getLegend(this.layer_def)\r\n                .then(legend => legend.setLayer(this))\r\n            : Promise.resolve(null);\r\n    }\r\n\r\n    /**\r\n     * Sets the current opacity (0-1) for this layer.\r\n     * Sub-classes will over-ride to pass along the value\r\n     */\r\n    setOpacity(opacity:number) { this.opacity = opacity; }\r\n    /** Gets the current opacity for this layer. */\r\n    getOpacity():number { return this.opacity; }\r\n\r\n    /** Turn the layer on. */\r\n    abstract on():MapLayer;\r\n    /** Then the layer off. */\r\n    abstract off():MapLayer;\r\n    /** Called when a layer's current extent changes to update the layer in place. */\r\n    abstract bounce():MapLayer;\r\n}\r\n\r\n// NOTE: this function replaces all encoded spaces (%20) with '+'\r\n// this is perhaps a kludge solution to the fact that %20 is three chars while + is one\r\n// and for some map layers sending a value for sld_body using %20 can result in\r\n// overflowing the maximum length of a URI breaking thos emaps.  This is a simple \r\n// workaround to that issue.\r\nexport function encodeHttpParams(params) {\r\n    if(!params) {\r\n        return '';\r\n    }\r\n    let parts = [];\r\n    Object.keys(params).forEach(k => {\r\n        if(params[k]) {\r\n            let ok = encodeURIComponent(k),\r\n                ov = encodeURIComponent(params[k]).replace(/%20/g,'+');\r\n            parts.push(`${ok}=${ov}`);\r\n        }\r\n    });\r\n    return parts.join('&');\r\n}\r\n\r\n// this code converts coordinates from ESPG:4326 to ESPG:3857, it originated @\r\n// http://gis.stackexchange.com/questions/52188/google-maps-wms-layer-with-3857\r\n// that author stated it came from StackOverflow which I tried to find to attribute properly but could not.\r\n// the issue here is that if requests are sent to the map service with ESPG:4326 coordinates everything\r\n// appears accurate when tightly zoomed however as you zoom out beyond a certain point the layers begin to\r\n// migrate north, the farther zoomed out the more drastic the migration (e.g. from Mexico into N. Canada)\r\n// while dealing in traditional lat/lng for google maps they are actually projected in 3857 (metres, not meters).\r\n// the main thing is that 4326 coordinates are projected onto a sphere/ellipsoid while 3857 are translated to\r\n// a flat surface.\r\n// unfortunately while google maps projection must be performing such transformations it doesn't expose this ability.\r\nexport function srsConversion(latLng) {\r\n    if ((Math.abs(latLng.lng()) > 180 || Math.abs(latLng.lat()) > 90)) {\r\n        return;\r\n    }\r\n\r\n    var num = latLng.lng() * 0.017453292519943295;\r\n    var x = 6378137.0 * num;\r\n    var a = latLng.lat() * 0.017453292519943295;\r\n\r\n    return {lng: x, lat: 3189068.5 * Math.log((1.0 + Math.sin(a)) / (1.0 - Math.sin(a)))};\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { DatePipe, DecimalPipe } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { MatSliderModule, MatSelectModule } from '@angular/material';\r\n\r\nimport { NpnMapLayerService } from './npn-map-layer.service';\r\nimport { NpnCommonModule } from '../common/index';\r\nimport { MapLayerLegendComponent } from './map-layer-legend.component';\r\nimport { SupportsOpacityControl } from './supports-opacity-control.component';\r\nimport { GriddedUrls } from './gridded-common';\r\nimport { WcsDataService } from './wcs-data.service';\r\nimport { BoundaryService } from './boundary.service';\r\n\r\nimport {\r\n    LegendGddUnitsPipe, AgddDefaultTodayElevationPipe, LegendAgddAnomalyPipe,\r\n    AgddDefaultTodayTimePipe, LegendSixAnomalyPipe, LegendDoyPipe, ExtentDatesPipe,\r\n    ThirtyYearAvgDayOfYearPipe,GriddedPipeProvider\r\n} from './pipes';\r\n\r\n@NgModule({\r\n    imports: [\r\n        FormsModule, ReactiveFormsModule,\r\n        MatSliderModule,\r\n        MatSelectModule,\r\n        NpnCommonModule\r\n    ],\r\n    declarations: [\r\n        MapLayerLegendComponent,\r\n        SupportsOpacityControl,\r\n        LegendGddUnitsPipe, AgddDefaultTodayElevationPipe, LegendAgddAnomalyPipe,\r\n        AgddDefaultTodayTimePipe, LegendSixAnomalyPipe, LegendDoyPipe, ExtentDatesPipe,\r\n        ThirtyYearAvgDayOfYearPipe,\r\n    ],\r\n    exports: [\r\n        MapLayerLegendComponent,\r\n        SupportsOpacityControl,\r\n    ],\r\n    providers: [\r\n        DatePipe, DecimalPipe,\r\n        LegendGddUnitsPipe, AgddDefaultTodayElevationPipe, LegendAgddAnomalyPipe,\r\n        AgddDefaultTodayTimePipe, LegendSixAnomalyPipe, LegendDoyPipe, ExtentDatesPipe,\r\n        ThirtyYearAvgDayOfYearPipe, GriddedPipeProvider,\r\n        NpnMapLayerService,\r\n        GriddedUrls,\r\n        WcsDataService,\r\n        BoundaryService\r\n    ]\r\n})\r\nexport class NpnGriddedModule { }","import { Injectable } from '@angular/core';\r\nimport * as $jq_ from 'jquery';\r\nconst $jq = $jq_;\r\n\r\nimport { NpnServiceUtils } from '../common/index';\r\n// TODO MAP_LAYERS here has been coded into the application\r\n// it may differ from the FWS apps to the vis-tool???\r\n// depending on how that shakes out perhaps a \"provider\" Injectable\r\n// that individual apps then wire into this service instance??\r\nimport {\r\n    MAP_LAYERS,\r\n    GriddedUrls,\r\n    MapLayerDefs,\r\n    MapLayerDefinition,\r\n    parseExtentDate,\r\n    MapLayerExtentValue,\r\n    MapLayerExtent,\r\n    MapLayerBoundingBox,\r\n    MapLayerStyle,\r\n    MapLayerExtentType,\r\n    WMS_VERSION,\r\n    MapLayerType,\r\n    MapLayerServiceType,\r\n    MapLayerDefinitionMap\r\n} from './gridded-common';\r\nimport { MapLayer } from './map-layer';\r\nimport { PestMapLayer } from \"./pest-map-layer\";\r\nimport { WmsMapLayer } from \"./wms-map-layer\";\r\nimport { GriddedPipeProvider } from './pipes';\r\nimport { MapLayerLegend } from './map-layer-legend';\r\nimport { PestMapLayerLegend } from \"./pest-map-layer-legend\";\r\nimport { WmsMapLayerLegend } from \"./wms-map-layer-legend\";\r\nimport { WcsDataService } from './wcs-data.service';\r\nimport { DefaultMapLayerLegend } from './default-map-layer-legend';\r\nimport { MapsAPILoader } from '@agm/core';\r\n\r\nconst DEEP_COPY = (o) => JSON.parse(JSON.stringify(o));\r\n\r\n@Injectable()\r\nexport class NpnMapLayerService {\r\n    private legends:any = {};\r\n    private layerDefs:any;\r\n\r\n    constructor(\r\n        public serviceUtils:NpnServiceUtils,\r\n        public wcsDataService:WcsDataService,\r\n        public griddedPipes:GriddedPipeProvider,\r\n        public griddedUrls:GriddedUrls,\r\n        private mapsApiLoader: MapsAPILoader\r\n    ) {}\r\n\r\n    newLayer(map:google.maps.Map,layerName:string):Promise<MapLayer> {\r\n        return this.mapsApiLoader.load()\r\n            .then(() => this.getLayerDefinition(layerName)\r\n            .then(layerDef => {\r\n                if(layerDef) {\r\n                    switch(layerDef.type||MapLayerType.STANDARD) {\r\n                        case MapLayerType.STANDARD:\r\n                            return new WmsMapLayer(map,layerDef,this);\r\n                        case MapLayerType.PEST:\r\n                            return new PestMapLayer(map,layerDef,this);\r\n                    }\r\n                }\r\n            }));\r\n    }\r\n\r\n    getDefaultLegend():MapLayerLegend {\r\n        const key = 'DEFAULT';\r\n        if(this.legends[key]) {\r\n            return this.legends[key];\r\n        }\r\n        return (this.legends[key] = new DefaultMapLayerLegend(this.griddedPipes));\r\n    }\r\n    \r\n    // this is separate from WmsLayer itself because FWS apps use\r\n    // legends separate from layers (for now).  If the clipped stuff\r\n    // is worked into a sub-class of NpnMapLayer then this should likely\r\n    // move into the layer implementation itself.\r\n    getLegend(input:MapLayerDefinition | string):Promise<MapLayerLegend> {\r\n        const definition:Promise<MapLayerDefinition> = typeof(input) === 'string'\r\n            ? this.getLayerDefinition(input as string)\r\n            : Promise.resolve(input as MapLayerDefinition);\r\n        return definition.then(layerDef => {\r\n            const layerBasis = layerDef.layerBasis;\r\n            const layerName = layerDef.name;\r\n            if(this.legends[layerName]) {\r\n                return Promise.resolve(this.legends[layerName]);\r\n            }\r\n            return this.serviceUtils.cachedGet(this.griddedUrls.wmsBaseUrl,{\r\n                    service: 'wms',\r\n                    request: 'GetStyles',\r\n                    version: WMS_VERSION,\r\n                    layers: layerBasis||layerName\r\n                },true /* as text*/)\r\n                .then(xml => {\r\n                    const legend_data = $jq($jq.parseXML(xml));\r\n                    const findChildren = (tagName,jqParent) => {\r\n                        let found = jqParent.find(tagName);\r\n                        return found.length === 0\r\n                            ? jqParent.find('sld\\\\:'+tagName) // FF\r\n                            : found;\r\n                    };\r\n                    const userStyles = findChildren('UserStyle',legend_data);\r\n                    const userStyleElm = !!layerBasis\r\n                        ? userStyles.toArray().reduce((found,e) => {\r\n                                if(found) {\r\n                                    return found;\r\n                                }\r\n                                const styleName = findChildren('Name',$jq(e)).first().text();\r\n                                return styleName === layerName ? e : null;\r\n                            },null)\r\n                        : userStyles.toArray()[0]; \r\n                    let color_map = findChildren('ColorMap',$jq(userStyleElm));\r\n                    let l:MapLayerLegend;\r\n                    if(color_map.length !== 0) {\r\n                        switch(layerDef.type||MapLayerType.STANDARD) {\r\n                            case MapLayerType.STANDARD:\r\n                                l = new WmsMapLayerLegend(\r\n                                    this.wcsDataService,\r\n                                    this.griddedPipes,\r\n                                    $jq(color_map.toArray()[0]),\r\n                                    layerDef,\r\n                                    legend_data);\r\n                                break;\r\n                            case MapLayerType.PEST:\r\n                                l = new PestMapLayerLegend(\r\n                                    this.wcsDataService,\r\n                                    this.griddedPipes,\r\n                                    $jq(color_map.toArray()[0]),\r\n                                    layerDef,\r\n                                    legend_data);\r\n                                break;\r\n                        }\r\n                    }\r\n                    return this.legends[layerName] = l;\r\n                });\r\n        });\r\n    }\r\n\r\n    private getLayerOverrides():Promise<MapLayerDefinitionMap> {\r\n        const url = 'assets/npn-map-layer-overrides.json';\r\n        return this.serviceUtils.cachedGet(url)\r\n            // on any error (e.g. 404 not fond) return an empty document (cached to avoid subsequent failures)\r\n            .catch(err => this.serviceUtils.cachedSet(url,{}));\r\n    }\r\n\r\n    getLayerDefinitions():Promise<MapLayerDefs> {\r\n        function mergeLayersIntoConfig(wms_layer_defs,overrides) {\r\n            let result = DEEP_COPY(MAP_LAYERS),\r\n                base_description = result.description;\r\n            result.categories.forEach(function(category){\r\n                // layers can inherit config like filters (if all in common) from\r\n                // the base category\r\n                let base_config = DEEP_COPY(category);\r\n                delete base_config.name;\r\n                delete base_config.layers;\r\n                base_config.description = base_config.description||base_description;\r\n                category.layers = category.layers.map(l => {\r\n                    let base_copy = DEEP_COPY(base_config);\r\n                    return {...base_copy,...wms_layer_defs[l.name],...l,...overrides[l.name]||{}};\r\n                });\r\n            });\r\n            return result;\r\n        }\r\n        if(this.layerDefs) {\r\n            return Promise.resolve(this.layerDefs);\r\n        }\r\n        return Promise.all([\r\n                this.serviceUtils.cachedGet(this.griddedUrls.wmsCapabilitiesUrl,null,true/*as text*/),\r\n                this.getLayerOverrides()\r\n            ]).then(results => {\r\n                const [xml,overrides] = results;\r\n                let wms_capabilities = $jq($jq.parseXML(xml));\r\n                console.debug('WmsMapLayerService:capabilities',wms_capabilities);\r\n                let wms_layer_defs = this._getLayers(wms_capabilities.find('Layer'));\r\n                console.debug('WmsMapLayerService:wms layer definitions',wms_layer_defs);\r\n                console.debug('WmsMapLayerService:wms layer overrides',overrides);\r\n                this.layerDefs = mergeLayersIntoConfig(wms_layer_defs,overrides);\r\n                console.debug('WmsMapLayerService:layer definitions',this.layerDefs);\r\n                return this.layerDefs;\r\n            });\r\n    }\r\n\r\n    getLayerDefinition(layerName:string):Promise<MapLayerDefinition> {\r\n        return this.getLayerDefinitions()\r\n                .then(definitions => {\r\n                    let layerMap = definitions.categories.reduce((map,c) => {\r\n                            c.layers.forEach(l => {\r\n                                map[l.name] = l;\r\n                            });\r\n                            return map;\r\n                        },{});\r\n                    return layerMap[layerName];\r\n                });\r\n    }\r\n\r\n    // private functions used to parse layer info out of WMS Capabilities response\r\n    // remain instance functions since they use some injected services\r\n    // returns an associative array of machine name layer to layer definition\r\n    private _getLayers(layers):({[name:string]: MapLayerDefinition}) {\r\n        if(!layers || layers.length < 2) { // 1st layer is parent, children are the real layers\r\n            return;\r\n        }\r\n        // make it a normal array, not a jQuery one\r\n        let ls = [];\r\n        layers.slice(1).each(function(i,o) {\r\n            ls.push(o);\r\n        });\r\n        return ls.map(l => this._layerToObject(l)).reduce((map,l) => {\r\n            map[l.name] = l;\r\n            return map;\r\n        },{});\r\n    }\r\n    private _layerToObject(layer):MapLayerDefinition {\r\n        let l = $jq(layer),\r\n            o = {\r\n                name: l.find('Name').first().text(),\r\n                // redmine #761\r\n                title: l.find('Title').first().text().replace(/\\((.+?)\\)/g, ''),\r\n                abstract: l.find('Abstract').first().text(),\r\n                bbox: this._parseBoundingBox(l.find('EX_GeographicBoundingBox').first()),\r\n                style: this._parseStyle(l.find('Style').first()),\r\n                extent: this._parseExtent(l.find('Extent').first()) // TODO see unmigrated code below\r\n            };\r\n        if(!o.bbox) {\r\n            o.bbox = this._parseLatLonBoundingBox(l.find('LatLonBoundingBox').first());\r\n        }\r\n        return o;\r\n    }\r\n    private _parseStyle(style):MapLayerStyle {\r\n        let s = $jq(style);\r\n        return {\r\n            name: s.find('Name').first().text(),\r\n            // redmine #761\r\n            title: s.find('Title').first().text().replace(/\\((.+?)\\)/g, ''),\r\n            legend: s.find('OnlineResource').attr('xlink:href') // not very specific...\r\n        };\r\n    }\r\n    private _parseLatLonBoundingBox(bb) {\r\n        if(bb.length) {\r\n            let bbox = {\r\n                westBoundLongitude: parseFloat(bb.attr('minx')),\r\n                eastBoundLongitude: parseFloat(bb.attr('maxx')),\r\n                southBoundLatitude: parseFloat(bb.attr('miny')),\r\n                northBoundLatitude: parseFloat(bb.attr('maxy')),\r\n                getBounds: function() { // TODO, cut/paste\r\n                    return new google.maps.LatLngBounds(\r\n                        new google.maps.LatLng(bbox.southBoundLatitude,bbox.westBoundLongitude), // sw\r\n                        new google.maps.LatLng(bbox.northBoundLatitude,bbox.eastBoundLongitude) // ne\r\n                    );\r\n                }\r\n            };\r\n            return bbox;\r\n        }\r\n    }\r\n    private _parseBoundingBox(bb):MapLayerBoundingBox {\r\n        if(bb.length) {\r\n            let bbox = {\r\n                westBoundLongitude: parseFloat(bb.find('westBoundLongitude').text()),\r\n                eastBoundLongitude: parseFloat(bb.find('eastBoundLongitude').text()),\r\n                southBoundLatitude: parseFloat(bb.find('southBoundLatitude').text()),\r\n                northBoundLatitude: parseFloat(bb.find('northBoundLatitude').text()),\r\n                getBounds: function() {\r\n                    return new google.maps.LatLngBounds(\r\n                        new google.maps.LatLng(bbox.southBoundLatitude,bbox.westBoundLongitude), // sw\r\n                        new google.maps.LatLng(bbox.northBoundLatitude,bbox.eastBoundLongitude) // ne\r\n                    );\r\n                }\r\n            };\r\n            // some bounding boxes seem to be messed up with lat/lons of 0 && -1\r\n            // so if any of those numbers occur throw away the bounding box.\r\n            return ![bbox.westBoundLongitude,bbox.eastBoundLongitude,bbox.southBoundLatitude,bbox.northBoundLatitude].reduce(function(v,n){\r\n                return v||(n === 0 || n === -1);\r\n            },false) ? bbox : undefined;\r\n        }\r\n    }\r\n    // represents an extent value of month/day/year\r\n    private _dateExtentValue(value:string,dateFmt?:string):MapLayerExtentValue {\r\n        const d = parseExtentDate(value);\r\n        return {\r\n            value: value,\r\n            date: d,\r\n            label: this.griddedPipes.get('date').transform(d,(dateFmt||'longDate')),\r\n            addToParams: function(params:any,serviceType:MapLayerServiceType):void {\r\n                switch(serviceType) {\r\n                    case MapLayerServiceType.WMS:\r\n                        params.time = value;\r\n                        break;\r\n                    case MapLayerServiceType.WCS:\r\n                        params.subset = params.subset||[];\r\n                        params.subset.push(`http://www.opengis.net/def/axis/OGC/0/time(\"${value}\")`);\r\n                        break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    // represents an extent value of day of year\r\n    private _doyExtentValue(value:string):MapLayerExtentValue {\r\n        return {\r\n            value: value,\r\n            label: this.griddedPipes.get('thirtyYearAvgDayOfYear').transform(value),\r\n            addToParams: function(params:any,serviceType:MapLayerServiceType):void {\r\n                switch(serviceType) {\r\n                    case MapLayerServiceType.WMS:\r\n                        params.elevation = value;\r\n                        break;\r\n                    case MapLayerServiceType.WCS:\r\n                        params.subset = params.subset||[];\r\n                        params.subset.push(`http://www.opengis.net/def/axis/OGC/0/elevation(${value})`);\r\n                        break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    private _parseExtent(extent):MapLayerExtent {\r\n        var e = $jq(extent),\r\n            content = e.text(),\r\n            dfltValue = e.attr('default'),\r\n            dflt,values,\r\n            name = e.attr('name'),\r\n            start,end,yearFmt = 'yyyy',i;\r\n        if(!name || !content) {\r\n            return undefined;\r\n        }\r\n        function findDefault(current,value) {\r\n            return current||(value.value == dfltValue ? value : undefined);\r\n        }\r\n        if(name === 'time') {\r\n            if(content.indexOf('/') === -1) { // for now skip <lower>/<upper>/<resolution>\r\n                values = content.split(',').map(d => this._dateExtentValue(d));\r\n                // ugh\r\n                dfltValue = dfltValue.replace(/0Z/,'0.000Z'); // extent values in ms preceision but not the default...\r\n                dflt = values.reduce(findDefault,undefined);\r\n                return {\r\n                    label: 'Date',\r\n                    type: MapLayerExtentType.DATE,\r\n                    current: dflt, // bind the extent value to use here\r\n                    values: values\r\n                };\r\n            } else {\r\n                values = /^([^\\/]+)\\/(.*)\\/P1Y$/.exec(content);\r\n                if(values && values.length === 3) {\r\n                    start = this._dateExtentValue(values[1],yearFmt);\r\n                    end = this._dateExtentValue(values[2],yearFmt);\r\n                    if(end.date.getFullYear() > start.date.getFullYear()) { // should never happen but to be safe\r\n                        values = [start];\r\n                        for(i = start.date.getFullYear()+1; i < end.date.getFullYear();i++) {\r\n                            values.push(this._dateExtentValue(i+'-01-01T00:00:00.000Z',yearFmt));\r\n                        }\r\n                        values.push(end);\r\n                        return {\r\n                            label: 'Year',\r\n                            type: MapLayerExtentType.YEAR,\r\n                            current: end,\r\n                            values: values\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n        } else if (name === 'elevation') {\r\n            values = content.split(',').map(e => this._doyExtentValue(e));\r\n            dflt = values.reduce(findDefault,undefined);\r\n            return {\r\n                label: 'Day of Year',\r\n                type: MapLayerExtentType.DOY,\r\n                current: dflt, // bind the extent value to use here\r\n                values: values\r\n            };\r\n        }\r\n    }\r\n}\r\n","import { Selection } from 'd3-selection';\r\nimport { MapLayerLegend } from './map-layer-legend';\r\nimport { Observable, from } from 'rxjs';\r\nimport { switchMap, map } from 'rxjs/operators';\r\nimport { GriddedPointData } from './gridded-common';\r\nimport { PestMapLayer } from './pest-map-layer';\r\n\r\nexport class PestMapLayerLegend extends MapLayerLegend {\r\n    getGriddedPointData(latLng:google.maps.LatLng):Observable<GriddedPointData> {\r\n        const layer:PestMapLayer = this.getLayer() as PestMapLayer;\r\n        return from(layer.getPestDescription())\r\n            .pipe(\r\n                switchMap(pest => {\r\n                    if(pest && pest.lowerThreshold && pest.startMonthDay && pest.agddMethod) {\r\n                        // special case WRT gridded data for this pest.\r\n                        const params:any = {\r\n                            climateProvider: 'NCEP',\r\n                            temperatureUnit: 'fahrenheit',\r\n                            startDate: layer.extent.current.date.getFullYear()+`-${pest.startMonthDay}`,\r\n                            endDate: layer.extent.current.date.toISOString().replace(/T.*$/,''),\r\n                            latitude: `${latLng.lat()}`,\r\n                            longitude: `${latLng.lng()}`\r\n                        };\r\n                        if(!pest.upperThreshold) {\r\n                            params.base = `${pest.lowerThreshold}`;\r\n                        } else {\r\n                            params.lowerThreshold = `${pest.lowerThreshold}`;\r\n                            params.upperThreshold = `${pest.upperThreshold}`;\r\n                        }\r\n                        return from(\r\n                            this.wcsDataService.serviceUtils.get(\r\n                                this.wcsDataService.serviceUtils.dataApiUrl(`/v0/agdd/${pest.agddMethod}/pointTimeSeries`),\r\n                                params\r\n                            )\r\n                        ).pipe(\r\n                            map(response => {\r\n                                const {timeSeries} = response;\r\n                                if(timeSeries) {\r\n                                    const point = timeSeries.length\r\n                                        ? timeSeries[timeSeries.length-1].agdd\r\n                                        : 0;\r\n                                    const legendData = this.getPointData(point);\r\n                                    const formatted = this.formatPointData(point);\r\n                                    const result = {point,legendData,formatted}\r\n                                    console.log('PestMapLayerLegend: custom gridded result',result);\r\n                                    return result;\r\n                                }\r\n                                return null;\r\n                            })\r\n                        );\r\n                    }\r\n                    return super.getGriddedPointData(latLng);\r\n                })\r\n            )\r\n    }\r\n\r\n    redraw(svg: Selection<any, any, any, any>, legendTitle: string): void {\r\n        const legend = this;\r\n        const width = parseFloat(svg.style('width').replace('px', '')),\r\n              height = parseFloat(svg.style('height').replace('px', '')),\r\n            // only data w/out 'ignore' in them\r\n            data = legend.getData().filter(d => d.original_label.indexOf('ignore') === -1), cell_width = 20, cell_height = 20;\r\n        console.debug('PestMapLegend.svg dimensions', width, height);\r\n        console.debug('PestMapLegend.legend cell width', cell_width);\r\n        console.debug('PestMapLegend.data', data);\r\n        const g = svg.append('g'), cell = g.selectAll('g.cell')\r\n            .data(data)\r\n            .enter()\r\n            .append('g')\r\n            .attr('class', 'cell')\r\n            .attr('transform', function (d, i) { return 'translate(' + 0 + ',' + (i * cell_width) + ')'; });\r\n        // add the  colored legend boxes.\r\n        cell.append('rect')\r\n            .attr('height', cell_height)\r\n            .attr('width', cell_width)\r\n            .style('stroke', 'black')\r\n            .style('stroke-width', '1px')\r\n            .style('fill', d => d.color)\r\n            .append('title').text(d => `${d.quantity}`);\r\n        // add the labels\r\n        cell.append('text')\r\n            .attr('dx', '2.4em')\r\n            .attr('dy', (cell_width / 1.5))\r\n            .style('text-anchor', 'start')\r\n            .text(d => d.original_label);\r\n        function label_cell(cell, label, anchor) {\r\n            cell.append('text')\r\n                .attr('dx', '2.4em')\r\n                .attr('dy', (cell_width / 1.5) /*cell_height+tick_length+(2*tick_padding)*/) // need to know line height of text\r\n                .style('text-anchor', anchor)\r\n                .text(label);\r\n        }\r\n        const legendHeight = cell_height * data.length;\r\n        /* TODO, this won't work no such element, and doesn't seem appropriate as we should futz with the size of the SVG\r\n        var pLegend = document.getElementsByClassName('pest-legend');\r\n        pLegend[0].style.height = legendHeight + 48 + 10 +'px';\r\n        if(legend.pest == 'Hemlock Woolly Adelgid') {\r\n            pLegend[0].style.width = 445 + 'px';\r\n        } else {\r\n            pLegend[0].style.width = 350 + 'px';\r\n        }\r\n        // pLegend[0].style.width = 405 + 'px';\r\n        */\r\n        let treatmentMethod = null;\r\n        if (['emerald_ash_borer', 'lilac_borer', 'apple_maggot'].indexOf(legend.ldef.name) !== -1) {\r\n            treatmentMethod = 'Window for Managing Adults';\r\n        }\r\n        else if (legend.ldef.name === 'winter_moth') {\r\n            treatmentMethod = 'Window for Managing Caterpillars';\r\n        }\r\n        if (treatmentMethod) {\r\n            svg.append('g').append('text').attr('dx', 5)\r\n                .attr('dy', 20 + legendHeight)\r\n                .attr('font-size', '16px')\r\n                .attr('text-anchor', 'right').text(legend.ldef.title + ' Forecast' + ', ' + legend.ldef.extent.current.label);\r\n            svg.append('g').append('text').attr('dx', 5)\r\n                .attr('dy', 38 + legendHeight)\r\n                .attr('font-size', '14px')\r\n                .attr('text-anchor', 'right').text(treatmentMethod);\r\n            svg.append('g').append('text').attr('dx', 5)\r\n                .attr('dy', 54 + legendHeight)\r\n                .attr('font-size', '11px')\r\n                .attr('text-anchor', 'right').text('USA National Phenology Network, www.usanpn.org');\r\n        }\r\n        else {\r\n            svg.append('g').append('text').attr('dx', 5)\r\n                .attr('dy', 30 + legendHeight)\r\n                .attr('font-size', '16px')\r\n                .attr('text-anchor', 'right').text(legend.ldef.title + ' Forecast' + ', ' + legend.ldef.extent.current.label);\r\n            svg.append('g').append('text').attr('dx', 5)\r\n                .attr('dy', 48 + legendHeight)\r\n                .attr('font-size', '11px')\r\n                .attr('text-anchor', 'right').text('USA National Phenology Network, www.usanpn.org');\r\n        }\r\n    }\r\n}\r\n","import { MapLayerDefinition, MapLayerExtentType, MapLayerServiceType, MapLayerExtentValue } from './gridded-common';\r\nimport { NpnMapLayerService } from './npn-map-layer.service';\r\nimport { MapLayer } from './map-layer';\r\nimport { ONE_DAY_MILLIS } from '../visualizations/vis-selection';\r\n\r\nexport interface PestDescription {\r\n    species: string;\r\n    lowerThreshold?: number;\r\n    upperThreshold?: number;\r\n    base?: number;\r\n    startMonthDay?: string;\r\n    agddMethod?: string;\r\n}\r\n\r\n/**\r\n * Wrapper for google.maps.GroundOverlay creation/interaction to allow\r\n * the on/off methods of the PestMapLayer to be synchronous even though\r\n * the creating of the underlying GroundOverlay is asynchronous.\r\n * I.e. the app may want to turn \"off\" a layer before it's actually \"on\"\r\n */\r\nclass GroundOverlayWrapper {\r\n    private overlayReadyResolver;\r\n    private overlayReady:Promise<google.maps.GroundOverlay> = new Promise(resolve => this.overlayReadyResolver = resolve);\r\n    constructor(data:Promise<any>,private opacity:number,private map:google.maps.Map) {\r\n        data.then(response => {\r\n            const { bbox, clippedImage } = response;\r\n            const [west, south, east, north] = bbox;\r\n            const overlay = new google.maps.GroundOverlay(clippedImage, { north, south, east, west }, { clickable: false });\r\n            overlay.setOpacity(this.opacity);\r\n            overlay.setMap(this.map);\r\n            this.overlayReadyResolver(overlay);\r\n        });\r\n    }\r\n\r\n    on() {\r\n        this.overlayReady.then(overlay => overlay.setMap(this.map));\r\n    }\r\n\r\n    off() {\r\n        this.overlayReady.then(overlay => overlay.setMap(null));\r\n    }\r\n\r\n    setOpacity(opacity:number) {\r\n        this.overlayReady.then(overlay => overlay.setOpacity(this.opacity = opacity));\r\n    }\r\n}\r\n\r\nexport class PestMapLayer extends MapLayer {\r\n    private overlay: GroundOverlayWrapper;\r\n    constructor(protected map: google.maps.Map, protected layer_def: MapLayerDefinition, protected layerService: NpnMapLayerService) {\r\n        super(map, layer_def, layerService);\r\n        const currentValue = this.newExtentValue(new Date()).value;\r\n        const minDateMillis = new Date(new Date().getFullYear() - 1, 0, 1).getTime();\r\n        const maxDateMillis = new Date(new Date().getTime() + (6*ONE_DAY_MILLIS)).getTime();\r\n        const values = [];\r\n        let cMillis = minDateMillis;\r\n        while(cMillis <= maxDateMillis) {\r\n            const d = new Date(cMillis);\r\n            values.push(this.newExtentValue(d));\r\n            cMillis += ONE_DAY_MILLIS;\r\n        }\r\n        layer_def.extent = {\r\n            current: values.reduce((found,v) => found||(v.value === currentValue ? v : undefined),undefined),\r\n            label: 'Date',\r\n            type: MapLayerExtentType.DATE,\r\n            values\r\n        };\r\n        console.log('PestMapLayer.extent',layer_def.extent);\r\n    }\r\n    newExtentValue(date: Date): MapLayerExtentValue {\r\n        date.setHours(0, 0, 0, 0);\r\n        const value = date.toISOString().replace(/T.*Z$/,'T00:00:00.000Z');\r\n        return {\r\n            value,\r\n            date,\r\n            label: `${date.toLocaleString('en-us', { month: 'long' })} ${date.getDate()}, ${date.getFullYear()}`,\r\n            addToParams(params: any, serviceType: MapLayerServiceType): void {\r\n                switch (serviceType) {\r\n                    case MapLayerServiceType.WMS:\r\n                        params.date = value.substring(0, 10);\r\n                        break;\r\n                    case MapLayerServiceType.WCS:\r\n                        params.subset = params.subset||[];\r\n                        params.subset.push(`http://www.opengis.net/def/axis/OGC/0/time(\"${value}\")`);\r\n                        break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    setOpacity(opacity:number) {\r\n        this.opacity = opacity;\r\n        if(this.overlay) {\r\n            this.overlay.setOpacity(opacity);\r\n        }\r\n    }\r\n    private _on(): PestMapLayer {\r\n        const params: any = {\r\n            species: this.layer_def.title\r\n        };\r\n        this.layer_def.extent.current.addToParams(params, MapLayerServiceType.WMS);\r\n        this.overlay = new GroundOverlayWrapper(this.layerService.serviceUtils.get(this.layerService.serviceUtils.dataApiUrl('/v0/agdd/pestMap'), params),this.opacity,this.map);\r\n        this.overlay.on();\r\n        return this;\r\n    }\r\n    on(): PestMapLayer {\r\n        //TODO Analytics.trackEvent('gridded-layer','on',this.title);\r\n        return this._on();\r\n    }\r\n    private _off(): PestMapLayer {\r\n        if (this.overlay) {\r\n            this.overlay.off();\r\n            this.overlay = null;\r\n        }\r\n        return this;\r\n    }\r\n    off(): PestMapLayer {\r\n        //TODO Analytics.trackEvent('gridded-layer','off',this.title);\r\n        return this._off();\r\n    }\r\n    bounce(): PestMapLayer {\r\n        return this._off()._on();\r\n    }\r\n\r\n    getPestDescription():Promise<PestDescription> {\r\n        const species = this.title;\r\n        return this.layerService.serviceUtils.cachedGet(\r\n            this.layerService.serviceUtils.dataApiUrl('/v0/agdd/pestDescriptions')\r\n        ).then((descriptions:PestDescription[]) => descriptions.find(d => d.species === species));\r\n    }\r\n\r\n    getTimeSeriesUrl():Promise<string> {\r\n        return this.getPestDescription()\r\n            .then(pest => this.layerService.serviceUtils.dataApiUrl(`/v0/agdd/${pest.agddMethod||'simple'}/pointTimeSeries`));\r\n    }\r\n}\r\n","import { Pipe, PipeTransform, Injectable } from '@angular/core';\r\nimport { DatePipe, DecimalPipe } from '@angular/common';\r\nimport { parseExtentDate } from './gridded-common';\r\nimport { ONE_DAY_MILLIS } from '../visualizations/vis-selection';\r\n\r\nconst ONE_DAY = (24*60*60*1000);\r\nconst JAN_ONE_2010 = new Date(2010,0);\r\nconst JAN_ONE_THIS_YEAR = new Date((new Date()).getFullYear(),0);\r\n\r\n@Pipe({name: 'legendGddUnits'})\r\nexport class LegendGddUnitsPipe implements PipeTransform {\r\n    constructor(private decimalPipe:DecimalPipe) {}\r\n    transform(n:number,includeUnits?:boolean) {\r\n        return this.decimalPipe.transform(n,'1.0-0')+(includeUnits ? ' AGDD' : '');\r\n    }\r\n}\r\n\r\n@Pipe({name: 'agddDefaultTodayElevation'})\r\nexport class AgddDefaultTodayElevationPipe implements PipeTransform {\r\n    constructor(private datePipe:DatePipe) {}\r\n\r\n    transform(values:any[]):any {\r\n        let todayLabel = this.datePipe.transform(new Date(),'MMMM d');\r\n        return (values||[]).reduce((dflt,v) =>{\r\n            return dflt||(v.label == todayLabel ? v : undefined);\r\n        },undefined);\r\n    }\r\n}\r\n\r\n@Pipe({name: 'legendAgddAnomaly'})\r\nexport class LegendAgddAnomalyPipe implements PipeTransform {\r\n    constructor(private decimalPipe:DecimalPipe) {}\r\n    transform(n:number,includeUnits?:boolean):string {\r\n        if(n === 0) {\r\n            return 'No Difference';\r\n        }\r\n        let lt = n < 0;\r\n        return this.decimalPipe.transform(Math.abs(n),'1.0')+(includeUnits ? ' AGDD ' : ' ')+(lt ? '<' : '>') +' Avg';\r\n    }\r\n}\r\n\r\n@Pipe({name: 'agddDefaultTodayTime'})\r\nexport class AgddDefaultTodayTimePipe implements PipeTransform {\r\n    constructor(private datePipe:DatePipe) {}\r\n\r\n    transform(values:any[]):string {\r\n        let todayLabel = this.datePipe.transform(new Date(),'MMMM d, y');\r\n        return (values||[]).reduce(function(dflt,v){\r\n            return dflt||(v.label == todayLabel ? v : undefined);\r\n        },undefined);\r\n    };\r\n}\r\n\r\n@Pipe({name: 'legendSixAnomaly'})\r\nexport class LegendSixAnomalyPipe implements PipeTransform {\r\n    transform(n:number):string {\r\n        if(n === 0) {\r\n            return 'No Difference';\r\n        }\r\n        var lt = n < 0,\r\n            abs = Math.abs(n);\r\n        return abs+' Days '+(lt ? 'Early' : 'Late');\r\n    };\r\n}\r\n\r\n@Pipe({name: 'legendDoy'})\r\nexport class LegendDoyPipe implements PipeTransform {\r\n    constructor(private datePipe:DatePipe) {}\r\n\r\n    transform(doy:number,fmt:string,current_year?:boolean):string {\r\n        doy = Math.round(doy);\r\n        if(doy === 0) {\r\n            doy = 1;\r\n        }\r\n        fmt = fmt||'MMM d'; // e.g. Jan 1\r\n        return this.datePipe.transform(new Date((current_year ? JAN_ONE_THIS_YEAR : JAN_ONE_2010).getTime()+((doy-1)*ONE_DAY)),fmt);\r\n    }\r\n}\r\n\r\n@Pipe({name: 'extentDates'})\r\nexport class ExtentDatesPipe implements PipeTransform {\r\n    constructor(private datePipe:DatePipe) {}\r\n\r\n    toTime(s:string):number {\r\n        let d = new Date();\r\n        if(s === 'yesterday' || s === 'today' || s === 'tomorrow') {\r\n            if(s === 'yesterday') {\r\n                d.setTime(d.getTime()-ONE_DAY);\r\n            } else if (s === 'tomorrow') {\r\n                d.setTime(d.getTime()+ONE_DAY);\r\n            }\r\n            s = this.datePipe.transform(d,'yyyy-MM-dd 00:00:00');\r\n        } else if(s.indexOf('T') === -1) {\r\n            s = d.getFullYear()+'-'+s+' 00:00:00';\r\n        }\r\n        return parseExtentDate(s).getTime();\r\n    }\r\n\r\n    transform(arr:string[],after:string,before:string):string[] {\r\n        var a = after ? this.toTime(after) : undefined,\r\n            b = before ? this.toTime(before) : undefined;\r\n        if(a || b) {\r\n            arr = arr.filter((d) => {\r\n                var t = parseExtentDate(d).getTime();\r\n                return (!a || (a && t > a)) && (!b || (b && t < b));\r\n            });\r\n        }\r\n        return arr;\r\n    }\r\n}\r\n\r\nexport enum DoyTxType {\r\n    DATE = 'date',\r\n    DOY_STRING = 'doy', // as used by WMS extents e.g. 1.0\r\n    LABEL = 'label'\r\n}\r\nconst DOY_LABEL_FMT = 'MMMM d';\r\n\r\n@Pipe({name: 'thirtyYearAvgDayOfYear'})\r\nexport class ThirtyYearAvgDayOfYearPipe implements PipeTransform {\r\n    constructor(private datePipe:DatePipe) {}\r\n\r\n    transform(input:string | Date,txTo:DoyTxType = DoyTxType.LABEL):any {\r\n        if(typeof(input) === 'string') {\r\n            const doy = parseFloat(input);\r\n            if(!isNaN(doy)) {\r\n                input = new Date(JAN_ONE_2010.getTime()+((doy-1)*ONE_DAY));\r\n            }\r\n        }\r\n        if (input instanceof Date) {\r\n            switch(txTo) {\r\n                case DoyTxType.DATE:\r\n                    return input;\r\n                case DoyTxType.LABEL:\r\n                    return this.datePipe.transform(input,DOY_LABEL_FMT);\r\n                case DoyTxType.DOY_STRING:\r\n                    if(input.getFullYear() !== 2010) {\r\n                        input.setFullYear(2010);\r\n                    }\r\n                    input.setHours(0,0,0,0);\r\n                    const diff = input.getTime() - JAN_ONE_2010.getTime();\r\n                    const doy = (diff/ONE_DAY_MILLIS)+1.0;\r\n                    return doy.toFixed(1);\r\n            }\r\n        }\r\n        console.warn(`ThirtyYearAvgDayOfYearPipe.transform unexpected input for translation to \"${txTo}\"`,input);\r\n        return input;\r\n    }\r\n}\r\n\r\n@Injectable()\r\nexport class GriddedPipeProvider {\r\n    readonly pipes:any = {};\r\n\r\n    constructor(\r\n        private extentDates:ExtentDatesPipe,\r\n        private legendDoy:LegendDoyPipe,\r\n        private legendSixAnomaly:LegendSixAnomalyPipe,\r\n        private agddDefaultTodayTime:AgddDefaultTodayTimePipe,\r\n        private legendAgddAnomaly:LegendAgddAnomalyPipe,\r\n        private agddDefaultTodayElevation:AgddDefaultTodayElevationPipe,\r\n        private legendGddUnits:LegendGddUnitsPipe,\r\n        private thirtyYearAvgDayOfYear:ThirtyYearAvgDayOfYearPipe,\r\n        private date:DatePipe\r\n    ) {\r\n        this.pipes.extentDates = extentDates;\r\n        this.pipes.legendDoy = legendDoy;\r\n        this.pipes.legendSixAnomaly = legendSixAnomaly;\r\n        this.pipes.agddDefaultTodayTime = agddDefaultTodayTime;\r\n        this.pipes.legendAgddAnomaly = legendAgddAnomaly;\r\n        this.pipes.agddDefaultTodayElevation = agddDefaultTodayElevation;\r\n        this.pipes.legendGddUnits = legendGddUnits;\r\n        this.pipes.thirtyYearAvgDayOfYear = thirtyYearAvgDayOfYear;\r\n        this.pipes.date = date;\r\n    }\r\n\r\n    get(pipeName:string):PipeTransform {\r\n        return this.pipes[pipeName];\r\n    }\r\n}","//export * from './wms-map-layer';\r\nexport * from './npn-gridded.module';\r\nexport * from './map-layer';\r\nexport * from './npn-map-layer.service';\r\nexport * from './map-layer-legend';\r\nexport * from './wcs-data.service';\r\nexport { SupportsOpacity } from './supports-opacity-control.component';\r\nexport { MapLayerLegendComponent } from './map-layer-legend.component';\r\nexport * from './google-feature-bounds';\r\nexport * from './gridded-common';\r\nexport { GriddedPipeProvider, DoyTxType } from './pipes';\r\nexport * from './wms-map-layer';\r\nexport * from './wms-map-layer-legend';\r\nexport * from './pest-map-layer';\r\nexport * from './pest-map-layer-legend';\r\nexport * from './default-map-layer-legend';\r\nexport * from './boundary.service';","import {Component,Input,OnChanges,SimpleChanges} from '@angular/core';\r\n\r\n// NOTE: these functions are already defined on google.maps.ImageMapType\r\n// re-using the function names and can later just claim that ImageMapType\r\n// implements this interface\r\nexport interface SupportsOpacity {\r\n    setOpacity(o:number);\r\n    getOpacity():number;\r\n}\r\n\r\n@Component({\r\n    selector: 'supports-opacity-control',\r\n    template:`\r\n    <label>Opacity\r\n        <mat-slider min=\"0\" max=\"100\" step=\"1\" tickInterval=\"25\" [thumbLabel]=\"opacity\" [(ngModel)]=\"opacity\" (change)=\"opacityChanged()\" [disabled]=\"!supportsOpacity\"></mat-slider>\r\n    </label>\r\n    `\r\n})\r\nexport class SupportsOpacityControl implements OnChanges {\r\n    @Input()\r\n    supportsOpacity:SupportsOpacity;\r\n    opacity:number = 100;\r\n\r\n    opacityChanged() {\r\n        if(this.supportsOpacity) {\r\n            this.supportsOpacity.setOpacity(this.opacity/100.0);\r\n        }\r\n    }\r\n\r\n    ngOnChanges(changes:SimpleChanges):void {\r\n        console.log('SupportsOpacityControl.ngOnchanges',changes);\r\n        if(changes.supportsOpacity && changes.supportsOpacity.currentValue) {\r\n            this.opacity = Math.round(changes.supportsOpacity.currentValue.getOpacity()*100);\r\n        }\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { HttpParams, HttpParameterCodec } from '@angular/common/http';\r\n\r\nimport * as $jq_ from 'jquery';\r\nconst $jq = $jq_;\r\n\r\nimport { MapLayerLegend } from './map-layer-legend';\r\nimport { NpnServiceUtils } from '../common/index';\r\n\r\nconst TO_RADIANS = (degrees:number) => degrees * Math.PI / 180;\r\nconst TO_DEGREES = (radians:number) => radians * 180 / Math.PI;\r\nexport const DESTINATION_POINT = (latLng:google.maps.LatLng,brng:number,dist:number):google.maps.LatLng => {\r\n    // 0=N,90=E,180=S,270=W dist in km\r\n    dist = dist / 6371;\r\n    brng = TO_RADIANS(brng);\r\n\r\n    let lat1 = TO_RADIANS(latLng.lat()),\r\n        lon1 = TO_RADIANS(latLng.lng());\r\n\r\n    let lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) +\r\n                         Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));\r\n\r\n    let lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) *\r\n                                 Math.cos(lat1),\r\n                                 Math.cos(dist) - Math.sin(lat1) *\r\n                                 Math.sin(lat2));\r\n\r\n    if (isNaN(lat2) || isNaN(lon2)) {\r\n         return null;\r\n     }\r\n\r\n    return new google.maps.LatLng(TO_DEGREES(lat2),TO_DEGREES(lon2));\r\n}\r\n\r\n@Injectable()\r\nexport class WcsDataService {\r\n    constructor(public serviceUtils:NpnServiceUtils) {}\r\n\r\n    newInfoWindowHandler(map:google.maps.Map) {\r\n        return new GriddedInfoWindowHandler(this,map);\r\n    }\r\n\r\n    // NOTE: the original from the npn-vis-tool passed in a layer object and augmented\r\n    // WCS parameters based on its extent.  At the moment full layers are not in use\r\n    // and don't exist for the set of current components.  All usage at the moment\r\n    // ties back to the ClippedWmsMapSelection class so look there when the time comes\r\n    getGriddedData(layerName:string,\r\n                   latLng:google.maps.LatLng,\r\n                   gridSize:number,\r\n                   paramsAugment?:(args:any) => void):Observable<number[]> {\r\n        const edges = [0,80,180,270].map(bearing => DESTINATION_POINT(latLng,bearing,(gridSize/2)));\r\n        const wcsArgs = {\r\n                service: 'WCS',\r\n                request: 'GetCoverage',\r\n                version: '2.0.1',\r\n                coverageId: layerName.replace(':','__'), // convention\r\n                format: 'application/gml+xml',\r\n                subset: []\r\n            };\r\n        // add edges\r\n        wcsArgs.subset.push('http://www.opengis.net/def/axis/OGC/0/Long('+[edges[3].lng(),edges[1].lng()].join(',')+')');\r\n        wcsArgs.subset.push('http://www.opengis.net/def/axis/OGC/0/Lat('+[edges[2].lat(),edges[0].lat()].join(',')+')');\r\n        // date extent example...\r\n        // http://www.opengis.net/def/axis/OGC/0/time(\"2018-01-31T00:00:00.000Z\")\r\n        if(paramsAugment) {\r\n            paramsAugment(wcsArgs);\r\n        }\r\n        console.log('wcsArgs',wcsArgs);\r\n        /*\r\n        TODO re-test issue post Angular 6\r\n        // see: https://github.com/angular/angular/issues/11058\r\n        // will need to change when upgrading Angular version and moving to HttpClient\r\n        let urlParams:URLSearchParams = new URLSearchParams('',new GhQueryEncoder());\r\n        */\r\n        let params = new HttpParams({encoder:new CustomEncoder()});\r\n        Object.keys(wcsArgs).filter(key => key !== 'subset').forEach(key => params = params.set(key,wcsArgs[key]));\r\n        wcsArgs.subset.forEach(v => params = params.append('subset',v));\r\n        return this.serviceUtils.http.get(`${this.serviceUtils.config.geoServerRoot}/wcs`,{params,responseType:'text'})\r\n            .pipe(\r\n                map(response => {\r\n                    let wcsData = $jq($jq.parseXML(response)),\r\n                        tuples = wcsData.find('tupleList').text();\r\n                    return tuples ?\r\n                        tuples.trim().split(' ').map(t => parseFloat(t)) :\r\n                        [];\r\n                })\r\n            )\r\n    }\r\n}\r\n\r\nclass CustomEncoder implements HttpParameterCodec {\r\n    encodeKey(key: string): string {\r\n      return encodeURIComponent(key);\r\n    }\r\n  \r\n    encodeValue(value: string): string {\r\n      return encodeURIComponent(value);\r\n    }\r\n  \r\n    decodeKey(key: string): string {\r\n      return decodeURIComponent(key);\r\n    }\r\n  \r\n    decodeValue(value: string): string {\r\n      return decodeURIComponent(value);\r\n    }\r\n  }\r\n\r\n/*\r\nclass GhQueryEncoder extends QueryEncoder {\r\n    encodeKey(k: string): string {\r\n        k = super.encodeKey(k);\r\n        return k.replace(/\\+/gi, '%2B');\r\n    }\r\n    encodeValue(v: string): string {\r\n        v = super.encodeKey(v);\r\n        return v.replace(/\\+/gi, '%2B');\r\n    }\r\n}\r\n*/\r\n\r\n/**\r\n * IMPORTANT: This is code that came from the legacy application and is currently still used by some FWS\r\n * applications (clipped-wms-map).  The functionality has been re-implemented within `MapLayerLegend`\r\n * and this class should probably be re-visited/removed\r\n */\r\nexport class GriddedInfoWindowHandler {\r\n    infoWindow:google.maps.InfoWindow;\r\n    constructor(private dataService:WcsDataService,private map:google.maps.Map) {}\r\n\r\n    open(latLng:google.maps.LatLng,layerName:string,legend:MapLayerLegend,paramsAugment?:(args:any) => void) {\r\n        this.dataService.getGriddedData(layerName,latLng,5,paramsAugment)\r\n            .subscribe((tuples:number[]) => {\r\n                console.log('GriddedInfoWindowHandler.tuples',tuples);\r\n                let point = tuples && tuples.length ? tuples[0] : undefined;\r\n                if(point === -9999 || isNaN(point)) {\r\n                    console.log(`GriddedInfoWindowHandler: received -9999 or Nan (${point}) ignoring`);\r\n                    return;\r\n                }\r\n                let html = `<div id=\"griddedPointInfoWindow\">`;\r\n                let legendPoint = legend.getPointData(point);\r\n                if(legendPoint) {\r\n                    html += `<div class=\"gridded-legend-color\" style=\"background-color: ${legendPoint.color};\">&nbsp;</div>`;\r\n                }\r\n                html += `<div class=\"gridded-point-data\">${legend.formatPointData(point)}</div>`;\r\n                html += `</div>`;\r\n                if(!this.infoWindow) {\r\n                    this.infoWindow = new google.maps.InfoWindow({\r\n                        maxWidth: 200,\r\n                        content: 'contents'\r\n                    });\r\n                }\r\n                this.infoWindow.setContent(html);\r\n                this.infoWindow.setPosition(latLng);\r\n                this.infoWindow.open(this.map);\r\n            });\r\n    }\r\n\r\n    close() {\r\n        if(this.infoWindow) {\r\n            this.infoWindow.close();\r\n        }\r\n    }\r\n}\r\n","import { Selection } from 'd3-selection';\r\nimport * as d3 from 'd3';\r\nimport { MapLayerLegend } from './map-layer-legend';\r\n\r\nexport class WmsMapLayerLegend extends MapLayerLegend {\r\n    redraw(svg: Selection<any, any, any, any>, legendTitle: string): void {\r\n        const legend = this;\r\n        if (svg) {\r\n            svg.selectAll('g').remove();\r\n        }\r\n        if (!legend || !svg) {\r\n            return;\r\n        }\r\n        let width = parseFloat(svg.style('width').replace('px', '')), height = parseFloat(svg.style('height').replace('px', '')), data = legend.getData(), mid_idx = Math.floor(data.length / 2), cell_width = width / data.length, cell_height = 30, top_pad = 2;\r\n        console.debug('WmsMapLegend.svg dimensions', width, height);\r\n        console.debug('WmsMapLegend.legend cell width', cell_width);\r\n        let g = svg.append('g'), cell = g.selectAll('g.cell')\r\n            .data(data)\r\n            .enter()\r\n            .append('g')\r\n            .attr('class', (d, i) => {\r\n                return 'cell' +\r\n                    ((i === 0) ? ' first' :\r\n                        ((i === mid_idx) ? ' middle' :\r\n                            ((i === data.length - 1) ? ' last' : '')));\r\n            })\r\n            .attr('transform', function (d, i) { return 'translate(' + (i * cell_width) + ',' + top_pad + ')'; })\r\n            .append('rect')\r\n            .attr('height', cell_height)\r\n            .attr('width', cell_width)\r\n            .style('stroke', 'black')\r\n            .style('stroke-width', '1px')\r\n            .style('fill', function (d, i) { return d.color; });\r\n        if (legend.ldef.legend_delimiter_every) {\r\n            let every = legend.ldef.legend_delimiter_every, running_total = 0, separators = data.map(function (d, i) {\r\n                if ((i + 1) === data.length) {\r\n                    return true;\r\n                }\r\n                running_total += (data[i + 1].quantity - data[i].quantity);\r\n                if (running_total >= every) {\r\n                    running_total = 0;\r\n                    return true;\r\n                }\r\n                return false;\r\n            }), top_bottom = [(cell_width + 1), cell_height, (cell_width + 1), cell_height].join(','), //{ stroke-dasharray: $w,$h,$w,$h }\r\n                top_right_bottom = [((cell_width * 2) + cell_height), cell_height].join(','), //{ stroke-dasharray: (($w*2)+$h),$h }\r\n                top_left_bottom = [(cell_width + 1), cell_height, (cell_width + cell_height + 1), 0].join(','); ////{ stroke-dasharray: $w,$h,($w+$h),0 }\r\n            console.debug('WmsMapLegend.legend_delimiter_every', every);\r\n            cell.style('stroke-dasharray', function (d, i) {\r\n                if (i === 0) {\r\n                    return separators[i] ? undefined : top_left_bottom;\r\n                }\r\n                return separators[i] ? top_right_bottom : top_bottom;\r\n            })\r\n                // top_bottom removes the left/right borders which leaves a little whitespace\r\n                // which looks odd so in cases where there is no right border increase a cell's width\r\n                // by 1px to cover that gap\r\n                .attr('width', function (d, i) {\r\n                    var w = parseFloat(d3.select(this).attr('width'));\r\n                    if (i === 0) {\r\n                        return separators[i] ? w : w + 1;\r\n                    }\r\n                    return separators[i] ? w : w + 1;\r\n                });\r\n            g.selectAll('g.cell').append('line')\r\n                .attr('stroke', function (d, i) { return separators[i] ? 'black' : 'none'; })\r\n                .attr('stroke-width', 2)\r\n                .attr('x1', cell_width - 1)\r\n                .attr('x2', cell_width - 1)\r\n                .attr('y1', 0)\r\n                .attr('y2', cell_height);\r\n        }\r\n        cell.append('title').text(function (d) { return d.label; });\r\n        let tick_length = 5, tick_padding = 3;\r\n        function label_cell(cell, label, anchor) {\r\n            let tick_start = (top_pad + cell_height + tick_padding);\r\n            cell.append('line')\r\n                .attr('x1', (cell_width / 2))\r\n                .attr('y1', tick_start)\r\n                .attr('x2', (cell_width / 2))\r\n                .attr('y2', tick_start + tick_length)\r\n                .attr('stroke', 'black')\r\n                .attr('stroke-width', '1');\r\n            cell.append('text')\r\n                .attr('dx', (cell_width / 2))\r\n                .attr('dy', '4em' /*cell_height+tick_length+(2*tick_padding)*/) // need to know line height of text\r\n                .style('text-anchor', anchor)\r\n                .text(label);\r\n        }\r\n        label_cell(svg.select('g.cell.first'), data[0].label, 'start');\r\n        label_cell(svg.select('g.cell.middle'), data[mid_idx].label, 'middle');\r\n        label_cell(svg.select('g.cell.last'), data[data.length - 1].label, 'end');\r\n        if (legend.ldef.legend_units) {\r\n            svg.append('g')\r\n                .append('text')\r\n                .attr('dx', (width / 2))\r\n                .attr('dy', 75 + top_pad)\r\n                .attr('text-anchor', 'middle')\r\n                .text(legend.ldef.legend_units);\r\n        }\r\n        // if given an explicit title use it o/w use the info from the\r\n        // legend definition, etc.\r\n        let legend_title;\r\n        if (legendTitle) {\r\n            legend_title = legendTitle;\r\n        }\r\n        else {\r\n            legend_title = legend.ldef.title;\r\n            if (legend.ldef.extent && legend.ldef.extent.current) {\r\n                legend_title += `, ${legend.ldef.extent.current.label}`;\r\n            }\r\n        }\r\n        if(!!legend_title) {\r\n            svg.append('g').append('text').attr('dx', 5)\r\n                .attr('dy', 100 + top_pad)\r\n                .attr('font-size', '18px')\r\n                .attr('text-anchor', 'right').text(legend_title);\r\n        }\r\n        svg.append('g').append('text').attr('dx', 5)\r\n            .attr('dy', (!!legend_title ? 118 : 85) + top_pad)\r\n            .attr('font-size', '11px')\r\n            .attr('text-anchor', 'right').text('USA National Phenology Network, www.usanpn.org');\r\n    }\r\n}\r\n","import { BOX_SIZE, BASE_WMS_ARGS, MapLayerDefinition, MapLayerServiceType } from './gridded-common';\r\nimport { NpnMapLayerService } from './npn-map-layer.service';\r\nimport { MapLayer, srsConversion, encodeHttpParams } from './map-layer';\r\nimport * as $jq_ from 'jquery';\r\nconst $jq = $jq_;\r\n\r\nexport class WmsMapLayer extends MapLayer {\r\n    private wmsArgs: any;\r\n    private sldBody: any;\r\n    private styleRange: number[];\r\n    googleLayer: google.maps.ImageMapType;\r\n    //[x: string]: any; // allow arbitrary properties\r\n\r\n    constructor(protected map: google.maps.Map, protected layer_def: MapLayerDefinition, protected layerService: NpnMapLayerService) {\r\n        super(map, layer_def, layerService);\r\n        if (layer_def.extent_values_filter) {\r\n            console.debug('layer ' + layer_def.name + ' has an extent_values_filter, processing', layer_def.extent_values_filter);\r\n            const valuesPipe = this.griddedPipes.get(layer_def.extent_values_filter.name), extentValues = layer_def.extent.values.map(e => e.value), filterArgs = [extentValues].concat(layer_def.extent_values_filter.args || []), filteredValues = valuesPipe.transform.apply(valuesPipe, filterArgs);\r\n            console.debug('filteredValues', (filteredValues.length > 1 ? (filteredValues[0] + '...' + filteredValues[filteredValues.length - 1]) : filteredValues));\r\n            layer_def.extent.values = layer_def.extent.values.filter(function (v) {\r\n                return filteredValues.indexOf(v.value) !== -1;\r\n            });\r\n            if (layer_def.extent.current && filteredValues.indexOf(layer_def.extent.current.value) === -1) {\r\n                console.debug('current extent value has become invalid, replacing with last option');\r\n                layer_def.extent.current = layer_def.extent.values.length ? layer_def.extent.values[layer_def.extent.values.length - 1] : undefined;\r\n            }\r\n        }\r\n        if (layer_def.extent_default_filter) {\r\n            console.debug('layer ' + layer_def.name + ' has an extent_default_filter, processing', layer_def.extent_default_filter);\r\n            let defaultPipe = this.griddedPipes.get(layer_def.extent_default_filter.name), defaultFilterArgs = [layer_def.extent.values].concat(layer_def.extent_default_filter.values || []);\r\n            layer_def.extent.current = defaultPipe.transform.apply(defaultPipe, defaultFilterArgs) || layer_def.extent.current;\r\n            console.debug('resulting default value', layer_def.extent.current);\r\n        }\r\n        /*\r\n        if(layer_def.description) {\r\n            layer_def.$description = $sce.trustAsHtml(layer_def.description);\r\n        }*/\r\n        this.wmsArgs = { ...BASE_WMS_ARGS, ...{ layers: layer_def.name } };\r\n        this.googleLayer = new google.maps.ImageMapType({\r\n            getTileUrl: (coord: google.maps.Point, zoom: number) => {\r\n                let proj = this.map.getProjection(), zfactor = Math.pow(2, zoom), top = proj.fromPointToLatLng(new google.maps.Point(coord.x * BOX_SIZE / zfactor, coord.y * BOX_SIZE / zfactor)), bot = proj.fromPointToLatLng(new google.maps.Point((coord.x + 1) * BOX_SIZE / zfactor, (coord.y + 1) * BOX_SIZE / zfactor)), ctop = srsConversion(top), cbot = srsConversion(bot), base = {};\r\n                if (this.extent && this.extent.current) {\r\n                    this.extent.current.addToParams(base, MapLayerServiceType.WMS);\r\n                }\r\n                var args: any = { bbox: [ctop.lng, cbot.lat, cbot.lng, ctop.lat].join(',') };\r\n                if (this.sldBody) {\r\n                    args.sld_body = this.sldBody;\r\n                }\r\n                let all_args = { ...base, ...this.wmsArgs, ...args };\r\n                return this.griddedUrls.wmsBaseUrl + '?' + encodeHttpParams(all_args);\r\n            },\r\n            tileSize: new google.maps.Size(BOX_SIZE, BOX_SIZE),\r\n            //isPng: true,\r\n            name: (layer_def.title || layer_def.name)\r\n        });\r\n        this.googleLayer.setOpacity(this.opacity);\r\n    }\r\n    setOpacity(opacity:number) {\r\n        this.opacity = opacity;\r\n        if(this.googleLayer) {\r\n            this.googleLayer.setOpacity(opacity);\r\n        }\r\n    }\r\n    on(): WmsMapLayer {\r\n        //TODO Analytics.trackEvent('gridded-layer','on',this.title);\r\n        this.map.overlayMapTypes.push(this.googleLayer);\r\n        return this;\r\n    }\r\n    off(): WmsMapLayer {\r\n        if (this.map.overlayMapTypes.getLength()) {\r\n            //TODO Analytics.trackEvent('gridded-layer','off',this.title);\r\n            this.map.overlayMapTypes.pop();\r\n        }\r\n        // TODO deal with pest map which is a google.maps.GroundOverlay\r\n        return this;\r\n    }\r\n    bounce(): WmsMapLayer {\r\n        if (this.map.overlayMapTypes.getLength()) {\r\n            this.map.overlayMapTypes.pop();\r\n        }\r\n        this.map.overlayMapTypes.push(this.googleLayer);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets the style to pass to the WMS service, used to limit the layer to a range.\r\n     * \r\n     * @param style The new style (XML as a stirng)\r\n     */\r\n    setStyle(style:any) {\r\n        if(style !== this.sldBody) { // avoid off/on if nothing is changing\r\n            if(style) {\r\n                console.debug('style:',style);\r\n            }\r\n            this.sldBody = style;\r\n            this.bounce();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns The style range if any was set.\r\n     */\r\n    getStyleRange():number[] {\r\n        return this.styleRange;\r\n    }\r\n\r\n    /**\r\n     * Sets the style range to pass along to the server.\r\n     * \r\n     * @param range The new style range.\r\n     */\r\n    setStyleRange(range:number[]):Promise<void> {\r\n        if(!(this.styleRange = range)) {\r\n            this.setStyle(undefined);\r\n            return Promise.resolve();\r\n        }\r\n        return this.getLegend().then(legend => {\r\n            const styleDef = legend.getStyleDefinition(),\r\n                data = legend.getData(),\r\n                minQ = data[range[0]].quantity,\r\n                maxQ = data[range[1]].quantity,\r\n                $styleDef = $jq(styleDef);\r\n            let colors = $styleDef.find('ColorMapEntry');\r\n            let colorMap = $styleDef.find('ColorMap');\r\n            // only want the first style assosiated with the layer\r\n            // todo: instead of picking first style, generalize to pick by name\r\n            while (styleDef[0].firstElementChild.firstElementChild.children.length > 2) {\r\n                styleDef[0].firstElementChild.firstElementChild.removeChild(styleDef[0].firstElementChild.firstElementChild.lastChild);\r\n            }    \r\n            if(colors.length === 0) {\r\n                colors = $styleDef.find('sld\\\\:ColorMapEntry'); // FF\r\n            }\r\n            if(colorMap.length === 0) {\r\n                colorMap = $styleDef.find('sld\\\\:ColorMap'); // FF\r\n            }\r\n            if(colorMap) {\r\n                colorMap.attr('type','intervals');\r\n            }\r\n            colors.each(function() {\r\n                var cme = $jq(this),\r\n                    q = parseInt(cme.attr('quantity'));\r\n                /*if(q === -9999) {\r\n                    cme.attr('opacity','0.0');\r\n                    //cme.remove();\r\n                } else {*/\r\n                    cme.attr('opacity',(q > minQ && q <= maxQ) ? '1.0' : '0.0');\r\n                /*}*/\r\n            });\r\n            this.setStyle(xmlToString(styleDef[0]));\r\n        });\r\n    }\r\n}\r\n\r\n\r\nfunction xmlToString(xmlData) {\r\n    let xmlString;\r\n    if ((window as any).ActiveXObject) {\r\n        xmlString = xmlData.xml; // MSIE\r\n    } else {\r\n        xmlString = (new XMLSerializer()).serializeToString(xmlData);\r\n    }\r\n    return xmlString;\r\n}","export * from './public_api';","import {NgModule} from '@angular/core';\r\nimport {HttpClientModule} from '@angular/common/http';\r\n\r\nimport {VisualizationsModule} from './visualizations';\r\nimport {NpnCommonModule} from './common';\r\n\r\nimport {FormsModule} from '@angular/forms';\r\n\r\n@NgModule({\r\n  declarations: [\r\n  ],\r\n  imports: [\r\n    NpnCommonModule,\r\n    VisualizationsModule,\r\n    HttpClientModule,\r\n    FormsModule\r\n  ]\r\n})\r\nexport class NpnLibModule { }\r\n","export * from './common/public_api';\r\nexport * from './gridded/public_api';\r\nexport * from './visualizations/public_api';\r\nexport * from './npn-lib.module';","import {selectionProperty,GET_EXTERNAL,SET_EXTERNAL, GroupHttpParams, SelectionGroup} from '../vis-selection';\r\nimport {\r\n    TaxonomicSpeciesTitlePipe,\r\n    DoyPipe,\r\n    SpeciesPlot,\r\n    TaxonomicSpeciesType,\r\n    TaxonomicSpeciesRank,\r\n    TaxonomicPhenophaseType,\r\n    TaxonomicPhenophaseRank,\r\n    SpeciesTitlePipe,\r\n    getSpeciesPlotKeys\r\n} from '../../common';\r\nimport {ActivityCurvesSelection} from './activity-curves-selection';\r\n\r\nimport * as d3 from 'd3';\r\nimport { HttpParams } from '@angular/common/http';\r\n\r\nexport interface ActivityCurveMagnitudeData {\r\n    start_doy?: number;\r\n    end_doy?: number;\r\n    start_date: string;\r\n    end_date: string;\r\n}\r\n\r\nexport class ActivityCurve implements SpeciesPlot {\r\n    @selectionProperty()\r\n    id:number;\r\n\r\n    childId:number = 0;\r\n\r\n    @selectionProperty()\r\n    speciesRank:TaxonomicSpeciesRank;\r\n    @selectionProperty()\r\n    private _species:TaxonomicSpeciesType;\r\n    @selectionProperty({\r\n        ser: d => d,\r\n        des: d => {\r\n            // when deserializing re-align with the actual metric object\r\n            // so equality checks elsewhere work.\r\n            return !!d\r\n                ? ALL_METRICS.find(m => m.id === d.id)\r\n                : d;\r\n        }\r\n    })\r\n    private _metric;\r\n    @selectionProperty()\r\n    phenophaseRank:TaxonomicPhenophaseRank;\r\n    @selectionProperty()\r\n    private _phenophase:TaxonomicPhenophaseType;\r\n    @selectionProperty()\r\n    private _year:number;\r\n\r\n    private _originalMetrics;\r\n    private _metrics;\r\n\r\n    @selectionProperty()\r\n    private _color:string;\r\n    orient:string;\r\n\r\n    doyFocus:number;\r\n\r\n    private $data:ActivityCurveMagnitudeData[];\r\n    private $metricData:any;\r\n    private $x;\r\n    private $y;\r\n\r\n    selection:ActivityCurvesSelection;\r\n    private _group:SelectionGroup;\r\n    private _children:ActivityCurve[];\r\n\r\n    private get children():ActivityCurve[] {\r\n        return this._children||[];\r\n    }\r\n\r\n    private get curveId():string {\r\n        return `${this.id}-${this.childId}`;\r\n    }\r\n\r\n    private copy(childIndex:number):ActivityCurve {\r\n        const copy = new ActivityCurve();\r\n        copy.id = this.id;\r\n        copy.childId = childIndex;\r\n        copy.color = this.color;\r\n        copy.orient = this.orient;\r\n        copy.speciesRank = this.speciesRank;\r\n        copy._species = this._species;\r\n        copy._metric = this._metric;\r\n        copy.phenophaseRank = this.phenophaseRank;\r\n        copy._phenophase = this._phenophase;\r\n        copy._year = this._year;\r\n        copy._color = this._color;\r\n        copy.selection = this.selection;\r\n        return copy;\r\n    }\r\n\r\n    get external() { return GET_EXTERNAL.apply(this,arguments); }\r\n    set external(o) { SET_EXTERNAL.apply(this,arguments); }\r\n\r\n    private reset() {\r\n        delete this.$data;\r\n        delete this.$metricData;\r\n        this.children.forEach(c => {\r\n            delete c.$data;\r\n            delete c.$metricData;\r\n        });\r\n    }\r\n\r\n    private updateCheck(requiresUpdate?:boolean) {\r\n        if(this.selection && this.isValid()) {\r\n            if(!this.plotted() || requiresUpdate) {\r\n                this.selection.update();\r\n            } else {\r\n                this.selection.redraw();\r\n            }\r\n        }\r\n    }\r\n\r\n    get year() {\r\n        return this._year;\r\n    }\r\n    set year(y) {\r\n        this.reset();\r\n        this._year = y;\r\n        this.children.forEach(c => c._year = y);\r\n        this.updateCheck(true);\r\n    }\r\n\r\n    get phenophase():TaxonomicPhenophaseType {\r\n        return this._phenophase;\r\n    }\r\n    set phenophase(p:TaxonomicPhenophaseType) {\r\n        this.reset();\r\n        this._phenophase = p;\r\n        this.children.forEach(c => c._phenophase = p);\r\n        this.updateCheck(true);\r\n    }\r\n\r\n    get color():string {\r\n        return this._color;\r\n    }\r\n    set color(c:string) {\r\n        this._color = c;\r\n        this.updateCheck(false);\r\n    }\r\n\r\n    get metric() {\r\n        return this._metric;\r\n    }\r\n    set metric(m) {\r\n        delete this.$metricData;\r\n        this._metric = m;\r\n        this.children.forEach(c => {\r\n            delete c.$metricData;\r\n            c._metric = m\r\n        });\r\n        this.updateCheck();\r\n    }\r\n\r\n    get species():TaxonomicSpeciesType {\r\n        return this._species;\r\n    }\r\n    set species(s:TaxonomicSpeciesType) {\r\n        this.reset();\r\n        this._species = s;\r\n        this.children.forEach(c => c._species = s);\r\n        this.phenophase = undefined;\r\n        this._metrics = this._species && this._species.kingdom \r\n            ? (ACTIVITY_CURVE_KINGDOM_METRICS[this._species.kingdom]||[])\r\n            : [];\r\n        this._originalMetrics = this._metrics;\r\n        if(this._metric && this._metrics.indexOf(this._metric) === -1) {\r\n            // previous metric has become invalid\r\n            this.metric = undefined;\r\n        }\r\n        if(this._metrics.length && !this._metric) {\r\n            this.metric = this._metrics[0];\r\n        }\r\n    }\r\n\r\n    get validMetrics() {\r\n        return (this._metrics||[]);\r\n    }\r\n\r\n    /**\r\n     * Puts all valid metrics back if they were overridden\r\n     */\r\n    overrideValidMetricsReset() {\r\n        this._metrics = this._originalMetrics;\r\n    }\r\n\r\n    /**\r\n     * Change which metrics are selectable.  This codes does NOT validate\r\n     * the input it should only ever be a subset of the originally valid\r\n     * metrics.\r\n     * \r\n     * @param valid The new set of valid metrics.\r\n     */\r\n    overrideValidMetrics(valid:any[]) {\r\n        this._metrics = valid;\r\n        if(this._metric && this._metrics.indexOf(this._metric) === -1) {\r\n            // previous metric has become invalid\r\n            delete this._metric;\r\n            if(this.selection) {\r\n                this.selection.redraw();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @return The metric label for the curve axis.\r\n     */\r\n    axisLabel(): string {\r\n        return this.metric ? this.metric.label : '?';\r\n    }\r\n\r\n    doyDataValue() {\r\n        let self = this,\r\n            data = self.data() as ActivityCurveMagnitudeData[],\r\n            value,d,i;\r\n        if(self.doyFocus && data) {\r\n            for(i = 0; i < data.length; i++) {\r\n                d = data[i];\r\n                if(self.doyFocus >= d.start_doy && self.doyFocus <= d.end_doy) {\r\n                    value = (self.metric.valueFormat||IDENTITY)(d[self.metric.id]);\r\n                    if(d[self.metric.sampleSize] !== -9999) {\r\n                        value += ' N:'+ d[self.metric.sampleSize];\r\n                    }\r\n                    return value;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @return Formatted label for the legend.\r\n     */\r\n    legendLabel(includeMetric:boolean) {\r\n        let doyFocusValue = this.doyDataValue();\r\n        const pp = this.phenophase as any;\r\n        return `${this.year}: `+\r\n               SPECIES_TITLE(this.species,this.speciesRank)+' - '+(pp.phenophase_name||pp.pheno_class_name)+\r\n               (includeMetric ? ` (${this.metric.label})` : '')+\r\n               (this._group ? ` (${this._group.label})` : '')+\r\n               (typeof(doyFocusValue) !== 'undefined' ? ` [${doyFocusValue}]` : '');\r\n    }\r\n\r\n    /**\r\n     * @return The metric id.\r\n     */\r\n    metricId() {\r\n        return this.metric? this.metric.id : undefined;\r\n    }\r\n\r\n    group(g:SelectionGroup):ActivityCurve {\r\n        this._group = g;\r\n        return this;\r\n    }\r\n\r\n    data(_?:ActivityCurveMagnitudeData[]):ActivityCurveMagnitudeData[]|ActivityCurve {\r\n        if(arguments.length) {\r\n            delete this.$data;\r\n            delete this.$metricData;\r\n            if(_) {\r\n                _.forEach(function(d) {\r\n                    d.start_doy = DOY(d.start_date);\r\n                    d.end_doy = DOY(d.end_date);\r\n                });\r\n                _.sort(function(a,b) {\r\n                    return a.start_doy - b.start_doy;\r\n                });\r\n                this.$data = _;\r\n            }\r\n            return this;\r\n        }\r\n        var self = this,\r\n            data = self.$data;\r\n        if(data && self.metric) {\r\n            // avoid re-filtering with UI updates, store the result and re-use until\r\n            // something changes\r\n            if(!self.$metricData) {\r\n                if(!self.metric.sampleSize) {\r\n                    console.warn('Metric does not define a sampleSize property, cannot filter out invalid data points.');\r\n                }\r\n                data = data.filter(function(d){\r\n                    if(self.metric.sampleSize && d[self.metric.sampleSize] === -9999) {\r\n                        //console.log('SAMPLE_SIZE filter.');\r\n                        return false;\r\n                    }\r\n                    return d[self.metric.id] !== -9999;\r\n                });\r\n                if(data.length !== self.$data.length) {\r\n                    console.debug('filtered out '+(self.$data.length-data.length)+'/'+ self.$data.length +' of -9999 records for metric ',self.metric);\r\n                }\r\n                /*\r\n                if(data.length === 26) { // simulate situation for development bi-weekly data\r\n                    //console.log('DEBUG CODE MODIFYING DATA!!');\r\n                    // create a single isolated data point and three separate curves\r\n                    // [0-9] [11] [13-19] [21-25]\r\n                    data = data.filter(function(d,i) {\r\n                        return (i !== 10 && i !== 12 && i !== 20);\r\n                    });\r\n                }*/\r\n                self.$metricData = data;\r\n            } else {\r\n                data = self.$metricData;\r\n            }\r\n        }\r\n        return data;\r\n    }\r\n\r\n    private endDate(year) {\r\n        var now = new Date();\r\n        if(year === now.getFullYear()) {\r\n            return this.selection.datePipe.transform(now,'yyyy-MM-dd');\r\n        }\r\n        return year+'-12-31';\r\n    }\r\n\r\n    /**\r\n     * Load data for this curve, or curves.  This function will return\r\n     * multiple curves if its selection is using grouping.  In that case the\r\n     * returned curves will be copies of this curve with the corresponding data populated\r\n     * on them.  Changes to this curve (what to plot, year, etc.) will ripple down into\r\n     * the curve copies so when rendered (via draw) on a visualization they will update.\r\n     * \r\n     * @param baseParams \r\n     */\r\n    loadData(baseParams:HttpParams):Promise<ActivityCurve []> {\r\n        let curveParams = baseParams\r\n            .set('start_date',`${this.year}-01-01`)\r\n            .set('end_date',this.endDate(this.year));\r\n        const keys = getSpeciesPlotKeys(this);\r\n        curveParams = curveParams.set(`${keys.speciesIdKey}[0]`,`${this.species[keys.speciesIdKey]}`);\r\n        if((this.speciesRank||TaxonomicSpeciesRank.SPECIES) !== TaxonomicSpeciesRank.SPECIES) {\r\n            curveParams = curveParams.set('taxonomy_aggregate','1');\r\n        }\r\n        curveParams = curveParams.set(`${keys.phenophaseIdKey}[0]`,`${this.phenophase[keys.phenophaseIdKey]}`);\r\n        if(this.phenophaseRank === TaxonomicPhenophaseRank.CLASS) {\r\n            curveParams = curveParams.set('pheno_class_aggregate','1');\r\n        }\r\n        const apiUrl = this.selection.serviceUtils.apiUrl('/npn_portal/observations/getMagnitudeData.json');\r\n        if(this.selection.groups && this.selection.groups.length) {\r\n            return this.selection.toGroupHttpParams(curveParams)\r\n                .then((groupParams:GroupHttpParams[]) => {\r\n                    // parallel arrays\r\n                    this._children = groupParams.map((gp,i) => this.copy(i));\r\n                    return Promise.all(\r\n                        this._children.map((curve,i) => this.selection.serviceUtils\r\n                            .cachedPost(apiUrl,groupParams[i].params.toString())\r\n                            .then(data => curve.group(groupParams[i].group).data(data) as ActivityCurve))\r\n                    )\r\n                });\r\n        } else {\r\n            return this.selection.serviceUtils\r\n                .cachedPost(apiUrl,curveParams.toString())\r\n                .then(data => [this.data(data) as ActivityCurve]);\r\n        }   \r\n    }\r\n\r\n    axis() {\r\n        var y = this.y(),\r\n            ticks = y.ticks(), // default is ~10 ticks\r\n            orient = this.orient||'left',\r\n            axis = orient === 'left' ? d3.axisLeft(y) : d3.axisRight(y);\r\n        if(ticks.length) {\r\n            // replace the final tick with the top of the y domain\r\n            // that -would- have been generated and use them explicitly\r\n            // this can result in ticks stacked on on another if too close\r\n            //ticks.push(y.domain()[1]);\r\n            // this often results in a larger space between the two topmost ticks\r\n            ticks[ticks.length-1] = y.domain()[1];\r\n            axis.tickValues(ticks);\r\n        }\r\n        return axis;\r\n    }\r\n\r\n    x(_?) {\r\n        if(arguments.length) {\r\n            this.$x = _;\r\n            return this;\r\n        }\r\n        return this.$x;\r\n    }\r\n\r\n    y(_?) {\r\n        if(arguments.length) {\r\n            this.$y = _;\r\n            return this;\r\n        }\r\n        return this.$y;\r\n    }\r\n\r\n    isValid():boolean {\r\n        return !!this.species &&\r\n            !!this.phenophase &&\r\n            !!this.year &&\r\n            !!this.metric;\r\n    }\r\n\r\n    plotted(): boolean {\r\n        // not keeping track of a flag but curves are plotted if they\r\n        // are valid and have data\r\n        const data = this.data() as ActivityCurveMagnitudeData[];\r\n        if(this.isValid() && !!data) {\r\n            return true; // this curve is plotted\r\n        }\r\n        // plotted if any children are plotted\r\n        return this.children.reduce((plotted,child) => (plotted||(child.plotted ? true: false)),false);\r\n    }\r\n\r\n    shouldRevisualize():boolean {\r\n        return this.isValid() && !this.data();\r\n    }\r\n\r\n    domain() {\r\n        var self = this,\r\n            data = self.data() as ActivityCurveMagnitudeData[],\r\n            extents;\r\n        if(data && self.metric) {\r\n            extents = d3.extent(data,function(d){\r\n                return d[self.metric.id];\r\n            });\r\n            if(extents[0] > 0) {\r\n                // typically data sets will contain 0 but really always want the\r\n                // lower extent of any y axis to be zero so make it so\r\n                extents[0] = 0;\r\n            } else if(extents[0] < 0) {\r\n                // this shouldn't happen but don't futz with the domain in this\r\n                // case or the graph would go wonky\r\n                console.warn('negative domain start for metric',extents,self.metric);\r\n            }\r\n            return extents;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Searches this curve's data for a data point nearest to a doy.\r\n     * \r\n     * @param doy The doy to find the nearest data to.\r\n     * @returns ActivityCurveMagnitudeData or undefined\r\n     */\r\n    nearest(doy:number):ActivityCurveMagnitudeData {\r\n        const data = this.data() as ActivityCurveMagnitudeData[];\r\n        return data.reduce((found,md) => (found||(doy >= md.start_doy && doy <= md.end_doy ? md : undefined)),undefined);\r\n    }\r\n\r\n    draw(chart) {\r\n        let self = this,\r\n            data = self.data() as ActivityCurveMagnitudeData[],\r\n            datas = [[]],\r\n            x,y,i,d,dn,line,\r\n            r = 3;\r\n        chart.selectAll(`g.curve.curve-${self.curveId}`).remove();\r\n        const g = chart.append('g')\r\n            .attr('class',`curve curve-${self.curveId}`);\r\n        if(data && data.length) {\r\n            // detect any gaps in the data, break it into multiple curves/points\r\n            // to plot\r\n            for(i = 0; i < data.length; i++) {\r\n                d = data[i];\r\n                dn = (i+1) < data.length ? data[i+1] : undefined;\r\n                datas[datas.length-1].push(d);\r\n                if(dn && dn.start_doy !== (d.end_doy+1)) {\r\n                    datas.push([]); // there's a gap in the data, start another curve or point\r\n                }\r\n            }\r\n            x = self.x();\r\n            y = self.y();\r\n            let x_functor = (d) => x(d.start_doy+Math.round((d.end_doy-d.start_doy)/2)),\r\n                y_functor = (d) => y(d[self.metric.id]);\r\n            line = d3.line();\r\n            switch(self.selection.interpolate) {\r\n                case INTERPOLATE.monotone:\r\n                    line.curve(d3.curveMonotoneX);\r\n                    break;\r\n                case INTERPOLATE.stepAfter:\r\n                    line.curve(d3.curveStepAfter);\r\n                    break;\r\n                case INTERPOLATE.linear:\r\n                    line.curve(d3.curveLinear);\r\n                    break;\r\n            }\r\n            line.x(x_functor);\r\n            line.y(y_functor);\r\n            console.debug('ActivityCurve.draw',self.species,self.phenophase,self.year,self.metric,self.domain(),y.domain());\r\n            console.debug('draw.datas',datas);\r\n            datas.forEach(function(curve_data,i){\r\n                if(curve_data.length === 1 || self.selection.dataPoints) {\r\n                    curve_data.forEach(function(d){\r\n                        g.append('circle')\r\n                            .attr('class','curve-point curve-point-'+self.curveId)\r\n                            .attr('r',r)\r\n                            .attr('fill',self.color)\r\n                            .attr('cx',x_functor(d))\r\n                            .attr('cy',y_functor(d));\r\n                    });\r\n                }\r\n                if(curve_data.length > 1) {\r\n                    g.append('path')\r\n                        .attr('class','curve curve-'+self.curveId)\r\n                        .attr('fill','none')\r\n                        .attr('stroke',self.color)\r\n                        .attr('stroke-linejoin','round')\r\n                        .attr('stroke-linecap','round')\r\n                        .attr('stroke-width',1.5)\r\n                        .attr('d',line(curve_data));\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\nexport enum INTERPOLATE {\r\n    linear,\r\n    stepAfter,\r\n    monotone\r\n};\r\nconst DECIMAL = v => v.toFixed(2);\r\nconst IDENTITY = o => o;\r\nconst SPECIES_TITLE_PIPE = new TaxonomicSpeciesTitlePipe(new SpeciesTitlePipe());\r\nconst SPECIES_TITLE = (item: TaxonomicSpeciesType,rank:TaxonomicSpeciesRank) => SPECIES_TITLE_PIPE.transform(item,rank);\r\nconst DOY_PIPE = new DoyPipe();\r\nconst DOY = (date,ignoreLeapYear?:boolean): any => DOY_PIPE.transform(date,ignoreLeapYear);\r\n\r\nconst COMMON_METRICS:any[] = [{\r\n            id: 'num_yes_records',\r\n            sampleSize: 'status_records_sample_size',\r\n            label: 'Total Yes Records'\r\n        },{\r\n            id: 'proportion_yes_records',\r\n            sampleSize: 'status_records_sample_size',\r\n            label: 'Proportion Yes Records',\r\n            valueFormat: DECIMAL,\r\n            proportion: true\r\n        }];\r\nexport const ACTIVITY_CURVE_KINGDOM_METRICS = {\r\n            Plantae: COMMON_METRICS.concat([{\r\n                id: 'numindividuals_with_yes_record',\r\n                sampleSize: 'individuals_sample_size',\r\n                label: 'Total Individuals with Yes Records'\r\n            },{\r\n                id: 'proportion_individuals_with_yes_record',\r\n                sampleSize: 'individuals_sample_size',\r\n                label: 'Proportion Individuals with Yes Records',\r\n                valueFormat: DECIMAL,\r\n                proportion: true\r\n            }]),\r\n            Animalia: COMMON_METRICS.concat([{\r\n                id: 'numsites_with_yes_record',\r\n                sampleSize: 'sites_sample_size',\r\n                label: 'Total Sites with Yes Records'\r\n            },{\r\n                id: 'proportion_sites_with_yes_record',\r\n                sampleSize: 'sites_sample_size',\r\n                label: 'Proportion Sites with Yes Records',\r\n                valueFormat: DECIMAL,\r\n                proportion: true\r\n            },{\r\n                id: 'total_numanimals_in-phase',\r\n                sampleSize: 'in-phase_site_visits_sample_size',\r\n                label: 'Total Animals In Phase'\r\n            },\r\n            {\r\n                id: 'mean_numanimals_in-phase',\r\n                sampleSize: 'in-phase_per_hr_sites_sample_size',\r\n                label: 'Animals In Phase',\r\n                valueFormat: DECIMAL\r\n            },{\r\n                id: 'mean_numanimals_in-phase_per_hr',\r\n                sampleSize: 'in-phase_per_hr_sites_sample_size',\r\n                label: 'Animals In Phase per Hour',\r\n                valueFormat: DECIMAL\r\n            },{\r\n                id: 'mean_numanimals_in-phase_per_hr_per_acre',\r\n                sampleSize: 'phase_per_hr_per_acre_sites_sample_size',\r\n                label: 'Animals In Phase per Hour per Acre',\r\n                valueFormat: DECIMAL\r\n            }])\r\n        };\r\n\r\nconst ALL_METRICS = Object.keys(ACTIVITY_CURVE_KINGDOM_METRICS).reduce((arr,key) =>{\r\n    ACTIVITY_CURVE_KINGDOM_METRICS[key]\r\n        .filter(metric => arr.indexOf(metric) === -1)\r\n        .forEach(metric => arr.push(metric));\r\n    return arr;\r\n},[]);","import {Component,Input} from '@angular/core';\r\n\r\nimport {INTERPOLATE, ActivityCurve} from './activity-curve';\r\nimport {ActivityCurvesSelection,ActivityFrequency,ACTIVITY_FREQUENCIES} from './activity-curves-selection';\r\nimport {STATIC_COLORS} from '../../common';\r\nimport { faExclamationTriangle } from '@fortawesome/pro-light-svg-icons';\r\n\r\nexport const ACTIVITY_CURVES_INTERPOLATES = [{\r\n    value: INTERPOLATE.linear,\r\n    label: 'Linear'\r\n},{\r\n    value: INTERPOLATE.monotone,\r\n    label: 'Monotone',\r\n},{\r\n    value: INTERPOLATE.stepAfter,\r\n    label: 'Step after'\r\n}];\r\n\r\n@Component({\r\n    selector: 'activity-curves-control',\r\n    template: `\r\n    <div *ngIf=\"!selection.canAddPlot\" class=\"max-plots-reached\"><fa-icon [icon]=\"faExclamationTriangle\"></fa-icon> One more curve would exceed the maximum of {{selection.MAX_PLOTS}} allowed</div>\r\n    <div class=\"curve mat-elevation-z1\" *ngFor=\"let curve of selection.curves; index as i\">\r\n        <label>Curve #{{i+1}}</label>\r\n        <curve-selection-control\r\n            [selection]=\"selection\"\r\n            [curve]=\"curve\"\r\n            [required]=\"i === 0\"\r\n            [gatherColor]=\"true\"\r\n            (onSpeciesChange)=\"speciesMetricChange($event)\"\r\n            (onMetricChange)=\"speciesMetricChange($event)\">\r\n            </curve-selection-control>\r\n        <div class=\"action-holder\">\r\n            <button *ngIf=\"selection.curves.length > 1\" mat-button (click)=\"removeCurve(i)\">Remove curve</button>\r\n            <button *ngIf=\"i === selection.curves.length-1\" mat-button (click)=\"addCurve()\" [disabled]=\"!selection.canAddPlot\">Add curve</button>\r\n        </div>\r\n    </div>\r\n    <div class=\"curve-common\">\r\n        <mat-form-field class=\"date-interval\">\r\n            <mat-select placeholder=\"Date Interval\" [(ngModel)]=\"selection.frequency\">\r\n                <mat-option *ngFor=\"let f of frequencies\" [value]=\"f\">{{f.label}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n\r\n        <mat-form-field class=\"line-interpolateion\">\r\n            <mat-select placeholder=\"Line Interpolation\" [(ngModel)]=\"selection.interpolate\">\r\n                <mat-option *ngFor=\"let i of interpolates\" [value]=\"i.value\">{{i.label}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n\r\n        <mat-checkbox [(ngModel)]=\"selection.dataPoints\">Show data points</mat-checkbox>\r\n    </div>\r\n    `,\r\n    styles:[`\r\n        .curve,\r\n        .curve-common {\r\n            display: flex;\r\n            align-items: center;\r\n            margin: 2px 2px 5px 2px;\r\n            padding: 4px;\r\n        }\r\n        .curve-common {\r\n            margin-top: 10px;\r\n        }\r\n        .curve >label {\r\n            white-space: nowrap;\r\n        }\r\n        .curve >label:after {\r\n            content: ':';\r\n            margin-right: 10px;\r\n        }\r\n        .curve >.action-holder {\r\n            display: flex;\r\n            flex-direction: column;\r\n        }\r\n        .date-interval {\r\n            width: 125px;\r\n        }\r\n        .line-interpolateion {\r\n            width: 150px;\r\n        }\r\n        .action-holder {\r\n            margin: 10px 0px;\r\n            text-align: right;\r\n        }\r\n    `]\r\n})\r\nexport class ActivityCurvesControlComponent {\r\n    @Input()\r\n    selection: ActivityCurvesSelection;\r\n\r\n    frequencies:ActivityFrequency[] =  ACTIVITY_FREQUENCIES;\r\n    interpolates:any[] = ACTIVITY_CURVES_INTERPOLATES;\r\n    faExclamationTriangle = faExclamationTriangle;\r\n\r\n    addCurve() {\r\n        const curve = new ActivityCurve();\r\n        curve.id = this.selection.curves.length;\r\n        curve.color = STATIC_COLORS[curve.id];\r\n        curve.selection = this.selection;\r\n        this.selection.curves.push(curve);\r\n    }\r\n\r\n    removeCurve(i) {\r\n        this.selection.curves.splice(i,1);\r\n        this.selection.update();\r\n        this.speciesMetricChange();\r\n    }\r\n\r\n    speciesMetricChange() {\r\n        // need to prevent more than two metrics being selected\r\n        const curves = this.selection.curves||[];\r\n        const selectedMetrics = [];\r\n        curves.forEach(c => {\r\n            c.overrideValidMetricsReset();\r\n            if(selectedMetrics.length === 2) {\r\n                const valid = c.validMetrics;\r\n                c.overrideValidMetrics(selectedMetrics.filter(m => valid.indexOf(m) !== -1));\r\n            } else if (c.metric && selectedMetrics.indexOf(c.metric) === -1) {\r\n                selectedMetrics.push(c.metric);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { DatePipe } from '@angular/common';\r\nimport { NpnServiceUtils, SpeciesService, NetworkService } from '../../common';\r\nimport { ActivityCurvesSelection } from './activity-curves-selection';\r\n\r\n@Injectable()\r\nexport class ActivityCurvesSelectionFactory {\r\n    constructor(\r\n        protected serviceUtils:NpnServiceUtils,\r\n        protected datePipe: DatePipe,\r\n        protected speciesService:SpeciesService,\r\n        protected networkService:NetworkService\r\n    ) {}\r\n\r\n    newSelection(): ActivityCurvesSelection {\r\n        return new ActivityCurvesSelection(this.serviceUtils,this.datePipe,this.speciesService,this.networkService);\r\n    }\r\n}\r\n","import { HttpParams } from '@angular/common/http';\r\nimport { DatePipe } from '@angular/common';\r\n\r\nimport { NpnServiceUtils, TaxonomicSpeciesRank, TaxonomicPhenophaseRank, getSpeciesPlotKeys, SpeciesService, NetworkService, getStaticColor, STATIC_COLORS } from '../../common';\r\n\r\nimport { INTERPOLATE, ActivityCurve } from './activity-curve';\r\nimport { StationAwareVisSelection, selectionProperty, BASE_POP_INPUT, POPInput } from '../vis-selection';\r\n\r\nexport class ActivityFrequency {\r\n    value:string|number;\r\n    label:string;\r\n}\r\nexport const ACTIVITY_FREQUENCY_MONTHLY:ActivityFrequency = {\r\n    value: 'months',\r\n    label: 'Monthly'\r\n};\r\nexport const ACTIVITY_FREQUENCY_BIWEEKLY:ActivityFrequency = {\r\n    value: 14,\r\n    label: 'Bi-weekly'\r\n};\r\nexport const ACTIVITY_FREQUENCY_WEEKLY:ActivityFrequency = {\r\n    value: 7,\r\n    label: 'Weekly'\r\n};\r\nexport const ACTIVITY_FREQUENCIES:ActivityFrequency[] = [\r\n    ACTIVITY_FREQUENCY_MONTHLY,\r\n    ACTIVITY_FREQUENCY_BIWEEKLY,\r\n    ACTIVITY_FREQUENCY_WEEKLY\r\n];\r\n\r\n// @dynamic\r\nexport class ActivityCurvesSelection extends StationAwareVisSelection {\r\n    $supportsPop:boolean = true;\r\n\r\n    @selectionProperty()\r\n    $class:string = 'ActivityCurvesSelection';\r\n\r\n    defaultInterpolate = INTERPOLATE.monotone;\r\n    @selectionProperty()\r\n    private _interpolate: INTERPOLATE = INTERPOLATE.monotone;\r\n    @selectionProperty()\r\n    private _dataPoints:boolean = true;\r\n    defaultFrequency = ACTIVITY_FREQUENCIES[0];\r\n    @selectionProperty({\r\n        ser: d => d,\r\n        des: d => {\r\n            // when deserializing re-align with the actual metric object\r\n            // so equality checks elsewhere work.\r\n            return !!d\r\n                ? ACTIVITY_FREQUENCIES.find(af => d.value === af.value)\r\n                : d;\r\n        }\r\n    })\r\n    private _frequency:ActivityFrequency = ACTIVITY_FREQUENCIES[0];\r\n    @selectionProperty({\r\n        ser: d => d ? d.external : undefined,\r\n        des: d => {\r\n            let ac = new ActivityCurve();\r\n            ac.external = d;\r\n            return ac;\r\n        }\r\n    })\r\n    private _curves:ActivityCurve[];\r\n\r\n    /** The maximum number of plots we want to allow. */\r\n    readonly MAX_PLOTS:number = 6;\r\n\r\n    constructor(\r\n        public serviceUtils:NpnServiceUtils,\r\n        public datePipe: DatePipe,\r\n        public speciesService:SpeciesService,\r\n        public networkService:NetworkService\r\n    ) {\r\n        super(serviceUtils,networkService);\r\n        // create a default empty curve\r\n        const curve0 = new ActivityCurve();\r\n        curve0.color = STATIC_COLORS[0];\r\n        curve0.id = 0;\r\n        this.curves = [curve0];\r\n    }\r\n\r\n    /**\r\n     * Indicates whether or not adding one more plot will result in a visualization exceeding\r\n     * the maximum number of allowed plots.\r\n     */\r\n    get canAddPlot():boolean {\r\n        const groups = this.groups ? this.groups.length : 0;\r\n        const next_plots = (this._curves ? this._curves.length : 0)+1;\r\n        const next_count = groups ? (groups * next_plots) : next_plots;\r\n        return next_count <= this.MAX_PLOTS;\r\n    }\r\n\r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        return super.toPOPInput(input)\r\n            .then(input => {\r\n                const yearRange = this.validCurves.reduce((range,curve) => {\r\n                        if(!range) {\r\n                            return [curve.year,curve.year];\r\n                        }\r\n                        if(curve.year < range[0]) {\r\n                            range[0] = curve.year;\r\n                        }\r\n                        if(curve.year > range[1]) {\r\n                            range[1] = curve.year;\r\n                        }\r\n                        return range;\r\n                    },undefined);\r\n                if(yearRange) {\r\n                    input.startDate = `${yearRange[0]}-01-01`;\r\n                    input.endDate = `${yearRange[1]}-12-31`;\r\n                }\r\n                return this.speciesService.getSpeciesIds(this.validCurves)\r\n                    .then(ids => {\r\n                        input.species = ids;\r\n                        return input;\r\n                    });\r\n            });\r\n    }\r\n\r\n    hasValidCurve():boolean {\r\n        return this.validCurves.length > 0;\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return  typeof(this._interpolate) === 'number' && // is a numeric based enum with a 0\r\n            !!this._frequency &&\r\n            this.hasValidCurve();\r\n    }\r\n\r\n    private updateCheck(requiresUpdate?:boolean) {\r\n        const anyValid = this.hasValidCurve();\r\n        const anyPlotted = this.curves.reduce((plotted,curve) => (plotted||curve.plotted()),false);\r\n        if(requiresUpdate) {\r\n            if(anyValid) {\r\n                this.update();\r\n            }\r\n        } else {\r\n            if(anyValid && anyPlotted) {\r\n                this.redraw();\r\n            } else if (anyValid) {\r\n                this.update();\r\n            }\r\n        }\r\n    }\r\n\r\n    set frequency(f:ActivityFrequency) {\r\n        this._frequency = f;\r\n        // any change in frequency invalidates any data held by curves\r\n        (this._curves||[]).forEach((c:any) => {\r\n            c._frequency = f;\r\n            c.data(null);\r\n        });\r\n        this.updateCheck(true);\r\n    }\r\n\r\n    get frequency():ActivityFrequency {\r\n        return this._frequency;\r\n    }\r\n\r\n    set interpolate(i:INTERPOLATE) {\r\n        this._interpolate = i;\r\n        this.updateCheck();\r\n    }\r\n\r\n    get interpolate():INTERPOLATE {\r\n        return this._interpolate;\r\n    }\r\n\r\n    get dataPoints():boolean {\r\n        return this._dataPoints;\r\n    }\r\n    set dataPoints(dp:boolean) {\r\n        this._dataPoints = dp;\r\n        this.updateCheck(false);\r\n    }\r\n\r\n    set curves(cs:ActivityCurve[]) {\r\n        this._curves = cs;\r\n        (this._curves||[]).forEach(c => c.selection = this);\r\n    }\r\n\r\n    get curves():ActivityCurve[] {\r\n        return this._curves;\r\n    }\r\n\r\n    get validCurves():ActivityCurve[] {\r\n        return (this._curves||[]).filter(c => c.isValid());\r\n    }\r\n\r\n    /**\r\n     * Load all the curves and their data.  It's ipmortant to understand that this function\r\n     * may return more curves than are defined on the selection and the resulting curves may\r\n     * not be references to those held on this selection.\r\n     */\r\n    loadCurves(): Promise<ActivityCurve[]> {\r\n        this.working = true;\r\n        return this.toURLSearchParams(new HttpParams()\r\n                .set('request_src','npn-vis-activity-curves')\r\n                .set('frequency',`${this.frequency.value}`)\r\n            ).then((baseParams:HttpParams) => {\r\n                const promises:Promise<ActivityCurve[]>[] = this.curves\r\n                    .filter(c => (c.data(null) as ActivityCurve).isValid())\r\n                    .map(c => c.loadData(baseParams));\r\n                return Promise.all(promises)\r\n                    .then((curves:ActivityCurve[][]) => {\r\n                        this.working = false;\r\n                        const toPlot = curves.reduce((arr,list) => arr.concat(list),[]);\r\n                        if(this.groups && this.groups.length) {\r\n                            toPlot.forEach((curve,index) => curve.color = getStaticColor(index));\r\n                        }\r\n                        return toPlot;\r\n                    })\r\n                    .catch(err => {\r\n                        this.working = false;\r\n                        //throw err;\r\n                        this.handleError(err);\r\n                        return [];\r\n                    });\r\n            });    \r\n    }\r\n\r\n    protected handleError(error: any): void {\r\n        console.error('ERROR',error);\r\n    }\r\n}\r\n","import { Component, Input, ElementRef } from '@angular/core';\r\n\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport { LegendDoyPipe } from '../../common';\r\nimport { VisualizationMargins } from '../visualization-base.component';\r\nimport { ONE_DAY_MILLIS } from '../vis-selection';\r\nimport { SvgVisualizationBaseComponent } from '../svg-visualization-base.component';\r\n\r\nimport { ActivityCurvesSelection } from './activity-curves-selection';\r\n\r\nimport { Axis, axisBottom } from 'd3-axis';\r\nimport { ScaleLinear, scaleLinear } from 'd3-scale';\r\nimport * as d3 from 'd3';\r\nimport { ActivityCurve, ActivityCurveMagnitudeData } from './activity-curve';\r\n\r\nconst ROOT_DATE = new Date(2010,0);\r\nconst D3_DATE_FMT = d3.timeFormat('%m/%d');\r\nconst DATE_FMT = (d) => {\r\n    let time = ((d-1)*ONE_DAY_MILLIS)+ROOT_DATE.getTime(),\r\n        date = new Date(time);\r\n    return D3_DATE_FMT(date);\r\n};\r\nconst PAD_DOMAIN = (d,metric) => {\r\n    if(d && d.length === 2) {\r\n        d = [d[0],(d[1]*1.05)];\r\n        if(metric && metric.proportion && d[1] > 1) {\r\n            d[1] = 1.0; // don't allow proportions to overflow for clarity.\r\n        }\r\n    }\r\n    return d;\r\n};\r\n\r\nconst DOY_INTERVAL_TICK = (interval) => {\r\n    var doy = 1,\r\n        ticks = [];\r\n    while(doy <= 365) {\r\n        ticks.push(doy);\r\n        doy += interval;\r\n    }\r\n    return ticks;\r\n};\r\nconst X_TICK_CFG = {\r\n    7: {\r\n        rotate: 45,\r\n        values: DOY_INTERVAL_TICK(14)\r\n    },\r\n    14: {\r\n        rotate: 45,\r\n        values: DOY_INTERVAL_TICK(28)\r\n    },\r\n    months: {\r\n        values: [1,32,60,91,121,152,182,213,244,274,305,335]\r\n    }\r\n};\r\n\r\nconst DEFAULT_TOP_MARGIN = 80;\r\nconst LEGEND_VPAD = 4;\r\nconst MARGIN_VPAD = 10;\r\n\r\n@Component({\r\n    selector: 'activity-curves',\r\n    templateUrl: '../svg-visualization-base.component.html',\r\n    styleUrls: ['../svg-visualization-base.component.scss']\r\n})\r\nexport class ActivityCurvesComponent extends SvgVisualizationBaseComponent {\r\n    @Input() selection: ActivityCurvesSelection;\r\n\r\n    x: ScaleLinear<number,number>;\r\n    xAxis: Axis<number>;\r\n\r\n    filename:string = 'activity-curves.png';\r\n    margins: VisualizationMargins = {top: DEFAULT_TOP_MARGIN,left: 80,right: 80,bottom: 80};\r\n\r\n    private _curves:ActivityCurve[];\r\n\r\n    constructor(protected rootElement: ElementRef,protected media:ObservableMedia,private legendDoyPipe: LegendDoyPipe) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    get curves():ActivityCurve[] {\r\n        return (this._curves||[]).filter(c => c.isValid());\r\n    }\r\n\r\n    /**\r\n     * Organizes the valid curves into a map of metric to curves using that metric.\r\n     */\r\n    private byMetric() {\r\n        return this.curves.reduce((map,c) => {\r\n            map[c.metric.id] = map[c.metric.id]||{\r\n                metric: c.metric,\r\n                curves: []\r\n            };\r\n            map[c.metric.id].curves.push(c);\r\n            return map;\r\n        },{});\r\n    }\r\n\r\n    /**\r\n     * Tests to see if the curves are all using the same metric.\r\n     */\r\n    private usingCommonMetric() {\r\n        const curves = this.curves;\r\n        // could be byMetric().length === 1 but this could be more performant\r\n        return curves.length > 0\r\n            // all curves using same metric.\r\n            ? curves.reduce((metric,curve) => metric === curve.metric ? metric : undefined,\r\n                curves[0].metric)\r\n            : undefined;\r\n    }\r\n\r\n    private newY() {\r\n        let sizing = this.sizing;\r\n        return scaleLinear().range([sizing.height,0]).domain([0,100]);\r\n    }\r\n\r\n    private updateLegend(): void {\r\n        const {chart,sizing,selection} = this;\r\n        chart.select('.legend').remove();\r\n        const commonMetric = this.usingCommonMetric();\r\n        const legend = chart.append('g')\r\n                .attr('class','legend')\r\n                // the 150 below was picked just based on the site of the 'Activity Curves' title\r\n                .attr('transform',`translate(90,-${sizing.margin.top-10})`) // relative to the chart, not the svg\r\n                .style('font-size','1em');\r\n        \r\n        const r = 5;\r\n        this.curves.filter(c => c.plotted())\r\n            .forEach((curve,index) => {\r\n                const yTrans = (((index+1)*(this.baseFontSize() as number))+(index*LEGEND_VPAD));\r\n                const legendItem = legend.append('g')\r\n                    .attr('class',`legend-item curve-${curve.id} row-${index}`)\r\n                    .attr('transform',`translate(0,${yTrans})`);\r\n                legendItem.append('circle')\r\n                    .attr('r',r)\r\n                    .attr('fill',curve.color);\r\n                legendItem.append('text')\r\n                    .style('font-size', this.baseFontSize(true))\r\n                    .attr('x',(2*r))\r\n                    .attr('y',(r/2))\r\n                    .text(curve.legendLabel(!commonMetric));\r\n            });\r\n    }\r\n\r\n    private hover():void {\r\n        let svg = this.svg,\r\n            selection = this.selection,\r\n            sizing = this.sizing,\r\n            self = this,\r\n            x = this.x;\r\n        let hover = svg.append('g')\r\n            .attr('transform', 'translate(' + sizing.margin.left + ',' + sizing.margin.top + ')')\r\n            .style('display','none');\r\n        let hoverLine = hover.append('line')\r\n                .attr('class','focus')\r\n                .attr('fill','none')\r\n                .attr('stroke','green')\r\n                .attr('stroke-width',1)\r\n                .attr('x1',0)\r\n                .attr('y1',0)\r\n                .attr('x2',0)\r\n                .attr('y2',sizing.height),\r\n            hoverDoy = hover.append('text')\r\n                .attr('class','focus-doy')\r\n                .attr('y',10)\r\n                .attr('x',0)\r\n                .text('hover doy');\r\n        let focusOff = () => {\r\n                this.curves.forEach(function(c) { delete c.doyFocus; });\r\n                hover.style('display','none');\r\n                this.updateLegend();\r\n            },\r\n            focusOn = () => {\r\n                // only turn on if something has been plotted\r\n                if(this.curves.reduce(function(plotted,c){\r\n                        return plotted||c.plotted();\r\n                    },false)) {\r\n                    hover.style('display',null);\r\n                }\r\n            };\r\n\r\n        // left as function due to d3's use of `this`\r\n        function updateFocus() {\r\n            let coords = d3.mouse(this),\r\n                xCoord = coords[0],\r\n                yCoord = coords[1],\r\n                doy = Math.round(x.invert(xCoord)),\r\n                dataPoint:ActivityCurveMagnitudeData = self.curves.reduce(function(dp:ActivityCurveMagnitudeData,curve){\r\n                    if(!dp && curve.plotted()) {\r\n                        dp = curve.nearest(doy);\r\n                    }\r\n                    return dp;\r\n                },undefined);\r\n            hoverLine.attr('transform','translate('+xCoord+')');\r\n            hoverDoy\r\n                .style('text-anchor',doy < 324 ? 'start' : 'end')\r\n                .attr('x',xCoord+(10*(doy < 324 ? 1 : -1)))\r\n                .text(dataPoint ?\r\n                    self.legendDoyPipe.transform(dataPoint.start_doy)+' - '+self.legendDoyPipe.transform(dataPoint.end_doy) :\r\n                    self.legendDoyPipe.transform(doy));\r\n            self.curves.forEach(function(c) { c.doyFocus = doy; });\r\n            self.updateLegend();\r\n        }\r\n        svg.append('rect')\r\n            .attr('class','overlay')\r\n            .attr('transform', 'translate(' + this.margins.left + ',' + this.margins.top + ')')\r\n            .style('fill','none')\r\n            .style('pointer-events','all')\r\n            .attr('x',0)\r\n            .attr('y',0)\r\n            .attr('width',sizing.width)\r\n            .attr('height',sizing.height)\r\n            .on('mouseover',focusOn)\r\n            .on('mouseout',focusOff)\r\n            .on('mousemove',updateFocus);\r\n    }\r\n\r\n    protected reset(): void {\r\n        // make room for the legend based on the number of plots\r\n        this.margins.top = DEFAULT_TOP_MARGIN;\r\n        const fontSize = this.baseFontSize() as number;\r\n        if(this.selection) {\r\n            const plotCount = this.curves.filter(c => c.plotted()).length;\r\n            if(plotCount) {\r\n                this.margins.top = ((plotCount+1)*fontSize)+(plotCount*LEGEND_VPAD)+MARGIN_VPAD;\r\n            }\r\n        }\r\n        super.reset();\r\n        let chart = this.chart,\r\n            sizing = this.sizing;\r\n\r\n        this.x = scaleLinear().range([0,sizing.width]).domain([1,365]);\r\n        this.xAxis = axisBottom<number>(this.x).tickFormat(DATE_FMT);\r\n\r\n        this.curves.forEach(c => c.x(this.x).y(this.newY()));\r\n\r\n        const titleFontSize = 18;\r\n        const titleDy = this.margins.top-titleFontSize-fontSize;\r\n        this.chart.append('g')\r\n             .attr('class','chart-title')\r\n             .append('text')\r\n             .attr('y', '0')\r\n             .attr('dy',`-${titleDy}`)\r\n             .attr('x', '0')\r\n             .attr('dx','-3em')\r\n             .style('text-anchor','start')\r\n             .style('font-size',`${titleFontSize}px`)\r\n             .text('Activity Curves');\r\n        this.commonUpdates();\r\n    }\r\n\r\n    protected update(): void {\r\n        this.reset();\r\n        this.selection.loadCurves().then(curves => {\r\n            this._curves = curves;\r\n            this.reset();\r\n            this.redraw()\r\n        });\r\n    }\r\n\r\n    protected redrawSvg(): void {\r\n        let chart = this.chart,\r\n            sizing = this.sizing,\r\n            selection = this.selection;\r\n\r\n        chart.selectAll('g .axis').remove();\r\n\r\n        const mapped = this.byMetric();\r\n        const metricIds = Object.keys(mapped);\r\n        metricIds.forEach(metricId => {\r\n            const metric = mapped[metricId].metric;\r\n            const curves:ActivityCurve[] = mapped[metricId].curves;\r\n            \r\n            // build domain that encapsulates all curves using a given metric\r\n            const domain = d3.extent(curves.reduce((arr,c) => arr.concat(c.domain()),[]));\r\n            const y = this.newY().domain(PAD_DOMAIN(domain,metric));\r\n            curves.forEach(c => c.y(y));\r\n        });\r\n\r\n        metricIds.forEach((metricId,index) => {\r\n            const orientation = index === 0 ? 'left' : 'right';\r\n            const primaryCurve:ActivityCurve = mapped[metricId].curves[0];\r\n            primaryCurve.orient = orientation;\r\n            chart.append('g')\r\n                .attr('class', `y axis ${orientation} ${metricId}`)\r\n                .attr('transform',`translate(${orientation === 'left' ? 0 : sizing.width})`)\r\n                .call(primaryCurve.axis())\r\n                .append('text')\r\n                    .attr('class','axis-title')\r\n                    .attr('transform', 'rotate(-90)')\r\n                    .attr('y', '0')\r\n                    .attr('dy',`${orientation === 'left' ? '-' : ''}4em`)\r\n                    .attr('x',-1*(sizing.height/2)) // looks odd but to move in the Y we need to change X because of transform\r\n                    .style('text-anchor', 'middle')\r\n                    .attr('fill','#000')\r\n                    .text(primaryCurve.axisLabel());\r\n        });\r\n\r\n        let xTickConfig = X_TICK_CFG[(selection.frequency||selection.defaultFrequency).value];\r\n        this.xAxis.tickValues(xTickConfig.values);\r\n        chart.append('g')\r\n            .attr('class', 'x axis')\r\n            .attr('transform', 'translate(0,' + sizing.height + ')')\r\n            .call(this.xAxis)\r\n            .append('text')\r\n            .attr('y','0')\r\n            .attr('dy','3em')\r\n            .attr('x',(sizing.width/2))\r\n            .attr('class','axis-label')\r\n            .style('text-anchor', 'middle')\r\n            .text('Date');\r\n        if(xTickConfig.rotate) {\r\n            chart.selectAll('g.x.axis g.tick text')\r\n                .style('text-anchor','end')\r\n                .attr('transform','rotate(-'+xTickConfig.rotate+')');\r\n            chart.selectAll('g.x.axis .axis-label')\r\n                .attr('dy','4em');\r\n        }\r\n\r\n        // if a given metric just has a single curve then color its axis to match\r\n        metricIds.forEach(metricId => {\r\n            const curves:ActivityCurve[] = mapped[metricId].curves;\r\n            if(curves.length === 1) {\r\n                const axis = chart.select(`g.y.axis.${metricId}`);\r\n                ['g.tick text','text.axis-title'].forEach(subSelect => axis.selectAll(subSelect).style('fill',curves[0].color))\r\n            }\r\n        });\r\n\r\n        this.commonUpdates();\r\n\r\n        // draw the curves\r\n        this.curves.forEach(c => c.draw(chart));\r\n\r\n        this.updateLegend();\r\n        this.hover();\r\n    }\r\n}\r\n","import {Component,Input,SimpleChanges, Output, EventEmitter} from '@angular/core';\r\nimport {FormControl} from '@angular/forms';\r\n\r\nimport {MonitorsDestroy} from '../../common';\r\nimport {ActivityCurve} from './activity-curve';\r\nimport {ActivityCurvesSelection} from './activity-curves-selection';\r\nimport { takeUntil, filter, debounceTime } from 'rxjs/operators';\r\nimport { HigherSpeciesPhenophaseInputCriteria } from '../common-controls';\r\nimport { VisSelectionEvent } from '../vis-selection';\r\n\r\n@Component({\r\n    selector: 'curve-selection-control',\r\n    template: `\r\n    <mat-form-field class=\"year-input\">\r\n        <mat-select [placeholder]=\"'Year'+(required ? ' *':'')\" [formControl]=\"yearControl\">\r\n            <mat-option *ngFor=\"let y of validYears\" [value]=\"y\">{{y}}</mat-option>\r\n        </mat-select>\r\n        <mat-error *ngIf=\"yearControl.errors && yearControl.errors.required\">Year is required</mat-error>\r\n    </mat-form-field>\r\n\r\n    <higher-species-phenophase-input\r\n        [gatherColor]=\"gatherColor\"\r\n        [selection]=\"selection\"\r\n        [criteria]=\"criteria\"\r\n        [(plot)]=\"curve\"\r\n        [disabled]=\"speciesInputDisabled\"\r\n        [required]=\"required\"\r\n        (plotChange)=\"onSpeciesChange.next($event)\">\r\n    </higher-species-phenophase-input>\r\n\r\n    <mat-form-field class=\"metric-input\">\r\n        <mat-select placeholder=\"Metric\" [(ngModel)]=\"metric\" [disabled]=\"!curve.validMetrics.length\" [disabled]=\"disabled\">\r\n            <mat-option *ngFor=\"let m of curve.validMetrics\" [value]=\"m\">{{m.label}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `,\r\n    styles: [`\r\n        .year-input {\r\n            width: 75px;\r\n        }\r\n        .metric-input {\r\n            width: 255px;\r\n        }\r\n    `]\r\n})\r\nexport class CurveControlComponent extends MonitorsDestroy {\r\n    @Input()\r\n    gatherColor:boolean = false;\r\n    @Input()\r\n    required:boolean = true;\r\n    @Input()\r\n    disabled:boolean = false;\r\n    @Input()\r\n    selection: ActivityCurvesSelection;\r\n    @Input()\r\n    curve: ActivityCurve;\r\n\r\n    @Output()\r\n    onSpeciesChange = new EventEmitter<any>();\r\n    @Output()\r\n    onMetricChange = new EventEmitter<any>();\r\n\r\n    yearControl:FormControl;\r\n    criteria:HigherSpeciesPhenophaseInputCriteria;\r\n\r\n    get metric():any {\r\n        return this.curve.metric;\r\n    }\r\n    set metric(metric:any) {\r\n        const oldValue = this.curve.metric;\r\n        const newValue = this.curve.metric = metric;\r\n        this.onMetricChange.next({oldValue,newValue});\r\n    }\r\n\r\n    validYears:number[] = (function() {\r\n        let thisYear = (new Date()).getFullYear(),\r\n            years: number[] = [],\r\n            c = 2010;\r\n        while(c <= thisYear) {\r\n            years.push(c++);\r\n        }\r\n        return years.reverse();\r\n    })();\r\n\r\n    ngOnInit() {\r\n        this.selection.pipe(\r\n            filter(event => event === VisSelectionEvent.SCOPE_CHANGE),\r\n            debounceTime(500),\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe(() => this.updateCriteria());\r\n\r\n        this.yearControl = new FormControl(this.curve.year,/*Validators.required*/(c) => {\r\n            if(this.required && !c.value) {\r\n                return {\r\n                    required: true\r\n                };\r\n            }\r\n            return null;\r\n        });\r\n        if(this.disabled) {\r\n            this.yearControl.disable();\r\n        }\r\n        this.yearControl.valueChanges\r\n            .pipe(takeUntil(this.componentDestroyed))\r\n            .subscribe(y => {\r\n                this.curve.year = y;\r\n                this.updateCriteria();\r\n            });\r\n        setTimeout(() => this.updateCriteria());\r\n    }\r\n\r\n    updateCriteria() {\r\n        this.criteria = {\r\n            years: this.curve.year ? [this.curve.year] : [],\r\n            stationIds: this.selection.getStationIds()\r\n        };\r\n    }\r\n\r\n    ngOnChanges(changes:SimpleChanges):void {\r\n        if(changes.disabled && this.yearControl) {\r\n            if(changes.disabled.currentValue) {\r\n                this.yearControl.disable();\r\n            } else {\r\n                this.yearControl.enable();\r\n            }\r\n        }\r\n    }\r\n\r\n    get speciesInputDisabled():boolean {\r\n        return this.disabled || !this.curve.year;\r\n    }\r\n}\r\n","export * from './public_api';","export * from './activity-curve';\r\nexport * from './activity-curves-selection';\r\nexport * from './activity-curves-selection-factory.service';\r\nexport * from './activity-curves.component';\r\nexport * from './activity-curves-control.component';\r\nexport * from './curve-control.component';\r\n","import { NpnServiceUtils } from '@npn/common/common';\r\nimport { AgddTimeSeriesSelection } from './agdd-time-series-selection';\r\nimport { Injectable } from '@angular/core';\r\nimport { NpnMapLayerService } from '@npn/common/gridded';\r\n\r\n@Injectable()\r\nexport class AgddTimeSeriesSelectionFactory {\r\n    constructor(private layerService:NpnMapLayerService, protected serviceUtils:NpnServiceUtils) {}\r\n\r\n    newSelection(): AgddTimeSeriesSelection {\r\n        return new AgddTimeSeriesSelection(this.layerService,this.serviceUtils);\r\n    }\r\n}","import { VisSelection, selectionProperty } from '../vis-selection';\r\nimport { NpnServiceUtils } from '@npn/common/common';\r\n\r\nimport * as d3 from 'd3';\r\nimport { MapLayer, NpnMapLayerService, PestMapLayer, CATEGORY_PEST, MapLayerLegend } from '@npn/common/gridded';\r\nimport { Subject } from 'rxjs';\r\n\r\nexport const CATEGORY_PESTS = CATEGORY_PEST;\r\nexport const CATEGORY_TEMP_ACCUMULATIONS = 'Daily Temperature Accumulations';\r\n\r\nconst DATE_FORMAT = d3.timeFormat('%Y-%m-%d');\r\nexport const DATA_FUNC = (d:TimeSeriesDataPoint):number => !!d.agdd ? d.agdd : d.point_value;\r\nconst DOY_MAP = (data:TimeSeriesDataPoint[]) => data.reduce((map,d) => {\r\n        map[d.doy] = DATA_FUNC(d);\r\n        return map;\r\n    },{});\r\n\r\nexport interface TimeSeriesDataPoint {\r\n    agdd?: number;\r\n    gdd?: number;\r\n    point_value: number;\r\n    doy: number;\r\n    date?: string;\r\n}\r\n\r\nconst COERCE_TIME_SERIES_RESPONSE = (data):TimeSeriesDataPoint[] => {\r\n    if(data && Array.isArray(data.timeSeries)) { // pointTimeSeries response\r\n        return data.timeSeries as TimeSeriesDataPoint[];\r\n    }\r\n    if(data && !Array.isArray(data)) {\r\n        console.warn('HANDLE_TIME_SERIES_RESPONSE data not array')\r\n        return [];\r\n    }\r\n    return data as TimeSeriesDataPoint[];\r\n}\r\n\r\nexport interface AgddTimeSeriesDataHolder {\r\n    data: TimeSeriesDataPoint[]; // full series\r\n    filtered?: TimeSeriesDataPoint[]; // used by the visualization\r\n    plotted?: boolean;\r\n    focus?: any;\r\n    doyMap?: any;\r\n    year?: any;\r\n    color?: string;\r\n}\r\n\r\nexport interface AgddTimeSeriesData {\r\n    average?: AgddTimeSeriesDataHolder;\r\n    selected?: AgddTimeSeriesDataHolder;\r\n    previous?: AgddTimeSeriesDataHolder;\r\n    forecast?: AgddTimeSeriesDataHolder;\r\n}\r\n\r\nexport const AGDD_COLORS = {\r\n    average: 'black',\r\n    selected: 'blue',\r\n    previous: 'orange',\r\n    forecast: 'red'\r\n};\r\n\r\nconst GDD_AGDD_LAYER_NAME = 'gdd:agdd';\r\nexport const DEFAULT_AGDD_LAYER_CATEGORY = CATEGORY_TEMP_ACCUMULATIONS;\r\nexport const DEFAULT_AGDD_LAYER_NAME = GDD_AGDD_LAYER_NAME;\r\n\r\nexport class AgddTimeSeriesSelection extends VisSelection {\r\n    @selectionProperty()\r\n    $class:string = 'AgddTimeSeriesSelection';\r\n\r\n    @selectionProperty()\r\n    private _latLng:number[];\r\n    @selectionProperty()\r\n    _layerCategory:string = DEFAULT_AGDD_LAYER_CATEGORY;\r\n    @selectionProperty()\r\n    private _layerName:string = DEFAULT_AGDD_LAYER_NAME;\r\n    @selectionProperty()\r\n    private _extentValue:string;\r\n\r\n    @selectionProperty()\r\n    private _showLastYear:boolean = false;\r\n    @selectionProperty()\r\n    private _threshold:number;\r\n    thresholdCeiling:number = 20000;\r\n    @selectionProperty()\r\n    private _doy:number;\r\n\r\n    layer:MapLayer;\r\n    legend:MapLayerLegend;\r\n\r\n    constructor(private layerService:NpnMapLayerService,protected serviceUtils:NpnServiceUtils) {\r\n        super();\r\n    }\r\n\r\n    isValid():boolean {\r\n        return !!this._layerName && !!this.latLng && this.latLng.length === 2;\r\n    }\r\n\r\n    private _monitorLayerChange:Subject<string>;\r\n    monitorLayerChange():Subject<string> {\r\n        if(!this._monitorLayerChange) {\r\n            this._monitorLayerChange = new Subject();\r\n        }\r\n        return this._monitorLayerChange;\r\n    }\r\n\r\n    endMonitorLayerChange():void {\r\n        if(this._monitorLayerChange) {\r\n            this._monitorLayerChange.complete();\r\n            this._monitorLayerChange = undefined;\r\n        }\r\n    }\r\n\r\n    get layerName():string { return this._layerName; }\r\n    set layerName(l:string) {\r\n        this._layerName = l;\r\n        if(this.layer && this.layer.layerName !== l) {\r\n            this.layer.off(); // shouldn't be necessary\r\n            this._getLayer = undefined;\r\n            this.layer = undefined;\r\n            this.legend = null;\r\n            this._start = undefined;\r\n            this._end = undefined;\r\n            this._selectedData = undefined;\r\n            this._averageData = undefined;\r\n            this._previousData = undefined;\r\n            this._timeSeriesUrl = undefined;\r\n            this._selectedParamsBasis = undefined;\r\n            // let the layer initially dictate threshold\r\n            delete this._threshold;\r\n        }\r\n        if(this._monitorLayerChange) {\r\n            this._monitorLayerChange.next(this._layerName);\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    set layerCategory(s:string) {\r\n        this._layerCategory = s;\r\n        //this.layerName = null;\r\n    }\r\n    get layerCategory():string { return this._layerCategory; }\r\n\r\n    private updateExtentValue() {\r\n        if(this.layer && this._extentValue) {\r\n            const newValue = this.layer.extent.values.reduce((found,v) => found||(v.value === this._extentValue ? v : undefined),undefined);\r\n            if(newValue && this.layer.extent.current !== newValue) {\r\n                this.layer.extent.current = newValue;\r\n                if(this.layer.getMap()) {\r\n                    this.layer.bounce();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    get extentValue():string { return this._extentValue; }\r\n    set extentValue(v:string) {\r\n        // technically changes to extent that result in a year\r\n        // change require an update, but during population\r\n        // of layer/extent, etc. the selection should be paused\r\n        // \"end\" date changed as a result.\r\n        if(v !== this._extentValue) {\r\n            this._extentValue = v;\r\n            this._start = undefined;\r\n            this._end = undefined;\r\n            this._selectedData = undefined;\r\n            this._averageData = undefined;\r\n            this._previousData = undefined;\r\n            this.updateExtentValue();\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The resulting layer will be disconnected from a map.\r\n     * External callers may call setMap(m) and on/off but\r\n     * this selection does not directly use the layer in conjunction\r\n     * with a map.\r\n     * \r\n     * If the selection does not have an associated layerName the\r\n     * resulting Promise will be rejected immediately.\r\n     */\r\n    _getLayer:Promise<MapLayer>;\r\n    getLayer():Promise<MapLayer> {\r\n        if(!this.layerName) {\r\n            return Promise.reject();\r\n        }\r\n        if(!this._getLayer) {\r\n            this._getLayer = this.layerService.newLayer(null,this.layerName)\r\n                .then(layer => this.layer = layer)\r\n                .then(layer => {\r\n                    this.updateExtentValue();\r\n                    // on aside get legend but still return layer\r\n                    layer.getLegend().then(l => this.legend = l);\r\n                    return layer;\r\n                });\r\n        }\r\n        return this._getLayer;\r\n    }\r\n\r\n    /**\r\n     * The base temperature value for the underlying layer.\r\n     * This code assumes that only a certain subset of layers\r\n     * are suitable for this visualization.\r\n     */\r\n    get baseTemp():number {\r\n        let base = 32;\r\n        if(this.layer) {\r\n            base = this.layer.layerBasis === GDD_AGDD_LAYER_NAME ? 32 : 50;\r\n            const meta = this.layer.layerDefinition.meta;\r\n            // special cases\r\n            if(meta && meta.agddBaseTemp) {\r\n                base = meta.agddBaseTemp;\r\n            }\r\n        }\r\n        return base;\r\n    }\r\n\r\n    private _end:Date;\r\n    /**\r\n     * Fetches the end date for pulling the time series.\r\n     * If the current layer extent is for this year then\r\n     * the end will be the maximum available extent date\r\n     * otherwise 12/31 of the extent year.\r\n     */\r\n    private get end():Date {\r\n        if(!this._end) {\r\n            const {layer} = this;\r\n            if(!layer) {\r\n                return new Date((new Date).getFullYear(),11,31);\r\n            }\r\n            const current = layer.extent.current.date;\r\n            const extentYear = current.getFullYear();\r\n            if(extentYear === (new Date()).getFullYear()) {\r\n                // end is the maximum extent\r\n                this._end = new Date(layer.extent.values[layer.extent.values.length-1].date.getTime());\r\n            } else {\r\n                // dec 31 of the extent year\r\n                this._end = new Date(extentYear,11,31);\r\n            }\r\n        }\r\n        return this._end;\r\n    }\r\n    private _start:Date;\r\n    private get start():Date {\r\n        const {layer} = this;\r\n        if(!layer) {\r\n            // don't cache\r\n            return new Date(this.end.getFullYear(),0,1);\r\n        }\r\n        return this._start||(this._start = new Date(this.end.getFullYear(),0,1));\r\n    }\r\n\r\n    private _timeSeriesUrl:Promise<string>;\r\n    private get timeSeriesUrl():Promise<string> {\r\n        if(!this._timeSeriesUrl) {\r\n            this._timeSeriesUrl = this.layer instanceof PestMapLayer\r\n                ? this.layer.getTimeSeriesUrl()\r\n                : Promise.resolve(this.serviceUtils.dataApiUrl(`/v0/agdd/simple/pointTimeSeries`));\r\n        }\r\n        return this._timeSeriesUrl;\r\n    }\r\n\r\n    private get show30YearAverage():boolean {\r\n        if(this.layer) {\r\n            const {meta} = this.layer.layerDefinition;\r\n            if(meta && typeof(meta.agddSupports30YearAvg) === 'boolean') {\r\n                return meta.agddSupports30YearAvg;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    get threshold():number { \r\n        if(this._threshold) {\r\n            return this._threshold;\r\n        }\r\n        if(this.layer) {\r\n            const {meta} = this.layer.layerDefinition;\r\n            if(meta && typeof(meta.agddDefaultThreshold) === 'number') {\r\n                return meta.agddDefaultThreshold;\r\n            }\r\n        }\r\n        return 1000;\r\n    }\r\n    set threshold(t:number) {\r\n        this._threshold = t;\r\n        this.redraw();\r\n    }\r\n\r\n    get latLng():number[] { return this._latLng; }\r\n    set latLng(ltlng:number[]) {\r\n        this._latLng = ltlng;\r\n        this._selectedData = undefined;\r\n        this._averageData = undefined;\r\n        this._previousData = undefined;\r\n        this.update();\r\n    }\r\n\r\n    /** Whether or not the range of the time series can support previous data. */\r\n    get lastYearValid():boolean {\r\n        return (this.start.getFullYear()-1) >= 2016; // time series data starts in 2016\r\n    }\r\n\r\n    get showLastYear():boolean {\r\n        if(this.layer) {\r\n            return this.lastYearValid ? this._showLastYear : false;\r\n        }\r\n        return this._showLastYear;\r\n    }\r\n    set showLastYear(b:boolean) {\r\n        this._showLastYear = b;\r\n        this.update();\r\n    }\r\n\r\n    // controls visually how much of the year is drawn on the visualization\r\n    // e.g. allows for zooming in on the beginning of a year\r\n    get doy():number { return this._doy||365; }\r\n    set doy(d:number) {\r\n        this._doy = d;\r\n        // this is kind of a workaround but redraws update\r\n        // the bounds of the axes and for some reason inconsistently\r\n        // lines go wonky, resize re-writes the entire visualization\r\n        // and the problem does not occur then\r\n        // doing this since not sufficient time to better understand.\r\n        //this.redraw();\r\n        this.resize();\r\n    }\r\n\r\n    private _averageData:Promise<AgddTimeSeriesDataHolder>;\r\n    private averageData():Promise<AgddTimeSeriesDataHolder> {\r\n        if(!this._averageData) {\r\n            const [latitude,longitude] = this.latLng;\r\n            // this doesn't feel quite robust enough\r\n            const layer = this.baseTemp === 32 ? 'gdd:30yr_avg_agdd' : 'gdd:30yr_avg_agdd_50f';\r\n            this._averageData = this.serviceUtils.get(\r\n                this.serviceUtils.apiUrl('/npn_portal/stations/getTimeSeries.json'),\r\n                {latitude,longitude,layer})\r\n                .then(COERCE_TIME_SERIES_RESPONSE)\r\n                .then(data => ({\r\n                    data,\r\n                    doyMap: DOY_MAP(data),\r\n                    year:'30-year Average',\r\n                    color: AGDD_COLORS.average\r\n                }));\r\n        }\r\n        return this._averageData;\r\n    }\r\n\r\n    private _selectedParamsBasis:Promise<any>;\r\n    private get selectedParamsBasis():Promise<any> {\r\n        if(!this._selectedParamsBasis) {\r\n            return this._selectedParamsBasis = this.layer instanceof PestMapLayer\r\n                ? this.layer.getPestDescription()\r\n                    .then(pest => {\r\n                        let {lowerThreshold,upperThreshold,base} = pest;\r\n                        lowerThreshold = lowerThreshold||0;\r\n                        upperThreshold = upperThreshold||0;\r\n                        base = base||lowerThreshold||this.baseTemp\r\n                        return {lowerThreshold,upperThreshold,base};\r\n                    })\r\n                : Promise.resolve({\r\n                    upperThreshold: 0,\r\n                    lowerThreshold: 0,\r\n                    base: this.baseTemp\r\n                });\r\n        }\r\n        return this._selectedParamsBasis;\r\n    }\r\n\r\n    private get selectedParams():Promise<any> {\r\n        const [latitude,longitude] = this.latLng;\r\n        const startDate = DATE_FORMAT(this.start);\r\n        const start_date = startDate;\r\n        const endDate = DATE_FORMAT(this.end);\r\n        const end_date = endDate;\r\n        return Promise.all([\r\n            this.timeSeriesUrl,\r\n            this.selectedParamsBasis\r\n        ]).then(results => {\r\n            const [timeSeriesUrl,paramsBasis] = results;\r\n            const {lowerThreshold,upperThreshold,base} = paramsBasis;\r\n            // NOTE: some pests have a \"base\" but lowerThreshold is always being used here.\r\n            // e.g. Bronze Birch Borer, Emerald Ash Borer\r\n            return {\r\n                layer: this.layer.layerBasis,\r\n                latitude,longitude,\r\n                climateProvider: 'NCEP',\r\n                temperatureUnit: 'fahrenheit',\r\n                timeSeriesUrl,\r\n                startDate,start_date,\r\n                endDate,end_date,\r\n                base,\r\n                lowerThreshold,\r\n                upperThreshold\r\n            };\r\n        });        \r\n    }\r\n\r\n    private _selectedData:Promise<AgddTimeSeriesDataHolder>;\r\n    private selectedData():Promise<AgddTimeSeriesDataHolder> { // always the full shooting match, forecast can/will be pulled from this\r\n        if(!this._selectedData) {\r\n            this._selectedData = Promise.all([\r\n                this.timeSeriesUrl,\r\n                this.selectedParams\r\n            ]).then(results => {\r\n                const [timeSeriesUrl,selectedParams] = results;\r\n                return this.serviceUtils.get(timeSeriesUrl,selectedParams)\r\n                    .then(COERCE_TIME_SERIES_RESPONSE)\r\n                    .then(data => ({\r\n                        data,\r\n                        doyMap: DOY_MAP(data),\r\n                        year:this.start.getFullYear(),\r\n                        color: AGDD_COLORS.selected\r\n                    }))\r\n            });  \r\n        }\r\n        return this._selectedData;\r\n    }\r\n\r\n    private _previousData:Promise<AgddTimeSeriesDataHolder>;\r\n    private previousData():Promise<AgddTimeSeriesDataHolder> {\r\n        if(!this._previousData) {\r\n            const lastYear = this.start.getFullYear()-1;\r\n            const start = new Date(lastYear,0,1);\r\n            const end = new Date(lastYear,11,31);\r\n            const startDate = DATE_FORMAT(start);\r\n            const start_date = startDate;\r\n            const endDate = DATE_FORMAT(end);\r\n            const end_date = endDate;\r\n            this._previousData = Promise.all([\r\n                this.timeSeriesUrl,\r\n                this.selectedParams\r\n            ]).then(results => {\r\n                const [timeSeriesUrl,selectedParams] = results;\r\n                const params = {...selectedParams,startDate,start_date,endDate,end_date};\r\n                return this.serviceUtils.get(timeSeriesUrl,params)\r\n                    .then(COERCE_TIME_SERIES_RESPONSE)\r\n                    .then(data => ({\r\n                        data,\r\n                        doyMap: DOY_MAP(data),\r\n                        year:lastYear,\r\n                        color: AGDD_COLORS.previous\r\n                    }));\r\n            });  \r\n        }\r\n        return this._previousData;\r\n    }\r\n\r\n    data():Promise<AgddTimeSeriesData> {\r\n        this.working = true;\r\n        return this.getLayer()\r\n            .then(layer => {\r\n                //this._latLng = [25.240821110543152,-80.56457375588832]; // TODO remove dev values.\r\n                //this._showLastYear = true;\r\n                const promises = [this.selectedData()];\r\n                if(this.show30YearAverage) {\r\n                    promises.push(this.averageData());\r\n                }\r\n                if(this.showLastYear && this.lastYearValid) {\r\n                    promises.push(this.previousData());\r\n                }\r\n                return Promise.all(promises)\r\n                    .then(results => {\r\n                        let [selected,average,previous] = results;\r\n                        let forecast:AgddTimeSeriesDataHolder;\r\n                        if(this.end.getFullYear() === (new Date()).getFullYear()) { // this may always be true depending on \"end\"\r\n                            const todayFormatted = DATE_FORMAT(new Date());\r\n                            selected = {\r\n                                ...selected,\r\n                                data: selected.data.reduce((arr,d) => {\r\n                                    if(!forecast) {\r\n                                        arr.push(d);\r\n                                        if(todayFormatted === d.date) {\r\n                                            // include the last day of the selected range in the forecast so the two connect on the graph\r\n                                            forecast = {\r\n                                                data:[d],\r\n                                                year: `${this.start.getFullYear()} forecast`,\r\n                                                color: AGDD_COLORS.forecast\r\n                                            };\r\n                                        }\r\n                                    } else {\r\n                                        forecast.data.push(d);\r\n                                    }\r\n                                    return arr;\r\n                                },[])};\r\n                            if(forecast) {\r\n                                forecast.doyMap = DOY_MAP(forecast.data);\r\n                            }\r\n                        }\r\n                        this.working = false;\r\n                        return {average,selected,forecast,previous};\r\n                    });\r\n            });\r\n    }\r\n}","import { Component, Input, ElementRef, ViewEncapsulation } from '@angular/core';\r\nimport { SvgVisualizationBaseComponent } from '../svg-visualization-base.component';\r\nimport { AgddTimeSeriesSelection, AgddTimeSeriesData,  DATA_FUNC, TimeSeriesDataPoint, AGDD_COLORS } from './agdd-time-series-selection';\r\nimport { VisualizationMargins } from '../visualization-base.component';\r\nimport { ObservableMedia } from '@angular/flex-layout';\r\nimport { ONE_DAY_MILLIS } from '../vis-selection';\r\n\r\nimport { Axis, axisBottom, axisLeft } from 'd3-axis';\r\nimport { ScaleLinear, scaleLinear } from 'd3-scale';\r\nimport * as d3 from 'd3';\r\nimport { DecimalPipe } from '@angular/common';\r\n\r\nconst DEG_F = '\\u00B0' + 'F';\r\nconst D3_DATE_FMT = d3.timeFormat('%m/%d');\r\nconst ROOT_DATE = new Date(2010,0);\r\nconst DATE_FMT = (d) => {\r\n    let time = ((d-1)*ONE_DAY_MILLIS)+ROOT_DATE.getTime(),\r\n        date = new Date(time);\r\n    return D3_DATE_FMT(date);\r\n};\r\n@Component({\r\n    selector: 'agdd-time-series',\r\n    templateUrl: '../svg-visualization-base.component.html',\r\n    styleUrls: ['../svg-visualization-base.component.scss']\r\n})\r\nexport class AgddTimeSeriesComponent extends SvgVisualizationBaseComponent {\r\n    @Input() selection:AgddTimeSeriesSelection;\r\n    filename:string = 'agdd-time-series.png';\r\n    margins: VisualizationMargins = {top: 80,left: 80,right: 30,bottom: 60};\r\n\r\n\r\n    x: ScaleLinear<number,number>;\r\n    xAxis: Axis<number>\r\n\r\n    y: ScaleLinear<number,number>;\r\n    yAxis: Axis<number>;\r\n    _yMax:number;\r\n    get yMax():number { return this._yMax||20000; }\r\n\r\n    _line;\r\n    get line() { return this._line||(() => {}); }\r\n\r\n    thresholdLine;\r\n\r\n    private _data:AgddTimeSeriesData;\r\n    get data():AgddTimeSeriesData { return this._data||{} };\r\n\r\n    constructor(protected rootElement:ElementRef,protected media:ObservableMedia,private decimalPipe:DecimalPipe) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    private removeLines() {\r\n        const {data,chart} = this;\r\n        chart.selectAll('path.gdd').remove();\r\n        Object.keys(data)\r\n            .filter(key => !!data[key])\r\n            .forEach(key => delete data[key].plotted);\r\n        this.updateLegend();\r\n    }\r\n\r\n    private addLines() {\r\n        const {data,chart,line} = this;\r\n        Object.keys(data)\r\n            .filter(key => !!data[key])\r\n            .forEach(key => {\r\n                chart.append('path')\r\n                    .attr('class','gdd '+key)\r\n                    .attr('fill','none')\r\n                    .attr('stroke',data[key].color)\r\n                    .attr('stroke-linejoin','round')\r\n                    .attr('stroke-linecap','round')\r\n                    .attr('stroke-width',1.5)\r\n                    .attr('d',line(data[key].filtered||data[key].data));\r\n                data[key].plotted = true;\r\n            });\r\n        this.updateLegend();\r\n    }\r\n\r\n    private updateTitle() {\r\n        //console.log('AGDD: updateTitle');\r\n        const {chart,sizing,selection} = this;\r\n        const title = chart.select('.chart-title');\r\n        title.selectAll('*').remove();\r\n        title.append('text')\r\n            .attr('y', '0')\r\n            .attr('dy','-3em')\r\n            .attr('x', (sizing.width/2))\r\n            .style('text-anchor','middle')\r\n            .style('font-size','18px').text('Accumulated Growing Degree Days');\r\n        if(selection.latLng && selection.latLng.length === 2) {\r\n            const [lat,lng] = selection.latLng;\r\n            title.append('text')\r\n            .attr('y', '0')\r\n            .attr('dy','-1.8em')\r\n            .attr('x', (sizing.width/2))\r\n            .style('text-anchor','middle')\r\n            .style('font-size','18px').text(`(Lat: ${lat.toFixed(3)}, Lon: ${lng.toFixed(3)}) ${selection.baseTemp}${DEG_F} Base Temp`);\r\n        }\r\n    }\r\n\r\n    private updateAxes() {\r\n        // console.log('AGDD: updateAxes');\r\n        this.removeLines();\r\n        const {data,chart,sizing,y,yAxis,x,xAxis,selection} = this;\r\n        let {yMax} = this;\r\n        const lineKeys = Object.keys(data).filter(key => !!data[key]);\r\n        if(lineKeys.length) {\r\n            // calculate/re-calculate the y-axis domain so that the data fits nicely\r\n            const maxes = lineKeys.reduce((arr,key) => {\r\n                    arr.push(d3.max((data[key].filtered||data[key].data),DATA_FUNC));\r\n                    return arr;\r\n                },[]);\r\n            selection.thresholdCeiling = Math.round(yMax = d3.max(maxes));\r\n            yMax = yMax*1.05;\r\n            const doy = selection.doy;\r\n\r\n            // update x/y axis\r\n            yAxis.scale(y.domain([0,yMax]));\r\n            xAxis.scale(x.domain([1,doy]));\r\n\r\n            // filter or unfilter the data depending on doy\r\n            Object.keys(data)\r\n                .filter(key => !!data[key])\r\n                .forEach(key => data[key].filtered = doy < 365\r\n                        ? data[key].filtered = data[key].data.filter(d => d.doy <= doy)\r\n                        : undefined);\r\n\r\n            this.addLines();\r\n            // update the position of the threshold line\r\n            const yCoord = this.y(selection.threshold);\r\n            this.thresholdLine\r\n                .attr('y1',yCoord).attr('y2',yCoord)\r\n                // hide the threshold line if it's off the axis\r\n                .style('display',selection.threshold > selection.thresholdCeiling ? 'none' : null);\r\n        }\r\n        chart.selectAll('g .axis').remove();\r\n        chart.append('g')\r\n            .attr('class', 'y axis')\r\n            .call(yAxis)\r\n            .append('text')\r\n            .attr('fill','#000')\r\n            .attr('transform', 'rotate(-90)')\r\n            .attr('y', '0')\r\n            .attr('dy','-3.75em')\r\n            .attr('x',-1*(sizing.height/2)) // looks odd but to move in the Y we need to change X because of transform\r\n            .style('text-anchor', 'middle')\r\n            .text('Accumulated Growing Degree Day Units (AGDDs)');\r\n\r\n        chart.append('g')\r\n            .attr('class', 'x axis')\r\n            .attr('transform', 'translate(0,' + sizing.height + ')')\r\n            .call(xAxis)\r\n            .append('text')\r\n            .attr('fill','#000')\r\n            .attr('y','0')\r\n            .attr('dy','2.5em')\r\n            .attr('x',(sizing.width/2))\r\n            .style('text-anchor', 'middle')\r\n            .text('Date');\r\n        this.commonUpdates();\r\n    }\r\n\r\n    private updateLegend(): void {\r\n        //console.log('AGDD: updateLegend');\r\n        const chart = this.chart;\r\n        chart.selectAll('g.legend').remove();\r\n        const legend = chart.append('g')\r\n            .attr('class', 'legend')\r\n            .attr('transform', 'translate(30,-45)') // relative to the chart, not the svg\r\n            .style('font-size', '1em');\r\n        const rect = legend.append('rect')\r\n                .style('fill', 'white')\r\n                .style('stroke', 'black')\r\n                .style('opacity', '0.8')\r\n                .attr('width', 130)\r\n                .attr('height', 60);\r\n        const data = this.data,\r\n            fontSize = 14, r = 5, vpad = 4,\r\n            keys = ['average', 'selected', 'forecast', 'previous']; //Object.keys(data), hard coding to control order\r\n        const plotCnt = keys.reduce((cnt, key) => {\r\n                let row;\r\n                if (data[key] && data[key].plotted && (data[key].filtered || data[key].data).length) {\r\n                    row = legend.append('g')\r\n                        .attr('class', 'legend-item ' + key)\r\n                        .attr('transform', 'translate(10,' + (((cnt + 1) * fontSize) + (cnt * vpad)) + ')');\r\n                    row.append('circle')\r\n                        .attr('r', r)\r\n                        .attr('fill', data[key].color);\r\n                    row.append('text')\r\n                        .style('font-size', fontSize + 'px')\r\n                        .attr('x', (2 * r))\r\n                        .attr('y', (r / 2))\r\n                        .text(data[key].year);\r\n                    cnt++;\r\n                }\r\n                return cnt;\r\n            }, 0);\r\n        rect.style('display',plotCnt === 0 ? 'none' : null);\r\n        if (plotCnt < 3) {\r\n            rect.attr('height', 45);\r\n        } else if (plotCnt > 3) {\r\n            rect.attr('height', 80);\r\n        }\r\n    }\r\n\r\n    private hover():void {\r\n        const {svg,sizing,x,y,yMax} = this;\r\n        const self = this;\r\n        const hover = svg.append('g')\r\n            .attr('transform', 'translate(' + sizing.margin.left + ',' + sizing.margin.top + ')')\r\n            .style('display','none');\r\n        const hoverLine = hover.append('line')\r\n                .attr('class','focus')\r\n                .attr('fill','none')\r\n                .attr('stroke','green')\r\n                .attr('stroke-width',1)\r\n                .attr('x1',x(1))\r\n                .attr('y1',y(0))\r\n                .attr('x2',x(1))\r\n                .attr('y2',y(yMax));\r\n        const hoverInfoDy = '1.2em',\r\n            hoverInfoX = 15,\r\n            hoverInfo = hover.append('text')\r\n                .attr('class','gdd-info')\r\n                .attr('font-size',16)\r\n                .attr('y',40),\r\n            doyInfo = hoverInfo.append('tspan').attr('dy','1em').attr('x',hoverInfoX),\r\n            doyLabel = doyInfo.append('tspan').attr('class','gdd-label').text('DOY: '),\r\n            doyValue = doyInfo.append('tspan').attr('class','gdd-value'),\r\n            infoKeys = ['average','previous','selected','forecast'],\r\n            infos = infoKeys.reduce(function(map,key){\r\n                map[key] = hoverInfo.append('tspan').attr('dy',hoverInfoDy).attr('x',hoverInfoX);\r\n                return map;\r\n            },{}),\r\n            infoLabels = infoKeys.reduce(function(map,key){\r\n                map[key] = infos[key]\r\n                    .append('tspan')\r\n                    .attr('class','gdd-label '+key)\r\n                    .style('font-weight','bold')\r\n                    .style('fill',AGDD_COLORS[key]);\r\n                return map;\r\n            },{}),\r\n            infoValues = infoKeys.reduce(function(map,key){\r\n                map[key] = infos[key].append('tspan').attr('class','gdd-value');\r\n                return map;\r\n            },{}),\r\n            infoDiffs = ['previous','forecast','selected'].reduce(function(map,key){\r\n                map[key] = infos[key].append('tspan').attr('class','gdd-diff');\r\n                return map;\r\n            },{});\r\n        function focusOff() {\r\n            hover.style('display','none');\r\n        }\r\n        function focusOn() {\r\n            hover.style('display',null);\r\n        }\r\n        const nuberFmt = n => this.decimalPipe.transform(n,'1.0-0');\r\n        // clear any \"focus\" values on existing data otherwise focus rings won't\r\n        // show up after resize.\r\n        infoKeys.filter(k => !!this.data[k]).forEach(k => delete this.data[k].focus);\r\n        function updateFocus() {\r\n            let coords = d3.mouse(this),\r\n                data = self.data,\r\n                xCoord = coords[0],\r\n                doy = Math.round(x.invert(xCoord)),\r\n                lineKeys = Object.keys(data).filter(k => !!data[k]),\r\n                temps;\r\n            hoverLine.attr('transform','translate('+xCoord+')');\r\n            temps = lineKeys.reduce(function(map,key) {\r\n                var temp;\r\n                if(data[key].plotted) {\r\n                    // get the value for doy\r\n                    temp = data[key].doyMap[doy];\r\n                    if(typeof(temp) !== 'undefined') {\r\n                        map[key] = {\r\n                            year: data[key].year,\r\n                            gdd: temp\r\n                        };\r\n                        if(!data[key].focus) {\r\n                            // create a focus ring for this line\r\n                            data[key].focus = hover.append('circle')\r\n                                .attr('r',4.5)\r\n                                .attr('fill','none')\r\n                                .attr('stroke','steelblue');\r\n                        }\r\n                        data[key].focus\r\n                            .style('display',null)\r\n                            .attr('transform','translate('+xCoord+','+y(temp)+')');\r\n                    } else if (data[key].focus) {\r\n                        // invalid doy, hide focus ring\r\n                        data[key].focus.style('display','none');\r\n                    }\r\n                }\r\n                return map;\r\n            },{});\r\n            const idFunc = d => d.doy;\r\n            \r\n            //console.debug('temps for doy '+doy,temps);\r\n            doyValue.text(`${doy} (${DATE_FMT(doy)})`);\r\n            Object.keys(infos).forEach(function(key) {\r\n                var temp,diff,avgDoy,diffDoy,text,i;\r\n                if(temps[key]) {\r\n                    infos[key].style('display',null);\r\n                    infoLabels[key].text((temps[key].year||'30-year Average')+': ');\r\n                    temp = temps[key].gdd;\r\n                    infoValues[key].text(nuberFmt(temp)+' GDD');\r\n                    if(infoDiffs[key] && temps.average != null) {\r\n                        diff = temp-temps.average.gdd;\r\n                        text = ' ('+(diff > 0 ? '+' : '')+nuberFmt(diff)+' GDD';\r\n                        // on what day did the current temperature happen\r\n                        for(i = 0; i < data.average.data.length; i++) {\r\n                            if(DATA_FUNC(data.average.data[i]) > temp) {\r\n                                avgDoy = idFunc(data.average.data[i]);\r\n                                break;\r\n                            }\r\n                        }\r\n                        // this can happen when the year being compared\r\n                        // is now hotter than the average has ever been\r\n                        // i.e. late in the year\r\n                        if(avgDoy > 0 && avgDoy < 366) {\r\n                            diffDoy = (avgDoy-doy);\r\n                            text +='/'+(diffDoy > 0 ?'+' : '')+diffDoy+' days';\r\n                        }\r\n\r\n                        text += ')';\r\n                        infoDiffs[key]\r\n                        .attr('class','gdd-diff '+(diff > 0 ? 'above' : 'below'))\r\n                        .style('fill',(diff > 0 ? 'red' : 'blue'))\r\n                        .text(text);\r\n                    }\r\n                } else {\r\n                    infos[key].style('display','none');\r\n                }\r\n            });\r\n\r\n        }\r\n        svg.append('rect')\r\n            .attr('class','overlay')\r\n            .attr('transform', 'translate(' + sizing.margin.left + ',' + sizing.margin.top + ')')\r\n            .style('fill','none')\r\n            .style('pointer-events','all')\r\n            .attr('x',0)\r\n            .attr('y',0)\r\n            .attr('width',x(365))\r\n            .attr('height',y(0))\r\n            .on('mouseover',focusOn)\r\n            .on('mouseout',focusOff)\r\n            .on('mousemove',updateFocus);\r\n    }\r\n\r\n    protected redrawSvg(): void {\r\n        //console.log('AGDD: redrawSvg');\r\n        this.updateAxes();\r\n        this.updateTitle();\r\n    }\r\n\r\n    public reset():void {\r\n        //console.log('AGDD: reset');\r\n        super.reset();\r\n        const {chart,sizing,yMax} = this;\r\n        chart.append('g').attr('class','chart-title');\r\n        this.updateTitle();\r\n\r\n        this.x = scaleLinear().range([0,sizing.width]).domain([1,365]);\r\n        this.xAxis = axisBottom<number>(this.x).tickFormat(DATE_FMT);\r\n\r\n        this.y = scaleLinear().range([sizing.height,0]).domain([0,yMax])\r\n        this.yAxis = axisLeft<number>(this.y);\r\n\r\n        const line = d3.line<TimeSeriesDataPoint>();\r\n        line.curve(d3.curveLinear);\r\n        line.x(d => this.x(d.doy));\r\n        line.y(d => typeof(d.agdd) === 'number' ? this.y(d.agdd) : this.y(d.point_value));\r\n        this._line = line;\r\n\r\n        this.thresholdLine = chart.append('line')\r\n            .attr('class','threshold')\r\n            .attr('fill','none')\r\n            .attr('stroke','green')\r\n            .attr('stroke-width',1)\r\n            .attr('x1',this.x(1))\r\n            .attr('y1',this.y(this.yMax))\r\n            .attr('x2',this.x(365))\r\n            .attr('y2',this.y(yMax))\r\n            .style('display','none');\r\n        \r\n        this.hover();\r\n        this.updateAxes();\r\n        this.commonUpdates();\r\n    }\r\n\r\n    protected update():void {\r\n        //console.log('AGDD: update');\r\n        this._data = undefined;\r\n        this.reset(); // would like to be able to avoid but\r\n        this.selection.data()\r\n            .then(d => this._data = d)\r\n            .then(() => {\r\n                this.reset();\r\n                this.redraw();\r\n            });\r\n    }\r\n}","import { Component, Input, SimpleChanges, NgZone } from '@angular/core';\r\nimport {\r\n    AgddTimeSeriesSelection,\r\n    CATEGORY_PESTS,\r\n    CATEGORY_TEMP_ACCUMULATIONS,\r\n    DEFAULT_AGDD_LAYER_NAME\r\n} from './agdd-time-series-selection';\r\nimport { MonitorsDestroy } from '@npn/common/common';\r\nimport { takeUntil, startWith } from 'rxjs/operators';\r\nimport { MapLayer, NpnMapLayerService, MapLayerDefinition, MapLayerDefs, CATEGORY_PEST } from '@npn/common/gridded';\r\n\r\n@Component({\r\n    selector: 'agdd-ts-map-layer-control',\r\n    template: `\r\n    <mat-form-field class=\"layer-category\">\r\n        <mat-select placeholder=\"Layer category\" [(ngModel)]=\"selection.layerCategory\" (selectionChange)=\"categoryChange()\">\r\n            <mat-option [value]=\"CATEGORY_PESTS\">{{CATEGORY_PESTS}}</mat-option>\r\n            <mat-option [value]=\"CATEGORY_TEMP_ACCUMULATIONS\">{{CATEGORY_TEMP_ACCUMULATIONS}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <div [ngSwitch]=\"selection.layerCategory\" *ngIf=\"selection.layerCategory && layerDefinitions\">\r\n        <pest-map-layer-control *ngSwitchCase=\"CATEGORY_PESTS\" [selection]=\"selection\" [layerDefinitions]=\"layerDefinitions\"></pest-map-layer-control>\r\n        <temp-accum-map-layer-control *ngSwitchCase=\"CATEGORY_TEMP_ACCUMULATIONS\" [selection]=\"selection\" [layerDefinitions]=\"layerDefinitions\" agddTimeSeries=\"true\"></temp-accum-map-layer-control>\r\n    </div>\r\n    <div *ngIf=\"selection.layer\" class=\"layer-controls\">\r\n        <extent-control [selection]=\"selection\"></extent-control>\r\n        <supports-opacity-control [supportsOpacity]=\"selection.layer\"></supports-opacity-control>\r\n        <p *ngIf=\"selection.layer.hasAbstract()\" [innerHTML]=\"selection.layer.getAbstract()\"></p>\r\n    </div>\r\n    `,\r\n    styles:[`\r\n    :host {\r\n        display: block;\r\n    }\r\n    mat-form-field.layer-category {\r\n        display: block;\r\n    }\r\n    .layer-controls {\r\n        width: 400px;\r\n    }\r\n    .layer-controls >p {\r\n        margin: 12px 0px 0px 0px;\r\n    }\r\n    `]\r\n})\r\nexport class AgddTsMapLayerControl extends MonitorsDestroy {\r\n    @Input() selection: AgddTimeSeriesSelection;\r\n    @Input() map;/*:google.maps.Map;*/\r\n\r\n    layerDefinitions:MapLayerDefs;\r\n    pests:MapLayerDefinition[];\r\n\r\n    CATEGORY_PESTS = CATEGORY_PESTS;\r\n    CATEGORY_TEMP_ACCUMULATIONS = CATEGORY_TEMP_ACCUMULATIONS;\r\n    marker;\r\n    layer:MapLayer;\r\n    private mapResolver;\r\n    private getMap = new Promise<google.maps.Map>(resolve => this.mapResolver = resolve);\r\n\r\n    constructor(private layerService:NpnMapLayerService,private zone:NgZone){\r\n        super();\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.layerService.getLayerDefinitions().then((defs:MapLayerDefs) => {\r\n            this.layerDefinitions = defs;\r\n            this.pests = this.layerDefinitions.categories.find(c => c.name === CATEGORY_PEST).layers;\r\n        });\r\n        const {selection,componentDestroyed} = this;\r\n        // would be nice to just watch the selection but updates only come through if a selection is valid\r\n        componentDestroyed.subscribe(() => selection.endMonitorLayerChange());\r\n        selection.monitorLayerChange().pipe(\r\n            startWith(selection.layerName),\r\n            takeUntil(componentDestroyed)\r\n        ).subscribe(layerName => {\r\n            console.log(`AgddTsMapLayerControl.layerName=${layerName}`);\r\n            if(this.layer && this.layer.layerName !== layerName) {\r\n                this.layer.off();\r\n                this.layer = undefined;\r\n            }\r\n            if(layerName && !this.layer) {\r\n                Promise.all([\r\n                    this.getMap,\r\n                    selection.getLayer()\r\n                ]).then(results => {\r\n                    const [map,layer] = results;\r\n                    layer.setMap(map);\r\n                    layer.on();\r\n                    this.layer = layer;\r\n                });\r\n            }\r\n        });\r\n\r\n        this.getMap.then(map => {\r\n            const updateLatLng = event => {\r\n                console.log(`AgddTsMapLayerControl.updateLatLng ${event.latLng.lat()},${event.latLng.lng()}`);\r\n                this.zone.run(() => {\r\n                    selection.latLng = [\r\n                        event.latLng.lat(),\r\n                        event.latLng.lng()\r\n                    ]\r\n                });\r\n            };\r\n            if(selection.latLng && selection.latLng.length === 2) {\r\n                const {latLng} = selection;\r\n                this.marker = new google.maps.Marker({\r\n                    map,\r\n                    draggable:true,\r\n                    position: new google.maps.LatLng(latLng[0],latLng[1])\r\n                });\r\n                this.marker.addListener('dragend',updateLatLng);\r\n            }\r\n            google.maps.event.addListener(map,'click',event => {\r\n                if(!this.marker) {\r\n                    this.marker = new google.maps.Marker({\r\n                        map,\r\n                        draggable:true,\r\n                        position: event.latLng\r\n                    });\r\n                    this.marker.addListener('dragend',updateLatLng);\r\n                }\r\n                this.marker.setPosition(event.latLng);\r\n                updateLatLng(event);\r\n            });\r\n        });\r\n    }\r\n\r\n    ngOnChanges(changes:SimpleChanges) {\r\n        if(changes && changes.map && changes.map.currentValue) {\r\n            this.mapResolver(changes.map.currentValue);\r\n        }\r\n    }\r\n\r\n    categoryChange() {\r\n        this.selection.layerName = this.selection.layerCategory === CATEGORY_PESTS\r\n            ? this.pests[0].name\r\n            : DEFAULT_AGDD_LAYER_NAME;\r\n    }\r\n}","export * from './public_api';","export * from './agdd-time-series-selection';\r\nexport * from './agdd-time-series-selection.factory';\r\nexport * from './agdd-time-series.component';\r\nexport * from './agdd-ts-map-layer-control.component';","import {Component,Input,OnInit} from '@angular/core';\r\n\r\nimport {CalendarSelection} from './calendar-selection';\r\nimport { HigherSpeciesPhenophaseInputCriteria } from '../common-controls';\r\nimport { filter, debounceTime, takeUntil } from 'rxjs/operators';\r\nimport { VisSelectionEvent } from '../vis-selection';\r\nimport { MonitorsDestroy } from '@npn/common/common';\r\nimport { faExclamationTriangle } from '@fortawesome/pro-light-svg-icons';\r\n\r\nconst THIS_YEAR = (new Date()).getFullYear();\r\nconst VALID_YEARS = (function(){\r\n    let max = THIS_YEAR+1,\r\n        current = 1900,\r\n        years:number[] = [];\r\n    while(current < max) {\r\n        years.push(current++);\r\n    }\r\n    return years;\r\n})();\r\n\r\n@Component({\r\n    selector: 'calendar-control',\r\n    template: `\r\n    <div *ngIf=\"!selection.canAddPlot\" class=\"max-plots-reached\"><fa-icon [icon]=\"faExclamationTriangle\"></fa-icon> One more year or species/phenophase combination would exceed the maximum of {{selection.MAX_PLOTS}} plots</div>\r\n    <div>\r\n        <div class=\"year-input-wrapper\" *ngFor=\"let plotYear of selection.years;index as idx\">\r\n            <mat-form-field class=\"year-input\">\r\n                <mat-select placeholder=\"Year {{idx+1}}\" [(ngModel)]=\"selection.years[idx]\" (ngModelChange)=\"yearChange()\" id=\"year_{{idx}}\">\r\n                    <mat-option *ngFor=\"let y of selectableYears(selection.years[idx])\" [value]=\"y\">{{y}}</mat-option>\r\n                </mat-select>\r\n            </mat-form-field>\r\n            <button *ngIf=\"selection.years?.length > 0\" mat-button class=\"remove-year\" (click)=\"removeYear(idx)\">Remove</button>\r\n            <button *ngIf=\"idx === (selection.years.length-1)\" mat-button class=\"add-year\" (click)=\"addYear()\" [disabled]=\"!selection.canAddPlot\">Add</button>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"phenophase-input-wrapper\" *ngFor=\"let spi of selection.plots; index as idx\">\r\n        <higher-species-phenophase-input\r\n            gatherColor=\"true\"\r\n            [selection]=\"selection\"\r\n            [criteria]=\"criteria\"\r\n            [plot]=\"spi\"\r\n            (plotChange)=\"selection.update()\"></higher-species-phenophase-input>\r\n        <button *ngIf=\"idx > 0\" mat-button class=\"remove-plot\" (click)=\"removePlot(idx)\">Remove</button>\r\n        <button *ngIf=\"idx === (selection.plots.length-1)\" mat-button class=\"add-plot\" (click)=\"addPlot()\" [disabled]=\"!plotsValid() || !selection.canAddPlot\">Add</button>\r\n    </div>\r\n\r\n    <mat-checkbox [(ngModel)]=\"selection.negative\" (change)=\"redrawChange()\">Display negative data</mat-checkbox>\r\n\r\n    <label for=\"label-size-input\">Label size\r\n        <mat-slider id=\"label-size-input\" min=\"0\" max=\"10\" step=\"0.25\" [(ngModel)]=\"selection.fontSizeDelta\" (change)=\"redrawChange()\" [disabled]=\"!selection.isValid()\"></mat-slider>\r\n    </label>\r\n\r\n    <label for=\"label-position-input\">Label position\r\n        <mat-slider id=\"label-position-input\" min=\"0\" max=\"100\" step=\"1\" [(ngModel)]=\"selection.labelOffset\" (change)=\"redrawChange()\" [disabled]=\"!selection.isValid()\"></mat-slider>\r\n    </label>\r\n\r\n    <label for=\"label-band-size-input\">Band size\r\n        <mat-slider invert id=\"label-band-size-input\" min=\"0\" max=\"0.95\" step=\"0.05\" [(ngModel)]=\"selection.bandPadding\" (change)=\"redrawChange()\" [disabled]=\"!selection.isValid()\"></mat-slider>\r\n    </label>\r\n    `,\r\n    styles:[`\r\n        .year-input-wrapper {\r\n            display: inline-block;\r\n            margin-right: 15px;\r\n        }\r\n        .year-input {\r\n            width: 60px;\r\n        }\r\n        .phenophase-input-wrapper {\r\n            display: block;\r\n        }\r\n        label[for=\"label-size-input\"] {\r\n            margin-left: 15px;\r\n        }\r\n    `]\r\n})\r\nexport class CalendarControlComponent extends MonitorsDestroy {\r\n    @Input()\r\n    selection: CalendarSelection;\r\n    maxYears = 5;\r\n    criteria:HigherSpeciesPhenophaseInputCriteria;\r\n    faExclamationTriangle = faExclamationTriangle;\r\n\r\n    selectableYears(y:number) {\r\n        if(y) {\r\n            // validYears including y but excluding any others in the selection\r\n            return VALID_YEARS.filter(yr => {\r\n                return yr === y || this.selection.years.indexOf(yr) === -1;\r\n            });\r\n        }\r\n        return VALID_YEARS;\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.selection.pipe(\r\n            filter(event => event === VisSelectionEvent.SCOPE_CHANGE),\r\n            debounceTime(500),\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe(() => this.updateCriteria());\r\n        \r\n        if(this.selection.years.length === 0) {\r\n            this.addYear();\r\n        }\r\n        if(this.selection.plots.length === 0) {\r\n            this.addPlot();\r\n        }\r\n        setTimeout(() => this.updateCriteria());\r\n    }\r\n\r\n    updateCriteria() {\r\n        this.criteria = {\r\n            years: this.selection.years,\r\n            stationIds: this.selection.getStationIds()\r\n        };\r\n    }\r\n\r\n    yearChange() {\r\n        this.updateCriteria();\r\n        this.selection.update();\r\n    }\r\n\r\n    redrawChange(change?) {\r\n        if(change && !change.oldValue && change.newValue) { // e.g. no color to a color means a plot that wasn't valid is now potentially valid.\r\n            this.selection.update();\r\n        } else {\r\n            this.selection.redraw();\r\n        }\r\n    }\r\n\r\n    addPlot() {\r\n        this.selection.plots.push({});\r\n    }\r\n\r\n    removePlot(index:number) {\r\n        this.selection.plots.splice(index,1);\r\n        this.selection.update();\r\n    }\r\n\r\n    addYear() {\r\n        let y = THIS_YEAR;\r\n        while(this.selection.years.indexOf(y) !== -1) {\r\n            y--;\r\n        }\r\n        this.selection.years.push(y);\r\n        this.yearChange();\r\n    }\r\n\r\n    removeYear(index:number) {\r\n        this.selection.years.splice(index,1);\r\n        this.yearChange();\r\n    }\r\n\r\n    plotsValid() {\r\n        return this.selection.plots.length === this.selection.validPlots.length;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { NpnServiceUtils, TaxonomicSpeciesTitlePipe, SpeciesService, NetworkService } from '../../common';\r\nimport { CalendarSelection } from './calendar-selection';\r\n\r\n@Injectable()\r\nexport class CalendarSelectionFactory {\r\n    requestSrc: string = 'npn-vis-calendar';\r\n\r\n    constructor(\r\n        private serviceUtils:NpnServiceUtils,\r\n        private speciesTitle:TaxonomicSpeciesTitlePipe,\r\n        private speciesService:SpeciesService,\r\n        private networkService:NetworkService\r\n    ) {}\r\n\r\n    newSelection(): CalendarSelection {\r\n        return new CalendarSelection(this.serviceUtils,this.speciesTitle,this.speciesService,this.networkService);\r\n    }\r\n}\r\n","import {ObservationDateVisSelection} from '../observation-date-vis-selection';\r\n\r\nimport {selectionProperty} from '../vis-selection';\r\n\r\nexport class CalendarSelection extends ObservationDateVisSelection {\r\n    @selectionProperty()\r\n    $class:string = 'CalendarSelection';\r\n\r\n    @selectionProperty()\r\n    labelOffset:number = 4;\r\n    @selectionProperty()\r\n    bandPadding:number = 0.5;\r\n    @selectionProperty()\r\n    fontSizeDelta:number = 0;\r\n    @selectionProperty()\r\n    monthFormat?:string;\r\n\r\n    isValid():boolean {\r\n        return typeof(this.labelOffset) === 'number' &&\r\n               typeof(this.bandPadding) === 'number' &&\r\n               typeof(this.fontSizeDelta) === 'number' &&\r\n                super.isValid();\r\n    }\r\n}\r\n\r\nexport {ObservationDataDataPoint,ObservationDateData} from '../observation-date-vis-selection';\r\n","import {Component,Input, ElementRef} from '@angular/core';\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport {ONE_DAY_MILLIS} from '../vis-selection';\r\nimport {CalendarSelection,ObservationDataDataPoint,ObservationDateData} from './calendar-selection';\r\nimport {VisualizationMargins} from '../visualization-base.component';\r\nimport {SvgVisualizationBaseComponent} from '../svg-visualization-base.component';\r\n\r\nimport {Axis,axisBottom,axisRight} from 'd3-axis';\r\nimport {ScaleBand,scaleBand} from 'd3-scale';\r\nimport * as d3 from 'd3';\r\nimport { ObservationDatePlotData } from '../observation-date-vis-selection';\r\n\r\n@Component({\r\n    selector: 'calendar',\r\n    templateUrl: '../svg-visualization-base.component.html',\r\n    styleUrls: ['../svg-visualization-base.component.scss']\r\n})\r\nexport class CalendarComponent extends SvgVisualizationBaseComponent {\r\n    @Input() selection: CalendarSelection;\r\n\r\n    filename:string = 'calendar.png';\r\n    margins: VisualizationMargins = {top: 20, right: 35, bottom: 45, left: 35};\r\n\r\n    x: ScaleBand<number>;\r\n    xAxis: Axis<number>;\r\n\r\n    y: ScaleBand<number>;\r\n    yAxis: Axis<number>\r\n\r\n    private processed:ObservationDateData;\r\n    private data:ObservationDatePlotData[];\r\n\r\n    constructor(protected rootElement: ElementRef, protected media: ObservableMedia) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    // the doy of the first of each month doesn't change from year to year just what\r\n    // day of the week days fall on so what year is used to calculate them is irrelevant\r\n    xTickValues(): number[] {\r\n        var firsts = [1],i,count = 1;\r\n        for(i = 1; i < 12; i++) {\r\n            var date = new Date(1900,i);\r\n            // back up 1 day\r\n            date.setTime(date.getTime()-ONE_DAY_MILLIS);\r\n            count += date.getDate();\r\n            firsts.push(count);\r\n        }\r\n        return this.x.domain().filter(function(d){\r\n            return firsts.indexOf(d) !== -1;\r\n        });\r\n    }\r\n\r\n    protected commonUpdates(): void {\r\n        // forces all text to 14 px\r\n        super.commonUpdates();\r\n        // labels are customizable in size\r\n        let bw = this.y.bandwidth();\r\n        let dy = -1*((bw/2)+this.selection.labelOffset),\r\n            labelFontSize = (this.baseFontSize() as number)+this.selection.fontSizeDelta;\r\n        this.chart.selectAll('.y.axis text')\r\n            .attr('x', 0)\r\n            .attr('dy', dy)\r\n            .attr('style', `text-anchor: start; font-size: ${labelFontSize}px;`);\r\n    }\r\n\r\n    private getMonthFormat(): string {\r\n        if(this.selection.monthFormat) {\r\n            return this.selection.monthFormat;\r\n        }\r\n        if(this.sizing && this.sizing.width < 800) {\r\n            return '%b';\r\n        }\r\n        return '%B';\r\n    }\r\n\r\n    protected reset(): void {\r\n        super.reset();\r\n        this.processed = undefined;\r\n        let chart = this.chart,\r\n            sizing = this.sizing,\r\n            d3_month_fmt = d3.timeFormat(this.getMonthFormat());\r\n\r\n        this.x = scaleBand<number>().range([0,sizing.width]).domain(d3.range(1,366))\r\n            .paddingInner(-0.1).paddingOuter(0.5);\r\n        this.xAxis = axisBottom<number>(this.x).tickValues(this.xTickValues())\r\n            .tickFormat((i) => {\r\n                let date = new Date(1900,0);\r\n                date.setTime(date.getTime()+(ONE_DAY_MILLIS*i));\r\n                return d3_month_fmt(date);\r\n            });\r\n        this.y = scaleBand<number>().range([sizing.height,0]).domain(d3.range(0,6)).paddingOuter(0.5);\r\n        this.yAxis = axisRight<number>(this.y).tickSize(sizing.width).tickFormat(i => {\r\n            return this.processed && this.processed.data && i < this.processed.labels.length ?\r\n                this.processed.labels[i] : '';\r\n        });\r\n\r\n        chart.append('g')\r\n            .attr('class', 'x axis')\r\n            .attr('transform', 'translate(0,' + sizing.height + ')')\r\n            .call(this.xAxis);\r\n\r\n        chart.append('g')\r\n            .attr('class', 'y axis')\r\n            .call(this.yAxis);\r\n        chart.selectAll('g .y.axis line')\r\n            .style('stroke','#777')\r\n            .style('stroke-dasharray','2,2');\r\n\r\n        // hide y axis ticks and domain\r\n        //chart.selectAll('g .y.axis .tick line').style('display','none');\r\n        chart.selectAll('g .y.axis .domain').style('display','none');\r\n\r\n        this.commonUpdates();\r\n    }\r\n\r\n    protected update(): void {\r\n        this.reset();\r\n        this.selection.getData().then(data => {\r\n            this.data = data;\r\n            this.redraw();\r\n        })\r\n        .catch(this.handleError);\r\n    }\r\n\r\n    protected redrawSvg(): void {\r\n        if(!this.data) {\r\n            return;\r\n        }\r\n        const processed = this.processed = this.selection.postProcessData(this.data);\r\n\r\n        // update y axis\r\n        this.y.paddingInner(this.selection.bandPadding);\r\n        if(processed && processed.labels) {\r\n            this.y.domain(d3.range(0,processed.labels.length));\r\n        }\r\n        this.yAxis.scale(this.y);\r\n        this.chart.selectAll('g .y.axis')\r\n            .call(this.yAxis);\r\n\r\n        this.chart.selectAll('.doy').remove();\r\n        if(processed && processed.data) {\r\n            let doys = this.chart.selectAll('.doy').data(processed.data, d => {\r\n                let point = d as ObservationDataDataPoint; // why is this necessary\r\n                return`${point.y}-${point.x}-${point.color}`;\r\n            });\r\n            doys = doys.enter().insert('line',':first-child').attr('class','doy');\r\n            let dx = Math.ceil(this.x.bandwidth()/2),\r\n                dy = this.y.bandwidth()/2;\r\n            doys.attr('x1', d => this.x(d.x)-dx)\r\n                .attr('y1', (d,i) => this.y(d.y)+dy)\r\n                .attr('x2', d => this.x(d.x)+dx)\r\n                .attr('y2', (d,i) => this.y(d.y)+dy)\r\n                .attr('doy-point',d => `(${d.x},${d.y})`)\r\n                .attr('stroke', d => d.color)\r\n                .attr('stroke-width', `${this.y.bandwidth()}`)\r\n                .append('title')\r\n                .text(function(d) {\r\n                    return d.x; // x is the doy\r\n                });\r\n        }\r\n        this.commonUpdates();\r\n    }\r\n}\r\n","export * from './public_api';","export {CalendarSelection} from './calendar-selection';\r\nexport {CalendarSelectionFactory} from './calendar-selection-factory.service';\r\nexport {CalendarComponent} from './calendar.component';\r\nexport {CalendarControlComponent} from './calendar-control.component';\r\n","import {Component, Input, OnInit} from '@angular/core';\r\nimport {ClippedWmsMapSelection} from './clipped-wms-map-selection';\r\n\r\n@Component({\r\n    selector: 'clipped-wms-map-control',\r\n    template: `\r\n    <mat-form-field class=\"map-service-input\">\r\n        <mat-select placeholder=\"Map\" [(ngModel)]=\"selection.service\" (ngModelChange)=\"serviceChange()\">\r\n            <mat-option *ngFor=\"let s of validServices\" [value]=\"s.value\">{{s.label}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <mat-form-field class=\"map-layer-input\">\r\n        <mat-select placeholder=\"Layer\" [(ngModel)]=\"selection.layer\" (ngModelChange)=\"layerChange()\">\r\n            <mat-option *ngFor=\"let l of validLayers\" [value]=\"l\">{{l.label}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <mat-checkbox [(ngModel)]=\"selection.useBufferedBoundary\" (change)=\"layerChange()\">Use Buffered Boundary</mat-checkbox>\r\n    `,\r\n    styles:[`\r\n        .map-service-input {\r\n            width: 225px;\r\n        }\r\n        .map-layer-input {\r\n            width: 155px;\r\n        }\r\n        mat-form-field {\r\n            padding-right: 10px;\r\n        }\r\n    `]\r\n})\r\nexport class ClippedWmsMapControl implements OnInit {\r\n    @Input()\r\n    selection: ClippedWmsMapSelection;\r\n\r\n    validServices:any[];\r\n    validLayers:any[];\r\n\r\n    serviceChange() {\r\n        this.validLayers = this.selection.validLayers;\r\n        let selection = this.selection,\r\n            layers = this.selection.validLayers;\r\n        selection.layer = layers.length ? layers[0] : undefined;\r\n        this.layerChange();\r\n    }\r\n\r\n    layerChange() {\r\n        let selection = this.selection;\r\n        if(selection.isValid()) {\r\n            selection.update();\r\n        } else {\r\n            selection.reset();\r\n        }\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.validServices = this.selection.validServices;\r\n        this.serviceChange();\r\n    }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\n\r\nimport { DatePipe } from '@angular/common';\r\nimport { NpnServiceUtils, NetworkService } from '../../common';\r\nimport { WcsDataService, NpnMapLayerService } from '../../gridded';\r\n\r\nimport { ClippedWmsMapSelection } from './clipped-wms-map-selection';\r\n\r\n@Injectable()\r\nexport class ClippedWmsMapSelectionFactory {\r\n    constructor(protected serviceUtils:NpnServiceUtils,\r\n                protected datePipe: DatePipe,\r\n                protected layerService:NpnMapLayerService,\r\n                protected dataService:WcsDataService,\r\n                protected networkService:NetworkService) {}\r\n\r\n    newSelection(): ClippedWmsMapSelection {\r\n        return new ClippedWmsMapSelection(this.serviceUtils,this.datePipe,this.layerService,this.dataService,this.networkService);\r\n    }\r\n}\r\n","import { NetworkAwareVisSelection, selectionProperty, ONE_DAY_MILLIS } from '../vis-selection';\r\nimport { NpnServiceUtils, NetworkService } from '../../common';\r\nimport {\r\n    MapLayerLegend,\r\n    SupportsOpacity,\r\n    googleFeatureBounds,\r\n    WcsDataService,\r\n    GriddedInfoWindowHandler,\r\n    NpnMapLayerService\r\n} from '../../gridded';\r\n\r\nimport { DatePipe } from '@angular/common';\r\n\r\nconst SIX_NODATA_DISCLAIMER = `This Refuge has not yet met the requirements for the Spring Leaf Index model. Check back later in the year.`;\r\n\r\nconst SIX_LAYERS:ClippedLayerDef[] = [{\r\n    id: 'current',\r\n    label: 'Current Si-x leaf index',\r\n    layerName: 'si-x:average_leaf_ncep',\r\n    clippingService: 'si-x/area/clippedImage',\r\n    statisticsService: 'si-x/area/statistics',\r\n    noDataDisclaimer: SIX_NODATA_DISCLAIMER\r\n},{\r\n    id: 'forecast',\r\n    label: '6-day forecast',\r\n    layerName: 'si-x:average_leaf_ncep',\r\n    clippingService: 'si-x/area/clippedImage',\r\n    statisticsService: 'si-x/area/statistics',\r\n    forecast: true,\r\n    noDataDisclaimer: SIX_NODATA_DISCLAIMER\r\n},{\r\n    id: 'anomaly',\r\n    label: 'Anomaly',\r\n    layerName: 'si-x:leaf_anomaly',\r\n    clippingService: 'si-x/anomaly/area/clippedImage',\r\n    statisticsService: 'si-x/anomaly/area/statistics',\r\n    noDataDisclaimer: SIX_NODATA_DISCLAIMER\r\n}];\r\nconst AGDD_LAYERS:ClippedLayerDef[] = [{\r\n    id: 'current',\r\n    label: 'Current AGDD',\r\n    layerName: 'gdd:agdd',\r\n    clippingService: 'agdd/area/clippedImage',\r\n    statisticsService: 'agdd/area/statistics',\r\n},{\r\n    id: 'forecast',\r\n    label: '6-day forecast',\r\n    layerName: 'gdd:agdd',\r\n    clippingService: 'agdd/area/clippedImage',\r\n    statisticsService: 'agdd/area/statistics',\r\n    forecast: true,\r\n},{\r\n    id: 'anomaly',\r\n    label: 'Anomaly',\r\n    layerName: 'gdd:agdd_anomaly',\r\n    clippingService: 'agdd/anomaly/area/clippedImage',\r\n    statisticsService: 'agdd/anomaly/area/statistics',\r\n}];\r\n\r\nexport class ClippedWmsMapSelection extends NetworkAwareVisSelection {\r\n    @selectionProperty()\r\n    $class:string = 'ClippedWmsMapSelection';\r\n\r\n    @selectionProperty() // may need to use get/set pattern\r\n    service:string = 'si-x'; // si-x || agdd\r\n    @selectionProperty()\r\n    layer:ClippedLayerDef = SIX_LAYERS[0];\r\n    @selectionProperty()\r\n    fwsBoundary:string;\r\n    @selectionProperty()\r\n    useBufferedBoundary:boolean = false;\r\n\r\n    legend:MapLayerLegend;\r\n    overlay:ImageOverlay;\r\n    data:WmsMapSelectionData;\r\n    private features:any[];\r\n    private listeners:any[];\r\n    private infoWindowHandler:GriddedInfoWindowHandler;\r\n\r\n    // these are not persisted but status of spring dashboard or\r\n    // other components can tailor them.\r\n    public explicitDate:Date;\r\n    public forecastDays:number = 6;\r\n\r\n    constructor(protected serviceUtils:NpnServiceUtils,\r\n                protected datePipe:DatePipe,\r\n                protected mapLayerService:NpnMapLayerService,\r\n                protected dataService:WcsDataService,\r\n                protected networkService:NetworkService) {\r\n        super(networkService);\r\n    }\r\n\r\n    isValid():boolean {\r\n        return (this.service === 'si-x' || this.service === 'agdd') && !!this.layer && !!this.fwsBoundary;\r\n    }\r\n\r\n    get validServices(): any[] {\r\n        return [{\r\n            value: 'si-x',\r\n            label: 'Spring index'\r\n        },{\r\n            value: 'agdd',\r\n            label: 'Accumulated growing degree days'\r\n        }];\r\n    }\r\n    get validLayers(): any[] {\r\n        switch(this.service) {\r\n            case 'si-x':\r\n                return SIX_LAYERS;\r\n            case 'agdd':\r\n                return AGDD_LAYERS;\r\n        }\r\n        return [];\r\n    }\r\n\r\n    get apiDate(): string {\r\n        // always \"today\" or 6 days in the future for forecast\r\n        let d = this.explicitDate ?\r\n            new Date(this.explicitDate.getTime()) : new Date();\r\n        if(this.layer && this.layer.forecast) {\r\n            d.setTime(d.getTime()+(this.forecastDays*ONE_DAY_MILLIS));\r\n        }\r\n        return this.datePipe.transform(d,'y-MM-dd');\r\n    }\r\n\r\n    getBoundary(): Promise<any> {\r\n        const url = this.serviceUtils.dataApiUrl('/v0/si-x/area/boundary');\r\n        const params = {\r\n                format: 'geojson',\r\n                fwsBoundary: this.fwsBoundary\r\n            };\r\n        return this.serviceUtils.cachedGet(url,params)\r\n            .then(response => {\r\n                if(response && response.boundary) {\r\n                    return this.serviceUtils.cachedGet(response.boundary,{});\r\n                }\r\n                throw new Error('missing boundary in response.');\r\n            });\r\n    }\r\n\r\n    getData(): Promise<any> {\r\n        let url = this.serviceUtils.dataApiUrl(`/v0/${this.layer.clippingService}`),\r\n            params = {\r\n                layerName: this.layer.layerName,\r\n                fwsBoundary: this.fwsBoundary,\r\n                date: this.apiDate,\r\n                useBufferedBoundary: this.useBufferedBoundary,\r\n                style: true,\r\n                fileFormat: 'png'\r\n            };\r\n        return this.serviceUtils.cachedGet(url,params);\r\n    }\r\n\r\n    getStatistics(): Promise<any> {\r\n        const url = this.serviceUtils.dataApiUrl(`/v0/${this.layer.statisticsService}`);\r\n        const params = {\r\n                layerName: this.layer.layerName,\r\n                fwsBoundary: this.fwsBoundary,\r\n                date: this.apiDate,\r\n                useBufferedBoundary: this.useBufferedBoundary,\r\n                useCache: this.serviceUtils.dataApiUseStatisticsCache\r\n            };\r\n        return this.serviceUtils.cachedGet(url,params)\r\n            .then(stats => {\r\n                // translate the date string to a date object.\r\n                let dateParts = /^(\\d{4})-(\\d{2})-(\\d{2})/.exec(stats.date);\r\n                stats.date = new Date(\r\n                    parseInt(dateParts[1]),\r\n                    parseInt(dateParts[2])-1,\r\n                    parseInt(dateParts[3])\r\n                );\r\n                return stats;\r\n            });\r\n\r\n    }\r\n\r\n    getAllData(): Promise<WmsMapSelectionData> {\r\n        return Promise.all([\r\n                this.getData(),\r\n                this.getBoundary(),\r\n                this.getStatistics()\r\n            ])\r\n            .then(arr => ({\r\n                    data: arr[0],\r\n                    boundary: arr[1],\r\n                    statistics: arr[2]\r\n                }));\r\n    }\r\n\r\n    fitBounds(map: google.maps.Map) {\r\n        let bounds = undefined;\r\n        if(this.data && this.data.data) {\r\n            bounds = this.toBounds(this.data.data.bbox);\r\n            if(bounds) {\r\n                map.fitBounds(bounds);\r\n            }\r\n        }\r\n        if(!bounds && this.features && this.features.length) {\r\n            let allBounds = this.features.map(f => googleFeatureBounds(f)).filter(b => !!b);\r\n            if(allBounds.length) {\r\n                let bounds = allBounds[0];\r\n                if(allBounds.length > 1) {\r\n                    // union in the others\r\n                    allBounds.slice(1).forEach(b => bounds.union(b));\r\n                }\r\n                map.fitBounds(bounds);\r\n            }\r\n        }\r\n    }\r\n\r\n    resizeMap(map: google.maps.Map): Promise<any> {\r\n        return new Promise(resolve => {\r\n            this.fitBounds(map);\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    removeFrom(map: google.maps.Map): Promise<any> {\r\n        return new Promise(resolve => {\r\n            if(this.overlay) {\r\n                this.overlay.remove();\r\n            }\r\n            (this.features||[]).forEach(f => {\r\n                map.data.remove(f);\r\n            });\r\n            (this.listeners||[]).forEach(l => google.maps.event.removeListener(l));\r\n            if(this.infoWindowHandler) {\r\n                this.infoWindowHandler.close();\r\n            }\r\n            this.data = undefined;\r\n            this.features = undefined;\r\n            this.listeners = undefined;\r\n            this.infoWindowHandler = undefined;\r\n            this.overlay = undefined;\r\n            this.legend = undefined;\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    addTo(map: google.maps.Map): Promise<any> {\r\n        return new Promise((_resolve,_reject) => {\r\n            this.working = true;\r\n            let resolve = (d?:any) => {\r\n                    this.working = false;\r\n                    _resolve(d);\r\n                },\r\n                reject = (e?:any) => {\r\n                    this.working = false;\r\n                    _reject(e);\r\n                };\r\n            if(this.overlay && this.features) {\r\n                return reject('already added to map, call removeFrom');\r\n            }\r\n            this.getAllData()\r\n                .then(all => {\r\n                    if(this.overlay && this.features) {\r\n                        console.log('in promise, already have overlay and features');\r\n                        return resolve();\r\n                    }\r\n                    // have to do this so that the google api classes aren't\r\n                    // touched too early and our class extension invalid\r\n                    lazyClassLoader();\r\n\r\n                    this.data = all;\r\n                    let data = all.data,\r\n                        bounds = this.toBounds(data.bbox),\r\n                        clippedImage = data.clippedImage;\r\n                    if(bounds) {\r\n                        map.panTo(bounds.getCenter());\r\n                        /*\r\n                        let rect = new google.maps.Rectangle({\r\n                            strokeColor: '#FF0000',\r\n                            strokeOpacity: 0.8,\r\n                            strokeWeight: 2,\r\n                            fillColor: '#FF0000',\r\n                            fillOpacity: 0.35,\r\n                            map: map,\r\n                            bounds: bounds\r\n                        });*/\r\n                        map.fitBounds(bounds);\r\n\r\n                        this.overlay = new ImageOverLayImpl(bounds,clippedImage,map);\r\n                        this.overlay.add();\r\n                        this.infoWindowHandler = this.dataService.newInfoWindowHandler(map);\r\n                        let wcsDateArg = `http://www.opengis.net/def/axis/OGC/0/time(\"${this.apiDate}T00:00:00.000Z\")`,\r\n                            wcsParamAugmenter = (params:any) => {\r\n                                params.subset = params.subset||[];\r\n                                params.subset.push(wcsDateArg);\r\n                            };\r\n                        this.listeners = this.listeners||[];\r\n                        this.listeners.push(map.addListener('click',(event) =>\r\n                            this.infoWindowHandler.open(event.latLng,this.layer.layerName,this.legend,wcsParamAugmenter)));\r\n                    }\r\n\r\n                    this.addBoundary(map,all.boundary);\r\n\r\n                    this.mapLayerService.getLegend(data.layerClippedFrom)\r\n                        .then(legend => {\r\n                            console.debug('ClippedWmsMapSelection.legend:',legend);\r\n                            this.legend = legend;\r\n                            resolve();\r\n                        })\r\n                        .catch(reject);\r\n                })\r\n                .catch(reject);\r\n        });\r\n\r\n    }\r\n\r\n    addBoundary(map: google.maps.Map,geoJson:any) {\r\n        console.log('ClippedWmsMapSelection.addBoundary',geoJson);\r\n        this.features = map.data.addGeoJson(geoJson);\r\n        map.data.setStyle(feature => {\r\n            return {\r\n                strokeColor: '#000000',\r\n                strokeOpacity: 0.8,\r\n                strokeWeight: 2,\r\n                fillColor: '#FF0000',\r\n                fillOpacity: 0.0,\r\n                clickable: false,\r\n            };\r\n        });\r\n        this.fitBounds(map);\r\n    }\r\n\r\n    private toBounds(bbox:number[]): google.maps.LatLngBounds {\r\n        if(bbox && bbox.length === 4) {\r\n            let sw_lng = bbox[0],\r\n                sw_lat = bbox[1],\r\n                ne_lng = bbox[2],\r\n                ne_lat = bbox[3];\r\n            return new google.maps.LatLngBounds(\r\n              new google.maps.LatLng(sw_lat,sw_lng),\r\n              new google.maps.LatLng(ne_lat,ne_lng)\r\n            );\r\n            /*\r\n            let coords = /^BOX\\(\\s*(-?\\d+\\.\\d+)\\s+(-?\\d+\\.\\d+),\\s*(-?\\d+\\.\\d+)\\s+(-?\\d+\\.\\d+)\\s*\\)/.exec(this.box);\r\n            if(coords.length === 5) {\r\n                let sw_lng = parseFloat(coords[1]),\r\n                    sw_lat = parseFloat(coords[2]),\r\n                    ne_lng = parseFloat(coords[3]),\r\n                    ne_lat = parseFloat(coords[4]);\r\n                return new google.maps.LatLngBounds(\r\n                  new google.maps.LatLng(sw_lat,sw_lng),\r\n                  new google.maps.LatLng(ne_lat,ne_lng)\r\n                );\r\n            }*/\r\n        }\r\n        return null;\r\n    }\r\n    // lat + N of equator, - S of equator\r\n    // lng + E of meridian - W of meridian\r\n}\r\n\r\nexport interface ClippedLayerDef {\r\n    id: string;\r\n    label: string;\r\n    layerName: string;\r\n    clippingService: string;\r\n    statisticsService: string;\r\n    noDataDisclaimer?: string;\r\n    forecast?: boolean;\r\n}\r\n\r\ninterface ClippedImageResponse {\r\n    date: string;\r\n    layerClippedFrom: string;\r\n    clippedImage: string;\r\n    bbox: number [];\r\n}\r\n\r\ninterface WmsMapSelectionData {\r\n    data: ClippedImageResponse;\r\n    boundary: any; // geoJson\r\n    statistics: any;\r\n};\r\n\r\ninterface ImageOverlay extends google.maps.OverlayView,SupportsOpacity {\r\n    add();\r\n    remove();\r\n}\r\nlet ImageOverLayImpl: { new (bounds: google.maps.LatLngBounds, image: string, map: google.maps.Map): ImageOverlay };\r\n\r\nfunction lazyClassLoader() {\r\n    ImageOverLayImpl = class ImageOverLayImpl extends google.maps.OverlayView implements ImageOverlay {\r\n        bounds: google.maps.LatLngBounds;\r\n        image: string;\r\n        map: google.maps.Map;\r\n        div_:any;\r\n        opacity:number = 0.75;\r\n\r\n        constructor(bounds: google.maps.LatLngBounds, image: string, map: google.maps.Map) {\r\n            super();\r\n            this.bounds = bounds;\r\n            this.image = image;\r\n            this.map = map;\r\n        }\r\n\r\n        add() {\r\n            (this as any).setMap(this.map);\r\n        }\r\n\r\n        remove() {\r\n            (this as any).setMap(null);\r\n        }\r\n\r\n        setOpacity(o:number) {\r\n            this.opacity = o;\r\n            if(this.div_) {\r\n                this.div_.style.opacity = o;\r\n            }\r\n        }\r\n\r\n        getOpacity():number {\r\n            return this.opacity;\r\n        }\r\n\r\n        onAdd() {\r\n            let div = document.createElement('div');\r\n            div.style.borderStyle = 'none';\r\n            div.style.borderWidth = '0px';\r\n            div.style.position = 'absolute';\r\n\r\n            // Create the img element and attach it to the div.\r\n            let img = document.createElement('img');\r\n            img.src = this.image;\r\n            img.style.width = '100%';\r\n            img.style.height = '100%';\r\n            img.style.position = 'absolute';\r\n            div.appendChild(img);\r\n\r\n            this.div_ = div;\r\n\r\n            // Add the element to the \"overlayLayer\" pane.\r\n            var panes = (this as any).getPanes();\r\n            panes.overlayLayer.appendChild(div);\r\n            this.setOpacity(this.opacity);\r\n        }\r\n\r\n        draw() {\r\n            // We use the south-west and north-east\r\n            // coordinates of the overlay to peg it to the correct position and size.\r\n            // To do this, we need to retrieve the projection from the overlay.\r\n            var overlayProjection = (this as any).getProjection();\r\n\r\n            // Retrieve the south-west and north-east coordinates of this overlay\r\n            // in LatLngs and convert them to pixel coordinates.\r\n            // We'll use these coordinates to resize the div.\r\n            var sw = overlayProjection.fromLatLngToDivPixel(this.bounds.getSouthWest());\r\n            var ne = overlayProjection.fromLatLngToDivPixel(this.bounds.getNorthEast());\r\n\r\n            // Resize the image's div to fit the indicated dimensions.\r\n            var div = this.div_;\r\n            div.style.left = sw.x + 'px';\r\n            div.style.top = ne.y + 'px';\r\n            div.style.width = (ne.x - sw.x) + 'px';\r\n            div.style.height = (sw.y - ne.y) + 'px';\r\n        }\r\n\r\n        onRemove() {\r\n            this.div_.parentNode.removeChild(this.div_);\r\n            this.div_ = null;\r\n        }\r\n    }\r\n}\r\n","import {Component, Input, OnInit, Pipe, PipeTransform} from '@angular/core';\r\nimport { DecimalPipe } from '@angular/common';\r\n\r\nimport { ClippedWmsMapSelection, ClippedLayerDef } from './clipped-wms-map-selection';\r\nimport * as d3 from 'd3';\r\n\r\n// wraps DecimalPipe and supplies custom formatting for specific layers for mean/min/max\r\n@Pipe({\r\n    name: 'clippedStatValue'\r\n})\r\nexport class ClippedStatValuePipe implements PipeTransform {\r\n    readonly dateFormat = d3.timeFormat('%B %e');\r\n    constructor(private decimalPipe:DecimalPipe) {}\r\n    transform(value:any,nFormat:string,layer:ClippedLayerDef):any {\r\n        if(layer && layer.layerName === 'si-x:leaf_anomaly') {\r\n            let transformed = this.decimalPipe.transform(Math.abs(value),nFormat);\r\n            if(value < 0) {\r\n                return `${transformed} days early`;\r\n            } else {\r\n                return `${transformed} days late`;\r\n            }\r\n        }\r\n        // for non-anomaly maps value is DOY, display as date with DOY in parens.\r\n        const rounded = Math.floor(value);\r\n        const dateFmt = this.dateFormat(this.getDate(rounded));\r\n        return `${dateFmt} (${rounded})`;\r\n    }\r\n\r\n    private getDate(rounded:number):Date {\r\n        const d = new Date(2010,0,1); // 2010 not a leap year\r\n        d.setTime(d.getTime()+((rounded-1)*24*60*60*1000));\r\n        return d;\r\n    }\r\n}\r\n\r\nconst COUNT_TT = 'Number of map pixels included in the calculations';\r\nconst SIX_COMPLETE = 'Proportion of area that has reached the First Leaf Index';\r\nconst AGDD_COMPLETE = 'Highest amount of warmth accumulated since Jan 1 in the area, measured in growing degree days (GDDs)';\r\n\r\nconst SIX_TOOLTIPS = {\r\n    count: COUNT_TT,\r\n    mean: 'Mean day of year First Leaf Index was reached',\r\n    stdDev: 'Standard deviation of mean day of year First Leaf Index was reached',\r\n    min: 'Earliest day of year First Leaf Index was reached',\r\n    max: 'Latest day of year First Leaf Index was reached',\r\n    complete: SIX_COMPLETE\r\n};\r\nconst AGDD_TOOLTIPS = {\r\n    count: COUNT_TT,\r\n    mean: 'Warmth accumulated since Jan 1, averaged across the area, measured in growing degree days (GDDs)',\r\n    stdDev: 'Standard deviation in warmth accumulated since Jan 1, averaged across the area, measured in growing degree days (GDDs)',\r\n    min: 'Lowest amount of warmth accumulated since Jan 1 in the area, measured in growing degree days (GDDs)',\r\n    max: AGDD_COMPLETE\r\n};\r\nconst SIX_ANOMALY_TOOLTIPS = {\r\n    count: COUNT_TT,\r\n    mean: 'Measure of how early or late spring arrived in this area this year compared to long-term average. Calculated as average of values for pixels displayed',\r\n    stdDev: 'The standard deviation of the average number of days different from a long-term average (1981-2010) for the pixels displayed',\r\n    min: 'Earliest day compared to a long-term average (1981-2010) for the pixels displayed',\r\n    max: 'Latest day compared to a long-term average (1981-2010) for the pixels displayed',\r\n    complete: SIX_COMPLETE\r\n};\r\nconst AGDD_ANOMALY_TOOLTIPS = {\r\n    count: COUNT_TT,\r\n    mean: 'Difference in the warmth accumulated since Jan 1 from a long-term average (1981-2010), measured in growing degree days (GDDs)',\r\n    stdDev: 'Standard deviation in difference in the warmth accumulated since Jan 1 from a long-term average (1981-2010), measured in growing degree days (GDDs)',\r\n    min: 'Lowest difference in the warmth accumulated since Jan 1 from a long-term average (1981-2010), measured in growing degree days (GDDs)',\r\n    max: 'Highest difference in the warmth accumulated since Jan 1 from a long-term average (1981-2010), measured in growing degree days (GDDs)',\r\n    complete: AGDD_COMPLETE\r\n};\r\n@Component({\r\n    selector: 'clipped-wms-map-statistics',\r\n    template: `\r\n    <table *ngIf=\"statistics\" [ngClass]=\"{'no-data': statistics.count === 0}\">\r\n        <tbody>\r\n            <tr><td>Date</td><td>{{statistics.date | date:'longDate'}}</td></tr>\r\n            <tr *ngIf=\"statistics.count !== 0\" [matTooltip]=\"tooltips['count']\"><td>Count</td><td>{{statistics.count}}</td></tr>\r\n            <tr *ngIf=\"statistics.count !== 0\" [matTooltip]=\"tooltips['mean']\"><td>Mean</td><td>{{statistics.mean | clippedStatValue:'1.1-1':selection.layer}}</td></tr>\r\n            <tr *ngIf=\"statistics.count !== 0\" [matTooltip]=\"tooltips['stdDev']\"><td>Std Dev</td><td>{{statistics.stddev | number:'1.1-1'}}</td></tr>\r\n            <tr *ngIf=\"statistics.count !== 0\" [matTooltip]=\"tooltips['min']\"><td>Min</td><td>{{statistics.min  | clippedStatValue:'1.0-1':selection.layer}}</td></tr>\r\n            <tr *ngIf=\"statistics.count !== 0\" [matTooltip]=\"tooltips['max']\"><td>Max</td><td>{{statistics.max  | clippedStatValue:'1.0-1':selection.layer}}</td></tr>\r\n            <tr *ngIf=\"!gdd && statistics.count !== 0\" [matTooltip]=\"tooltips['complete']\"><td>Complete</td><td>{{statistics.percentComplete | number:'1.0-1'}}%</td></tr>\r\n            <tr><td *ngIf=\"statistics.count === 0 && selection.layer.noDataDisclaimer\" colspan=\"2\" class=\"no-data-disclaimer\">{{selection.layer.noDataDisclaimer}}</td></tr>\r\n        </tbody>\r\n    </table>\r\n    `,\r\n    styles:[`\r\n        :host {\r\n            line-height: 12px;\r\n        }\r\n        table.no-data {\r\n            max-width: 250px;\r\n        }\r\n        tr td:first-of-type {\r\n            font-weight: bold;\r\n            text-align: right;\r\n            padding-right: 5px;\r\n        }\r\n        tr td:first-of-type:after {\r\n            content: ':';\r\n        }\r\n        tr td.no-data-disclaimer {\r\n            text-align: center;\r\n        }\r\n        tr td.no-data-disclaimer:after {\r\n            content: '';\r\n        }\r\n    `],\r\n    providers: [ClippedStatValuePipe]\r\n})\r\nexport class ClippedWmsMapStatisticsComponent {\r\n    @Input()\r\n    selection:ClippedWmsMapSelection;\r\n\r\n    statistics:any;\r\n    gdd:boolean;\r\n    tooltips:any;\r\n\r\n    ngDoCheck() {\r\n        if(this.selection && this.selection.data && this.selection.data.statistics) {\r\n            this.statistics = this.selection.data.statistics;\r\n            this.gdd = this.selection && /^gdd/.test(this.selection.layer.layerName);\r\n            this.tooltips = this.gdd ?\r\n                (this.selection.layer.id === 'anomaly' ? AGDD_ANOMALY_TOOLTIPS : AGDD_TOOLTIPS) :\r\n                (this.selection.layer.id === 'anomaly' ? SIX_ANOMALY_TOOLTIPS : SIX_TOOLTIPS);\r\n        }\r\n    }\r\n}\r\n","module.exports = \"<div class=\\\"vis-container\\\">\\r\\n    <div class=\\\"vis-working\\\" *ngIf=\\\"selection.working\\\">\\r\\n        <npn-logo spin=\\\"false\\\"></npn-logo>\\r\\n    </div>\\r\\n    <div class=\\\"map-wrapper\\\">\\r\\n        <agm-map (mapReady)=\\\"mapReady($event)\\\"  [streetViewControl]=\\\"false\\\"  [styles]=\\\"mapStyles\\\" [scrollwheel]=\\\"false\\\"></agm-map>\\r\\n        <map-layer-legend *ngIf=\\\"!thumbnail && selection.legend && selection.data && selection.data.statistics && selection.data.statistics.count !== 0\\\" [legend]=\\\"selection.legend\\\"></map-layer-legend>\\r\\n        <clipped-wms-map-statistics *ngIf=\\\"!thumbnail && selection && selection.data && selection.data.statistics\\\"\\r\\n            [selection]=\\\"selection\\\"></clipped-wms-map-statistics>\\r\\n    </div>\\r\\n    <supports-opacity-control *ngIf=\\\"!thumbnail\\\" [supportsOpacity]=\\\"selection.overlay\\\"></supports-opacity-control>\\r\\n</div>\\r\\n\"","module.exports = \".vis-container {\\n  display: block;\\n  position: relative; }\\n  .vis-container agm-map {\\n    /*\\r\\n        encapsulation: ViewEncapsulation.None or this rule won't be able to apply\\r\\n        */ }\\n  .vis-container agm-map img[src*=usanpn] {\\n      -ms-interpolation-mode: nearest-neighbor;\\n          image-rendering: pixelated;\\n      image-rendering: -moz-crisp-edges; }\\n  .map-wrapper {\\n  position: relative; }\\n  .map-wrapper map-layer-legend .gridded-legend {\\n    margin-top: 10px;\\n    border-bottom: 1px solid #aaa; }\\n  @media (min-width: 992px) {\\n    .map-wrapper map-layer-legend,\\n    .map-wrapper clipped-wms-map-statistics {\\n      position: absolute;\\n      left: 10px;\\n      padding: 8px;\\n      border: 1px solid #aaa;\\n      background-color: rgba(255, 255, 255, 0.85);\\n      border-radius: 5px; }\\n    .map-wrapper map-layer-legend {\\n      bottom: 25px;\\n      width: 60%; }\\n      .map-wrapper map-layer-legend .gridded-legend {\\n        margin-top: 0px;\\n        border-bottom: none;\\n        width: 100%;\\n        height: 125px;\\n        border: none; }\\n    .map-wrapper clipped-wms-map-statistics {\\n      top: 10px; } }\\n\"","import {Component,Input,ElementRef, ViewEncapsulation} from '@angular/core';\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport {MapVisualizationBaseComponent} from '../map-visualization-base.component';\r\n\r\nimport {ClippedWmsMapSelection} from './clipped-wms-map-selection';\r\n\r\n@Component({\r\n    selector: 'clipped-wms-map',\r\n    templateUrl: './clipped-wms-map.component.html',\r\n    styleUrls: ['./clipped-wms-map.component.scss'],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class ClippedWmsMapComponent extends MapVisualizationBaseComponent {\r\n    @Input() selection: ClippedWmsMapSelection;\r\n\r\n    constructor(protected rootElement: ElementRef, protected media: ObservableMedia) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    mapReady(map:google.maps.Map): void {\r\n        this.getMapResolver(map);\r\n    }\r\n\r\n    protected reset():void {\r\n        this.getMap().then(m => {\r\n            this.selection.removeFrom(m)\r\n                .then(() => {\r\n                    super.reset();\r\n                });\r\n        });\r\n    }\r\n\r\n    protected update():void {\r\n        this.resize();\r\n        this.getMap().then(m => {\r\n            this.selection.removeFrom(m)\r\n                .then(() => {\r\n                    this.selection.addTo(m)\r\n                });\r\n        });\r\n    }\r\n\r\n    protected resize():void {\r\n        super.resize();\r\n        this.getMap().then(m => this.selection.resizeMap(m));\r\n    }\r\n}\r\n","export * from './public_api';","export { ClippedWmsMapSelection } from './clipped-wms-map-selection';\r\nexport { ClippedWmsMapSelectionFactory } from './clipped-wms-map-selection-factory';\r\nexport { ClippedWmsMapControl } from './clipped-wms-map-control.component';\r\nexport { ClippedWmsMapComponent } from './clipped-wms-map.component';\r\nexport { ClippedWmsMapStatisticsComponent, ClippedStatValuePipe } from './clipped-wms-map-statistics.component';\r\n","import { Component, Output, EventEmitter, Input, SimpleChanges } from '@angular/core';\r\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { VisSelection, StationAwareVisSelection, NetworkAwareVisSelection } from '../vis-selection';\r\nimport { Subject, Observable, from, combineLatest, of } from 'rxjs';\r\nimport { switchMap, map, takeUntil, debounceTime, filter, tap } from 'rxjs/operators';\r\nimport { MonitorsDestroy,\r\n         SpeciesService,\r\n         SpeciesPlot,\r\n         TaxonomicSpeciesRank,\r\n         SpeciesTaxonomicInfo,\r\n         PhenophaseTaxonomicInfo,\r\n         TaxonomicSpeciesTitlePipe,\r\n         TaxonomicPhenophaseRank,\r\n         STATIC_COLORS } from '../../common';\r\nimport { HttpParams } from '@angular/common/http';\r\nimport { faInfoCircle } from '@fortawesome/pro-light-svg-icons';\r\n\r\nexport interface HigherSpeciesPhenophaseInputCriteria {\r\n    years?: number[];\r\n    stationIds?: Promise<number []>;\r\n}\r\n\r\n/**\r\n * Filtering of applicable species is based upon the `criteria` input.\r\n */\r\n@Component({\r\n    selector: 'higher-species-phenophase-input',\r\n    template: `\r\n    <mat-form-field class=\"species-rank-input\">\r\n        <mat-select [placeholder]=\"speciesTaxRankPlaceholder\" [formControl]=\"speciesRank\">\r\n            <mat-option *ngFor=\"let r of speciesRanks\" [value]=\"r.rank\">{{r.label}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <mat-form-field class=\"species-input\">\r\n        <input matInput [placeholder]=\"speciesPlaceholder\" aria-label=\"Species\"\r\n            [matAutocomplete]=\"sp\"\r\n            [formControl]=\"species\" (focus)=\"speciesFocus()\" />\r\n        <mat-autocomplete #sp=\"matAutocomplete\" [displayWith]=\"speciesLabel\">\r\n            <mat-option *ngFor=\"let o of $filteredSpeciesList | async\" [value]=\"o.item\">\r\n              {{o.label}}\r\n            </mat-option>\r\n        </mat-autocomplete>\r\n        <mat-progress-bar *ngIf=\"fetchingSpeciesList\" mode=\"query\"></mat-progress-bar>\r\n        <mat-hint *ngIf=\"showSpeciesHint\" align=\"end\"><fa-icon [icon]=\"hintIcon\" [matTooltip]=\"speciesHint\"></fa-icon></mat-hint>\r\n    </mat-form-field>\r\n    <mat-form-field class=\"pheno-input\">\r\n        <mat-select [placeholder]=\"phenophasePlaceholder\" [formControl]=\"phenophase\">\r\n            <mat-option *ngFor=\"let o of phenophaseList\" [value]=\"o.item\">{{o.label}}</mat-option>\r\n        </mat-select>\r\n        <mat-progress-bar *ngIf=\"fetchingPhenophaseList\" mode=\"query\"></mat-progress-bar>\r\n        <mat-hint *ngIf=\"phenophaseHint\" align=\"end\"><fa-icon [icon]=\"hintIcon\" [matTooltip]=\"phenophaseHint\"></fa-icon></mat-hint>\r\n    </mat-form-field>\r\n    <mat-form-field *ngIf=\"actuallyGatherColor\" class=\"color-input\">\r\n        <mat-select  [placeholder]=\"colorPlaceholder\" [formControl]=\"color\">\r\n        <mat-select-trigger><div class=\"color-swatch\" [ngStyle]=\"{'background-color':color.value}\"></div></mat-select-trigger>\r\n        <mat-option *ngFor=\"let c of colorList\" [value]=\"c\"><div class=\"color-swatch\" [ngStyle]=\"{'background-color':c}\"></div></mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n<pre *ngIf=\"debug\">\r\nspecies={{speciesTaxInfo?.species.length | number}} classes={{speciesTaxInfo?.classes.length | number}} orders={{speciesTaxInfo?.orders.length | number}} families={{speciesTaxInfo?.families.length | number}}\r\nphenophases={{phenophaseTaxInfo?.phenophases.length | number}} classes={{phenophaseTaxInfo?.classes.length | number}}\r\n</pre>\r\n    `,\r\n    styles:[`\r\n    .color-swatch {\r\n        display: inline-block;\r\n        width: 20px;\r\n        height: 20px;\r\n    }\r\n    .color-input {\r\n        width: 70px;\r\n    }\r\n    `]\r\n})\r\nexport class HigherSpeciesPhenophaseInputComponent extends MonitorsDestroy {\r\n    @Input() required:boolean = true;\r\n    @Input() disabled:boolean = false;\r\n    \r\n    private criteriaUpdate:Subject<HigherSpeciesPhenophaseInputCriteria> = new Subject();\r\n    _criteria:HigherSpeciesPhenophaseInputCriteria;\r\n\r\n    @Input() debug:boolean = false;\r\n    @Input() selection:VisSelection; // for access to network args\r\n    @Input() plot:SpeciesPlot;\r\n    @Output() plotChange = new EventEmitter<SpeciesPlot>();\r\n\r\n    speciesRank:FormControl = new FormControl();\r\n    speciesRanks = [{\r\n        label: 'Species',\r\n        rank: TaxonomicSpeciesRank.SPECIES\r\n    },{\r\n        label: 'Genus',\r\n        rank: TaxonomicSpeciesRank.GENUS\r\n    },{\r\n        label: 'Family',\r\n        rank: TaxonomicSpeciesRank.FAMILY\r\n    },{\r\n        label: 'Order',\r\n        rank: TaxonomicSpeciesRank.ORDER\r\n    },{\r\n        label: 'Class',\r\n        rank: TaxonomicSpeciesRank.CLASS\r\n    }\r\n    ];\r\n    species:FormControl = new FormControl();\r\n    fetchingSpeciesList:boolean = false;\r\n    speciesList:any[];\r\n    $filteredSpeciesList:Observable<any []>;\r\n    speciesLabel; // closure for translating species items to strings.\r\n    speciesTaxInfo:SpeciesTaxonomicInfo; // just for debug purposes\r\n\r\n    phenophase:FormControl = new FormControl();\r\n    fetchingPhenophaseList:boolean = false;\r\n    phenophaseList:any[];\r\n    phenophaseHint;\r\n    phenophaseTaxInfo:PhenophaseTaxonomicInfo; // just for debug purposes\r\n\r\n    ignoreGatherColor:boolean = false;\r\n    /**\r\n     * Whether or not to gather color and set on the plot\r\n     * This input is ignored if the selection is an instanceof NetworkAwareVisSelection\r\n     * and is using grouping.  In that scenario visualizations will need to calculate\r\n     * colors based on groups.length*plots.length.\r\n     */\r\n    @Input() gatherColor:boolean = false;\r\n    color:FormControl = new FormControl();\r\n    colorList:string[] = STATIC_COLORS;\r\n\r\n    private group:FormGroup;\r\n\r\n    hintIcon = faInfoCircle;\r\n\r\n    constructor(\r\n        private speciesService:SpeciesService,\r\n        public speciesTitle:TaxonomicSpeciesTitlePipe\r\n    ) {\r\n        super();\r\n        this.speciesLabel = item => this.speciesTitle.transform(item,this.speciesRank.value);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.criteriaUpdate\r\n            .pipe(takeUntil(this.componentDestroyed))\r\n            .subscribe(() => this.ignoreGatherColor =\r\n                (this.selection instanceof NetworkAwareVisSelection &&\r\n                 !!this.selection.groups &&\r\n                 this.selection.groups.length > 0));\r\n\r\n        const $speciesTaxonomicInfo:Observable<SpeciesTaxonomicInfo> = this.criteriaUpdate.pipe(\r\n            tap(() => this.fetchingSpeciesList = true),\r\n            switchMap(criteria => from((criteria.stationIds||Promise.resolve([])).then(stationIds => {\r\n                        let params = new HttpParams();\r\n                        (stationIds||[]).forEach((id,idx) => params = params.set(`station_ids[${idx}]`,`${id}`))\r\n                        return params;\r\n                    })).pipe(\r\n                        switchMap(params => {\r\n                            /*\r\n                            IMPORTANT: the network_id/person_id parameters are being added here to cover a special case when the\r\n                            vis tool is opened restricted to a network (groupId) or individual (personId).  The application very\r\n                            intentionally does not typically use these request parameters but translates results to lists of stations\r\n                            instead to support geographic boundaries.  Doing this creates a situation where a visitor _could_ more\r\n                            easily create a selection that results in no data on a visualization if they are using boundaries that do\r\n                            not intersect with the location of their stations.  This is assumed acceptable since they will either not\r\n                            use boundaries or know where their sites are located and draw boundaries accordingly...\r\n                             */\r\n                            if(this.selection instanceof StationAwareVisSelection) {\r\n                                const {groupId,personId} = this.selection;\r\n                                if(!!groupId) {\r\n                                    params = params.set('network_id', groupId);\r\n                                }\r\n                                if(!!personId) {\r\n                                    params = params.set('person_id', personId);\r\n                                }\r\n                            }\r\n                            return this.speciesService.getAllSpeciesHigher(params,criteria.years);\r\n                        })\r\n                    )),\r\n            tap(() => this.fetchingSpeciesList = false)\r\n        );\r\n\r\n        combineLatest(\r\n            this.speciesRank.valueChanges,\r\n            $speciesTaxonomicInfo\r\n        ).pipe(\r\n            filter(input => !!input[0] && !!input[1]),\r\n            map(input => {\r\n                const [rank,info] = input;\r\n                this.speciesTaxInfo = info;\r\nconsole.log('speciesTaxInfo',info);\r\n                switch(rank) {\r\n                    case TaxonomicSpeciesRank.SPECIES:\r\n                        return info.species;\r\n                    case TaxonomicSpeciesRank.CLASS:\r\n                        return info.classes;\r\n                    case TaxonomicSpeciesRank.ORDER:\r\n                        return info.orders;\r\n                    case TaxonomicSpeciesRank.FAMILY:\r\n                        return info.families;\r\n                    case TaxonomicSpeciesRank.GENUS:\r\n                        return info.genera; // TODO: make sure this works, KW just made genus plural\r\n                }\r\n                throw new Error(`Invalid species rank \"${rank}\"`);\r\n            }),\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe((list:any[]) => {\r\n            const rank = this.speciesRank.value as TaxonomicSpeciesRank;\r\n            const species = this.species.value as any;\r\n            this.speciesList = list.map(item => {\r\n                const label = this.speciesLabel(item);\r\n                const lower = label.toLowerCase();\r\n                return {item,label,lower};\r\n            });\r\n            if(rank !== TaxonomicSpeciesRank.SPECIES) {\r\n                this.speciesList.sort((a,b) => a.label.localeCompare(b.label));\r\n            }\r\n            this.$filteredSpeciesList = this.species.valueChanges.pipe(\r\n                debounceTime(500),\r\n                filter(s => typeof(s) === 'string'),\r\n                map(s => {\r\n                    if(s && this.speciesList) {\r\n                        s = s.trim().toLowerCase();\r\n                        return this.speciesList.filter(o => o.lower.indexOf(s) !== -1);\r\n                    }\r\n                    return this.speciesList\r\n                        ? this.speciesList.slice()\r\n                        : [];\r\n                })\r\n            );\r\n            // clear the current value if it is no longer valid\r\n            if(species) {\r\n                switch(rank) {\r\n                    case TaxonomicSpeciesRank.SPECIES:\r\n                        if(!species.species_id) {\r\n                            this.species.setValue(null);\r\n                        }\r\n                        break;\r\n                    case TaxonomicSpeciesRank.CLASS:\r\n                        if(!species.class_id || !!species.species_id) {\r\n                            this.species.setValue(null);\r\n                        }\r\n                        break;\r\n                    case TaxonomicSpeciesRank.ORDER:\r\n                        if(!species.order_id || !!species.species_id) {\r\n                            this.species.setValue(null);\r\n                        }\r\n                        break;\r\n                    case TaxonomicSpeciesRank.FAMILY:\r\n                        if(!species.family_id || !!species.species_id) {\r\n                            this.species.setValue(null);\r\n                        }\r\n                        break;\r\n                    case TaxonomicSpeciesRank.GENUS:\r\n                        if(!species.genus_id || !!species.species_id) {\r\n                            this.species.setValue(null);\r\n                        }\r\n                        break;\r\n                }\r\n            } else {\r\n                this.species.setValue(null);\r\n            }\r\n        });\r\n\r\n        // whenever species changes go update the available phenophases/classes\r\n        // TODO deal with station_ids?\r\n        const $phenophaseTaxInfo:Observable<PhenophaseTaxonomicInfo> = combineLatest(\r\n            this.species.valueChanges,\r\n            this.criteriaUpdate.pipe(debounceTime(500)),\r\n        ).pipe(\r\n            tap(() => this.fetchingPhenophaseList = true),\r\n            switchMap(input => {\r\nconsole.log('$phenophaseTaxInfo.input',input);\r\n                const [species,criteria] = input;\r\n                return !!species && typeof(species) === 'object'\r\n                ? from(\r\n                    (criteria.years && criteria.years.length\r\n                    ? this.speciesService.getPhenodefinitionsForYears(species,this.speciesRank.value,criteria.years)\r\n                    : this.speciesService.getAllPhenodefinitions(species,this.speciesRank.value))\r\n                    .then(phenos => this.speciesService.generatePhenophaseTaxonomicInfo(phenos)))\r\n                : of(null)\r\n            }),\r\n            tap(() => this.fetchingPhenophaseList = false),\r\n        );\r\n\r\n        // when the in\r\n        const $phenoListChange = $phenophaseTaxInfo.pipe(\r\n            map(info => {\r\n                this.phenophaseTaxInfo = info\r\n                if(info) {\r\nconsole.log('phenophaseTaxInfo',info);\r\n                    return info.classes.map(item => ({\r\n                        item,\r\n                        label: item.pheno_class_name\r\n                    }));\r\n                }\r\n                return [];\r\n            }),\r\n            tap(list => this.phenophaseList = list),\r\n            takeUntil(this.componentDestroyed),\r\n        );\r\n\r\n        //  species or list of phenophases changed, need to check validity of phenophase if set\r\n        combineLatest(\r\n            this.species.valueChanges,\r\n            $phenoListChange\r\n        ).pipe(\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe(input => {\r\n            const [species,phenoList] = input;\r\n            if(!species) {\r\n                if(this.phenophase.enabled) {\r\n                    this.phenophase.disable({emitEvent:false});\r\n                }\r\n                return this.phenophase.setValue(null);\r\n            }\r\n            if(this.phenophase.disabled) {\r\n                this.phenophase.enable({emitEvent:false});\r\n            }\r\n            const phenophase = this.phenophase.value;\r\n            if(phenophase && phenoList.length) {\r\n                const key = 'pheno_class_id';\r\n                const id = phenophase[key];\r\n                //console.log(`check pheno validity id=${id}`,phenophase,phenoList);\r\n                if(!id) { // can't be valid, rank changed\r\n                    return this.phenophase.setValue(null);\r\n                }\r\n                const valid = (phenoList as any[]).reduce((found,i) => (found||(i.item[key] === id ? i : null)),null);\r\n                this.phenophase.setValue(valid ? valid.item : null);\r\n            }\r\n        });\r\n       \r\n        this.speciesRank.setValue((this.plot ? this.plot.speciesRank : null)||TaxonomicSpeciesRank.SPECIES);\r\n        this.species.setValue(this.plot ? this.plot.species : null);\r\n        this.phenophase.setValue(this.plot ? this.plot.phenophase : null);\r\n        this.color.setValue(this.plot ? this.plot.color : null);\r\n\r\n        combineLatest(\r\n            this.phenophase.valueChanges,\r\n            $phenophaseTaxInfo\r\n        ).pipe(\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe((input:any[]) => {\r\n            const [pheno,list] = input;\r\n            this.phenophaseHint = (!!pheno && !!list && !!list.phenophases && list.phenophases.length)\r\n                ? ('Phenophases included: ' + list.phenophases\r\n                    .filter(pp => pheno.pheno_class_id == pp.pheno_class_id) // phenophases of class\r\n                    .sort((a,b) => a.seq_num - b.seq_num)\r\n                    .map(pp => pp.phenophase_name.trim()) // map t name\r\n                    .reduce((arr,ppn) => { // eliminate any duplicate names\r\n                        if(arr.indexOf(ppn) === -1) {\r\n                            arr.push(ppn);\r\n                        }\r\n                        return arr;\r\n                    },[])\r\n                    .join(', '))\r\n                : undefined;\r\n        });\r\n\r\n        // gather up any input changes and propagate them outward\r\n        this.group = new FormGroup({\r\n            speciesRank: this.speciesRank,\r\n            species: this.species,\r\n            phenophase: this.phenophase,\r\n            color: this.color,\r\n        });\r\n        this.checkDisabled();\r\n        this.checkRequired();\r\n        this.criteriaUpdate.next(this.criteria||{});\r\n        this.group.valueChanges\r\n            .pipe(\r\n                //tap(v => console.log('selection changed',v)),\r\n                // TODO expand the condition that decides when a plot is complete...\r\n                map(v => !!v.speciesRank && !!v.species && typeof(v.species) === 'object'\r\n                    && !!v.phenophase\r\n                    && (!this.actuallyGatherColor || !!v.color)\r\n                    ? v\r\n                    : null\r\n                ),\r\n                takeUntil(this.componentDestroyed)\r\n            )\r\n            .subscribe(v => {\r\n                //setTimeout(() => {\r\n                    // edit the plot in place, it may be a class\r\n                    this.plot.speciesRank = v ? v.speciesRank : null;\r\n                    this.plot.species = v ? v.species : null;\r\n                    this.plot.phenophaseRank = TaxonomicPhenophaseRank.CLASS;\r\n                    this.plot.phenophase = v ? v.phenophase : null;\r\n                    if(this.actuallyGatherColor) {\r\n                        this.plot.color = v ? v.color : null;\r\n                    } else {\r\n                        delete this.plot.color; // just to be safe, mostly stesting\r\n                    }\r\n                    this.plotChange.next(this.plot);\r\n                //});\r\n            });\r\n    }\r\n\r\n    @Input()\r\n    set criteria(c:HigherSpeciesPhenophaseInputCriteria) {\r\n        this.criteriaUpdate.next(this._criteria = c);\r\n    }\r\n\r\n    get criteria():HigherSpeciesPhenophaseInputCriteria {\r\n        return this._criteria;\r\n    }\r\n\r\n    checkDisabled() {\r\n        if(this.group) {\r\n            if(this.disabled) {\r\n                this.group.disable();\r\n            } else {\r\n                this.group.enable();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkRequired() {\r\n        if(this.group) {\r\n            const validators = this.required\r\n                ? [Validators.required]\r\n                : null;\r\n            Object.keys(this.group.controls).forEach(key => this.group.controls[key].setValidators(validators));\r\n            this.group.updateValueAndValidity();\r\n        }\r\n    }\r\n\r\n    ngOnChanges(changes:SimpleChanges) {\r\n        if(changes.disabled) {\r\n            this.checkDisabled();\r\n        }\r\n        if(changes.required) {\r\n            this.checkRequired();\r\n        }\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        super.ngOnDestroy();\r\n        this.criteriaUpdate.complete();\r\n    }\r\n\r\n    get speciesTaxRankPlaceholder():string {\r\n        return 'Taxonomic rank'+(this.required ? ' *' : '');\r\n    }\r\n\r\n    get speciesPlaceholder():string {\r\n        const rank = this.speciesRank\r\n            ? this.speciesRank.value as TaxonomicSpeciesRank\r\n            : TaxonomicSpeciesRank.SPECIES;\r\n        let label;\r\n        switch(rank) {\r\n            case TaxonomicSpeciesRank.SPECIES:\r\n                label = 'Species';\r\n                break;\r\n            case TaxonomicSpeciesRank.CLASS:\r\n                label = 'Class';\r\n                break;\r\n            case TaxonomicSpeciesRank.ORDER:\r\n                label = 'Order';\r\n                break;\r\n            case TaxonomicSpeciesRank.FAMILY:\r\n                label = 'Family';\r\n                break;\r\n            case TaxonomicSpeciesRank.GENUS:\r\n                label = 'Genus';\r\n                break;\r\n        }\r\n        return label + (!this.fetchingPhenophaseList && (this.speciesList||[]).length ? ` (${(this.speciesList||[]).length})` : '') + (this.required ? ' *' : '');\r\n    }\r\n\r\n    get phenophasePlaceholder():string {\r\n        return 'Phenophase class' /*+ ((this.phenophaseList||[]).length ? ` (${(this.phenophaseList||[]).length})`: '')*/ + (this.required ? ' *' : '');\r\n    }\r\n\r\n    get actuallyGatherColor():boolean {\r\n        return this.gatherColor && !this.ignoreGatherColor;\r\n    }\r\n\r\n    get colorPlaceholder():string {\r\n        return 'Color'+(this.required ? ' *' : '');\r\n    }\r\n\r\n    speciesFocus() {\r\n        if(!this.species.value) {\r\n            this.species.setValue(' ');\r\n        }\r\n    }\r\n\r\n    get showSpeciesHint():boolean {\r\n        const rank = this.speciesRank.value;\r\n        const s = this.species.value;\r\n        return rank === TaxonomicSpeciesRank.SPECIES && !!s\r\n            && (typeof(s.class_common_name) === 'string' && typeof(s.class_name) === 'string')\r\n            && (typeof(s.order_common_name) === 'string' && typeof(s.order_name) === 'string')\r\n            && (typeof(s.family_common_name) === 'string' && typeof(s.family_name) === 'string');\r\n    }\r\n\r\n    get speciesHint():string {\r\n        const species = this.species.value;\r\n        const classDisplay = this.speciesTitle.transform(species,TaxonomicSpeciesRank.CLASS);\r\n        const orderDisplay = this.speciesTitle.transform(species,TaxonomicSpeciesRank.ORDER);\r\n        const familyDisplay = this.speciesTitle.transform(species,TaxonomicSpeciesRank.FAMILY);\r\n        const genusDisplay = this.speciesTitle.transform(species,TaxonomicSpeciesRank.GENUS);\r\n        return `Class: \"${classDisplay}\" Order: \"${orderDisplay}\" Family: \"${familyDisplay}\" Genus: \"${genusDisplay}`;\r\n    }\r\n\r\n}","export * from './public_api';","export * from './year-range-input.component';\r\nexport * from './higher-species-phenophase-input.component';\r\n","import {Component,Input,Output,EventEmitter,OnInit} from '@angular/core';\r\n\r\n@Component({\r\n    selector: 'year-range-input',\r\n    template: `\r\n    <mat-form-field class=\"start-year\">\r\n        <mat-select placeholder=\"Start year\" [(ngModel)]=\"start\">\r\n            <mat-option *ngFor=\"let y of validStarts\" [value]=\"y\">{{y}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <mat-form-field class=\"end-year\">\r\n        <mat-select placeholder=\"End year\" [(ngModel)]=\"end\" [disabled]=\"!start\">\r\n            <mat-option *ngFor=\"let y of validEnds\" [value]=\"y\">{{y}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `,\r\n    styles:[`\r\n        .start-year,\r\n        .end-year {\r\n            width: 75px;\r\n        }\r\n        mat-form-field {\r\n            padding-right: 10px;\r\n        }\r\n    `]\r\n})\r\nexport class YearRangeInputComponent {\r\n    @Output() startChange = new EventEmitter<number>();\r\n    startValue:number;\r\n    @Output() onStartChange = new EventEmitter<any>();\r\n\r\n    @Output() endChange = new EventEmitter<number>();\r\n    endValue:number;\r\n    @Output() onEndChange = new EventEmitter<any>();\r\n\r\n    @Input()\r\n    maxSpan:number = 10;\r\n\r\n    validStarts:number[] = (function(){\r\n        let max = (new Date()).getFullYear(),\r\n            current = 1900,\r\n            years:number[] = [];\r\n        while(current <= max) {\r\n            years.push(current++);\r\n        }\r\n        return years.reverse();\r\n    })();\r\n    validEnds:number[] = [];\r\n\r\n    @Input()\r\n    get start() {\r\n        return this.startValue;\r\n    }\r\n    set start(s:number) {\r\n        if(typeof(s) === 'string') {\r\n            s = +s;\r\n        }\r\n        if(s !== this.startValue) {\r\n            let oldValue = this.startValue;\r\n            this.startChange.emit(this.startValue = s);\r\n            this.onStartChange.emit({\r\n                oldValue: oldValue,\r\n                newValue: this.startValue\r\n            });\r\n            if(s) {\r\n                let thisYear = (new Date()).getFullYear(),\r\n                    current = s,//+1,\r\n                    max = current+this.maxSpan,\r\n                    ends:number[] = [];\r\n                if(max > thisYear) {\r\n                    max = thisYear+1;\r\n                }\r\n                while(current < max) {\r\n                    ends.push(current++);\r\n                }\r\n                this.validEnds = ends.reverse();\r\n                // if(this.end > max) {\r\n                //     this.end = undefined;\r\n                // }\r\n            }\r\n        }\r\n    }\r\n\r\n    @Input()\r\n    get end() {\r\n        return this.endValue;\r\n    }\r\n    set end(e:number) {\r\n        if(typeof(e) === 'string') {\r\n            e = +e;\r\n        }\r\n        if(e !== this.endValue) {\r\n            let oldValue = this.endValue;\r\n            this.endChange.emit(this.endValue = e);\r\n            this.onEndChange.emit({\r\n                oldValue: oldValue,\r\n                newValue: this.endValue\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","export * from './public_api';","import { Component } from '@angular/core';\r\n\r\nimport { VisSelection, VisSelectionEvent } from './vis-selection';\r\nimport { VisualizationBaseComponent, VisualizationSizing, VisualizationMargins } from './visualization-base.component';\r\nimport { MAP_STYLES } from '../gridded';\r\n\r\n/*\r\nIMPORTANT: see not in VisualizationBaseComponent\r\n\r\n@Component({\r\n  selector: 'map-visualization-base',\r\n  templateUrl: './map-visualization-base.component.html',\r\n  styleUrls: ['./map-visualization-base.component.scss']\r\n})\r\n*/\r\nexport class MapVisualizationBaseComponent extends VisualizationBaseComponent {\r\n    protected latitude: number = 38.8402805;\r\n    protected longitude: number = -97.61142369999999\r\n    protected zoom: number = 4;\r\n\r\n    protected getMapResolver;\r\n    protected getMapPromise = new Promise<google.maps.Map>(resolve => {\r\n        this.getMapResolver = resolve;\r\n    });\r\n\r\n    mapStyles: any[] = MAP_STYLES;\r\n\r\n    mapReady(map: google.maps.Map): void {\r\n        map.addListener('resize', () => {\r\n            console.log('resize happened');\r\n            console.log('panning to center');\r\n            map.setZoom(3);\r\n            setTimeout(() => {\r\n                map.panTo(new google.maps.LatLng(this.latitude, this.longitude));\r\n                map.setZoom(this.zoom);\r\n            }, 500);\r\n        });\r\n        this.getMapResolver(map);\r\n    }\r\n\r\n    getMap(): Promise<google.maps.Map> {\r\n        return this.getMapPromise;\r\n    }\r\n\r\n    protected resize(): void {\r\n        this.getMap().then(map => {\r\n            let sizing = this.getSizeInfo(),\r\n                root = this.rootElement.nativeElement as HTMLElement,\r\n                mapElm = root.querySelector('agm-map') as HTMLElement;\r\n            mapElm.style.width = `${sizing.width}px`;\r\n            mapElm.style.height = `${sizing.height}px`;\r\n            google.maps.event.trigger(map, 'resize');\r\n        });\r\n    }\r\n\r\n    protected reset(): void {\r\n        this.getMap().then(map => {\r\n            console.log('Map reset', map);\r\n            map.panTo(new google.maps.LatLng(this.latitude, this.longitude));\r\n            map.setZoom(this.zoom);\r\n        });\r\n    }\r\n\r\n    protected redraw(): void {\r\n        this.getMap().then(map => {\r\n            console.log('Map redraw', map);\r\n        });\r\n    }\r\n    protected update(): void {\r\n        this.resize();\r\n        this.getMap().then(map => {\r\n            console.log('Map update', map);\r\n        });\r\n    }\r\n}\r\n","import { Component, Input, ViewChild, ViewEncapsulation } from '@angular/core';\r\nimport { MapSelection } from './map-selection';\r\nimport {\r\n    NpnMapLayerService,\r\n    MapLayerDefs,\r\n    CATEGORY_PEST,\r\n    MapLayerDefinition,\r\n    CATEGORY_TEMP_ACCUM_30_YR_AVG,\r\n    CATEGORY_TEMP_ACCUM_CURRENT_AK,\r\n    CATEGORY_TEMP_ACCUM_CURRENT,\r\n    CATEGORY_TEMP_ACCUM_DAILY_ANOM,\r\n    CATEGORY_SIX_HIST_ANNUAL,\r\n    CATEGORY_SIX_CURRENT_YEAR_AK,\r\n    CATEGORY_SIX_CURRENT_YEAR,\r\n    CATEGORY_SIX_DAILY_ANOM,\r\n    CATEGORY_SIX_30_YR_AVG\r\n} from '@npn/common/gridded';\r\nimport { FormControl } from '@angular/forms';\r\nimport { merge } from 'rxjs';\r\nimport { startWith, takeUntil, debounceTime } from 'rxjs/operators';\r\nimport { MonitorsDestroy } from '@npn/common/common';\r\nimport { GriddedRangeSliderControl } from './gridded-range-slider-control.component';\r\n\r\n// these components were written for the map visualization\r\n// but they overlap in functionality with the AGDD Time Series\r\n// requirements so as opposed to using MapSelection|AgddTimeSeriesSelection\r\n// for the shared controls using a separate interface\r\n// just so that it's clear (not using Agdd here to avoid circular dependencies).\r\ninterface HasLayerVisSelection {\r\n    layerName:string;\r\n    redraw: () => void;\r\n    center?: number[];\r\n}\r\n\r\nconst CATEGORY_PESTS = CATEGORY_PEST;\r\nconst CATEGORY_TEMP_ACCUMULATIONS = 'Daily Temperature Accumulations';\r\nconst CATEGORY_SPRING_INDICES = 'Spring Indices';\r\n\r\n@Component({\r\n    selector: 'consolidated-map-layer-control',\r\n    template: `\r\n    <mat-form-field class=\"layer-category\">\r\n        <mat-select placeholder=\"Layer category\" [(ngModel)]=\"selection.layerCategory\">\r\n            <mat-option [value]=\"null\">None</mat-option>\r\n            <mat-option [value]=\"CATEGORY_PESTS\">{{CATEGORY_PESTS}}</mat-option>\r\n            <mat-option [value]=\"CATEGORY_TEMP_ACCUMULATIONS\">{{CATEGORY_TEMP_ACCUMULATIONS}}</mat-option>\r\n            <mat-option [value]=\"CATEGORY_SPRING_INDICES\">{{CATEGORY_SPRING_INDICES}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <div [ngSwitch]=\"selection.layerCategory\" *ngIf=\"selection.layerCategory && layerDefinitions\">\r\n        <pest-map-layer-control *ngSwitchCase=\"CATEGORY_PESTS\" [selection]=\"selection\" [layerDefinitions]=\"layerDefinitions\"></pest-map-layer-control>\r\n        <temp-accum-map-layer-control *ngSwitchCase=\"CATEGORY_TEMP_ACCUMULATIONS\" [selection]=\"selection\" [layerDefinitions]=\"layerDefinitions\"></temp-accum-map-layer-control>\r\n        <spring-index-map-layer-control *ngSwitchCase=\"CATEGORY_SPRING_INDICES\" [selection]=\"selection\" [layerDefinitions]=\"layerDefinitions\"></spring-index-map-layer-control>\r\n    </div>\r\n    <div *ngIf=\"selection.layer\" class=\"layer-controls\">\r\n        <extent-control [selection]=\"selection\"></extent-control>\r\n        <supports-opacity-control [supportsOpacity]=\"selection\"></supports-opacity-control>\r\n        <gridded-range-slider [selection]=\"selection\"></gridded-range-slider>\r\n        <p *ngIf=\"selection.layer.hasAbstract()\" [innerHTML]=\"selection.layer.getAbstract()\"></p>\r\n    </div>\r\n    `,\r\n    styles:[`\r\n    :host {\r\n        display: block;\r\n    }\r\n    mat-form-field.layer-category {\r\n        display: block;\r\n    }\r\n    .layer-controls {\r\n        width: 400px;\r\n    }\r\n    .layer-controls >p {\r\n        margin: 12px 0px 0px 0px;\r\n    }\r\n    `],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class ConsolidatedMapLayerControlComponent {\r\n    @Input() selection:MapSelection;\r\n    layerDefinitions:MapLayerDefs;\r\n    @ViewChild(GriddedRangeSliderControl) rangeSlider:GriddedRangeSliderControl;\r\n\r\n    CATEGORY_PESTS = CATEGORY_PESTS;\r\n    CATEGORY_TEMP_ACCUMULATIONS = CATEGORY_TEMP_ACCUMULATIONS;\r\n    CATEGORY_SPRING_INDICES = CATEGORY_SPRING_INDICES;\r\n\r\n    constructor(\r\n        private layerService:NpnMapLayerService\r\n    ) {}\r\n\r\n    ngOnInit() {\r\n        this.layerService.getLayerDefinitions().then((defs:MapLayerDefs) => this.layerDefinitions = defs);\r\n    }\r\n}\r\n\r\n@Component({\r\n    selector: 'pest-map-layer-control',\r\n    template: `\r\n    <mat-form-field>\r\n        <mat-select placeholder=\"Phenoforecast\" [(ngModel)]=\"selection.layerName\" (selectionChange)=\"selection.redraw()\">\r\n            <mat-option *ngFor=\"let l of layers\" [value]=\"l.name\">{{l.title}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `,\r\n    styles: [`\r\n    mat-form-field {\r\n        display: block;\r\n    }\r\n    `]\r\n})\r\nexport class PestMapLayerControlComponent {\r\n    @Input() selection:HasLayerVisSelection;\r\n    @Input() layerDefinitions:MapLayerDefs;\r\n\r\n    layers:MapLayerDefinition[];\r\n\r\n    ngOnInit() {\r\n        this.layers = this.layerDefinitions.categories.find(c => c.name === CATEGORY_PEST).layers;\r\n        if(!this.selection.layerName) {\r\n            this.selection.layerName = this.layers[0].name;\r\n            this.selection.redraw();\r\n        }\r\n    }\r\n}\r\n\r\nconst LOWER_44_CENTER:number[] = [38.535680, -99.248833];\r\nconst AK_CENTER:number[] = [64.559308, -141.465422];\r\n\r\nenum TEMP_ACCUM_BASE {\r\n    DAILY_30Y_AVG = 'Daily 30-year Average',\r\n    CUR_DAY = 'Current Day',\r\n    DAILY_ANOM = 'Daily Anomaly'\r\n}\r\n@Component({\r\n    selector: 'temp-accum-map-layer-control',\r\n    template: `\r\n    <div class=\"base-ak\">\r\n        <mat-form-field class=\"base-layer\">\r\n            <mat-select placeholder=\"Layer\" [formControl]=\"baseLayer\">\r\n                <mat-option *ngFor=\"let b of baseOpts\" [value]=\"b\">{{b}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n        <mat-checkbox *ngIf=\"!!alaska\" [formControl]=\"alaska\">Alaska</mat-checkbox>\r\n    </div>\r\n    <mat-form-field>\r\n        <mat-select placeholder=\"Degree base\" [formControl]=\"degreeBase\">\r\n            <mat-option [value]=\"32\">32 &deg;</mat-option>\r\n            <mat-option [value]=\"50\">50 &deg;</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>   \r\n    `,\r\n    styles:[`\r\n    :host {\r\n        display: block;\r\n    }\r\n    .base-ak {\r\n        display:flex;\r\n        align-items: center;\r\n    }\r\n    .base-layer {\r\n        padding-right: 10px;\r\n        flex-grow: 1;\r\n    }\r\n    `]\r\n})\r\nexport class TempAccumMapLayerControlComponent extends MonitorsDestroy {\r\n    @Input() selection:HasLayerVisSelection;\r\n    @Input() layerDefinitions:MapLayerDefs;\r\n    @Input() agddTimeSeries:boolean = false;\r\n\r\n    baseLayer:FormControl;\r\n    baseOpts = [TEMP_ACCUM_BASE.DAILY_30Y_AVG,TEMP_ACCUM_BASE.CUR_DAY,TEMP_ACCUM_BASE.DAILY_ANOM];\r\n    degreeBase:FormControl;\r\n    alaska:FormControl;\r\n\r\n    ngOnInit() {\r\n        const categories = this.layerDefinitions.categories.reduce((map,cat) => (map[cat.name] = cat) && map,{});\r\n        //console.log('TempAccumMapLayerControlComponent: TEMP ACCUM CATEGORIES',categories);\r\n        let initBaseValue = TEMP_ACCUM_BASE.DAILY_30Y_AVG;\r\n        let initDegValue = 32;\r\n        let initAkValue = false;\r\n        const initLayerName = this.selection.layerName;\r\n        if(initLayerName) {\r\n            // re-build values based on which layer was selected\r\n            const initCatName = [\r\n                CATEGORY_TEMP_ACCUM_30_YR_AVG,\r\n                CATEGORY_TEMP_ACCUM_CURRENT_AK,\r\n                CATEGORY_TEMP_ACCUM_CURRENT,\r\n                CATEGORY_TEMP_ACCUM_DAILY_ANOM\r\n            ].find(catName => !!categories[catName].layers.find(l => l.name === initLayerName));\r\n            const initCat = categories[initCatName];\r\n            //console.log(`TempAccumMapLayerControlComponent: ${initLayerName} is in \"${initCatName}\"`,initCat);\r\n            switch(initCatName) {\r\n                case CATEGORY_TEMP_ACCUM_30_YR_AVG:\r\n                    initBaseValue = TEMP_ACCUM_BASE.DAILY_30Y_AVG;\r\n                    break;\r\n                case CATEGORY_TEMP_ACCUM_CURRENT:\r\n                case CATEGORY_TEMP_ACCUM_CURRENT_AK:\r\n                    initBaseValue = TEMP_ACCUM_BASE.CUR_DAY;\r\n                    break;\r\n                case CATEGORY_TEMP_ACCUM_DAILY_ANOM:\r\n                    initBaseValue = TEMP_ACCUM_BASE.DAILY_ANOM;\r\n                    break;\r\n            }\r\n            initDegValue = initCat.layers[0].name === initLayerName\r\n                ? 32\r\n                : 50;\r\n            initAkValue = initCatName === CATEGORY_TEMP_ACCUM_CURRENT_AK;\r\n        }\r\n        console.log(`TempAccumMapLayerControlComponent: initBaseValue=\"${initBaseValue}\" initDegValue=${initDegValue} initAkValue=${initAkValue}`);\r\n        this.baseLayer = new FormControl(initBaseValue);\r\n        if(this.agddTimeSeries) {\r\n            this.baseLayer.disable();\r\n        }\r\n        this.degreeBase = new FormControl(initDegValue);\r\n        if(!this.agddTimeSeries) {\r\n            this.alaska = new FormControl(initAkValue);\r\n            this.baseLayer.valueChanges\r\n                .pipe(\r\n                    startWith(this.baseLayer.value),\r\n                    takeUntil(this.componentDestroyed)\r\n                )\r\n                .subscribe(baseLayer => {\r\n                    if(baseLayer === TEMP_ACCUM_BASE.CUR_DAY) {\r\n                        this.alaska.enable();\r\n                    } else {\r\n                        this.alaska.disable();\r\n                        if(this.alaska.value) {\r\n                            this.alaska.setValue(false);\r\n                        }\r\n                    }\r\n                });\r\n        }\r\n        (this.alaska\r\n            ? merge( this.baseLayer.valueChanges,this.degreeBase.valueChanges,this.alaska.valueChanges)\r\n            : merge( this.baseLayer.valueChanges,this.degreeBase.valueChanges))\r\n        .pipe(\r\n            startWith(null),\r\n            debounceTime(250),\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe(() => {\r\n            const base:TEMP_ACCUM_BASE = this.baseLayer.value;\r\n            const degrees:number = this.degreeBase.value;\r\n            // IMPORTANT: in gridded-comomon for all temp accumulations layer sets there are two\r\n            // layers, the first is 32 degree and the second is 50 degree\r\n            const degreesIndex = degrees === 32 ? 0 : 1;\r\n            const ak:boolean = this.alaska ? this.alaska.value : false;\r\n            let categoryName = null;\r\n            switch(base) {\r\n                case TEMP_ACCUM_BASE.DAILY_30Y_AVG:\r\n                    categoryName = CATEGORY_TEMP_ACCUM_30_YR_AVG;\r\n                    break;\r\n                case TEMP_ACCUM_BASE.CUR_DAY:\r\n                    categoryName = ak ? CATEGORY_TEMP_ACCUM_CURRENT_AK : CATEGORY_TEMP_ACCUM_CURRENT;\r\n                    break;\r\n                case TEMP_ACCUM_BASE.DAILY_ANOM:\r\n                    categoryName = CATEGORY_TEMP_ACCUM_DAILY_ANOM;\r\n                    break;\r\n            }\r\n            this.selection.layerName = categories[categoryName].layers[degreesIndex].name;\r\n            this.selection.redraw();\r\n        });\r\n        if(this.alaska) {\r\n            this.alaska.valueChanges\r\n                .pipe(takeUntil(this.componentDestroyed))\r\n                .subscribe(ak => this.selection.center = ak ? AK_CENTER : LOWER_44_CENTER);\r\n        }\r\n    }\r\n}\r\n\r\nenum SIX_BASE {\r\n    HIST_ANNUAL = 'Historic Annual',\r\n    CUR_YEAR = 'Current Year',\r\n    DAILY_ANOM = 'Daily Anomaly',\r\n    THIRTY_YR_AVG = '30-Year Average'\r\n}\r\nenum SIX_LORB {\r\n    LEAF = 'First Leaf',\r\n    BLOOM = 'First Bloom'\r\n}\r\n@Component({\r\n    selector: 'spring-index-map-layer-control',\r\n    template: `\r\n    <div class=\"base-ak\">\r\n        <mat-form-field class=\"base-layer\">\r\n            <mat-select placeholder=\"Layer\" [formControl]=\"baseLayer\">\r\n                <mat-option *ngFor=\"let b of baseOpts\" [value]=\"b\">{{b}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n        <mat-checkbox [formControl]=\"alaska\">Alaska</mat-checkbox>\r\n    </div>\r\n    <mat-form-field>\r\n        <mat-select placeholder=\"Leaf or bloom\" [formControl]=\"leafOrBloom\">\r\n            <mat-option *ngFor=\"let o of leafOrBloomOpts\" [value]=\"o\">{{o}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `,\r\n    styles:[`\r\n    :host {\r\n        display: block;\r\n    }\r\n    .base-ak {\r\n        display:flex;\r\n        align-items: center;\r\n    }\r\n    .base-layer {\r\n        padding-right: 10px;\r\n        flex-grow: 1;\r\n    }\r\n    `]\r\n})\r\nexport class SpringIndexMapLayerControlComponent extends MonitorsDestroy {\r\n    @Input() selection:MapSelection;\r\n    @Input() layerDefinitions:MapLayerDefs;\r\n\r\n    baseLayer:FormControl;\r\n    baseOpts = [SIX_BASE.HIST_ANNUAL,SIX_BASE.CUR_YEAR,SIX_BASE.DAILY_ANOM,SIX_BASE.THIRTY_YR_AVG];\r\n    alaska:FormControl;\r\n    leafOrBloom:FormControl;\r\n    leafOrBloomOpts = [SIX_LORB.LEAF,SIX_LORB.BLOOM];\r\n\r\n    ngOnInit() {\r\n        const categories = this.layerDefinitions.categories.reduce((map,cat) => (map[cat.name] = cat) && map,{});\r\n        let initBaseValue = SIX_BASE.HIST_ANNUAL;\r\n        let initAkValue = false;\r\n        let initLeafOrBloomValue = SIX_LORB.LEAF;\r\n        const initLayerName = this.selection.layerName;\r\n        if(initLayerName) {\r\n            // re-build values based on which layer was selected\r\n            const initCatName = [\r\n                CATEGORY_SIX_HIST_ANNUAL,\r\n                CATEGORY_SIX_CURRENT_YEAR_AK,\r\n                CATEGORY_SIX_CURRENT_YEAR,\r\n                CATEGORY_SIX_DAILY_ANOM,\r\n                CATEGORY_SIX_30_YR_AVG\r\n            ].find(catName => !!categories[catName].layers.find(l => l.name === initLayerName));\r\n            const initCat = categories[initCatName];\r\n            switch(initCatName) {\r\n                case CATEGORY_SIX_HIST_ANNUAL:\r\n                    initBaseValue = SIX_BASE.HIST_ANNUAL;\r\n                    break;\r\n                case CATEGORY_SIX_CURRENT_YEAR:\r\n                case CATEGORY_SIX_CURRENT_YEAR_AK:\r\n                    initBaseValue = SIX_BASE.CUR_YEAR;\r\n                    break;\r\n                case CATEGORY_SIX_DAILY_ANOM:\r\n                    initBaseValue = SIX_BASE.DAILY_ANOM;\r\n                    break;\r\n                case CATEGORY_SIX_30_YR_AVG:\r\n                    initBaseValue = SIX_BASE.THIRTY_YR_AVG;\r\n            }\r\n            initLeafOrBloomValue = initCat.layers[0].name === initLayerName\r\n                ? SIX_LORB.LEAF\r\n                : SIX_LORB.BLOOM;\r\n            initAkValue = initCatName === CATEGORY_SIX_CURRENT_YEAR_AK;\r\n        }\r\n        console.log(`SpringIndexMapLayerControlComponent: initBaseValue=\"${initBaseValue}\" initLeafOrBloomValue=\"${initLeafOrBloomValue}\" initAkValue=${initAkValue}`);\r\n        this.baseLayer = new FormControl(initBaseValue);\r\n        this.alaska = new FormControl(initAkValue);\r\n        this.leafOrBloom = new FormControl(initLeafOrBloomValue);\r\n\r\n        this.baseLayer.valueChanges\r\n        .pipe(\r\n            startWith(this.baseLayer.value),\r\n            takeUntil(this.componentDestroyed)\r\n        )\r\n        .subscribe(baseLayer => {\r\n            if(baseLayer === SIX_BASE.CUR_YEAR || baseLayer === SIX_BASE.DAILY_ANOM) {\r\n                this.selection.year = new Date().getFullYear();\r\n                this.selection.extentValue = new Date().toISOString().split('T')[0]+\"00:00:00.000Z\";\r\n            }\r\n            if(baseLayer === SIX_BASE.CUR_YEAR) {\r\n                this.alaska.enable();\r\n            } else {\r\n                this.alaska.disable();\r\n                if(this.alaska.value) {\r\n                    this.alaska.setValue(false);\r\n                }\r\n            }\r\n        });\r\n        merge(\r\n            this.baseLayer.valueChanges,\r\n            this.alaska.valueChanges,\r\n            this.leafOrBloom.valueChanges\r\n        ).pipe(\r\n            startWith(null),\r\n            debounceTime(250),\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe(() => {\r\n            const base:SIX_BASE = this.baseLayer.value;\r\n            const leafOrBloom:SIX_LORB = this.leafOrBloom.value;\r\n            // IMPORTANT: in gridded-common for all six layer sets the first two are first leaf and bloom in that order\r\n            const lorbIndex = leafOrBloom == SIX_LORB.LEAF ? 0 : 1;\r\n            const ak:boolean = this.alaska.value;\r\n            let categoryName = null;\r\n            switch(base) {\r\n                case SIX_BASE.HIST_ANNUAL:\r\n                    categoryName = CATEGORY_SIX_HIST_ANNUAL\r\n                    break;\r\n                case SIX_BASE.CUR_YEAR:\r\n                    categoryName = ak ? CATEGORY_SIX_CURRENT_YEAR_AK : CATEGORY_SIX_CURRENT_YEAR;\r\n                    break;\r\n                case SIX_BASE.DAILY_ANOM:\r\n                    categoryName = CATEGORY_SIX_DAILY_ANOM;\r\n                    break;\r\n                case SIX_BASE.THIRTY_YR_AVG:\r\n                    categoryName = CATEGORY_SIX_30_YR_AVG;\r\n                    break;\r\n            }\r\n            this.selection.layerName = categories[categoryName].layers[lorbIndex].name;\r\n            this.selection.redraw();\r\n        });\r\n        this.alaska.valueChanges\r\n        .pipe(takeUntil(this.componentDestroyed))\r\n        .subscribe(ak => this.selection.center = ak ? AK_CENTER : LOWER_44_CENTER);\r\n    }\r\n}","import { Component, Input, PipeTransform } from '@angular/core';\r\n\r\nimport {\r\n    MapLayer,\r\n    MapLayerExtentType,\r\n    MapLayerExtentValue,\r\n    GriddedPipeProvider,\r\n    DoyTxType\r\n} from '../../gridded';\r\n\r\nimport * as d3 from 'd3';\r\nimport { MapSelection } from './map-selection';\r\n\r\nexport interface HasLayerSelection {\r\n    layer:MapLayer;\r\n    extentValue:string;\r\n}\r\n\r\n@Component({\r\n    selector: 'extent-control',\r\n    template: `\r\n    <div [ngSwitch]=\"selection.layer.extentType\">\r\n        <extent-date-control *ngSwitchCase=\"date\" [selection]=\"selection\"></extent-date-control>\r\n        <extent-year-control *ngSwitchCase=\"year\" [selection]=\"selection\"></extent-year-control>\r\n        <extent-doy-control *ngSwitchCase=\"doy\" [selection]=\"selection\"></extent-doy-control>\r\n    </div>\r\n    `\r\n})\r\nexport class ExtentControl {\r\n    @Input() selection:HasLayerSelection;\r\n    date = MapLayerExtentType.DATE;\r\n    year = MapLayerExtentType.YEAR;\r\n    doy = MapLayerExtentType.DOY;\r\n}\r\n\r\n@Component({\r\n    selector: 'extent-date-control',\r\n    template: `\r\n    <h4>Date</h4>\r\n    <mat-form-field>\r\n        <input matInput [matDatepicker]=\"extentDatePicker\" [min]=\"minDate\" [max]=\"maxDate\" [value]=\"selectedDate\"\r\n            (dateChange)=\"selectedDate = $event.value\">\r\n        <mat-datepicker-toggle matSuffix [for]=\"extentDatePicker\"></mat-datepicker-toggle>\r\n        <mat-datepicker #extentDatePicker></mat-datepicker>\r\n    </mat-form-field>\r\n    `\r\n})\r\nexport class ExtentDateControl {\r\n    @Input() selection:HasLayerSelection;\r\n\r\n    _selectedDate:Date;\r\n    minDate:Date;\r\n    maxDate:Date;\r\n\r\n    set selectedDate(d:Date) {\r\n        d.setHours(0,0,0,0);\r\n        this._selectedDate = d;\r\n        this.selection.extentValue = d.toISOString().replace(/T.*Z$/,'T00:00:00.000Z');\r\n    }\r\n    get selectedDate():Date {\r\n        return this._selectedDate;\r\n    }\r\n\r\n    private lastLayer:MapLayer;\r\n    ngDoCheck():void {\r\n        if(this.selection.layer && this.selection.layer !== this.lastLayer) {\r\n            const layer = this.lastLayer = this.selection.layer;\r\n            if(layer) {\r\n                this.minDate = layer.extent.values[0].date;\r\n                this.maxDate = layer.extent.values[layer.extent.values.length-1].date;\r\n                this.selectedDate = layer.extent.current.date;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Component({\r\n    selector: 'extent-doy-control',\r\n    template: `\r\n    <h4>Day of year</h4>\r\n    <div class=\"controls\">\r\n        <mat-form-field>\r\n            <mat-select placeholder=\"Month\" [(value)]=\"selectedMonth\">\r\n                <mat-option *ngFor=\"let m of months\" [value]=\"m\">{{m | date:'MMMM'}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n        <mat-form-field>\r\n            <mat-select placeholder=\"Day\" [(value)]=\"selectedDayOfMonth\">\r\n                <mat-option *ngFor=\"let d of monthDays\" [value]=\"d\">{{d}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n        <div class=\"current-value\">{{selection?.layer?.extent.current.value | number:'1.0-0'}}</div>\r\n    </div>\r\n    `,\r\n    styles:[`\r\n    .controls {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n    }\r\n    `]\r\n})\r\nexport class ExtentDoyControl {\r\n    @Input() selection:HasLayerSelection;\r\n\r\n    thirtyYearAvgDayOfYear:PipeTransform;\r\n    baseYear:number;\r\n    months:Date [];\r\n    monthDays:number [];\r\n\r\n    _selectedMonth:Date;\r\n    _selectedDayOfMonth: number;\r\n\r\n    constructor(private pipes:GriddedPipeProvider) {\r\n        this.thirtyYearAvgDayOfYear = pipes.get('thirtyYearAvgDayOfYear');\r\n        this.baseYear = this.thirtyYearAvgDayOfYear.transform('1.0',DoyTxType.DATE).getFullYear();\r\n        this.months = d3.range(0,12).map(m => new Date(this.baseYear,m));\r\n    }\r\n\r\n    get selectedMonth():Date {\r\n        return this._selectedMonth;\r\n    }\r\n    set selectedMonth(d:Date) {\r\n        this.setSelectedMonth(d);\r\n        // user changed month\r\n        this.selectedDayOfMonth = 1;\r\n    }\r\n\r\n    private setSelectedMonth(d:Date) {\r\n        this._selectedMonth = d;\r\n        this.monthDays = d3.range(1,getDaysInMonth(d)+1);\r\n    }\r\n\r\n    get selectedDayOfMonth():number { return this._selectedDayOfMonth; }\r\n    set selectedDayOfMonth(d:number) {\r\n        this._selectedDayOfMonth = d;\r\n        this._selectedMonth.setDate(d);\r\n        this.selection.extentValue = this.thirtyYearAvgDayOfYear.transform(this._selectedMonth,DoyTxType.DOY_STRING);\r\n    }\r\n\r\n    private lastLayer:MapLayer;\r\n    ngDoCheck():void {\r\n        if(this.selection.layer && this.selection.layer !== this.lastLayer) {\r\n            const layer = this.lastLayer = this.selection.layer;\r\n            if(layer) {\r\n                const currentDate = this.thirtyYearAvgDayOfYear.transform(layer.extent.current.value,true);\r\n                this.setSelectedMonth(this.months[currentDate.getMonth()]);\r\n                this.selectedDayOfMonth = currentDate.getDate();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Component({\r\n    selector: 'extent-year-control',\r\n    template: `\r\n    <h4>Year</h4>\r\n    <mat-form-field>\r\n        <mat-select placeholder=\"Year\" [(value)]=\"selectedExtent\">\r\n            <mat-option *ngFor=\"let ext of selection.layer?.extent.values\" [value]=\"ext\">{{ext.label}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `\r\n})\r\nexport class ExtentYearControl {\r\n    @Input() selection:HasLayerSelection;\r\n\r\n    _selectedExtent:MapLayerExtentValue;\r\n\r\n    get selectedExtent():MapLayerExtentValue { return this._selectedExtent; }\r\n    set selectedExtent(ext:MapLayerExtentValue) {\r\n        this._selectedExtent = ext;\r\n        this.selection.extentValue = ext.value;\r\n    }\r\n\r\n    private lastLayer:MapLayer;\r\n    ngDoCheck():void {\r\n        if(this.selection.layer && this.selection.layer !== this.lastLayer) {\r\n            const layer = this.lastLayer = this.selection.layer;\r\n            if(layer) {\r\n                this.selectedExtent = layer.extent.current;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nconst ONE_DAY = (24*60*60*1000);\r\n\r\nfunction getDaysInMonth(date:Date):number {\r\n    let month = date.getMonth(),\r\n        tmp;\r\n    if(month === 11) {\r\n        return 31;\r\n    }\r\n    tmp = new Date(date.getTime());\r\n    tmp.setDate(1);\r\n    tmp.setMonth(tmp.getMonth()+1);\r\n    tmp.setTime(tmp.getTime()-ONE_DAY);\r\n    console.debug('last day of month '+(month+1)+' is '+tmp);\r\n    return tmp.getDate();\r\n}","import { Component, Input, EventEmitter } from '@angular/core';\r\nimport { WmsMapLayer, MapLayer } from '../../gridded';\r\nimport { Options } from 'ng5-slider';\r\nimport { MapSelection } from './map-selection';\r\n\r\n// TODO the selection object does not change (the layer within it does)\r\n// so this control is not updating when switching layers\r\n// also on load from shared URL the layer probably isn't there yet when\r\n// the selection is available since it's loaded asynchronously so the \r\n// control does not render properly\r\n@Component({\r\n    selector: 'gridded-range-slider',\r\n    template: `\r\n    <ng5-slider *ngIf=\"options\" [(value)]=\"min\" [(highValue)]=\"max\" [options]=\"options\" [manualRefresh]=\"manualRefresh\"></ng5-slider>\r\n    `\r\n})\r\nexport class GriddedRangeSliderControl {\r\n    @Input() selection:MapSelection;\r\n    options:Options;\r\n    _min:number;\r\n    _max:number;\r\n    manualRefresh:EventEmitter<void> = new EventEmitter();\r\n\r\n    resize() {\r\n        this.manualRefresh.next();\r\n    }\r\n\r\n    get max():number { return this._max; }\r\n    set max(m:number) {\r\n        this._max = m;\r\n        this.updateRange();\r\n    }\r\n\r\n    get min():number { return this._min; }\r\n    set min(m:number) { \r\n        this._min = m;\r\n        this.updateRange();\r\n    }\r\n\r\n    private updateRange() {\r\n        if(this.min === this.options.floor && this.max === this.options.ceil) {\r\n            // complete range selected, clear any style range\r\n            this.selection.styleRange = undefined;\r\n        } else {\r\n            this.selection.styleRange = [this.min,this.max];\r\n        }\r\n    }\r\n\r\n    private lastLayer:MapLayer;\r\n    ngDoCheck():void {\r\n        if(this.selection.layer && this.selection.layer !== this.lastLayer) {\r\n            if((this.lastLayer = this.selection.layer) instanceof WmsMapLayer) {\r\n                this.selection.layer.getLegend().then(legend => {\r\n                    const data = legend.getData();\r\n                    const existingRange = this.selection.styleRange;\r\n                    this._min = existingRange ? existingRange[0] : 0;\r\n                    this._max = existingRange ? existingRange[1] : (data.length-1);\r\n                    this.options = {\r\n                        floor: 0,\r\n                        ceil: (data.length-1),\r\n                        step: 1,\r\n                        showTicks: true,\r\n                        showSelectionBar: true,\r\n                        translate: n => data[n].label,\r\n                        getTickColor: n => data[n].color,\r\n                        getPointerColor: n => data[n].color,\r\n                        getSelectionBarColor: n => data[n].color\r\n                    };\r\n                });\r\n            } else {\r\n                this.options = undefined;\r\n            }\r\n        }\r\n    }\r\n}","export * from './public_api';","import { Injectable } from '@angular/core';\r\nimport { MapSelection } from './map-selection';\r\nimport { NpnMapLayerService } from '../../gridded';\r\nimport { NpnServiceUtils, SpeciesService, NetworkService } from '../../common';\r\n\r\n@Injectable()\r\nexport class MapSelectionFactory {\r\n    constructor(\r\n        private layerService:NpnMapLayerService,\r\n        private serviceUtils:NpnServiceUtils,\r\n        private speciesService:SpeciesService,\r\n        private networkService:NetworkService\r\n    ) {}\r\n\r\n    newSelection():MapSelection {\r\n        return new MapSelection(this.layerService,this.serviceUtils,this.speciesService,this.networkService);\r\n    }\r\n}","import {\r\n    selectionProperty,\r\n    POPInput,\r\n    BASE_POP_INPUT\r\n} from '../vis-selection';\r\nimport {\r\n    MapLayer,\r\n    NpnMapLayerService,\r\n    MapLayerLegend,\r\n    WmsMapLayer,\r\n    SupportsOpacity\r\n} from '../../gridded';\r\nimport { SiteOrSummaryVisSelection, SiteOrSummaryPlotData } from '../site-or-summary-vis-selection';\r\nimport { NpnServiceUtils, SpeciesService, NetworkService } from '@npn/common/common';\r\nimport { HttpParams } from '@angular/common/http';\r\n\r\n/**\r\n * Note: This type of selection contains more functionality than the underlying visualization\r\n * will care to make use of.  I.e. if `individualPhenometrics` is set to true then summarized\r\n * data would be used and if `networkIds` were populated on the selection they would be used\r\n * \r\n * @dynamic\r\n */\r\nexport class MapSelection extends SiteOrSummaryVisSelection implements SupportsOpacity {\r\n    $supportsPop:boolean = true;\r\n\r\n    @selectionProperty()\r\n    $class = 'MapSelection';\r\n\r\n    @selectionProperty()\r\n    _layerCategory:string;\r\n    @selectionProperty()\r\n    _layerName:string;\r\n    @selectionProperty()\r\n    opacity:number = 0.75;\r\n    @selectionProperty()\r\n    _styleRange:number[];\r\n    @selectionProperty()\r\n    _extentValue:string;\r\n    @selectionProperty()\r\n    _center:number[]; // lat,lng\r\n    @selectionProperty()\r\n    _zoom:number;\r\n\r\n    @selectionProperty() // vis supports a single year of data\r\n    _year:number;\r\n\r\n    private map:google.maps.Map;\r\n    layer:MapLayer;\r\n    legend:MapLayerLegend;\r\n\r\n    constructor(\r\n        private layerService:NpnMapLayerService,\r\n        protected serviceUtils:NpnServiceUtils,\r\n        protected speciesService:SpeciesService,\r\n        protected networkService:NetworkService\r\n    ) {\r\n        super(serviceUtils,speciesService,networkService);\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        params = params.set('request_src','npn-vis-map')\r\n            .set('start_date',`${this.year}-01-01`)\r\n            .set('end_date',`${this.year}-12-31`);\r\n        return super.toURLSearchParams(params);\r\n    }\r\n\r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        return super.toPOPInput(input)\r\n            .then(input => {\r\n                input.startDate = `${this.year}-01-01`;\r\n                input.endDate = `${this.year}-12-31`;\r\n                return input;\r\n            });\r\n    }\r\n\r\n    get year():number {\r\n        return this._year;\r\n    }\r\n    set year(y:number) {\r\n        this._year = y;\r\n        this.update();\r\n    }\r\n\r\n    set layerCategory(s:string) {\r\n        this._layerCategory = s;\r\n        this.layerName = null;\r\n        this.redraw();\r\n    }\r\n    get layerCategory():string { return this._layerCategory; }\r\n\r\n    set layerName(s:string) {\r\n        console.debug(`MapSelection.layerName=${s}`);\r\n        this._layerName = s;\r\n        if(this.layer && this.layer.layerName !== s) {\r\n            this.layer.off();\r\n            this.layer = undefined;\r\n            this.legend = undefined;\r\n            // TODO allow propagation of styleRange\r\n            // when switching layers\r\n            this.styleRange = undefined;\r\n        }\r\n    }\r\n\r\n    get layerName():string {\r\n        return this._layerName;\r\n    }\r\n\r\n    set styleRange(range:number[]) {\r\n        console.debug(`MapSelection.styleRange=${range}`);\r\n        this._styleRange = range;\r\n        if(this.layer && this.layer instanceof WmsMapLayer) {\r\n            this.layer.setStyleRange(range);\r\n        }\r\n    }\r\n\r\n    get styleRange():number[] {\r\n        return this._styleRange;\r\n    }\r\n\r\n    // returns true if a change was made\r\n    private updateExtentValue():boolean {\r\n        if(this.layer && this._extentValue) {\r\n            const newValue = this.layer.extent.values.reduce((found,v) => found||(v.value === this._extentValue ? v : undefined),undefined);\r\n            if(!newValue) {\r\n                // this is OK if it happens, since we can keep the _extentValue from layer to layer\r\n                // if the user switches from one layer to another with compatible extents then we can just\r\n                // re-use it, which seems nice. o/w it should just go back to the \"default\"\r\n                this._extentValue = undefined;\r\n            } else if (this.layer.extent.current !== newValue) {\r\n                this.layer.extent.current = newValue;\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    set extentValue(v:string) {\r\n        this._extentValue = v;\r\n        if(this.layer && this.updateExtentValue()) {\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get extentValue():string {\r\n        return this._extentValue;\r\n    }\r\n\r\n    // using functions here because of the SupportsOpacity interface.\r\n    /** Sets the current opacity (0-1) for this layer. */\r\n    setOpacity(opacity:number) {\r\n        console.debug(`MapSelection.setOpacity=${opacity}`);\r\n        this.opacity = opacity;\r\n        if(this.layer) {\r\n            this.layer.setOpacity(this.opacity);\r\n        }\r\n    }\r\n    /** Gets the current opacity for this layer. */\r\n    getOpacity():number { return this.opacity; }\r\n\r\n    get center():number[] { return this._center; }\r\n    set center(latLng:number[]) {\r\n        this._center = latLng;\r\n        if(this.map && latLng && latLng.length === 2) {\r\n            this.map.setCenter(new google.maps.LatLng(latLng[0],latLng[1]));\r\n        }\r\n    }\r\n\r\n    get zoom():number { return this._zoom; }\r\n    set zoom(z:number) {\r\n        this._zoom = z;\r\n        if(this.map && z !== this.map.getZoom()) {\r\n            this.map.setZoom(z);\r\n        }\r\n    }\r\n\r\n    validForLayer():boolean {\r\n        return !!this.layerName;\r\n    }\r\n\r\n    validForData():boolean {\r\n        return typeof(this.year) === 'number' && this.validPlots.length > 0 &&\r\n            typeof(this.numDaysQualityFilter) === 'number';\r\n    }\r\n\r\n    isValid():boolean {\r\n        return this.validForLayer() || this.validForData();\r\n    }\r\n\r\n    // NOTE: There is no protection against this being called multiple times in fast succession\r\n    // e.g. setLayerName, updateLayer, change layerName, call updateLayer\r\n    // and if this happened there could be two Promises arguing over the ability set `this.layer`\r\n    // which could cause a layer \"sticking\" on the map.\r\n    updateLayer(map: google.maps.Map):Promise<void> {\r\n        const {layerName} = this;\r\n        console.debug(`MapSelection.updateLayer`,this.external);\r\n        if(this.map !== map) {\r\n            this.map = map;\r\n            const latLng = this._center;\r\n            if(latLng && latLng.length === 2) {\r\n                this.map.setCenter(new google.maps.LatLng(latLng[0],latLng[1]));\r\n            }\r\n            if(this._zoom) {\r\n                this.map.setZoom(this._zoom);\r\n            }\r\n            // this is perhaps a bit weird to have these listeners here\r\n            // rather than outside but it allows us to more cleanly access\r\n            // the \"private\" member properties are based upon.\r\n            map.addListener('center_changed',() => {\r\n                const latLng = this.map.getCenter();\r\n                this._center = [\r\n                    latLng.lat(),\r\n                    latLng.lng()\r\n                ];\r\n            });\r\n            map.addListener('zoom_changed',() => this._zoom = this.map.getZoom());\r\n        }\r\n        if(layerName) {\r\n            if(!this.layer) {\r\n                return this.layerService.newLayer(map,layerName)\r\n                    .then(layer => {\r\n                        this.layer = layer;\r\n                        layer.setOpacity(this.opacity);\r\n                        if(layer instanceof WmsMapLayer) {\r\n                            layer.setStyleRange(this.styleRange);\r\n                        }\r\n                        this.updateExtentValue();\r\n                        layer.on();\r\n                        return this.layer.getLegend().then(legend => {this.legend = legend});\r\n                    });\r\n            } else {\r\n                this.layer.bounce();\r\n            }\r\n        } else {\r\n            this.legend = this.layerService.getDefaultLegend();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n\r\n    getData():Promise<SiteOrSummaryPlotData[]> {\r\n        this.working = true;\r\n        return (this.validForData()\r\n            ? super.getData()\r\n            : Promise.resolve([]))\r\n            .then(results => {\r\n                this.working = false;\r\n                return results;\r\n            });\r\n    }\r\n}","import { Component, Input, SimpleChanges } from '@angular/core';\r\nimport { MapVisMarker, MAP_VIS_SVG_PATHS } from './map-visualization.component';\r\nimport { Station } from '../../common';\r\nimport { GriddedPointData, DefaultMapLayerLegend } from '../../gridded';\r\nimport { StationService } from '@npn/common/common/station.service';\r\nimport { MapSelection } from './map-selection';\r\n\r\n@Component({\r\n    selector: 'map-visualization-marker-iw',\r\n    template: `\r\n    <npn-logo spin=\"true\" *ngIf=\"!station; else stationInfo\"></npn-logo>\r\n    <ng-template #stationInfo>\r\n        <div class=\"station-info\">\r\n            <h3>{{station.site_name}}</h3>\r\n            <ul>\r\n            <li *ngIf=\"station.group_name\"><label>Group:</label> {{station.group_name}}</li>\r\n            <li><label>Latitude:</label> {{station.latitude}} <label>Longitude:</label> {{station.longitude}}</li>\r\n            <li *ngIf=\"data && data.legendData\" class=\"gridded-data\"><label>Gridded Layer Value:</label> <div class=\"legend-cell\"\r\n                [ngStyle]=\"{'background-color': data.legendData.color}\">&nbsp;</div> {{dataText(data)}}</li>\r\n            </ul>\r\n        </div>\r\n        <div class=\"record-info\" *ngFor=\"let r of marker.records\">\r\n            <h4>{{r | taxonomicSpeciesTitle:r.plot.speciesRank}}, {{r.phenophase_name||r.pheno_class_name||r.phenophase_description}}, {{r.mean_first_yes_year}}\r\n                <svg class=\"icon\" viewBox=\"0 0 22 22\">\r\n                    <path [attr.fill]=\"iconFill(r)\" [attr.d]=\"svgs[r.plotIndex]\" stroke='#000'></path>\r\n                </svg></h4>\r\n            <ul>\r\n            <!--<li><label>Observed Day of Onset:</label> {{r.mean_first_yes_doy | number:'1.0-0'}} ({{selection.legend.formatPointData((selection.layerName?.includes('gdd') || selection.layerCategory == 'Phenoforecasts') ? r.mean_gddf : r.mean_first_yes_doy)}})<span *ngIf=\"r.sd_first_yes_in_days > 0\"> [Standard Deviation: {{r.sd_first_yes_in_days | number:'1.1-1'}}]</span></li> -->\r\n            <li><label>Observed Day of Onset:</label> {{r.mean_first_yes_doy | number:'1.0-0'}} {{dateMarkerText(r)}} <span *ngIf=\"r.sd_first_yes_in_days > 0\">[Standard Deviation: {{r.sd_first_yes_in_days | number:'1.1-1'}}]</span></li>\r\n            <li *ngIf=\"showGddInPopup()\"><label>AGDD on Day of Onset:</label> {{gddMarkerText(r)}} </li>\r\n            </ul>\r\n        </div>\r\n    </ng-template>\r\n    `,\r\n    styles:[`\r\n    npn-logo {\r\n        width: 25px;\r\n        height: 25px;\r\n    }\r\n    svg {\r\n        border: none;\r\n        width: 16px;\r\n        height: 16px;\r\n    }\r\n    .legend-cell {\r\n        width: 15px;\r\n        height: 15px;\r\n        border: 1px solid black;\r\n        display: inline-block;\r\n        margin: 0 5px;\r\n    }\r\n    ul {\r\n        margin: 0px;\r\n        padding: 0px 0px 0px 5px;\r\n    }\r\n    ul > li {\r\n        list-style: none;\r\n        padding: 2px 0px;\r\n    }\r\n    label {\r\n        font-weight: bold;\r\n    }\r\n    h3,\r\n    h4 {\r\n        text-transform: none !important;\r\n    }\r\n    h3 {\r\n        margin: 0 0 8px !important;\r\n    }\r\n    h4 {\r\n        margin: 5px 0px !important;\r\n    }\r\n    li.gridded-data {\r\n        display:flex;\r\n        align-items: center;\r\n    }\r\n    `]\r\n})\r\nexport class MapVisualizationMarkerIw {\r\n    @Input() marker:MapVisMarker;\r\n    @Input() selection:MapSelection;\r\n\r\n    station:Station;\r\n    data:GriddedPointData;\r\n    svgs:any = MAP_VIS_SVG_PATHS;\r\n\r\n    constructor(\r\n        private stationService:StationService\r\n    ) {}\r\n\r\n    dataText(data) {\r\n        if (this.selection.layerCategory == 'Phenoforecasts' \r\n            || (this.selection.layerName && this.selection.layerName.includes('gdd'))) {\r\n            return `${data.formatted}`; // for gdd layers, data.point and data.formatted are same, formatted is just rounded\r\n        } else {\r\n            return `${data.point} (${data.formatted})`;\r\n        }\r\n    }\r\n\r\n    dateMarkerText(r) {\r\n        if (this.selection.layerCategory == 'Phenoforecasts' \r\n            || (this.selection.layerName && this.selection.layerName.includes('gdd'))) {\r\n            return '';\r\n        } else {\r\n            return `(${this.selection.legend.formatPointData(r.mean_first_yes_doy)})`;\r\n        }\r\n    }\r\n\r\n    gddMarkerText(r) {\r\n        if (this.selection.layerCategory == 'Phenoforecasts' \r\n            || (this.selection.layerName && this.selection.layerName.includes('gdd'))) {\r\n            return r.mean_gddf != -9999 ? `${r.mean_gddf} (Daymet, start date Jan 1, base 32${String.fromCharCode(176)})` : 'not available';\r\n        } else {\r\n            return ``;\r\n        }\r\n    }\r\n\r\n    showGddInPopup() {\r\n        return (this.selection.layerCategory == 'Phenoforecasts' \r\n        || (this.selection.layerName && this.selection.layerName.includes('gdd')))\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges):void {\r\n        if(changes.marker) {\r\n            this.station = null;\r\n            this.data = null;\r\n            if(this.marker) {\r\n                this.marker.records.forEach(r => {\r\n                    console.log('POINT DATA',this.selection.legend.getPointData(r.mean_first_yes_doy),r);\r\n                });\r\n                const {legend} = this.selection;\r\n                Promise.all([\r\n                    this.stationService.getStation(this.marker.site_id),\r\n                    (legend && !(legend instanceof DefaultMapLayerLegend)) ?\r\n                        legend.getGriddedPointData(new google.maps.LatLng(this.marker.latitude,this.marker.longitude)).toPromise()\r\n                        : Promise.resolve(null)\r\n                ]).then(results => {\r\n                    console.log('MapVisualizationMarkerIw:results',results);\r\n                    const [station,data] = results;\r\n                    this.station = station;\r\n                    this.data = data;\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    iconFill(r) {\r\n        const data = this.selection.legend.getPointData(r.mean_first_yes_doy);\r\n        return data\r\n            ? data.color\r\n            : '#ffffff';\r\n    }\r\n}\r\n\r\n","module.exports = \".vis-container {\\n  display: block;\\n  position: relative; }\\n  .vis-container agm-map {\\n    /*\\r\\n        encapsulation: ViewEncapsulation.None or this rule won't be able to apply\\r\\n        */ }\\n  .vis-container agm-map img[src*=usanpn] {\\n      -ms-interpolation-mode: nearest-neighbor;\\n          image-rendering: pixelated;\\n      image-rendering: -moz-crisp-edges; }\\n  .map-wrapper {\\n  position: relative;\\n  width: 100%;\\n  height: 100%; }\\n  .map-wrapper map-layer-legend .gridded-legend {\\n    margin-top: 10px;\\n    border-bottom: 1px solid #aaa; }\\n  .map-wrapper .npnlogo {\\n    position: absolute;\\n    width: 180px;\\n    bottom: 75px;\\n    right: 70px;\\n    z-index: 1; }\\n  .map-wrapper .usgslogo {\\n    position: absolute;\\n    height: 50px;\\n    width: 130px;\\n    bottom: 15px;\\n    right: 70px;\\n    z-index: 1; }\\n  .map-wrapper .ualogo {\\n    position: absolute;\\n    height: 50px;\\n    bottom: 15px;\\n    right: 205px;\\n    z-index: 1; }\\n  .map-wrapper npn-logo.working {\\n    position: absolute;\\n    top: 5px;\\n    right: 5px;\\n    width: 30px;\\n    height: 30px;\\n    z-index: 100; }\\n  @media (min-width: 992px) {\\n    .map-wrapper map-layer-legend {\\n      position: absolute;\\n      left: 10px;\\n      padding: 8px;\\n      border: 1px solid #aaa;\\n      background-color: rgba(255, 255, 255, 0.85);\\n      border-radius: 5px; }\\n    .map-wrapper map-layer-legend {\\n      bottom: 25px;\\n      width: 60%; }\\n      .map-wrapper map-layer-legend .gridded-legend {\\n        margin-top: 0px;\\n        border-bottom: none;\\n        width: 100%;\\n        height: 125px;\\n        border: none; } }\\n  .map-wrapper .gridded-info {\\n    display: flex;\\n    align-items: center; }\\n  .map-wrapper .gridded-info .legend-swatch {\\n      width: 30px;\\n      height: 30px;\\n      border: 1px solid #aaa; }\\n  .map-wrapper .gridded-info .spinner-logo {\\n      width: 30px;\\n      height: 30px; }\\n  .map-wrapper .gridded-info .point-formatted {\\n      font-size: 1.25em;\\n      padding-left: .5em; }\\n  .map-wrapper .spinner-logo > svg {\\n    -webkit-animation-name: loading-anim;\\n            animation-name: loading-anim;\\n    -webkit-animation-duration: 1250ms;\\n            animation-duration: 1250ms;\\n    -webkit-animation-iteration-count: infinite;\\n            animation-iteration-count: infinite;\\n    -webkit-animation-timing-function: linear;\\n            animation-timing-function: linear;\\n    width: 28px;\\n    height: 28px; }\\n  .map-wrapper .spinner-logo > svg .swirl-top {\\n    fill: #f37022; }\\n  .map-wrapper .spinner-logo > svg .swirl-left {\\n    fill: #68bd46; }\\n  .map-wrapper .spinner-logo > svg .swirl-right {\\n    fill: #3b94d0; }\\n  @-webkit-keyframes loading-anim {\\n  from {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg); }\\n  to {\\n    -webkit-transform: rotate(360deg);\\n            transform: rotate(360deg); } }\\n  @keyframes loading-anim {\\n  from {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg); }\\n  to {\\n    -webkit-transform: rotate(360deg);\\n            transform: rotate(360deg); } }\\n\"","import { Component, Input, ElementRef, ViewChild } from '@angular/core';\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport { MapVisualizationBaseComponent } from '../map-visualization-base.component';\r\nimport { MapSelection } from './map-selection';\r\nimport { MapLayerLegendComponent } from '@npn/common/gridded/map-layer-legend.component';\r\nimport { MouseEvent } from '@agm/core';\r\nimport { GriddedPointData, MapLayerLegend } from '@npn/common/gridded';\r\nimport { Species, Phenophase } from '@npn/common/common';\r\nimport { SiteOrSummaryPlotData } from '../site-or-summary-vis-selection';\r\n\r\n@Component({\r\n    selector: 'map-visualization',\r\n    template: `\r\n    <div class=\"vis-container\">\r\n        <div class=\"map-wrapper\">\r\n            <npn-logo class=\"working\" *ngIf=\"selection.working\" spin=\"true\"></npn-logo>\r\n            <agm-map (mapReady)=\"mapReady($event)\" \r\n                [streetViewControl]=\"false\"  [styles]=\"mapStyles\" [scrollwheel]=\"false\"\r\n                (mapClick)=\"mapClick($event)\">\r\n                <agm-info-window *ngIf=\"griddedData || griddedLoading\"\r\n                    [isOpen]=\"griddedOpen\"\r\n                    (infoWindowClose)=\"griddedOpen = false\"\r\n                    [latitude]=\"griddedLat\" [longitude]=\"griddedLng\">\r\n                    <div *ngIf=\"griddedData || griddedLoading\" class=\"gridded-info\">\r\n                        <div *ngIf=\"griddedLoading\" class=\"spinner-logo\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 391 391\"><g>\r\n                            <path class=\"swirl-top\" d=\"M182,1c-36.3,2.4-68.6,13.4-95.3,32.5c-5.6,4-11.8,8.7-13.7,10.4l-3.5,3L73,46c5.8-1.6,15.6-1.2,22.2,1.1\r\n                                    c9.4,3.1,19.3,10.1,30.3,21.3C137.1,80.2,145.6,91,168,122c17.1,23.8,26.5,34.3,39.5,44.2c16.2,12.4,28.9,16.3,49.5,15.5\r\n                                    c21.7-0.9,38.4-7.7,53.2-21.6c17.4-16.3,25.7-36.1,25.8-61c0-10.3,0-10.3-2.2-9.6c-21.5,6.6-48.9,3.2-72.9-9.1\r\n                                    c-27.3-14.1-51.2-45.7-48.4-64.1c0.7-5.1,6-11,10.6-12c5.3-1,3-2.1-5.8-2.7C199.9,0.4,193.3,0.3,182,1z\"/>\r\n                            <path class=\"swirl-top\" d=\"M256.5,5.9c-8.8,0.9-11.6,1.9-13.9,5.3c-2.2,3.1-2,6.5,0.8,12.5c6.1,13.1,19.8,28.5,30.3,34\r\n                                    c11,5.9,28.3,8.6,41.2,6.4l6.5-1.1l8.2,4.5c4.5,2.5,8.7,4.5,9.3,4.5c2.5,0,0.8-4.1-3.6-9l-4.6-5.2l-0.1-10.2\r\n                                    c-0.1-9.3-0.4-10.7-3.3-16.7c-5.4-10.8-16-19.1-30-23.2C291.1,5.8,267.9,4.8,256.5,5.9z M315.8,40.2c2.7,2.7,0.7,7.8-2.9,7.8\r\n                                    c-2.1,0-4.9-2.6-4.9-4.5C308,40,313.3,37.7,315.8,40.2z\"/>\r\n                            <path class=\"swirl-top\" d=\"M72.5,50.6c-9.9,2.3-10.4,2.6-18.8,11.3c-4.5,4.7-11.1,12.2-14.6,16.6c-9.7,12.3-26,37.8-23,35.9\r\n                                    c0.8-0.5,4.6-3,8.6-5.7c9.7-6.4,23.9-13.1,34.8-16.3c8-2.5,10.6-2.7,24-2.7s15.9,0.2,23.8,2.6c4.8,1.5,12.4,4.5,16.9,6.8l8.1,4.1\r\n                                    l-3.8-6.9c-11.6-20.8-25.7-37.2-36.6-42.2C85.7,51.2,76.8,49.6,72.5,50.6z\"/>\r\n                            <path class=\"swirl-left\" d=\"M354.6,81.9c1.3,5,0.7,31.5-1,40.5c-4.6,24.2-16.5,43.5-35.4,57.4c-14.1,10.4-23.8,14.3-55.1,22.2\r\n                                    c-23.8,6-32.9,8.9-44.6,14.5c-22.7,10.9-35.8,23.3-45,42.6c-5.4,11.5-7.5,21.2-7.5,35.1c0,15.5,1.9,23.6,8.5,37.4\r\n                                    c10.3,21.3,27.7,35.9,51.2,43c7.6,2.4,10.6,2.7,22.3,2.8c15.3,0,23.2-1.5,34.5-6.7c19-8.6,31.2-17.5,48-34.8\r\n                                    c17.5-18,28.4-33.6,39.6-56.3c28.1-57.2,26.1-119.5-5.7-181.6C358.2,85.8,353.6,78.3,354.6,81.9z M329.4,194.2\r\n                                    c-30.6,42.4-63.6,80-84.9,96.8c-13.1,10.3-34,19-49.9,20.6l-6.4,0.7l-0.7-7.7c-1.4-14.8,2.6-33.4,9.7-45.3\r\n                                    c5-8.5,14.6-17.5,23.6-22.1c8.9-4.7,17.5-7.3,43.7-13.7c10.5-2.6,23.5-6.4,29.1-8.6c10.9-4.2,24.4-12.7,33.4-20.8\r\n                                    c3-2.8,5.7-5.1,5.8-5.1C333,189,331.5,191.4,329.4,194.2z\"/>\r\n                            <path class=\"swirl-right\" d=\"M67.5,108c-17.8,3.8-37.3,16-48,30.2C8.7,152.5,3.6,167,2,187.1C-0.1,215,7.8,248,24.4,280.3\r\n                                    c34.1,66.3,95.1,104.5,174.1,109.1l9,0.5l-6.5-1.4c-56.1-12.9-106.1-51.7-136.8-106.2c-14.5-25.7-20.6-47.5-20.7-73.8\r\n                                    c0-23.4,4.2-40,14.8-57.7c4.2-6.9,12.6-17.3,13.4-16.5c0.2,0.3-1.6,4.5-4,9.3C58.6,161.8,55,177.6,55,199c0,37.8,14.2,78,39.4,111.7\r\n                                    c14.5,19.5,39,42.1,58.8,54.2c14.9,9,31.2,16.2,46.5,20.5c14.6,4,15.2,3.9,5.5-1.4c-45.2-24.2-65.1-62.5-55.7-107.3\r\n                                    c0.9-4.3,3.9-15.1,6.6-24c9.7-31.5,12.1-43.7,12-63c0-9.1-0.5-14.3-2.1-20.2C154.6,125.4,111.9,98.7,67.5,108z\"/>\r\n                        </g></svg>\r\n                        </div>\r\n                        <div *ngIf=\"!griddedLoading\" class=\"legend-swatch\" [ngStyle]=\"{'background-color': griddedData.legendData?.color}\">&nbsp;</div>\r\n                        <div class=\"point-formatted\">{{griddedLoading ? 'Loading...' : griddedData.formatted}}</div>\r\n                    </div>\r\n                </agm-info-window>\r\n                <agm-marker *ngFor=\"let m of markers\"\r\n                    [latitude]=\"m.latitude\" [longitude]=\"m.longitude\"\r\n                    [iconUrl]=\"m.icon\"\r\n                    [title]=\"m.title\" (markerClick)=\"selectedMarker = m\"></agm-marker>\r\n                <agm-info-window\r\n                    [isOpen]=\"!!selectedMarker\" (infoWindowClose)=\"selectedMarker = null\"\r\n                    [latitude]=\"selectedMarker?.latitude\" [longitude]=\"selectedMarker?.longitude\">\r\n                    <map-visualization-marker-iw [marker]=\"selectedMarker\" [selection]=\"selection\"></map-visualization-marker-iw>\r\n                </agm-info-window>\r\n            </agm-map>\r\n            <map-layer-legend *ngIf=\"!thumbnail && selection.legend\" [legend]=\"selection.legend\"></map-layer-legend>\r\n            <img src = 'assets/USA-NPN-logo-RGB2019.png' class='npnlogo'/>\r\n            <img src = 'assets/University-of-Arizona-Logo.png' class='ualogo'/>\r\n            <img src = 'assets/usgs-logo.png' class='usgslogo'/>\r\n        </div>\r\n    </div>\r\n    `,\r\n    styleUrls: ['./map-visualization.component.scss']\r\n})\r\nexport class MapVisualizationComponent extends MapVisualizationBaseComponent {\r\n    @Input() selection:MapSelection;\r\n    @ViewChild(MapLayerLegendComponent) legend:MapLayerLegendComponent;\r\n\r\n    griddedLat:number;\r\n    griddedLng:number;\r\n    griddedOpen:boolean = false;\r\n    griddedData:GriddedPointData;\r\n    griddedLoading:boolean = false;\r\n\r\n    markers:MapVisMarker[];\r\n    selectedMarker:MapVisMarker;\r\n\r\n    constructor(protected rootElement: ElementRef, protected media: ObservableMedia) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    mapReady(map: google.maps.Map): void {\r\n        map.setCenter(new google.maps.LatLng(this.latitude, this.longitude));\r\n        map.setZoom(this.zoom);\r\n        this.getMapResolver(map);\r\n    }\r\n\r\n    /**\r\n     * triggered by window re-sizes and other UI logic when available screen\r\n     * real-estate may have changed.\r\n     */\r\n    protected resize():void {\r\n        console.log('MapVisualization.resize');\r\n        if(this.legend) {\r\n            this.legend.redraw();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * redraws are triggered by layer related changes.\r\n     */\r\n    protected redraw():void {\r\n        console.log('MapVisualization.redraw');\r\n        this.getMap().then(map => this.selection.updateLayer(map).then(() => {\r\n            if(this.legend) {\r\n                this.legend.redraw();\r\n            }\r\n            this.updateMarkers();\r\n        }));\r\n    }\r\n\r\n    private lastUpdateLegend:MapLayerLegend;\r\n    /**\r\n     * If the underlying legend coloring markers has changed since the last update\r\n     * then re-create all markers with new colors.  Markers have to be recreated\r\n     * since the underlying angular library won't update them if their references\r\n     * do not change (does not logically deep watch the contents of each marker).\r\n     */\r\n    private updateMarkers() {\r\n        const {legend} = this.selection;\r\n        if(\r\n           (!legend || legend !== this.lastUpdateLegend) || // if the legend changed\r\n           (this.markers.length && !this.markers[0].cloned) // OR the markers are \"new\" (!cloned) so haven't been colored\r\n           ) {\r\n            this.lastUpdateLegend = legend;\r\n            this.markers = (this.markers||[]).map(m => {\r\n                m = m.clone();\r\n                const data = legend\r\n                    ? legend.getPointData(m.doy)\r\n                    : null;\r\n                if(legend.layerName.includes('si-x') || legend.layerName.includes('no-layer')) {\r\n                    m.icon.fillColor = data ? data.color : '#ffffff';\r\n                } else {\r\n                    m.icon.fillColor = '#ffffff';\r\n                }\r\n                m.title = legend\r\n                    ? m.records.map(r => legend.formatPointData(r.mean_first_yes_doy)).join(', ')\r\n                    : m.records.map(r => r.mean_first_yes_doy).join(', ');\r\n                return m;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * updates are triggered by data related changes and will be called by the application\r\n     * when setting up the visualization the first time.\r\n     */\r\n    protected update():void {\r\n        console.log('MapVisualization.update');\r\n        this.markers = [];\r\n        this.getMap().then(() => { // just to make sure the google apis are loaded\r\n            this.selection.getData().then((allPlotData:SiteOrSummaryPlotData[]) => {\r\n                const data = allPlotData.reduce((records,plotData,plotIndex) => {\r\n                        const filtered = plotData.data\r\n                            .filter(d => d.mean_first_yes_doy !== -9999) // throw out invalid means\r\n                            .map(d => {\r\n                                d.plot = plotData.plot;\r\n                                d.plotIndex = plotIndex;\r\n                                return d;\r\n                            });\r\n                        return records.concat(filtered);\r\n                    },[])\r\n                    .sort((a,b) => a.mean_first_yes_doy - b.mean_first_yes_doy); // sort ascending by doy\r\n                console.log(`MapVisualization: data.length=${data.length} (filtered)`);\r\n                const bySiteMap:BySiteMap = {}; // to consolidate multiple species/phenos at a given station/marker\r\n                    this.markers = data.reduce((arr,d) => {\r\n                            if(bySiteMap[d.site_id]) {\r\n                                bySiteMap[d.site_id].addRecord(d);\r\n                            } else {\r\n                                const m = new MapVisMarker(d,newGoogleMapsSymbol(MAP_VIS_SVG_PATHS[d.plotIndex]));\r\n                                arr.push(m);\r\n                                bySiteMap[d.site_id] = m;\r\n                            }\r\n                            return arr;\r\n                        },[]);\r\n                console.log(`MapVisualization: markers.length=${this.markers.length}`);\r\n                this.redraw();\r\n            });\r\n        });\r\n    }\r\n\r\n    mapClick($event:MouseEvent) {\r\n        const {lat,lng} = $event.coords;\r\n        this.griddedLoading = true;\r\n        this.griddedLat = lat;\r\n        this.griddedLng = lng;\r\n        this.griddedData = null;\r\n        this.griddedOpen = true;\r\n        if(this.selection.layer  && this.selection.legend) {\r\n            this.selection.legend.getGriddedPointData(new google.maps.LatLng(lat,lng))\r\n                .subscribe(data => {\r\n                    if(data) {\r\n                        this.griddedLoading = false;\r\n                        this.griddedLat = lat;\r\n                        this.griddedLng = lng;\r\n                        this.griddedData = data;\r\n                        this.griddedOpen = true;\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    markerClick(marker:MapVisMarker) {\r\n        console.log('MapVisualization.markerClick',marker);\r\n    }\r\n}\r\n\r\nexport const MAP_VIS_SVG_PATHS:string[] = [\r\n    'M0 22 L22 22 L10 0 Z', // triangle\r\n    'M0 22 L22 22 L22 0 L0 0 Z', // square\r\n    'M4 22 L18 22 L22 10 L18 0 L4 0 L0 10 Z' // hexagon\r\n];\r\n\r\nfunction newGoogleMapsSymbol(path:string):google.maps.Symbol {\r\n    return {\r\n        path,\r\n        anchor: new google.maps.Point(11,11),\r\n        scale: 1,\r\n        fillOpacity: 1,\r\n        fillColor: '#ffffff',\r\n        strokeColor: '#204d74'\r\n    };\r\n}\r\n\r\ninterface BySiteMap {\r\n    [id:string]:MapVisMarker;\r\n}\r\n\r\ninterface MapVisRecord extends Species,Phenophase {\r\n    site_id:number;\r\n    mean_first_yes_doy:number;\r\n    phenophase_id:number;\r\n    latitude:number;\r\n    longitude:number;\r\n    // lots of other stuff\r\n}\r\n\r\nexport class MapVisMarker {\r\n    title:string;\r\n    records:MapVisRecord[];\r\n\r\n    constructor(public record:MapVisRecord,public icon:google.maps.Symbol,public cloned?:boolean) {\r\n        this.records = [record];\r\n    }\r\n\r\n    addRecord(record:MapVisRecord) {\r\n        this.records.push(record);\r\n        this.icon.strokeColor = '#00ff00';\r\n    }\r\n\r\n    get latitude():number { return this.record.latitude; }\r\n    get longitude():number { return this.record.longitude; }\r\n\r\n    get site_id():number { return this.record.site_id; }\r\n    get doy():number { return this.record.mean_first_yes_doy; }\r\n\r\n    clone():MapVisMarker {\r\n        const clone = new MapVisMarker(this.record,this.icon,true);\r\n        clone.records = this.records.slice();\r\n        return clone;\r\n    }\r\n}","export * from './map-selection';\r\nexport * from './map-selection.factory';\r\nexport * from './map-visualization.component';\r\nexport * from './extent-controls';\r\nexport * from './gridded-range-slider-control.component';\r\nexport * from './consolidated-map-layer-control.component';\r\nexport * from './map-visualization-marker-iw.component';","import { HttpParams } from '@angular/common/http';\r\n\r\nimport { StationAwareVisSelection, selectionProperty, POPInput, BASE_POP_INPUT, SelectionGroup, GroupHttpParams } from './vis-selection';\r\nimport { NpnServiceUtils, SpeciesPlot, TaxonomicSpeciesTitlePipe, getSpeciesPlotKeys, TaxonomicSpeciesRank, TaxonomicPhenophaseRank, SpeciesService, NetworkService, getStaticColor } from '../common';\r\n\r\nexport interface ObservationDatePlot extends SpeciesPlot {\r\n    [x: string]: any;\r\n}\r\n\r\nexport interface ObservationDataDataPoint {\r\n    x: number;\r\n    y: number;\r\n    color: string;\r\n}\r\nexport interface ObservationDateData {\r\n    labels: string[];\r\n    data: ObservationDataDataPoint[];\r\n}\r\n\r\nexport interface ObservationDatePlotData {\r\n    plot: ObservationDatePlot;\r\n    group?: SelectionGroup;\r\n    data: any;\r\n}\r\n\r\nexport abstract class ObservationDateVisSelection extends StationAwareVisSelection {\r\n    $supportsPop:boolean = true;\r\n\r\n    requestSrc: string = 'observation-date-vis-selection';\r\n\r\n    @selectionProperty()\r\n    negative: boolean = false;\r\n    @selectionProperty()\r\n    negativeColor: string = '#aaa'\r\n    @selectionProperty()\r\n    years: number[] = [];\r\n    @selectionProperty()\r\n    plots: ObservationDatePlot[] = [];\r\n\r\n    /** The maximum number of plots we want to allow. */\r\n    readonly MAX_PLOTS:number = 10;\r\n\r\n    constructor(\r\n        protected serviceUtils:NpnServiceUtils,\r\n        protected speciesTitle:TaxonomicSpeciesTitlePipe,\r\n        protected speciesService:SpeciesService,\r\n        protected networkService:NetworkService\r\n    ) {\r\n        super(serviceUtils,networkService);\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return this.years && this.years.length && this.validPlots.length > 0;\r\n    }\r\n\r\n    get validPlots(): ObservationDatePlot[] {\r\n        return (this.plots || []).filter(p => {\r\n            return p.species && p.phenophase && \r\n                // color only required if not grouping\r\n                (p.color || (this.groups && this.groups.length > 0));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Indicates whether or not adding one more plot will result in a visualization exceeding\r\n     * the maximum number of allowed plots.\r\n     */\r\n    get canAddPlot():boolean {\r\n        const years = this.years ? this.years.length : 0;\r\n        const groups = this.groups ? this.groups.length : 0;\r\n        const next_plots = ((this.plots ? this.plots.length : 0)+1)*years;\r\n        const next_count = groups ? (groups * next_plots) : next_plots;\r\n        return next_count <= this.MAX_PLOTS;\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        params = params.set('request_src', this.requestSrc);\r\n        this.years.forEach((y, i) => {\r\n            params = params.set(`year[${i}]`, `${y}`);\r\n        });\r\n        return super.toURLSearchParams(params);\r\n    }\r\n\r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        return super.toPOPInput(input)\r\n            .then(input => {\r\n                const yearRange = this.years.reduce((range,y) => {\r\n                        if(!range) {\r\n                            return [y,y];\r\n                        }\r\n                        if(y < range[0]) {\r\n                            range[0] = y;\r\n                        }\r\n                        if(y > range[1]) {\r\n                            range[1] = y;\r\n                        }\r\n                        return range;\r\n                    },undefined);\r\n                if(yearRange) {\r\n                    input.startDate = `${yearRange[0]}-01-01`;\r\n                    input.endDate = `${yearRange[1]}-12-31`;\r\n                }\r\n                return this.speciesService.getSpeciesIds(this.validPlots)\r\n                    .then(ids => {\r\n                        input.species = ids;\r\n                        return input;\r\n                    });\r\n            });\r\n    }\r\n\r\n    postProcessData(data: ObservationDatePlotData[]): ObservationDateData {\r\n        if (!data || !data.length) {\r\n            return null;\r\n        }\r\n        const plots = data.map(d => d.plot);\r\n        let y = (plots.length * this.years.length) -1;\r\n        const addDoys = (doys, color) => {\r\n            doys.forEach(doy => {\r\n                response.data.push({\r\n                    y: y,\r\n                    x: doy,\r\n                    color: color\r\n                });\r\n            });\r\n        };\r\n        const response:ObservationDateData = {\r\n            labels: [],\r\n            data: []\r\n        };\r\n        data.forEach(d => {\r\n            const plot = d.plot;\r\n            const group = d.group;\r\n            const rData:any= d.data;\r\n            let pPhases = {years:{}}; // empty\r\n            const pPhaseKey = plot.phenophaseRank === TaxonomicPhenophaseRank.CLASS ? 'pheno_classes' : 'phenophases';\r\n            if(rData && rData[pPhaseKey] && rData[pPhaseKey].length) {\r\n                pPhases = rData[pPhaseKey][0];\r\n            }\r\n            this.years.forEach(year => {\r\n                if(pPhases.years[year]) {\r\n                    if(this.negative) {\r\n                        addDoys(pPhases.years[year].negative,this.negativeColor);\r\n                    }\r\n                    addDoys(pPhases.years[year].positive,plot.color);\r\n                }\r\n                const pp = plot.phenophase as any;\r\n                response.labels.splice(0, 0, \r\n                    ` ${year}: `+\r\n                    this.speciesTitle.transform(plot.species,plot.speciesRank) +\r\n                    ' - '+\r\n                    (pp.phenophase_name||pp.pheno_class_name)+\r\n                    (!!group ? ` (${group.label})` : ''));\r\n                y--;\r\n            })\r\n        });\r\n        console.log('observation data', response);\r\n        return response;\r\n    }\r\n\r\n    getData(): Promise<ObservationDatePlotData[]> {\r\n        // work around TypeScript Promise.all issue\r\n        return this._getData();\r\n    }\r\n\r\n    private _getData(): Promise<any> {\r\n        if (!this.isValid()) {\r\n            return Promise.reject(this.INVALID_SELECTION);\r\n        }\r\n        const fetchDataForPlot = (baseParams,plot,group?) => {\r\n            const keys = getSpeciesPlotKeys(plot);\r\n            let plotParams = baseParams.set(`${keys.speciesIdKey}[0]`,`${plot.species[keys.speciesIdKey]}`)\r\n                .set(`${keys.phenophaseIdKey}[0]`,`${plot.phenophase[keys.phenophaseIdKey]}`);\r\n            if((plot.speciesRank||TaxonomicSpeciesRank.SPECIES) !== TaxonomicSpeciesRank.SPECIES) {\r\n                plotParams = plotParams.set('taxonomy_aggregate','1');\r\n            }\r\n            if(plot.phenophaseRank === TaxonomicPhenophaseRank.CLASS) {\r\n                plotParams = plotParams.set('pheno_class_aggregate','1');\r\n            }\r\n            return this.serviceUtils.cachedPost(serviceUrl,plotParams.toString())\r\n                .then((results:any[]) => {\r\n                    const data = results[0];\r\n                    return {plot,data,group};\r\n                });\r\n        };\r\n        this.working = true;\r\n        const serviceUrl = this.serviceUtils.apiUrl('/npn_portal/observations/getObservationDates.json');\r\n        return this.toURLSearchParams()\r\n            // one request per valid plot\r\n            .then(baseParams => {\r\n                const validPlots = this.validPlots;\r\n                return (this.groups && this.groups.length)\r\n                    ? this.toGroupHttpParams(baseParams)\r\n                        .then((groupParams:GroupHttpParams[]) => {\r\n                            let plotIndex = 0;\r\n                            // just to make TypeScript happy...\r\n                            const arr:Promise<ObservationDatePlotData>[] = [];\r\n                            const promises = validPlots.reduce((promises,p) => {\r\n                                groupParams.forEach(gp => {\r\n                                    const plot = JSON.parse(JSON.stringify(p));\r\n                                    plot.color = getStaticColor(plotIndex++);\r\n                                    promises.push(fetchDataForPlot(gp.params,plot,gp.group));\r\n                                });\r\n                                return promises;\r\n                            },arr);\r\n                            return Promise.all(promises);\r\n                        })\r\n                    : Promise.all(validPlots.map(plot => fetchDataForPlot(baseParams,plot)));\r\n            })\r\n            .then(result => {\r\n                this.working = false;\r\n                return result;\r\n            })\r\n            .catch(err => {\r\n                this.working = false;\r\n                this.handleError(err);\r\n            });\r\n    }\r\n}\r\n","export * from './public_api';","import {Component, Input, OnInit} from '@angular/core';\r\n\r\nimport {ObservationFrequencySelection} from './observation-frequency-selection';\r\n\r\n@Component({\r\n    selector: 'observation-frequency-control',\r\n    template:`\r\n    <mat-form-field class=\"year-input\">\r\n        <mat-select placeholder=\"Year *\" [(ngModel)]=\"selection.year\" (ngModelChange)=\"selection.update()\">\r\n            <mat-option *ngFor=\"let y of validYears\" [value]=\"y\">{{y}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `,\r\n    styles:[`\r\n        .year-input {\r\n            width: 65px;\r\n        }\r\n    `]\r\n})\r\nexport class ObservationFrequencyControl implements OnInit {\r\n    @Input()\r\n    selection: ObservationFrequencySelection;\r\n\r\n    // TODO what are the valid years?\r\n    validYears:number[] = (function(){\r\n        let max = (new Date()).getFullYear()+1,\r\n            current = 2000,\r\n            years:number[] = [];\r\n        while(current < max) {\r\n            years.push(current++);\r\n        }\r\n        return years.reverse();\r\n    })();\r\n\r\n    ngOnInit() {\r\n\r\n    }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {NetworkService,NpnServiceUtils} from '../../common';\r\n\r\nimport {ObservationFrequencySelection} from './observation-frequency-selection';\r\n\r\n@Injectable()\r\nexport class ObservationFrequencySelectionFactory {\r\n    constructor(protected serviceUtils:NpnServiceUtils,protected networkService: NetworkService) {}\r\n\r\n    newSelection(): ObservationFrequencySelection {\r\n        return new ObservationFrequencySelection(this.serviceUtils,this.networkService);\r\n    }\r\n}\r\n","import { NpnServiceUtils, NetworkService } from '../../common';\r\nimport { StationAwareVisSelection, selectionProperty, GroupHttpParams } from '../vis-selection';\r\nimport { HttpParams } from '@angular/common/http';\r\n\r\nexport interface ObservationFrequencyData {\r\n    /** The label for the data set. */\r\n    label: string;\r\n    /** The corresponding year. */\r\n    year: number;\r\n    /** Array of 12 (0=Jan,11=Dec) */\r\n    months: number[];\r\n}\r\n\r\ninterface SiteVisitFreqStation {\r\n    months: number[];\r\n    station_name: string;\r\n    station_id: number;\r\n}\r\ninterface SiteVisitFreq {\r\n    year: number;\r\n    station_ids: number[];\r\n    network_name: string;\r\n    stations: SiteVisitFreqStation[];\r\n}\r\n/**\r\n * @dynamic\r\n */\r\nexport class ObservationFrequencySelection extends StationAwareVisSelection {\r\n    @selectionProperty()\r\n    $class:string = 'ObservationFrequencySelection';\r\n\r\n    @selectionProperty()\r\n    $entity:any;\r\n\r\n    @selectionProperty()\r\n    year:number;\r\n\r\n    constructor(protected serviceUtils:NpnServiceUtils,protected networkService: NetworkService) {\r\n        super(serviceUtils,networkService);\r\n    }\r\n\r\n    isValid():boolean {\r\n        return !!this.year && this.networkIds.length > 0;\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        return super.toURLSearchParams(params.set('year',`${this.year}`));\r\n    }\r\n\r\n    getData():Promise<ObservationFrequencyData []> {\r\n        const url = this.serviceUtils.apiUrl('/npn_portal/networks/getSiteVisitFrequency.json');\r\n        const rollup = (data:SiteVisitFreq,label:string):ObservationFrequencyData => {\r\n            const year = data.year;\r\n            const months:number[] = data.stations.reduce((months:number[],station:SiteVisitFreqStation) => {\r\n                station.months.forEach((m,i) => months[i] += m);\r\n                return months;\r\n            },[0,0,0,0,0,0,0,0,0,0,0,0]);\r\n            return {label,year,months};\r\n        };\r\n        this.working = true;\r\n        if(!this.$entity) {\r\n            // the selection was created before the phenology trails work and must just contain a single network id\r\n            // for a refuge, chase it to get the label for the visualization and then the data....\r\n            return this.serviceUtils.cachedGet(url,{year: this.year,network_id:this.networkIds[0]})\r\n                .then((result:SiteVisitFreq) => {\r\n                    this.working = false;\r\n                    return [rollup(result,result.network_name)];\r\n                });\r\n        }\r\n        return this.toURLSearchParams()\r\n            .then(baseParams => {\r\n                if(this.groups && this.groups.length) {\r\n                    return this.toGroupHttpParams(baseParams)\r\n                        .then((groupParams:GroupHttpParams[]) => Promise.all(\r\n                                groupParams.map(gp =>this.serviceUtils.cachedPost(url,gp.params.toString())\r\n                                    .then((result:SiteVisitFreq) => rollup(result,gp.group.label)))\r\n                            ).then(data => {\r\n                                this.working = false;\r\n                                return data;\r\n                            }));\r\n                }\r\n                return this.serviceUtils.cachedPost(url,baseParams.toString())\r\n                    .then((result:SiteVisitFreq) => {\r\n                        this.working = false;\r\n                        let label = this.$entity.title;\r\n                        if(this.stationIds && this.stationIds.length) {\r\n                            // refuge, subset of stations\r\n                            label += ' (select stations)';\r\n                        } else if (this.$entity.network_ids && this.networkIds.length !== this.$entity.network_ids.length) {\r\n                            // phenology trail, subset of groups\r\n                            label += ' (select groups)';\r\n                        }\r\n                        return [rollup(result,label)];\r\n                    });\r\n            });\r\n    }\r\n}\r\n","import { Component, Input, ElementRef } from '@angular/core';\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport { VisualizationMargins } from '../visualization-base.component';\r\nimport { SvgVisualizationBaseComponent, DEFAULT_MARGINS } from '../svg-visualization-base.component';\r\n\r\nimport { ObservationFrequencySelection, ObservationFrequencyData } from './observation-frequency-selection';\r\n\r\nimport { Axis, axisBottom, axisLeft } from 'd3-axis';\r\nimport { Selection } from 'd3-selection';\r\nimport { ScaleBand, scaleBand, ScaleLinear, scaleLinear, ScaleOrdinal, scaleOrdinal } from 'd3-scale';\r\nimport * as d3 from 'd3';\r\nimport { getStaticColor } from '../../common';\r\n\r\nconst TITLE = 'Site visits by month';\r\nconst DEFAULT_TOP_MARGIN = 100;\r\nconst LEGEND_VPAD = 4;\r\nconst MARGIN_VPAD = 5;\r\nconst TITLE_FONT_SIZE = 18;\r\nconst SWATCH_SIZE = 20;\r\nconst BAR_OPACITY = '0.75';\r\n\r\n@Component({\r\n  selector: 'observation-frequency',\r\n  templateUrl: '../svg-visualization-base.component.html',\r\n  styleUrls: ['../svg-visualization-base.component.scss'],\r\n})\r\nexport class ObservationFrequencyComponent extends SvgVisualizationBaseComponent {\r\n    @Input()\r\n    selection:ObservationFrequencySelection;\r\n\r\n    title: Selection<any,any,any,any>;\r\n\r\n    x: ScaleBand<number>;\r\n    xAxis: Axis<number>;\r\n\r\n    y: ScaleLinear<number,number>;\r\n    yAxis: Axis<number>;\r\n\r\n    z: ScaleOrdinal<number,string> = scaleOrdinal<number,string>();\r\n\r\n    filename:string = 'observation-frequency.png';\r\n    margins: VisualizationMargins = {...DEFAULT_MARGINS, ...{top: DEFAULT_TOP_MARGIN,left: 80}};\r\n\r\n    data:ObservationFrequencyData[];\r\n\r\n    constructor(protected rootElement: ElementRef, protected media: ObservableMedia) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    protected reset(): void {\r\n        // dynamic top margins\r\n        this.margins.top = DEFAULT_TOP_MARGIN;\r\n        const fontSize:number = this.baseFontSize() as number;\r\n        const plotCount = this.data ? this.data.length : 0;\r\n        if(plotCount) {\r\n            this.margins.top = fontSize+(plotCount*SWATCH_SIZE)+(plotCount*LEGEND_VPAD)+MARGIN_VPAD;\r\n        }\r\n        super.reset();\r\n        const {chart,sizing,svg} = this;\r\n        const d3_month_fmt = d3.timeFormat('%B');\r\n        const titleDy = this.margins.top-TITLE_FONT_SIZE-fontSize;\r\n\r\n        this.title =  chart.append('g')\r\n                     .attr('class','chart-title')\r\n                     .append('text')\r\n                     .attr('y', '0')\r\n                     .attr('dy',`-${titleDy}`)\r\n                     .attr('x', '0')\r\n                     .style('text-anchor','start')\r\n                     .style('font-size',`${TITLE_FONT_SIZE}px`);\r\n\r\n        this.x = scaleBand<number>().rangeRound([0,sizing.width]).padding(0.05).domain(d3.range(0,12));\r\n        this.xAxis = axisBottom<number>(this.x).tickFormat(i =>  d3_month_fmt(new Date(1900,i)));\r\n        this.y = scaleLinear().range([sizing.height,0]).domain([0,20]); // just a default domain\r\n        this.yAxis = axisLeft<number>(this.y).tickSize(-sizing.width).tickFormat(d3.format('.0d'));\r\n\r\n        chart.append('g')\r\n            .attr('class', 'x axis')\r\n            .attr('transform', 'translate(0,' + sizing.height + ')')\r\n            .call(this.xAxis);\r\n\r\n        chart.append('g')\r\n            .attr('class', 'y axis')\r\n            .call(this.yAxis)\r\n                .append('text')\r\n                .attr('fill','#000') // somehow parent g has fill=\"none\"\r\n                .attr('transform', 'rotate(-90)')\r\n                .attr('y', '0')\r\n                .attr('dy','-3em')\r\n                .attr('x',-1*(sizing.height/2)) // looks odd but to move in the Y we need to change X because of transform\r\n                .style('text-anchor', 'middle')\r\n                .text('Site visits');\r\n\r\n        this.commonUpdates();\r\n    }\r\n\r\n    protected update(): void {\r\n        console.debug('ObservationFrequencyComponent.update');\r\n        this.reset();\r\n        delete this.data;\r\n        this.selection.getData()\r\n            .then(data => {\r\n                this.data = data;\r\n                this.reset()\r\n                this.redraw();\r\n            })\r\n            .catch(this.handleError);\r\n    }\r\n\r\n    private updateLegend():void {\r\n        const {chart,data,sizing,z} = this;\r\n        chart.select('.legend').remove();\r\n        if(data && data.length) {\r\n            const fontSize:number = this.baseFontSize() as number;\r\n            z.domain(data.map((d,i) => i)).range(data.map((d,i) => getStaticColor(i)));\r\n            const labels = data.map(d => d.label);\r\n            const legend = chart.append('g')\r\n                .attr('class','legend')\r\n                .attr('transform',`translate(55,-${sizing.margin.top})`)\r\n                .attr('text-anchor','start')\r\n                .style('font-size',`${fontSize}px`)\r\n                .selectAll('g')\r\n                .data(labels)\r\n                    .enter().append('g')\r\n                    // needs to be kept in sync with logic in dynamic margins in reset()\r\n                    .attr('transform',(d,i) => `translate(10,${fontSize+(i*SWATCH_SIZE)+(i*LEGEND_VPAD)})`);\r\n            // add legend swatches\r\n            legend.append('rect')\r\n                .attr('x',0)\r\n                .attr('width',SWATCH_SIZE)\r\n                .attr('height',SWATCH_SIZE)\r\n                .attr('fill',(d,i) => z(i))\r\n                .style('opacity',BAR_OPACITY);\r\n            // add labels\r\n            legend.append('text')\r\n                .attr('x',SWATCH_SIZE+4)\r\n                .attr('y',fontSize)\r\n                .attr('dy','0.1em')\r\n                .text(d => d);\r\n        }\r\n    }\r\n\r\n    protected commonUpdates(): void {\r\n        super.commonUpdates();\r\n        const {chart} = this;\r\n        // undo/change some of the commonUpdates\r\n        const _yAxis = chart.select('.y.axis');\r\n        _yAxis.select('path.domain')\r\n            .attr('stroke','none')\r\n            .style('stroke','none');\r\n        _yAxis.selectAll('.tick>line')\r\n            .attr('stroke',i => i === 0 ? '#000' : '#ddd')\r\n            .style('stroke',i => i === 0 ? '#000' : '#ddd');\r\n    }\r\n\r\n    protected redrawSvg(): void {\r\n        if(!this.data) {\r\n            return;\r\n        }\r\n        console.debug('ObservationFrequencyComponent.redrawSvg:data',this.data);\r\n        this.title.text(`${this.selection.year}`);\r\n        this.updateLegend();\r\n        const visData = d3.range(0,12)\r\n            .map(month => this.data.reduce((map,d,index) => {\r\n                map[`${index}`] = d.months[month];\r\n                return map;\r\n            },{}));\r\n        const max:number = visData.reduce((max:number,d) => {\r\n                const sum = Object.values(d).reduce((sum:number,n:number) => (sum+n),0);\r\n                return sum > max ? sum : max;\r\n            },0) as number; // TS handing of reduce is stupid\r\n        const layers = d3.stack().keys(this.data.map((d,i) => `${i}`))(visData);\r\n        const {chart,y,yAxis,x} = this;\r\n\r\n        y.domain([0,max]);\r\n        yAxis.ticks(max < 11 ? max : 10); // at most 10 ticks\r\n        chart.selectAll('g .y.axis').call(this.yAxis);\r\n\r\n        chart.selectAll('.layer').remove();\r\n        const layer = chart.selectAll('.layer')\r\n            .data(layers)\r\n            .enter()\r\n            .append('g')\r\n            .attr('class','layer')\r\n            .style('fill',(d,i) => this.z(i));\r\n        layer.selectAll('rect')\r\n            .data(d => d)\r\n            .enter()\r\n            .append('rect')\r\n                .attr('x',(d,i) => x(i))\r\n                .attr('y',d => y(d[1]))\r\n                .attr('height',d => y(d[0]) - y(d[1]))\r\n                .attr('width',x.bandwidth() -10)\r\n                .style('opacity',BAR_OPACITY);\r\n        this.commonUpdates();\r\n    }\r\n}","export * from './observation-frequency-selection';\r\nexport * from './observation-frequency-selection-factory.service';\r\nexport * from './observation-frequency.component';\r\nexport * from './observation-frequency-control.component';\r\n","export * from './public_api';","import {Component, Input, OnInit} from '@angular/core';\r\n\r\nimport {ObserverActivitySelection} from './observer-activity-selection';\r\n\r\n@Component({\r\n    selector: 'observer-activity-control',\r\n    template:`\r\n    <mat-form-field class=\"year-input\">\r\n        <mat-select placeholder=\"Year *\" [(ngModel)]=\"selection.year\" (ngModelChange)=\"selection.update()\">\r\n            <mat-option *ngFor=\"let y of validYears\" [value]=\"y\">{{y}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    `,\r\n    styles:[`\r\n        .year-input {\r\n            width: 65px;\r\n        }\r\n    `]\r\n})\r\nexport class ObserverActivityControl implements OnInit {\r\n    @Input()\r\n    selection: ObserverActivitySelection;\r\n\r\n    // TODO what are the valid years?\r\n    validYears:number[] = (function(){\r\n        let max = (new Date()).getFullYear()+1,\r\n            current = 2000,\r\n            years:number[] = [];\r\n        while(current < max) {\r\n            years.push(current++);\r\n        }\r\n        return years.reverse();\r\n    })();\r\n\r\n    ngOnInit() {\r\n\r\n    }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {NpnServiceUtils, NetworkService} from '../../common';\r\n\r\nimport {ObserverActivitySelection} from './observer-activity-selection';\r\n\r\n@Injectable()\r\nexport class ObserverActivitySelectionFactory {\r\n    constructor(protected serviceUtils:NpnServiceUtils,protected networkService:NetworkService) {}\r\n\r\n    newSelection(): ObserverActivitySelection {\r\n        return new ObserverActivitySelection(this.serviceUtils,this.networkService);\r\n    }\r\n}\r\n","import { NpnServiceUtils, NetworkService } from '../../common';\r\nimport { selectionProperty, StationAwareVisSelection, GroupHttpParams } from '../vis-selection';\r\nimport { HttpParams } from '@angular/common/http';\r\n\r\nexport interface ObserverActivityMonth {\r\n    /** Month (1-12) */\r\n    month:number;\r\n    /** Number of new observers */\r\n    newObservers:number;\r\n    /** Number of active observers */\r\n    activeObservers:number;\r\n}\r\n\r\nexport interface ObserverActivityData {\r\n    /** The label for the data set. */\r\n    label: string;\r\n    /** The corresponding year. */\r\n    year: number;\r\n    /** Array of 12 (ordered) */\r\n    months: ObserverActivityMonth[];\r\n    // TODO how do we label a non-grouped data set....\r\n    // previously simply relied on network_name as returned by the server....\r\n}\r\n\r\nexport class ObserverActivitySelection extends StationAwareVisSelection {\r\n    @selectionProperty()\r\n    $class:string = 'ObserverActivitySelection';\r\n\r\n    @selectionProperty()\r\n    $entity:any;\r\n\r\n    @selectionProperty()\r\n    year:number;\r\n\r\n    constructor(protected serviceUtils:NpnServiceUtils,protected networkService:NetworkService) {\r\n        super(serviceUtils,networkService);\r\n    }\r\n\r\n    isValid():boolean {\r\n        return !!this.year;\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        return super.toURLSearchParams(params.set('year',`${this.year}`));\r\n    }\r\n\r\n    getData():Promise<ObserverActivityData[]> {\r\n        const url = this.serviceUtils.apiUrl('/npn_portal/networks/getObserversByMonth.json');\r\n        // pulls data for a given month from a server response\r\n        const dataForMonth = (month:number,data:any):ObserverActivityMonth => ({\r\n            month,\r\n            newObservers: data.months[month].new_observers.length,\r\n            activeObservers: data.months[month].active_observers.length\r\n        });\r\n        this.working = true;\r\n        // if $entity is not set then this selection was created prior to the phenology trail\r\n        // work and so needs to behave as it did previously, only single network id, etc.\r\n        if(!this.$entity) {\r\n            return this.serviceUtils.cachedGet(url,{year: this.year,network_id: this.networkIds[0]})\r\n                .then(data => {\r\n                    this.working = false;\r\n                    data.label = `${data.network_name}`;\r\n                    data.months = [1,2,3,4,5,6,7,8,9,10,11,12].map(i => dataForMonth(i,data));\r\n                    const d = data as ObserverActivityData;\r\n                    return [d];\r\n                });\r\n        }\r\n        // $entity is set this is a new selection that can deal with\r\n        return this.toURLSearchParams()\r\n            .then(baseParams => {\r\n                if(this.groups && this.groups.length) {\r\n                    return this.toGroupHttpParams(baseParams)\r\n                        .then((groupParams:GroupHttpParams[]) => Promise.all(\r\n                            groupParams.map(gp => this.serviceUtils.cachedPost(url,gp.params.toString())\r\n                                .then(data => {\r\n                                    data.label = gp.group.label;\r\n                                    data.months = [1,2,3,4,5,6,7,8,9,10,11,12].map(i => dataForMonth(i,data));\r\n                                    const d = data as ObserverActivityData;\r\n                                    return d;\r\n                                }))\r\n                        )).then((results:ObserverActivityData[]) => {\r\n                            this.working = false;\r\n                            return results;\r\n                        })\r\n                }\r\n                // a single data set\r\n                return this.serviceUtils.cachedPost(url,baseParams.toString())\r\n                    .then(data => {\r\n                        this.working = false;\r\n                        let label = this.$entity.title;\r\n                        if(this.stationIds && this.stationIds.length) {\r\n                            // refuge, subset of stations\r\n                            label += ' (select stations)';\r\n                        } else if (this.$entity.network_ids && this.networkIds.length !== this.$entity.network_ids.length) {\r\n                            // phenology trail, subset of groups\r\n                            label += ' (select groups)';\r\n                        }\r\n                        data.label = label;\r\n                        data.months = [1,2,3,4,5,6,7,8,9,10,11,12].map(i => dataForMonth(i,data));\r\n                        const d = data as ObserverActivityData;\r\n                        return [d];\r\n                    });\r\n            });\r\n    }\r\n}\r\n","module.exports = \"<div class=\\\"vis-container\\\">\\r\\n    <div class=\\\"vis-working\\\" *ngIf=\\\"selection.working\\\">\\r\\n        <npn-logo spin=\\\"false\\\"></npn-logo>\\r\\n    </div>\\r\\n    <div class=\\\"chart-container\\\">\\r\\n        <visualization-download *ngIf=\\\"!thumbnail && !mobileMode\\\" svgWrapperId=\\\"{{id}}\\\" filename=\\\"{{filename}}\\\"></visualization-download>\\r\\n        <div [class]=\\\"clazz\\\" id=\\\"{{id}}\\\"><svg class=\\\"svg-visualization\\\"></svg></div>\\r\\n    </div>\\r\\n    <mat-radio-group style=\\\"display:block; margin-top: 10px;\\\" *ngIf=\\\"!thumbnail\\\"\\r\\n        [(ngModel)]=\\\"mode\\\"\\r\\n        (change)=\\\"redraw()\\\">\\r\\n        <mat-radio-button [value]=\\\"modes.ACTIVE_OBSERVERS\\\" style=\\\"margin-right: 5px;\\\">{{modes.ACTIVE_OBSERVERS}}</mat-radio-button>\\r\\n        <mat-radio-button [value]=\\\"modes.NEW_OBSERVERS\\\">{{modes.NEW_OBSERVERS}}</mat-radio-button>\\r\\n    </mat-radio-group>\\r\\n</div>\\r\\n\"","import { Component, Input, ElementRef } from '@angular/core';\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport { VisualizationMargins } from '../visualization-base.component';\r\nimport { SvgVisualizationBaseComponent, DEFAULT_MARGINS } from '../svg-visualization-base.component';\r\n\r\nimport { ObserverActivitySelection, ObserverActivityData } from './observer-activity-selection';\r\n\r\nimport { Axis, axisBottom, axisLeft } from 'd3-axis';\r\nimport { Selection } from 'd3-selection';\r\nimport { ScaleBand, scaleBand, ScaleLinear, scaleLinear, ScaleOrdinal, scaleOrdinal } from 'd3-scale';\r\nimport * as d3 from 'd3';\r\nimport { getStaticColor } from '../../common';\r\n\r\nconst DEFAULT_TOP_MARGIN = 100;\r\nconst LEGEND_VPAD = 4;\r\nconst MARGIN_VPAD = 5;\r\nconst TITLE_FONT_SIZE = 18;\r\nconst SWATCH_SIZE = 20;\r\nconst BAR_OPACITY = '0.75';\r\n\r\nenum ObserverActivityVisMode {\r\n    NEW_OBSERVERS = 'New Observers',\r\n    ACTIVE_OBSERVERS = 'Active Observers'\r\n};\r\n\r\n@Component({\r\n  selector: 'observer-activity',\r\n  templateUrl: './observer-activity.component.html',\r\n  styleUrls: ['../svg-visualization-base.component.scss']\r\n})\r\nexport class ObserverActivityComponent extends SvgVisualizationBaseComponent {\r\n    modes = ObserverActivityVisMode;\r\n    mode:ObserverActivityVisMode = ObserverActivityVisMode.ACTIVE_OBSERVERS;\r\n\r\n    @Input()\r\n    selection:ObserverActivitySelection;\r\n\r\n    title: Selection<any,any,any,any>;\r\n    tooltip: Selection<any,any,any,any>;\r\n    x: ScaleBand<number>;\r\n    xAxis: Axis<number>;\r\n    yAxisLabel;\r\n\r\n    y: ScaleLinear<number,number>;\r\n    yAxis: Axis<number>;\r\n\r\n    z: ScaleOrdinal<number,string> = scaleOrdinal<number,string>();\r\n\r\n    filename:string = 'observer-activity.png';\r\n    margins: VisualizationMargins = {...DEFAULT_MARGINS, ...{top: DEFAULT_TOP_MARGIN,left: 80}};\r\n\r\n    data:ObserverActivityData[];\r\n\r\n    constructor(protected rootElement: ElementRef, protected media: ObservableMedia) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    protected reset(): void {\r\n        // dynamic top margins\r\n        this.margins.top = DEFAULT_TOP_MARGIN;\r\n        const fontSize:number = this.baseFontSize() as number;\r\n        const plotCount = this.data ? this.data.length : 0;\r\n        if(plotCount) {\r\n            this.margins.top = fontSize+(plotCount*SWATCH_SIZE)+(plotCount*LEGEND_VPAD)+MARGIN_VPAD;\r\n        }\r\n        super.reset();\r\n        const {chart,sizing,svg} = this;\r\n        const d3_month_fmt = d3.timeFormat('%B');\r\n        const titleDy = this.margins.top-TITLE_FONT_SIZE-fontSize;\r\n\r\n        this.title =  chart.append('g')\r\n                     .attr('class','chart-title')\r\n                     .append('text')\r\n                     .attr('y', '0')\r\n                     .attr('dy',`-${titleDy}`)\r\n                     .attr('x', '0')\r\n                     .style('text-anchor','start')\r\n                     .style('font-size',`${TITLE_FONT_SIZE}px`);\r\n\r\n        this.x = scaleBand<number>().rangeRound([0,sizing.width]).padding(0.05).domain(d3.range(0,12));\r\n        this.xAxis = axisBottom<number>(this.x).tickFormat((i) => d3_month_fmt(new Date(1900,i)));\r\n        this.y = scaleLinear().range([sizing.height,0]).domain([0,20]); // just a default domain\r\n        this.yAxis = axisLeft<number>(this.y)\r\n            .tickSize(-sizing.width)\r\n            .tickFormat(d3.format('.0d'));\r\n\r\n        chart.append('g')\r\n            .attr('class', 'x axis')\r\n            .attr('transform', 'translate(0,' + sizing.height + ')')\r\n            .call(this.xAxis);\r\n\r\n        this.yAxisLabel = chart.append('g')\r\n            .attr('class', 'y axis')\r\n            .call(this.yAxis)\r\n                .append('text')\r\n                .attr('fill','#000') // somehow parent g has fill=\"none\"\r\n                .attr('transform', 'rotate(-90)')\r\n                .attr('y', '0')\r\n                .attr('dy','-3em')\r\n                .attr('x',-1*(sizing.height/2)) // looks odd but to move in the Y we need to change X because of transform\r\n                .style('text-anchor', 'middle');\r\n\r\n        this.tooltip = svg.append('g')\r\n            .attr('class','tooltip')\r\n            .style('display','none');\r\n        this.tooltip.append(\"rect\")\r\n            .attr(\"width\", 60)\r\n            .attr(\"height\", 20)\r\n            .attr(\"fill\", \"white\")\r\n            .style(\"opacity\", 0.5);\r\n        this.tooltip.append(\"text\")\r\n            .attr(\"x\", 30)\r\n            .attr(\"dy\", \"1.2em\")\r\n            .style(\"text-anchor\", \"middle\")\r\n            .attr(\"font-size\", \"12px\")\r\n            .attr(\"font-weight\", \"bold\");\r\n        this.commonUpdates();\r\n    }\r\n\r\n    protected update(): void {\r\n        this.reset();\r\n        this.selection.getData()\r\n            .then(data => {\r\n                this.data = data;\r\n                this.reset();\r\n                this.redraw();\r\n            })\r\n            .catch(this.handleError);\r\n    }\r\n\r\n    private updateLegend():void {\r\n        const {chart,data,sizing,z} = this;\r\n        chart.select('.legend').remove();\r\n        if(data && data.length) {\r\n            const fontSize:number = this.baseFontSize() as number;\r\n            z.domain(data.map((d,i) => i)).range(data.map((d,i) => getStaticColor(i)));\r\n            const labels = data.map(d => d.label);\r\n            const legend = chart.append('g')\r\n                .attr('class','legend')\r\n                .attr('transform',`translate(55,-${sizing.margin.top})`)\r\n                .attr('text-anchor','start')\r\n                .style('font-size',`${fontSize}px`)\r\n                .selectAll('g')\r\n                .data(labels)\r\n                    .enter().append('g')\r\n                    // needs to be kept in sync with logic in dynamic margins in reset()\r\n                    .attr('transform',(d,i) => `translate(10,${fontSize+(i*SWATCH_SIZE)+(i*LEGEND_VPAD)})`);\r\n            // add legend swatches\r\n            legend.append('rect')\r\n                .attr('x',0)\r\n                .attr('width',SWATCH_SIZE)\r\n                .attr('height',SWATCH_SIZE)\r\n                .attr('fill',(d,i) => z(i))\r\n                .style('opacity',BAR_OPACITY);\r\n            // add labels\r\n            legend.append('text')\r\n                .attr('x',SWATCH_SIZE+4)\r\n                .attr('y',fontSize)\r\n                .attr('dy','0.1em')\r\n                .text(d => d);\r\n        }\r\n    }\r\n\r\n    protected commonUpdates(): void {\r\n        super.commonUpdates();\r\n        const {chart} = this;\r\n        // undo/change some of the commonUpdates\r\n        const _yAxis = chart.select('.y.axis');\r\n        _yAxis.select('path.domain')\r\n            .attr('stroke','none')\r\n            .style('stroke','none');\r\n        _yAxis.selectAll('.tick>line')\r\n            .attr('stroke',i => i === 0 ? '#000' : '#ddd')\r\n            .style('stroke',i => i === 0 ? '#000' : '#ddd');\r\n    }\r\n\r\n    protected redrawSvg(): void {\r\n        if(!this.data) {\r\n            return;\r\n        }\r\n        console.debug('ObserverActivityComponent:data',this.data);\r\n        this.title.text(`${this.selection.year}`);\r\n        this.yAxisLabel.text(this.mode);\r\n        this.updateLegend();\r\n        const dataKey = this.mode === ObserverActivityVisMode.ACTIVE_OBSERVERS ? 'activeObservers' : 'newObservers';\r\n        const visData = d3.range(0,12)\r\n            .map(month => this.data.reduce((map,d,index) => {\r\n                map[`${index}`] = d.months[month][dataKey];\r\n                return map;\r\n            },{}));\r\n        const max:number = visData.reduce((max:number,d) => {\r\n                const sum = Object.values(d).reduce((sum:number,n:number) => (sum+n),0);\r\n                return sum > max ? sum : max;\r\n            },0) as number; // TS handing of reduce is stupid\r\n        const layers = d3.stack().keys(this.data.map((d,i) => `${i}`))(visData);\r\n        const {chart,y,yAxis,x,tooltip,sizing} = this;\r\n\r\n        y.domain([0,max]);\r\n        yAxis.ticks(max < 11 ? max : 10); // at most 10 ticks\r\n        chart.selectAll('g .y.axis').call(this.yAxis);\r\n\r\n        chart.selectAll('.layer').remove();\r\n        const layer = chart.selectAll('.layer')\r\n            .data(layers)\r\n            .enter()\r\n            .append('g')\r\n            .attr('class','layer')\r\n            .style('fill',(d,i) => this.z(i));\r\n        layer.selectAll('rect')\r\n            .data(d => d)\r\n            .enter()\r\n            .append('rect')\r\n                .attr('x',(d,i) => x(i))\r\n                .attr('y',d => y(d[1]))\r\n                .attr('height',d => y(d[0]) - y(d[1]))\r\n                .attr('width',x.bandwidth() -10)\r\n                .style('opacity',BAR_OPACITY);\r\n            /* tooltips not working nicely, flashing\r\n            .on('mouseover', () => tooltip.style('display',null))\r\n            .on('mouseout', () => tooltip.style('display','none'))\r\n            .on('mousemove', function(d) {\r\n                const container = this as d3.ContainerElement;\r\n                var xPosition = d3.mouse(container)[0] + sizing.margin.left - 5;\r\n                var yPosition = d3.mouse(container)[1] + sizing.margin.top - 5;\r\n                tooltip.attr('transform',`translate(${xPosition},${yPosition})`);\r\n                tooltip.select('text').text(d[1]-d[0]);\r\n            });*/\r\n        this.commonUpdates();\r\n    }\r\n}\r\n","export * from './observer-activity-selection';\r\nexport * from './observer-activity-selection-factory.service';\r\nexport * from './observer-activity.component';\r\nexport * from './observer-activity-control.component';\r\n","export { VisSelection, NetworkAwareVisSelection, StationAwareVisSelection } from './vis-selection';\r\nexport { VisualizationSelectionFactory } from './visualization-selection-factory.service';\r\nexport * from './visualizations.module';\r\nexport * from './calendar/public_api';\r\nexport * from './scatter-plot/public_api';\r\nexport * from './activity-curves/public_api';\r\nexport * from './clipped-wms-map/public_api';\r\nexport * from './observer-activity/public_api';\r\nexport * from './observation-frequency/public_api';\r\nexport * from './agdd-time-series/public_api';\r\nexport * from './map/public_api';\r\nexport * from './common-controls';\r\n","export * from './public_api';","export {ScatterPlotSelection,AXIS} from './scatter-plot-selection';\r\nexport {ScatterPlotSelectionFactory} from './scatter-plot-selection-factory.service';\r\nexport {ScatterPlotComponent} from './scatter-plot.component';\r\nexport {ScatterPlotControlsComponent as ScatterPlotControls} from './scatter-plot-controls.component';\r\n","import {Component, Input } from '@angular/core';\r\n\r\nimport {ScatterPlotSelection,AXIS} from './scatter-plot-selection';\r\nimport { HigherSpeciesPhenophaseInputCriteria } from '../common-controls';\r\nimport * as d3 from 'd3';\r\nimport { MonitorsDestroy } from '@npn/common/common';\r\nimport { takeUntil, filter, debounceTime } from 'rxjs/operators';\r\nimport { VisSelectionEvent } from '../vis-selection';\r\nimport { faExclamationTriangle } from '@fortawesome/pro-light-svg-icons';\r\n\r\n@Component({\r\n    selector: 'scatter-plot-control',\r\n    template: `\r\n    <div *ngIf=\"!selection.canAddPlot\" class=\"max-plots-reached\"><fa-icon [icon]=\"faExclamationTriangle\"></fa-icon> One more plot would exceed the maximum of {{selection.MAX_PLOTS}} allowed</div>\r\n    <year-range-input [(start)]=\"selection.start\" [(end)]=\"selection.end\" (onStartChange)=\"yearChange()\" (onEndChange)=\"yearChange()\"></year-range-input>\r\n\r\n    <div class=\"phenophase-input-wrapper\" *ngFor=\"let spi of selection.plots; index as idx\">\r\n        <higher-species-phenophase-input\r\n            gatherColor=\"true\"\r\n            [selection]=\"selection\"\r\n            [criteria]=\"criteria\"\r\n            [plot]=\"spi\"\r\n            (plotChange)=\"selection.update()\">\r\n        </higher-species-phenophase-input>\r\n        <button *ngIf=\"selection.plots.length > 1\" mat-button class=\"remove-plot\" (click)=\"removePlot(idx)\">Remove</button>\r\n        <button *ngIf=\"idx === (selection.plots.length-1)\" mat-button class=\"add-plot\" [disabled]=\"!plotsValid() || !selection.canAddPlot\" (click)=\"addPlot()\">Add</button>\r\n    </div>\r\n\r\n    <div>\r\n        <mat-form-field>\r\n            <mat-select placeholder=\"X Axis\" name=\"xAxis\" [(ngModel)]=\"selection.axis\" (ngModelChange)=\"redrawChange()\">\r\n              <mat-option *ngFor=\"let a of axis\" [value]=\"a\">{{a.label}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n\r\n        <mat-checkbox [(ngModel)]=\"selection.regressionLines\" (change)=\"redrawChange()\">Fit Lines</mat-checkbox>\r\n\r\n        <mat-checkbox [(ngModel)]=\"selection.individualPhenometrics\" (change)=\"selection.update()\">Use Individual Phenometrics</mat-checkbox>\r\n    </div>\r\n    `,\r\n    styles: [`\r\n        year-range-input,\r\n        .phenophase-input-wrapper {\r\n            display: block;\r\n            margin-top: 15px;\r\n        }\r\n        mat-form-field,\r\n        mat-checkbox {\r\n            padding-right: 10px;\r\n        }\r\n    `]\r\n})\r\nexport class ScatterPlotControlsComponent extends MonitorsDestroy {\r\n    @Input()\r\n    selection: ScatterPlotSelection;\r\n    axis = AXIS;\r\n    criteria:HigherSpeciesPhenophaseInputCriteria;\r\n\r\n    faExclamationTriangle = faExclamationTriangle;\r\n\r\n    ngOnInit() {\r\n        this.selection.pipe(\r\n            filter(event => event === VisSelectionEvent.SCOPE_CHANGE),\r\n            debounceTime(500),\r\n            takeUntil(this.componentDestroyed)\r\n        ).subscribe(() => this.updateCriteria());\r\n        \r\n        if(this.selection.plots.length === 0) {\r\n            this.addPlot();\r\n        }\r\n        setTimeout(() => this.updateCriteria());\r\n    }\r\n\r\n    yearChange() {\r\n        this.updateCriteria();\r\n        this.selection.update();\r\n    }\r\n\r\n    updateCriteria() {\r\n        this.criteria = {\r\n            years: d3.range(this.selection.start,this.selection.end+1),\r\n            stationIds: this.selection.getStationIds()\r\n        };\r\n    }\r\n\r\n    redrawChange(change?) {\r\n        if(change && !change.oldValue && change.newValue) { // e.g. no color to a color means a plot that wasn't valid is now potentially valid.\r\n            this.selection.update();\r\n        } else {\r\n            this.selection.redraw();\r\n        }\r\n    }\r\n\r\n    addPlot() {\r\n        this.selection.plots.push({});\r\n    }\r\n\r\n    removePlot(index:number) {\r\n        this.selection.plots.splice(index,1);\r\n        this.selection.update();\r\n    }\r\n\r\n    plotsValid() {\r\n        return this.selection.plots.length === this.selection.validPlots.length;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { NpnServiceUtils, SpeciesService, NetworkService } from '../../common';\r\nimport { ScatterPlotSelection } from './scatter-plot-selection';\r\n\r\n@Injectable()\r\nexport class ScatterPlotSelectionFactory {\r\n    constructor(\r\n        private serviceUtils:NpnServiceUtils,\r\n        private speciesService:SpeciesService,\r\n        private networkService:NetworkService) {}\r\n\r\n    newSelection(): ScatterPlotSelection {\r\n        return new ScatterPlotSelection(this.serviceUtils,this.speciesService,this.networkService);\r\n    }\r\n}\r\n","import { NULL_DATA, ONE_DAY_MILLIS, selectionProperty, POPInput, BASE_POP_INPUT } from '../vis-selection';\r\nimport { SiteOrSummaryVisSelection, SiteOrSummaryPlotData } from '../site-or-summary-vis-selection';\r\nimport { HttpParams } from '@angular/common/http';\r\nimport * as d3 from 'd3';\r\n\r\nconst KEYS_TO_NORMALIZE  = {\r\n    daylength: 'mean_daylength',\r\n    acc_prcp: 'mean_accum_prcp',\r\n    gdd: 'mean_gdd'\r\n};\r\n\r\nexport const AXIS = [\r\n    {key: 'latitude', label: 'Latitude', axisFmt: d3.format('.2f')},\r\n    {key: 'longitude', label: 'Longitude', axisFmt: d3.format('.2f')},\r\n    {key:'elevation_in_meters',label:'Elevation (m)'},\r\n    {key:'fyy', label: 'Year'},\r\n\r\n    {key:'prcp_fall',label:'Precip Fall (mm)'},\r\n    {key:'prcp_spring',label:'Precip Spring (mm)'},\r\n    {key:'prcp_summer',label:'Precip Summer (mm)'},\r\n    {key:'prcp_winter',label:'Precip Winter (mm)'},\r\n\r\n    {key:'tmax_fall',label:'Tmax Fall (C\\xB0)'},\r\n    {key:'tmax_spring',label:'Tmax Spring (C\\xB0)'},\r\n    {key:'tmax_summer',label:'Tmax Summer (C\\xB0)'},\r\n    {key:'tmax_winter',label:'Tmax Winter (C\\xB0)'},\r\n\r\n    {key:'tmin_fall',label:'Tmin Fall (C\\xB0)'},\r\n    {key:'tmin_spring',label:'Tmin Spring (C\\xB0)'},\r\n    {key:'tmin_summer',label:'Tmin Summer (C\\xB0)'},\r\n    {key:'tmin_winter',label:'Tmin Winter (C\\xB0)'},\r\n\r\n    {key:'daylength',label:'Day Length (s)'},\r\n    {key:'acc_prcp',label:'Accumulated Precip (mm)'},\r\n    {key:'gdd',label:'AGDD'}\r\n];\r\n\r\n/**\r\n * @dynamic\r\n */\r\nexport class ScatterPlotSelection extends SiteOrSummaryVisSelection {\r\n    $supportsPop:boolean = true;\r\n\r\n    @selectionProperty()\r\n    $class:string = 'ScatterPlotSelection';\r\n\r\n    @selectionProperty()\r\n    start: number = 2011;\r\n    @selectionProperty()\r\n    end: number = (new Date()).getFullYear();\r\n    @selectionProperty()\r\n    regressionLines: boolean = false;\r\n    @selectionProperty()\r\n    _axis:any = AXIS[0];\r\n    @selectionProperty()\r\n    _minDoy:number = 1;\r\n    @selectionProperty()\r\n    _maxDoy:number = 365;\r\n\r\n    /** The maximum number of plots we want to allow. */\r\n    readonly MAX_PLOTS:number = 6;\r\n\r\n    private d3DateFormat = d3.timeFormat('%x');\r\n\r\n    /**\r\n     * Indicates whether or not adding one more plot will result in a visualization exceeding\r\n     * the maximum number of allowed plots.\r\n     */\r\n    get canAddPlot():boolean {\r\n        const groups = this.groups ? this.groups.length : 0;\r\n        const next_plots = (this.plots ? this.plots.length : 0)+1;\r\n        const next_count = groups ? (groups * next_plots) : next_plots;\r\n        return next_count <= this.MAX_PLOTS;\r\n    }    \r\n\r\n    get minDoy():number { return this._minDoy; }\r\n    set minDoy(doy:number) {\r\n        this._minDoy = doy;\r\n        this.redraw();\r\n    }\r\n\r\n    get maxDoy():number { return this._maxDoy; }\r\n    set maxDoy(doy:number) {\r\n        this._maxDoy = doy;\r\n        this.redraw();\r\n    }\r\n\r\n    set axis(a:any) {\r\n        if(a) {\r\n            // an axis may hold axisFmt and if this selection is \r\n            // deserialized then it won't be in that array\r\n            this._axis = AXIS.indexOf(a) !== -1\r\n                ? a\r\n                : AXIS.find(ax => a.key === ax.key);\r\n        } else {\r\n            this._axis = a;\r\n        }\r\n    }\r\n\r\n    get axis():any {\r\n        return this._axis;\r\n    }\r\n\r\n    isValid():boolean {\r\n        return this.start &&\r\n               this.end &&\r\n               this.axis &&\r\n               (this.start <= this.end) &&\r\n               this.validPlots.length > 0;\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        params = params.set('climate_data','1')\r\n                    .set('request_src','npn-vis-scatter-plot')\r\n                    .set('start_date',`${this.start}-01-01`)\r\n                    .set('end_date',`${this.end}-12-31`);\r\n        return super.toURLSearchParams(params);\r\n    }\r\n\r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        return super.toPOPInput(input)\r\n            .then(input => {\r\n                input.startDate = `${this.start}-01-01`;\r\n                input.endDate = `${this.end}-12-31`;\r\n                return input;\r\n            });\r\n    }\r\n\r\n    doyDateFormat(doy:number):string {\r\n        let start = new Date(this.start,0,1),\r\n            time = ((doy-1)*ONE_DAY_MILLIS)+start.getTime(), // TODO, not enforcing that start/end be midnight on Jan 1\r\n            date = new Date(time);\r\n        return this.d3DateFormat(date);\r\n    }\r\n\r\n    // data access functions, not sure if the functionality here is too specific\r\n    // to the visualization of the resulting data so should be held somewhere else\r\n    // but it's here for now\r\n    getDoy(d): any {\r\n        return this.individualPhenometrics ? d.first_yes_doy : d.mean_first_yes_doy;\r\n    }\r\n\r\n    getFirstYesYear(d): any {\r\n        return this.individualPhenometrics ? d.first_yes_year : d.mean_first_yes_year;\r\n    }\r\n\r\n    axisData(d:any):number {\r\n        return d[this.axis.key];\r\n    }\r\n\r\n    axisNonNull(data:any[]): any[] {\r\n        return data.filter((d) => {\r\n            return this.axisData(d) !== NULL_DATA;\r\n        });\r\n    }\r\n\r\n    postProcessData(data:SiteOrSummaryPlotData[]):any[] {\r\n        const {start,minDoy,maxDoy} = this;\r\n        return data.reduce((result,plotData) => {\r\n                const filtered = plotData.data.filter(d => {\r\n                        const doy = this.getDoy(d);\r\n                        return doy >= minDoy && doy <= maxDoy;\r\n                    })\r\n                    .map(d => {\r\n                        d.color = plotData.plot.color;\r\n                        d.fyy = this.getFirstYesYear(d);\r\n                        for(let summaryKey in KEYS_TO_NORMALIZE) {\r\n                            if(typeof(d[summaryKey]) === 'undefined') {\r\n                                d[summaryKey] = d[KEYS_TO_NORMALIZE[summaryKey]];\r\n                            }\r\n                        }\r\n                        // this is the day # that will get plotted 1 being the first day of the start_year\r\n                        // 366 being the first day of start_year+1, etc.\r\n                        d.day_in_range = ((d.fyy-start)*365)+this.getDoy(d);\r\n                        return d;\r\n                    });\r\n                return result.concat(filtered);\r\n            },[]).map((d,i) => {\r\n                d.id = i;\r\n                return d;\r\n            });\r\n    }\r\n}\r\n","import { Component, Input, ElementRef } from '@angular/core';\r\n\r\nimport { ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport { TaxonomicSpeciesTitlePipe, getSpeciesPlotKeys } from '../../common';\r\nimport { VisualizationMargins } from '../visualization-base.component';\r\nimport { SvgVisualizationBaseComponent, DEFAULT_MARGINS } from '../svg-visualization-base.component';\r\n\r\nimport { ScatterPlotSelection } from './scatter-plot-selection';\r\n\r\nimport { Axis, axisBottom, axisLeft } from 'd3-axis';\r\nimport { Selection } from 'd3-selection';\r\nimport { ScaleLinear, scaleLinear } from 'd3-scale';\r\nimport * as d3 from 'd3';\r\nimport { SiteOrSummaryPlotData } from '../site-or-summary-vis-selection';\r\n\r\nconst DEFAULT_TOP_MARGIN = 80;\r\nconst LEGEND_VPAD = 4;\r\nconst MARGIN_VPAD = 5;\r\n\r\n@Component({\r\n  selector: 'scatter-plot',\r\n  templateUrl: '../svg-visualization-base.component.html',\r\n  styleUrls: ['../svg-visualization-base.component.scss'],\r\n  /*styles: [` // really because of the \"inline styles\" there's no big need to categorize things...\r\n      .visualization.ScatterPlotComponent {\r\n              border: 1px solid red;\r\n      }\r\n  `]*/\r\n})\r\nexport class ScatterPlotComponent extends SvgVisualizationBaseComponent {\r\n    @Input() selection : ScatterPlotSelection;\r\n\r\n    title: Selection<any,any,any,any>;\r\n\r\n    x: ScaleLinear<number,number>;\r\n    xAxis: Axis<number>;\r\n\r\n    y: ScaleLinear<number,number>;\r\n    yAxis: Axis<number>;\r\n\r\n    defaultAxisFormat = d3.format('d');\r\n    dateFormat = d3.timeFormat('%x');\r\n\r\n    filename:string = 'scatter-plot.png';\r\n    // https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-1.html#object-spread-and-rest\r\n    // similar to _|angular.extend\r\n    margins: VisualizationMargins = {...DEFAULT_MARGINS, ...{top: DEFAULT_TOP_MARGIN,left: 60}};\r\n\r\n    private data:SiteOrSummaryPlotData[];\r\n\r\n    constructor(protected rootElement: ElementRef, protected media:ObservableMedia, protected speciesTitle: TaxonomicSpeciesTitlePipe) {\r\n        super(rootElement,media);\r\n    }\r\n\r\n    protected reset(): void {\r\n        this.margins.top = DEFAULT_TOP_MARGIN;\r\n        const fontSize = this.baseFontSize() as number;\r\n        const plotCount = this.data ? this.data.length : 0;\r\n        if(plotCount) {\r\n            this.margins.top = ((plotCount+1)*fontSize)+(plotCount*LEGEND_VPAD)+MARGIN_VPAD;\r\n        }\r\n        super.reset();\r\n        const {chart,sizing} = this;\r\n        const titleFontSize = 18;\r\n        const titleDy = this.margins.top-titleFontSize-fontSize;\r\n        this.title =  chart.append('g')\r\n                     .attr('class','chart-title')\r\n                     .append('text')\r\n                     .attr('y', '0')\r\n                     .attr('dy',`-${titleDy}`)\r\n                     .attr('x', '-2.5em')\r\n                     .style('text-anchor','start')\r\n                     .style('font-size',`${titleFontSize}px`);\r\n        this.x = scaleLinear().range([0,sizing.width]).domain([0,100]);\r\n        this.xAxis = axisBottom<number>(this.x).tickFormat((i) => this.defaultAxisFormat(i));\r\n        this.y = scaleLinear().range([sizing.height,0]).domain([1,365]);\r\n        this.yAxis = axisLeft<number>(this.y);\r\n\r\n        chart.append('g')\r\n            .attr('class', 'x axis')\r\n            .attr('transform', 'translate(0,' + sizing.height + ')')\r\n            .call(this.xAxis);\r\n\r\n        chart.append('g')\r\n            .attr('class', 'y axis')\r\n            .call(this.yAxis)\r\n          .append('text')\r\n          .attr('fill','#000') // somehow parent g has fill=\"none\"\r\n          .attr('transform', 'rotate(-90)')\r\n          .attr('y', '0')\r\n          .attr('dy','-3em')\r\n          .attr('x',-1*(sizing.height/2)) // looks odd but to move in the Y we need to change X because of transform\r\n          .style('text-anchor', 'middle')\r\n          .text('Onset Day of Year');\r\n\r\n        this.commonUpdates();\r\n    }\r\n\r\n    protected update(): void {\r\n        this.reset();\r\n        this.selection.getData().then((data) => {\r\n            this.data = data;\r\n            this.redraw();\r\n        })\r\n        .catch(e => this.handleError(e));\r\n    }\r\n\r\n    protected redrawSvg():void {\r\n        if(!this.data) {\r\n            return;\r\n        }\r\n        let processedData = this.selection.postProcessData(this.data),\r\n            padding = 1,\r\n            selection = this.selection,\r\n            nonNullData = selection.axisNonNull(processedData),\r\n            getX = d => selection.axisData(d),\r\n            getY = d => selection.getDoy(d), // dataFunc\r\n            extent = d3.extent(nonNullData,getX),\r\n            formatXTickLabels = selection.axis.axisFmt||this.defaultAxisFormat;\r\n\r\n        this.title.text(`${selection.start} - ${selection.end}`);\r\n\r\n        this.x.domain([extent[0]-padding,extent[1]+padding]);\r\n        this.xAxis.scale(this.x).tickFormat(d3.format('.2f')); // TODO per-selection tick formatting\r\n        let xA = this.chart.selectAll('g .x.axis');\r\n        xA.call(this.xAxis.tickFormat(formatXTickLabels));\r\n        xA.selectAll('.axis-label').remove();\r\n        xA.append('text')\r\n          .attr('class','axis-label')\r\n          .attr('x',(this.sizing.width/2))\r\n          .attr('dy', '3em')\r\n          .attr('fill','#000')\r\n          .style('text-anchor', 'middle')\r\n          .style('font-size', '12px')\r\n          .text(this.selection.axis.label);\r\n\r\n        this.y.domain([this.selection.minDoy||1,this.selection.maxDoy||365]);\r\n        this.chart.selectAll('g .y.axis').call(this.yAxis);\r\n\r\n        this.chart.selectAll('.circle').remove();\r\n        let circles = this.chart.selectAll('.circle').data(nonNullData,(d:any) => d.id)\r\n            .enter().append('circle')\r\n            .attr('class', 'circle')\r\n            .style('stroke','#333')\r\n            .style('stroke-width','1');\r\n\r\n        circles.attr('cx', d => this.x(getX(d)))\r\n              .attr('cy', d => this.y(getY(d)))\r\n              .attr('r', '5')\r\n              .attr('fill',d => d.color)\r\n              .on('click',d => {\r\n                    if (d3.event.defaultPrevented){\r\n                        return;\r\n                    }\r\n                    this.record = d;\r\n                })\r\n              .append('title')\r\n              .text(d => `${selection.doyDateFormat(d.day_in_range)} [${d.latitude},${d.longitude}]`);\r\n\r\n        this.chart.selectAll('.regression').remove();\r\n        const plots = this.data.map(d => d.plot);\r\n        plots.forEach(plot => delete plot.regressionLine);\r\n        if(this.selection.regressionLines) {\r\n            let regressionLines = [];\r\n            plots.forEach(plot => {\r\n                let series = nonNullData.filter(d => d.color === plot.color);\r\n                if(series.length) {\r\n                    const keys = getSpeciesPlotKeys(plot);\r\n                    regressionLines.push(plot.regressionLine = new RegressionLine(\r\n                        `${plot.species[keys.speciesIdKey]}.${plot.phenophase[keys.phenophaseIdKey]}`,\r\n                        plot.color,\r\n                        series,\r\n                        getX, getY\r\n                    ));\r\n                }\r\n            });\r\n            let regression = this.chart.selectAll('.regression')\r\n                .data(regressionLines,(d:any) => d.id)\r\n                .enter().append('line')\r\n                .attr('class','regression');\r\n            regression\r\n                //.attr('data-legend',function(d) { return d.legend; } )\r\n                .attr('x1', d => this.x(d.p1[0]))\r\n                .attr('y1', d => this.y(d.p1[1]))\r\n                .attr('x2', d => this.x(d.p2[0]))\r\n                .attr('y2', d => this.y(d.p2[1]))\r\n                .attr('fill', d => d.color)\r\n                .attr('stroke', d => d.color)\r\n                .attr('stroke-width', 2);\r\n        }\r\n\r\n        this.chart.select('.legend').remove();\r\n        let legend = this.chart.append('g')\r\n            .attr('class','legend')\r\n            .attr('transform','translate(75,-'+(this.sizing.margin.top-10)+')')\r\n            .style('font-size','1em');\r\n        const r = 5;\r\n        this.data.forEach((d,i) => {\r\n            const plot = d.plot;\r\n            const group = d.group;\r\n            let row = legend.append('g')\r\n                .attr('class','legend-item')\r\n                .attr('transform','translate(10,'+(((i+1)*(this.baseFontSize() as number))+(i*LEGEND_VPAD))+')');\r\n            const pp:any = plot.phenophase;\r\n            let title =  this.speciesTitle.transform(plot.species,plot.speciesRank)+'/'+(pp.phenophase_name||pp.pheno_class_name);\r\n            if(plot.regressionLine && typeof(plot.regressionLine.r2) === 'number' && !isNaN(plot.regressionLine.r2)) {\r\n                // NOTE: the baseline-shift doesn't appear to work on Firefox\r\n                if(this.isIE) {\r\n                    title += ` (R2 ${plot.regressionLine.r2.toFixed(2)})`;\r\n                } else {\r\n                    title += ` (R<tspan style=\"baseline-shift: super; font-size: 0.65em;\">2</tspan> ${plot.regressionLine.r2.toFixed(2)})`;\r\n                }\r\n            }\r\n            if(group) {\r\n                title += ` (${group.label})`;\r\n            }\r\n            row.append('circle')\r\n                .attr('r',r)\r\n                .attr('fill',plot.color);\r\n            let text = row.append('text')\r\n                .style('font-size',this.baseFontSize(true))\r\n                .attr('x',(2*4))\r\n                .attr('y',(r/2));\r\n            if(this.isIE) {\r\n                text.text(title);\r\n            } else {\r\n                text.html(title);\r\n            }\r\n        });\r\n\r\n        this.commonUpdates();\r\n    }\r\n}\r\n\r\nclass RegressionLine {\r\n    id: string;\r\n    color: string;\r\n    legend: string; // TODO\r\n    p1: number[];\r\n    p2: number[];\r\n    r2: number;\r\n\r\n    constructor(id: string, color: string, data: any[], getX, getY) {\r\n        let datas = data.sort(function(o1,o2){ // sorting isn't necessary but makes it easy to pick min/max x\r\n                return getX(o1) - getX(o2);\r\n            }),\r\n            isNumber = d => typeof(d) === 'number',\r\n            xSeries = datas.map(getX).filter(isNumber),\r\n            ySeries = datas.map(getY).filter(isNumber),\r\n            leastSquaresCoeff = this.leastSquares(xSeries,ySeries),\r\n            x1 = xSeries[0] as number,\r\n            y1 = this.approxY(leastSquaresCoeff,x1),\r\n            x2 = xSeries[xSeries.length-1] as number,\r\n            y2 = this.approxY(leastSquaresCoeff,x2);\r\n\r\n        this.id = id;\r\n        this.color = color;\r\n        this.p1 = [x1,y1];\r\n        this.p2 = [x2,y2];\r\n        this.r2 = leastSquaresCoeff[2];\r\n    }\r\n\r\n    leastSquares(xSeries,ySeries): [number,number,number] {\r\n        if(xSeries.length === 0 || ySeries.length === 0) {\r\n            return [Number.NaN,Number.NaN,Number.NaN];\r\n        }\r\n        let reduceSumFunc = function(prev, cur) { return prev + cur; };\r\n\r\n        let xBar = xSeries.reduce(reduceSumFunc) * 1.0 / xSeries.length;\r\n        let yBar = ySeries.reduce(reduceSumFunc) * 1.0 / ySeries.length;\r\n\r\n        let ssXX = xSeries.map(function(d) { return Math.pow(d - xBar, 2); })\r\n            .reduce(reduceSumFunc);\r\n\r\n        let ssYY = ySeries.map(function(d) { return Math.pow(d - yBar, 2); })\r\n            .reduce(reduceSumFunc);\r\n\r\n        let ssXY = xSeries.map(function(d, i) { return (d - xBar) * (ySeries[i] - yBar); })\r\n            .reduce(reduceSumFunc);\r\n\r\n        let slope = ssXY / ssXX;\r\n        let intercept = yBar - (xBar * slope);\r\n        let rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);\r\n\r\n        return [slope, intercept, rSquare];\r\n    }\r\n\r\n    approxY(leastSquaresCoeff,x): number {\r\n        // y = a + bx\r\n        let a = leastSquaresCoeff[1],\r\n            b = leastSquaresCoeff[0];\r\n        return a + (b*x);\r\n    }\r\n}\r\n","import { HttpParams } from '@angular/common/http';\r\nimport { NpnServiceUtils,  SpeciesPlot, getSpeciesPlotKeys, TaxonomicSpeciesRank, TaxonomicPhenophaseRank, SpeciesService, NetworkService, getStaticColor } from '../common';\r\nimport { StationAwareVisSelection, selectionProperty, POPInput, BASE_POP_INPUT, GroupHttpParams, SelectionGroup } from './vis-selection';\r\n\r\nexport interface SiteOrSummaryPlot extends SpeciesPlot {\r\n    [x: string]: any;\r\n}\r\n\r\nexport interface SiteOrSummaryPlotData {\r\n    plot: SiteOrSummaryPlot;\r\n    group?: SelectionGroup;\r\n    data: any[];\r\n}\r\n\r\nexport abstract class SiteOrSummaryVisSelection extends StationAwareVisSelection {\r\n    @selectionProperty()\r\n    individualPhenometrics: boolean = false;\r\n    @selectionProperty()\r\n    _numDaysQualityFilter:number = 30;\r\n    @selectionProperty({\r\n        ser:d => {\r\n            const {species,phenophase} = d;\r\n            const o:any = {species,phenophase};\r\n            Object.getOwnPropertyNames(d)\r\n                .filter(key => key !== 'species' && key !== 'phenophase')\r\n                .forEach(key => o[key] = d[key]);\r\n            return o;\r\n        }\r\n    })\r\n    plots:SiteOrSummaryPlot[] = [];\r\n\r\n    constructor(\r\n        protected serviceUtils:NpnServiceUtils,\r\n        protected speciesService:SpeciesService,\r\n        protected networkService:NetworkService\r\n    ) {\r\n        super(serviceUtils,networkService);\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        if(this.numDaysQualityFilter && this.numDaysQualityFilter > 0) {\r\n            if(this.individualPhenometrics) {\r\n                params = params.set('num_days_quality_filter_individual',`${this.numDaysQualityFilter}`)\r\n            } else {\r\n                params = params.set('num_days_quality_filter',`${this.numDaysQualityFilter}`)\r\n            }\r\n        }\r\n        return super.toURLSearchParams(params);\r\n    }\r\n\r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        return super.toPOPInput(input)\r\n            .then(input => {\r\n                if(this.numDaysQualityFilter) {\r\n                    input.dataPrecision = this.numDaysQualityFilter;\r\n                }\r\n                return this.speciesService.getSpeciesIds(this.validPlots)\r\n                    .then(ids => {\r\n                        input.species = ids;\r\n                        return input;\r\n                    });\r\n            });\r\n    }\r\n\r\n    get validPlots():SiteOrSummaryPlot[] {\r\n        return this.plots.filter(p => !!p.species && !!p.phenophase);\r\n    }\r\n\r\n    get numDaysQualityFilter():number {\r\n        return this._numDaysQualityFilter;\r\n    }\r\n    set numDaysQualityFilter(n:number) {\r\n        this._numDaysQualityFilter = n;\r\n        this.update(); // param change\r\n    }\r\n\r\n    getData():Promise<SiteOrSummaryPlotData []> {\r\n        // work around TypeScript Promise.all issue\r\n        return this._getData();\r\n    }\r\n\r\n    private _getData(): Promise<any> {\r\n        if (!this.isValid()) {\r\n            return Promise.reject(this.INVALID_SELECTION);\r\n        }\r\n        const url = this.serviceUtils.apiUrl(`/npn_portal/observations/${this.individualPhenometrics ? 'getSummarizedData' : 'getSiteLevelData'}.json`);\r\n        const filterLqd = (data,plot,plotIndex) => { // site\r\n                const minusUnwanted =  data.filter(filterUnwantedDataFunctor(plot));\r\n                const minusSuspect = minusUnwanted.filter(filterSuspectSummaryData);\r\n                const filtered = minusSuspect.filter(this.individualPhenometrics ? filterLqSummaryData : filterLqSiteData);\r\n                console.debug(`plot[${plotIndex}] filtered out ${data.length-minusUnwanted.length}/${data.length} unwanted records`);\r\n                console.debug(`plot[${plotIndex}] filtered out ${minusUnwanted.length-minusSuspect.length}/${minusUnwanted.length} suspect records`);\r\n                console.debug(`plot[${plotIndex}] filtered out ${minusSuspect.length-filtered.length}/${minusSuspect.length} LQD records`);\r\n                if(this.individualPhenometrics) {\r\n                    const individuals = filtered.reduce(function (map, d) {\r\n                        var key = d.individual_id + '/' + d.phenophase_id + '/' + d.first_yes_year;\r\n                        map[key] = map[key] || [];\r\n                        map[key].push(d);\r\n                        return map;\r\n                    }, {});\r\n                    const uniqueIndividuals = [];\r\n                    for (let key in individuals) {\r\n                        let arr = individuals[key];\r\n                        if (arr.length > 1) {\r\n                            // sort by first_yes_doy\r\n                            arr.sort(function (a, b) {\r\n                                return a.first_yes_doy - b.first_yes_doy;\r\n                            });\r\n                        }\r\n                        // use the earliest record\r\n                        uniqueIndividuals.push(arr[0]);\r\n                    }\r\n                    console.debug(`plot[${plotIndex}] filtered out ${(filtered.length - uniqueIndividuals.length)}/${filtered.length} individual records (preferring lowest first_yes_doy)`);\r\n                    return uniqueIndividuals;\r\n                }\r\n                return filtered;\r\n            };\r\n        const fetchDataForPlot = (baseParams,plot,plotIndex,group?) => {\r\n            const keys = getSpeciesPlotKeys(plot);\r\n            let params = baseParams.set(`${keys.speciesIdKey}[0]`,`${plot.species[keys.speciesIdKey]}`)\r\n                .set(`${keys.phenophaseIdKey}[0]`,`${plot.phenophase[keys.phenophaseIdKey]}`);\r\n            if((plot.speciesRank||TaxonomicSpeciesRank.SPECIES) !== TaxonomicSpeciesRank.SPECIES) {\r\n                params = params.set('taxonomy_aggregate','1');\r\n            }\r\n            if(plot.phenophaseRank === TaxonomicPhenophaseRank.CLASS) {\r\n                params = params.set('pheno_class_aggregate','1');\r\n            }\r\n            params = params.set('climate_data','1');\r\n            return this.serviceUtils.cachedPost(url,params.toString())\r\n                .then(data => filterLqd(data,plot,plotIndex))\r\n                .then(data => ({plot,data,group}));\r\n        };\r\n        this.working = true;\r\n        return this.toURLSearchParams()\r\n            .then(baseParams => {\r\n                const validPlots = this.validPlots;\r\n                return (this.groups && this.groups.length )\r\n                    ? this.toGroupHttpParams(baseParams)\r\n                        .then((groupParams:GroupHttpParams[]) => {\r\n                            // multiply plots by groups\r\n                            let plotIndex = 0; // just for logging\r\n                            const promises = groupParams.reduce((promises,gp) => {\r\n                                validPlots.forEach(p => {\r\n                                    const plot = JSON.parse(JSON.stringify(p));\r\n                                    plot.color = getStaticColor(plotIndex);\r\n                                    promises.push(fetchDataForPlot(gp.params,plot,plotIndex++,gp.group));\r\n                                });\r\n                                return promises;\r\n                            },[]);\r\n                            return Promise.all(promises);\r\n                        })\r\n                    : Promise.all(validPlots.map((plot,plotIndex) => fetchDataForPlot(baseParams,plot,plotIndex)));\r\n            })\r\n            .then((results) => {\r\n                this.working = false;\r\n                return results;\r\n            })\r\n            .catch(err => {\r\n                this.working = false;\r\n                this.handleError(err);\r\n            });\r\n    }\r\n}\r\n\r\n/**\r\n * The underlying services do not treat species/phenophase pairs as\r\n * parallel arrays but as independent arrays.  This means when two species\r\n * share a phenophase but if that phenophase is only requested for one of the two\r\n * extra recrods can be returned and need to be discarded.  This function\r\n * returns a function that can be passed to Array.filter to discard those records\r\n * from server responses.\r\n * \r\n * Note: This should no longer ever prune out any unwanted records now that one request\r\n * is being made per plot\r\n */\r\nfunction filterUnwantedDataFunctor(plot:SpeciesPlot):(any) => boolean {\r\n    const keys = getSpeciesPlotKeys(plot);\r\n    const speciesId = plot.species[keys.speciesIdKey];\r\n    const phenoId = plot.phenophase[keys.phenophaseIdKey];\r\n    return d => {\r\n        const keep = speciesId == d[keys.speciesIdKey] &&\r\n                        phenoId == d[keys.phenophaseIdKey];\r\n        if(!keep) {\r\n            console.warn('filtering unwanted response record',d);\r\n        }\r\n        return keep;\r\n    };\r\n}\r\n\r\nfunction filterSuspectSummaryData(d):boolean {\r\n    var bad = (d.latitude === 0.0 || d.longitude === 0.0 || d.elevation_in_meters < 0);\r\n    if (bad) {\r\n        console.warn('suspect station data', d);\r\n    }\r\n    return !bad;\r\n}\r\n\r\nfunction filterLqSummaryData(d):boolean {\r\n    var keep = d.numdays_since_prior_no >= 0;\r\n    if (!keep) {\r\n        console.debug('filtering less precise data from summary output', d);\r\n    }\r\n    return keep;\r\n}\r\n\r\nfunction filterLqSiteData(d):boolean {\r\n    var keep = d.mean_numdays_since_prior_no >= 0;\r\n    if (!keep) {\r\n        console.debug('filtering less precise data from site level output', d);\r\n    }\r\n    return keep;\r\n}","module.exports = \"<div class=\\\"vis-container\\\">\\r\\n    <div class=\\\"vis-working\\\" *ngIf=\\\"selection.working\\\">\\r\\n        <npn-logo spin=\\\"false\\\"></npn-logo>\\r\\n    </div>\\r\\n    <div class=\\\"chart-container\\\">\\r\\n        <visualization-download *ngIf=\\\"!thumbnail && !mobileMode\\\" svgWrapperId=\\\"{{id}}\\\" filename=\\\"{{filename}}\\\"></visualization-download>\\r\\n        <div [class]=\\\"clazz\\\" id=\\\"{{id}}\\\"><svg class=\\\"svg-visualization\\\"></svg></div>\\r\\n    </div>\\r\\n    <div *ngIf=\\\"disclaimer && !thumbnail\\\" class=\\\"vis-disclaimer\\\">{{disclaimer}}</div>\\r\\n</div>\\r\\n<!--pre *ngIf=\\\"record\\\">{{record | json}}</pre-->\\r\\n\"","module.exports = \".vis-container {\\n  display: block;\\n  position: relative; }\\n  .vis-container .chart-container {\\n    position: relative; }\\n  .vis-container .visualization > svg,\\n  .vis-container img.thumbnail-image {\\n    border: 1px solid #000; }\\n  .vis-container .visualization > svg {\\n    display: block; }\\n  .vis-container .vis-disclaimer {\\n    margin-top: 5px;\\n    font-size: .75em;\\n    float: right; }\\n\"","import { Component, Input } from '@angular/core';\r\n\r\nimport { VisSelection, VisSelectionEvent } from './vis-selection';\r\nimport { VisualizationBaseComponent, VisualizationSizing, VisualizationMargins } from './visualization-base.component';\r\n\r\nimport { Selection } from 'd3-selection';\r\nimport * as d3 from 'd3';\r\n\r\nexport const DEFAULT_MARGINS: VisualizationMargins = { top: 20, right: 30, bottom: 60, left: 40 };\r\nexport const FONT_SIZE: number = 14;\r\nexport const FONT_SIZE_PX: string = FONT_SIZE + 'px';\r\n\r\n/*\r\nIMPORTANT: see not in VisualizationBaseComponent\r\n\r\n@Component({\r\n    selector: 'svg-visualization-base',\r\n    templateUrl: './svg-visualization-base.component.html',\r\n    styleUrls: ['./svg-visualization-base.component.scss']\r\n})\r\n*/\r\nexport class SvgVisualizationBaseComponent extends VisualizationBaseComponent {\r\n    record: any;\r\n\r\n    disclaimer: string;\r\n\r\n    filename: string = 'visualization.png';\r\n\r\n    // wrapping element\r\n    visRoot: Selection<any, any, any, any>;\r\n    // svg element\r\n    svg: Selection<any, any, any, any>;\r\n    // base g element that the chart draws on\r\n    chart: Selection<any, any, any, any>;\r\n\r\n    margins: VisualizationMargins = DEFAULT_MARGINS;\r\n\r\n    protected minWidth: number = 700;\r\n\r\n    baseFontSize(withPx?: boolean): number | string {\r\n        let fs = FONT_SIZE;\r\n        /*\r\n        if(this.sizing) {\r\n            if(this.sizing.width < 650) {\r\n                fs -=2;\r\n            }\r\n            if(this.sizing.width < 400) {\r\n                fs -= 2;\r\n            }\r\n        }*/\r\n        return withPx ? `${fs}px` : fs;\r\n    }\r\n\r\n    /**\r\n     * sub-classes should call after they have redrawn the visualization to get any\r\n     * common styling updates applied.\r\n     */\r\n    protected commonUpdates(): void {\r\n        let chart = this.chart,\r\n            fontSizePx = this.baseFontSize(true);\r\n\r\n        ['.axis path', '.axis line'].forEach(selector =>\r\n            chart.selectAll(selector).style('fill', 'none')\r\n                .style('stroke', '#000')\r\n                .style('shape-rendering', 'crispEdges'));\r\n\r\n        chart.selectAll('text')\r\n            .style('font-family', 'Arial');\r\n        chart.selectAll('g .axis text')\r\n            .style('font-size', fontSizePx);\r\n    }\r\n\r\n    /**\r\n     * `reset` is intended to initialize a visualziation to it's known \"clean\" state\r\n     * placing all common elements, etc.  Subclasses will almost certainly over-ride\r\n     * this implementation and call it to get the ball rolling.\r\n     *\r\n     * No asynchronous work should be done here, fetching data, etc. should happen\r\n     * only within `update`.\r\n     */\r\n    protected reset(): void {\r\n        let sizing = this.getSizeInfo(),\r\n            svg = this.svg,\r\n            width = sizing.width + sizing.margin.left + sizing.margin.right,\r\n            height = sizing.height + sizing.margin.top + sizing.margin.bottom;\r\n        // remove all children\r\n        svg.selectAll('*').remove();\r\n        // set size\r\n        svg.attr('width', width)\r\n            .attr('height', height)\r\n            .attr('viewBox', `0 0 ${width} ${height}`)\r\n            .attr('preserveAspectRatio', 'xMidYMid meet');\r\n        svg.append('g')\r\n            .attr('class', 'vis-background')\r\n            .append('rect')\r\n            .attr('width', '100%')\r\n            .attr('height', '100%')\r\n            .attr('fill', '#fff');\r\n        this.chart = svg.append('g')\r\n            .attr('transform', `translate(${sizing.margin.left},${sizing.margin.top})`)\r\n            .attr('class', 'vis-chart');\r\n\r\n        svg.append('g')\r\n            .attr('transform', `translate(10,${sizing.height + sizing.margin.top + sizing.margin.bottom - 10})`)\r\n            .append('text')\r\n            .attr('font-size', '11px')\r\n            .attr('font-style', 'italic')\r\n            .attr('text-anchor', 'right').text('USA National Phenology Network, www.usanpn.org');\r\n    }\r\n\r\n    protected resize(): void {\r\n        this.reset();\r\n        this.redraw();\r\n    }\r\n\r\n    // this used to be in ngAfterViewInit and most time it would succeed from there\r\n    // but very occasionally ngAfterViewInit would be called BEFORE the underlying\r\n    // elements exist in the DOM.  No time to understand cleanly why so these selections\r\n    // are now made whever asking about sizing which is the FIRST thing necessary to\r\n    // render an SVG visualization so it should be safe.\r\n    private selectElements() {\r\n        this.visRoot = d3.select('#' + this.id);\r\n        this.svg = this.visRoot.select('svg');\r\n    }\r\n\r\n    getSizeInfo(minWidth?: number): VisualizationSizing {\r\n        this.selectElements();\r\n        return super.getSizeInfo(this.minWidth);\r\n    }\r\n\r\n    /**\r\n     * IMPORTANT:\r\n     * Sub-classes should implement the redrawSvg and not over-ride redraw.\r\n     * If redraw is over-ridden the implementation  will lose the ability to\r\n     * dynamically replace themselves with a thumbnail should the screen\r\n     * realestate for the visualization get too small.\r\n     * \r\n     * public and not protected because used by HTML templates directly\r\n     */\r\n    redraw(): void {\r\n        this.redrawSvg();\r\n        let sizeInfo = this.sizing,\r\n            w = sizeInfo.width + sizeInfo.margin.left + sizeInfo.margin.right;\r\n        if (w === this.minWidth) {\r\n            // If the resulting width matches the minWidth then the realestate to draw the\r\n            // SVG is at or below the minWidth.  Attempting to render visualizations too small\r\n            // results in unusable/cramped results so when we reach this break point draw the\r\n            // visualization scaled to its minimum size and scale it down (shrink everything)\r\n            let native = this.rootElement.nativeElement as HTMLElement,\r\n                svg = native.querySelector('svg.svg-visualization') as SVGElement,\r\n                wrappedSvg = d3.select(svg),\r\n                h = sizeInfo.height + sizeInfo.margin.bottom + sizeInfo.margin.top,\r\n                aspectMult = sizeInfo.scaledWidth / this.minWidth;\r\n            wrappedSvg.attr('width', sizeInfo.scaledWidth);\r\n            wrappedSvg.attr('height', Math.round(h * aspectMult));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * SVG replacement for the redraw function.\r\n     */\r\n    protected redrawSvg(): void { throw new Error('abstract'); }\r\n\r\n    ngAfterViewInit() {\r\n        this.selectElements();\r\n        // sets up common handlers\r\n        super.ngAfterViewInit();\r\n    }\r\n\r\n}\r\n","import { EventEmitter } from '@angular/core';\r\nimport { newGuid, NpnServiceUtils, NetworkService, Station } from '../common';\r\nimport { HttpParams } from '@angular/common/http';\r\n\r\nexport const NULL_DATA = -9999;\r\nexport const ONE_DAY_MILLIS: number = (24 * 60 * 60 * 1000);\r\n\r\nexport const enum VisSelectionEvent {\r\n    RESET = 'reset', // go back to a \"clean\" slate\r\n    REDRAW = 'redraw', // assuming you have data simply re-draw with that data\r\n    UPDATE = 'update', // go get new data and reset/redraw\r\n    RESIZE = 'resize', // short cut for reset/redraw\r\n    SCOPE_CHANGE = 'scope_change', // a scope related property has changed (NetworkAwareVisSelection)\r\n}\r\n\r\n/*\r\n * A VisSelection is a jumble of properties and methods, not all of which should be serialized\r\n * and deserialized when [re]storing a selection to/from JSON.  In standard JavaScript this\r\n * could probably be dealt with cleanly via Object.defineProperty (and a big constructor) but\r\n * with TypeScript it's significantly more complicated.  For this reason all properties that\r\n * are part of what should be serialized for a given selection MUST be annotated with @selectionProperty()\r\n *\r\n * The virtual `external` property on a selection will produce a plain object representation\r\n * for a selection.  Assigning an object to the `external` property will deserialize it onto\r\n * the selection object.\r\n *\r\n * IMPORTANT: If a property key is prefixed with `_` it is assumed, by convention, that is the\r\n * internal representation of a virtual property of the same name without the leading `_`.\r\n * Such properties will be serialized without the leading `_` and when deserialized will be set\r\n * directly without the leading `_` so that any logic defined in the corresponding property setter\r\n * is run.\r\n */\r\nimport 'reflect-metadata';\r\nimport { Subject } from 'rxjs';\r\nconst selectionPropertyMetadataKey = Symbol('npnSelectionProperty');\r\nconst IDENTITY = d => d;\r\n/**\r\n * Defines a property handler for a selection property.\r\n */\r\nexport class SelectionPropertyHandler {\r\n    /**\r\n     * A function that is used to serialize a property object.\r\n     * Takes as input an object and returns an object.\r\n     * Defaults to object identity.\r\n     */\r\n    ser?: Function;\r\n    /**\r\n     * A function that is used to serialize a property object.\r\n     * Takes as input an object and returns an object.\r\n     * Defaults to object identity.\r\n     */\r\n    des?: Function;\r\n}\r\n/**\r\n * Property decorator to indicate which properties of a selection should\r\n * be part of the external form of the selection.\r\n * E.g.\r\n * <pre>\r\n *   @selectionProperty()\r\n *   private s:string;\r\n *   @selectionProperty({des: d => new Date(d)})\r\n *   private date:Date;\r\n *   @selectionProperty({\r\n *     des: d => {\r\n *       let o = new MyClass();\r\n *       ... copy properties for d to o ...\r\n *       return o;\r\n *     },\r\n *     ser: d => d\r\n *   })\r\n *   private o:MyClass;\r\n * </pre>\r\n */\r\nexport const selectionProperty = (handler?: SelectionPropertyHandler) => {\r\n    let the_handler = {\r\n        ...{ des: IDENTITY, ser: IDENTITY },\r\n        ...(handler || {})\r\n    };\r\n    return Reflect.metadata(selectionPropertyMetadataKey, the_handler);\r\n};\r\nconst isSelectionProperty = (target: any, propertyKey: string) => {\r\n    let meta = Reflect.getMetadata(selectionPropertyMetadataKey, target, propertyKey);\r\n    if (!meta) {\r\n        meta = Reflect.getMetadata(selectionPropertyMetadataKey, target, `_${propertyKey}`);\r\n    }\r\n    return meta;\r\n};\r\n// these are exported functions so that other classes can use similar\r\n// s11n/des11n functionality.\r\nexport function GET_EXTERNAL() {\r\n    let ext = {\r\n        // see comment below on $class property\r\n        //$class: this.constructor.name\r\n    };\r\n    Object.keys(this).forEach(key => {\r\n        let handler = isSelectionProperty(this, key);\r\n        if (handler) {\r\n            let v = this[key];\r\n            if (/^_/.test(key)) {\r\n                key = key.substring(1);\r\n            }\r\n            if (Array.isArray(v)) {\r\n                ext[key] = v.map(d => handler.ser(d));\r\n            } else {\r\n                ext[key] = handler.ser(v);\r\n            }\r\n        }\r\n    });\r\n    return ext;\r\n};\r\nexport function SET_EXTERNAL(o) {\r\n    Object.keys(o).forEach(key => {\r\n        let handler = isSelectionProperty(this, key);\r\n        if (handler) {\r\n            let v = o[key];\r\n            if (typeof (v) !== 'undefined') {\r\n                if (Array.isArray(v)) {\r\n                    this[key] = v.map(d => handler.des(d));\r\n                } else {\r\n                    this[key] = handler.des(v);\r\n                }\r\n            } else {\r\n                this[key] = undefined;\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nexport const REJECT_INVALID_SELECTION = 'invalid selection';\r\n\r\n/**\r\n * Base class for visualization selection (user input).  A VisSelection is attached\r\n * to a specific visualization and the selection itself sends events to the visualization\r\n * to tell it when meaningful changes have happened and it should reset/redraw or update.\r\n *\r\n * The utility methods reset/redraw/update send instructions to the visualization.  These\r\n * functions can be called at any time, even before the selection has been wired to its\r\n * visualization.  Events will be held onto and delivered if/when the visualization has\r\n * subscribed.\r\n *\r\n * Note: EventEmitter does not have an unsubscribe (though it, today, extends RxJs Subject)\r\n * so technically does.  Should perhaps consider not extending Angular's EventEmitter\r\n * \r\n * Note: Within the current set of visualizations there are two distinct ways that events\r\n * are triggered.  Earlier visualizations would have controls populate values on a selection\r\n * and then based on knowledge about how the visualization worked the controls themselves\r\n * would call update or redraw.  This meant that controls contained more logic and more\r\n * internal knowledge about how a specific visualization functions (which properties might\r\n * just alter the appearance of a visualization, redraw, versus what type of change might\r\n * require the visualization to go back to the server to get new data).  Newer visualization\r\n * implementations move that knowledge into the selection via the use of setters/getters\r\n * which can simplify controls many times simply allowing them to use two-way data binding\r\n * between a control and the selection itself.  The `pause`/`resume` functionality was added\r\n * to help with these types of implementations when special cases arise to avoid any attached\r\n * visualization components from doing work (e.g. population of defaults or cooperating\r\n * selection properties)\r\n * \r\n * @todo review use of `editMode` flag to see if it can be removed (maybe using `pause`/`resume` instead).\r\n * \r\n * @dynamic\r\n */\r\nexport abstract class VisSelection extends EventEmitter<VisSelectionEvent> {\r\n    /**\r\n     * Sub-classes set to true if they support export to POP\r\n     * Must also implement `toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput>`\r\n     */\r\n    $supportsPop:boolean = false;\r\n    /*\r\n    Note: Previously this.class.name was used when serializing a selection to JSON.\r\n    This does not work in production mode because of JavaScript minification.\r\n    So instead making this explicit.  All concrete VisSelection classes need to\r\n    add the $class @selectionProperty() and put their class name within it.\r\n     */\r\n    @selectionProperty()\r\n    $class: string = 'VisSelection';\r\n    @selectionProperty()\r\n    guid: string = newGuid();\r\n    @selectionProperty()\r\n    meta: any = {}; // a place for non selection specific info to be held\r\n    debug: boolean = false;\r\n    working: boolean = false;\r\n    // this flag is not persisted but can be used by a visualization if it\r\n    // would like to have a control pick \"default state\" while the visualization\r\n    // is being built.\r\n    editMode: boolean = false;\r\n    updateSent: boolean = false;\r\n    private _paused:boolean = false;\r\n    [x: string]: any;\r\n\r\n    readonly INVALID_SELECTION = REJECT_INVALID_SELECTION;\r\n\r\n    private lastEmit: any = {};\r\n    private firstSubscriberResolver: any;\r\n    private firstSubscriber: Promise<any> = new Promise<any>((resolve) => {\r\n        this.firstSubscriberResolver = resolve;\r\n    });\r\n\r\n    get external() { return GET_EXTERNAL.apply(this, arguments); }\r\n    set external(o) {\r\n        this.pause();\r\n        try {\r\n            SET_EXTERNAL.apply(this, arguments);\r\n        } finally {\r\n            this.resume();\r\n        }\r\n    }\r\n\r\n    /** @returns {boolean} true if events are paused. */\r\n    isPaused():boolean { return this._paused; }\r\n    /** Pauses even propagation so update/redraw, etc. will have no effect until resumed. */\r\n    pause() { this._paused = true; }\r\n    /** Resumes event propagation. */\r\n    resume() { this._paused = false; }\r\n\r\n    /**\r\n     * Instruct the visualization to go back to a \"clean\" slate\r\n     */\r\n    reset(): void {\r\n        this.emit(VisSelectionEvent.RESET);\r\n    }\r\n\r\n    /**\r\n     * Instruct the visualization to redraw itself using the data it already\r\n     * has and the current state of the selection.\r\n     * Will do nothing if the selection is not valid.\r\n     * If an update has not been sent yet then redraw will cause an update.\r\n     */\r\n    redraw(): void {\r\n        if(this.isValid()) {\r\n            if(!this.updateSent) {\r\n                this.update();\r\n            } else {\r\n                this.emit(VisSelectionEvent.REDRAW);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instruct the visualization to go get new data and reset/redraw itself.\r\n     * Will do nothing if the selection is not valid.\r\n     */\r\n    update(): void {\r\n        if(this.isValid()) {\r\n            this.emit(VisSelectionEvent.UPDATE);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instruct the visualization to resize itself.\r\n     */\r\n    resize(): void {\r\n        this.emit(VisSelectionEvent.RESIZE);\r\n    }\r\n\r\n    abstract isValid(): boolean;\r\n\r\n    protected handleError(e?: any): void {\r\n        console.error(e);\r\n        this.working = false;\r\n    }\r\n\r\n    // make sure no events go out until there is at least one subscriber to receive them.\r\n    emit(value?: VisSelectionEvent) {\r\n        if(this._paused) {\r\n            return;\r\n        }\r\n        var self = this,\r\n            emitArgs = arguments,\r\n            thisEmit: any = {\r\n                value: value,\r\n                when: Date.now(),\r\n                ext: JSON.stringify(this.external)\r\n            };\r\n        // throttle events on emit rather than requiring subscribers to do this.\r\n        // i.e. if the event being emitted differs from the last event emitted it\r\n        // always gets through.  events get pruned out if they are not distinct\r\n        // and happen within the specific interval\r\n        // e.g.\r\n        // selection.update(); selection.update(); selection.update();\r\n        // only the first will get through\r\n        // but selection.update() setTimeout(() => selection.update(),600);\r\n        // both will get through\r\n        if (this.lastEmit.value !== thisEmit.value || this.lastEmit.ext !== thisEmit.ext || this.lastEmit.when < (thisEmit.when - 500)) {\r\n            this.lastEmit = thisEmit;\r\n            console.log('letting event through', thisEmit/*, new Error(`${thisEmit.value}: stack trace`)*/);\r\n            this.firstSubscriber.then(() => {\r\n                super.emit.apply(self, emitArgs);\r\n                if(thisEmit.value === VisSelectionEvent.UPDATE) {\r\n                    this.updateSent = true;\r\n                }\r\n            });\r\n        } else {\r\n            console.log('pruned out redundant event', thisEmit);\r\n        }\r\n    }\r\n\r\n    subscribe(generatorOrNext?: any, error?: any, complete?: any): any {\r\n        // resolve the above promise..\r\n        this.firstSubscriberResolver();\r\n        return super.subscribe.apply(this, arguments);\r\n    }\r\n}\r\n\r\n/**\r\n * Selections may produce if they support export via the POP.\r\n * Selections need only supply start/endDate formatted `YYYY-MM-DD` \r\n */\r\nexport interface POPInput {\r\n    downloadType: string;\r\n    searchSource: string;\r\n    rangeType: string;\r\n\r\n    dataPrecision?: number;\r\n\r\n    startDate?: string;\r\n    startYear?: number;\r\n    startMonth?: string;\r\n    startDay?: number;\r\n\r\n    endDate?: string;\r\n    endYear?: string;\r\n    endMonth?: string;\r\n    endDay?: number;\r\n\r\n    species?: number[];\r\n    phenophases?: number[];\r\n    partnerGroups?: number[];\r\n    stations?: number[];\r\n}\r\n\r\nexport interface SupportsPOPInput {\r\n    toPOPInput(input?:POPInput):Promise<POPInput>;\r\n}\r\n\r\nconst MONTHS = [\r\n    'January','February','March','April','May','June',\r\n    'July','August','September','October','November','December'\r\n];\r\n/**\r\n * Takes values for `start|endDate` and fills in the values for\r\n * `start|endYear|Month|Day`\r\n * \r\n * @param input \r\n */\r\nexport function completePOPDates(input:POPInput):POPInput {\r\n    const toParts = d => {\r\n        let [year,month,day] = d.split('-').map(p => parseInt(p));\r\n        month = MONTHS[month-1];\r\n        return {year,month,day};\r\n    };\r\n    ['start','end'].forEach(prefix => {\r\n        const date = input[`${prefix}Date`];\r\n        if(date) {\r\n            const parts = toParts(date);\r\n            input[`${prefix}Year`] = parts.year;\r\n            input[`${prefix}Month`] = parts.month;\r\n            input[`${prefix}Day`] = parts.day;\r\n        }\r\n    });\r\n    return input;\r\n}\r\n\r\nexport const BASE_POP_INPUT:POPInput = {\r\n    downloadType: 'selectable',\r\n    searchSource: 'visualization-tool',\r\n    rangeType: 'Calendar'\r\n};\r\n\r\n/**\r\n * The mode of a given SelectionGroup\r\n */\r\nexport enum SelectionGroupMode {\r\n    /** The group represents the data gathered by a network. */\r\n    NETWORK = \"N\",\r\n    /** The group represents the data gathered by a single station. */\r\n    STATION = \"S\",\r\n    /** The group represents the data gathered by stations within a radius of a network (specifically a network with a known boundary). */\r\n    OUTSIDE = \"O\"\r\n};\r\n\r\n/**\r\n * Represents a selection group when performing visualization comparisons between\r\n * stations and networks.\r\n */\r\nexport interface SelectionGroup {\r\n    /** The label representing this selection group */\r\n    label: string;\r\n    /** The mode of this selection group. */\r\n    mode: SelectionGroupMode;\r\n    /** The network or station id of this selection group. */\r\n    id?: number;\r\n    /** If mode === NETWORK an optional list of station ids to exclude from the network. */\r\n    excludeIds?: number[];\r\n    /** If mode === OUTSIDE the radius outside of the network to gather stations. */\r\n    outsideRadiusMiles?: number;\r\n}\r\n\r\n/**\r\n * The pairing of a single SelectionGroup with the HttpParams that\r\n * will be used to fetch its data.\r\n */\r\nexport interface GroupHttpParams {\r\n    group: SelectionGroup;\r\n    params: HttpParams;\r\n}\r\n\r\n/**\r\n * @dynamic\r\n */\r\nexport abstract class NetworkAwareVisSelection extends VisSelection implements SupportsPOPInput {\r\n    @selectionProperty()\r\n    _networkIds?: number[] = [];\r\n    @selectionProperty()\r\n    _groups?: SelectionGroup[];\r\n\r\n    constructor(protected networkService:NetworkService){\r\n        super();\r\n    }\r\n\r\n    set networkIds(ids:number[]) {\r\n        this._networkIds = ids;\r\n        this.emit(VisSelectionEvent.SCOPE_CHANGE);\r\n    }\r\n\r\n    get networkIds():number[] {\r\n        return this._networkIds;\r\n    }\r\n\r\n    set groups(groups:SelectionGroup[]) {\r\n        this._groups = groups;\r\n        this.emit(VisSelectionEvent.SCOPE_CHANGE);\r\n    }\r\n\r\n    get groups():SelectionGroup[] {\r\n        return this._groups;\r\n    }\r\n\r\n    /**\r\n     * Fetches the list of station ids associated with a `Selectiongroup`\r\n     * \r\n     * @param group The group\r\n     */\r\n    private getStationIdsForGroup(group:SelectionGroup):Promise<number[]> {\r\n        switch(group.mode) {\r\n            case SelectionGroupMode.STATION:\r\n                return Promise.resolve([group.id]);\r\n            case SelectionGroupMode.NETWORK:\r\n                // translate the network to its underlying stations\r\n                return this.networkService.getStations(group.id)\r\n                    // just need the station_ids\r\n                    .then((stations:Station[]) => stations.map(s => s.station_id))\r\n                    // exclude any stations the group excludes\r\n                    .then((ids:number[]) => ids.filter(id => (group.excludeIds||[]).indexOf(id) === -1));\r\n            case SelectionGroupMode.OUTSIDE:\r\n                return this.networkService.getNearbyStationIds(group.id,group.outsideRadiusMiles);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * If the `groups` property is set then the output of this function will be\r\n     * the compilation of all the station ids that are part of the corresponding\r\n     * groups, otherwise it will be based upon any networkIds set.\r\n     */\r\n    getStationIds():Promise<number []> {\r\n        return !!this.groups && this.groups.length > 0\r\n            ? Promise.all(this.groups.map(group => this.getStationIdsForGroup(group)))\r\n                .then((list) => list.reduce((ids,idList) => {\r\n                    idList.forEach(id => {\r\n                        if(ids.indexOf(id) === -1) {\r\n                            ids.push(id);\r\n                        }\r\n                    });\r\n                    return ids;\r\n                },[]))\r\n            : this.networkIds && this.networkIds.length\r\n            ? this.networkService.getStations(this.networkIds)\r\n                .then(stations => stations.map(s => s.station_id))\r\n            : Promise.resolve([]);\r\n    }\r\n\r\n    /**\r\n     * If the `groups` property is set then no `station_id` parameters will\r\n     * be populated on the base `HttpParams` since separate requests will need to\r\n     * be issued for group data and `toGroupHttpParams` must be called to build those\r\n     * request parameters.\r\n     * \r\n     * @param params The HttpParams (optional)\r\n     */\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        return !!this.groups && this.groups.length > 0\r\n            ? Promise.resolve(params)\r\n            // translate any network_ids into station_ids\r\n            : this.getStationIds()\r\n                  .then(sids => sids.reduce((params,id,i) => params.set(`station_id[${i}]`, `${id}`),params));\r\n    }\r\n    \r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        input.partnerGroups = this.networkIds && this.networkIds.length\r\n            ? this.networkIds.slice()\r\n            : undefined;\r\n        return Promise.resolve(input);\r\n    }\r\n\r\n    /**\r\n     * Removes any station_id[n] parameters from a set of HttpParams.\r\n     * \r\n     * @param params The params to remove parameters from\r\n     */\r\n    protected resetStationIdParams(params: HttpParams):HttpParams {\r\n        params.keys()\r\n            .filter(key => /^station_id\\[\\d+\\]$/.test(key))\r\n            .forEach(key => params = params.delete(key));\r\n        return params;\r\n    }\r\n\r\n    /**\r\n     * Multiplies out a set of HttpParams by the value of the groups property.\r\n     * This function should NOT be called if the groups property is not set or empty (will result in a rejected Promise).\r\n     * \r\n     * @todo Implement SelectionGroupMode.OUTSIDE support\r\n     * @param params The params to multiply out by groups\r\n     */\r\n    toGroupHttpParams(params: HttpParams = new HttpParams()): Promise<GroupHttpParams[]> {\r\n        if(!this.groups || !this.groups.length) {\r\n            return Promise.reject('selection has no SelectionGroups defined');\r\n        }\r\n        // to be safe clean out any station_id parameters that might have been set\r\n        const resetParams = this.resetStationIdParams(params);\r\n        const promises:Promise<GroupHttpParams>[] = this.groups.map(group =>this.getStationIdsForGroup(group)\r\n            .then((ids:number[]) => {\r\n                params = ids.reduce((params,id,i) => params.set(`station_id[${i}]`,`${id}`),resetParams);\r\n                return ({group,params});\r\n            }));\r\n        return Promise.all(promises);\r\n    }\r\n}\r\n\r\nexport interface PredefinedBoundarySelection {\r\n    id: number;\r\n    boundaryName: string;\r\n    typeId: number;\r\n    boundaryTypeName: string;\r\n}\r\n\r\nexport interface PolygonBoundarySelection {\r\n    data: number[][];\r\n}\r\n\r\nexport type BoundarySelection = PredefinedBoundarySelection | PolygonBoundarySelection;\r\n\r\nexport function isPredefinedBoundarySelection(o:any):boolean {\r\n    return typeof(o.id) === 'number' &&\r\n        typeof(o.typeId) === 'number' &&\r\n        typeof(o.boundaryName) === 'string' &&\r\n        typeof(o.boundaryTypeName) === 'string';\r\n}\r\n\r\nexport function isPolygonBoundarySelection(o:any):boolean {\r\n    return Array.isArray(o.data) &&\r\n        o.data.length &&\r\n        Array.isArray(o.data[0]) &&\r\n        o.data[0].length === 2 &&\r\n        typeof(o.data[0][0]) === 'number';\r\n}\r\n\r\n/**\r\n * @dynamic\r\n */\r\nexport abstract class StationAwareVisSelection extends NetworkAwareVisSelection {\r\n    @selectionProperty()\r\n    _personId;\r\n    @selectionProperty()\r\n    _groupId;\r\n    @selectionProperty()\r\n    _stationIds?: any[] = [];\r\n    @selectionProperty()\r\n    _boundaries:BoundarySelection[];\r\n\r\n    constructor(protected serviceUtils:NpnServiceUtils,protected networkService:NetworkService) {\r\n        super(networkService);\r\n    }\r\n\r\n    set stationIds(ids:any[]) {\r\n        this._stationIds = ids;\r\n        this.emit(VisSelectionEvent.SCOPE_CHANGE);\r\n    }\r\n    get stationIds():any[] {\r\n        return this._stationIds;\r\n    }\r\n\r\n    get personId():any {\r\n        return this._personId;\r\n    }\r\n    set personId(id:any) {\r\n        const orig = this._personId;\r\n        if((this._personId = id) != orig) {\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    get groupId():any {\r\n        return this._groupId;\r\n    }\r\n\r\n    set groupId(id:any) {\r\n        const orig = this._groupId;\r\n        if((this._groupId = id) != orig) {\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    get boundaries():BoundarySelection[] {\r\n        return this._boundaries||[];\r\n    }\r\n\r\n    set boundaries(boundaries:BoundarySelection[]) {\r\n        this._boundaries = boundaries;\r\n        this.update();\r\n    }\r\n\r\n    protected getStationIdPromises():Promise<number[]>[] {\r\n        const baseParams:any = {};\r\n        if(this.personId) {\r\n            baseParams.person_id = this.personId;\r\n        }\r\n        if(this.groupId) {\r\n            baseParams.group_id = this.groupId;\r\n        }\r\n        const promises = this.boundaries.map(b => {\r\n            if((b as any).data) {\r\n                const polySelection = b as PolygonBoundarySelection;\r\n                const polygon = polySelection.data.slice();\r\n                polygon.push(polySelection.data[0]); // close the loop\r\n                return this.serviceUtils.cachedGet(\r\n                        this.serviceUtils.apiUrl('/npn_portal/stations/getStationsByLocation.json'),\r\n                        {...baseParams,wkt: 'POLYGON(('+polygon.map(pair => `${pair[1]} ${pair[0]}`).join(',')+'))'}\r\n                    )\r\n                    .then(response => response.map(s => s.station_id))\r\n            }\r\n            const predefSelection = b as PredefinedBoundarySelection;\r\n            return this.serviceUtils.cachedGet(\r\n                this.serviceUtils.apiUrl('/npn_portal/stations/getStationsForBoundary.json'),\r\n                {...baseParams,boundary_id:predefSelection.id}\r\n            );\r\n        });\r\n        // If this selection has an explicit list of stationIds then return them and ignore any\r\n        // the parent class might supply by virtue of the value of the networkIds property.\r\n        // It is assumed that if they are set AND the parent has a list of networkIds\r\n        // that the list of stationIds is a subset of stations within the parent's networks\r\n        if(this.stationIds && this.stationIds.length) {\r\n            promises.push(Promise.resolve(this.stationIds.slice()));\r\n        } else {\r\n            promises.push(super.getStationIds());\r\n        }\r\n        return promises;\r\n    }\r\n\r\n    getStationIds():Promise<number []> {\r\n        return Promise.all(this.getStationIdPromises())\r\n            .then(results => results.reduce((ids,stationIds) => ids.concat(stationIds),[]))\r\n    }\r\n\r\n    toURLSearchParams(params: HttpParams = new HttpParams()): Promise<HttpParams> {\r\n        return super.toURLSearchParams(params)\r\n            .then(params => this.personId ? params.set('person_id',`${this.personId}`) : params)\r\n            .then(params => this.groupId ? params.set('group_id',`${this.groupId}`) : params)\r\n            .then(params => {\r\n                // note: in case the parent's implementation of toURLSearchParams included station_ids parameters we need\r\n                // to unset them and replace them with any this class generates (which may include or exclude those supplied\r\n                // by the parent)\r\n                params = this.resetStationIdParams(params);\r\n                return this.getStationIds().then(results => {\r\n                    results.forEach((id,i) => params = params.set(`station_id[${i}]`, `${id}`));\r\n                    return params;\r\n                })\r\n            });\r\n    }\r\n\r\n    toPOPInput(input:POPInput = {...BASE_POP_INPUT}):Promise<POPInput> {\r\n        return super.toPOPInput(input)\r\n            .then(input => Promise.all(this.getStationIdPromises())\r\n                .then(results => {\r\n                    input.stations = results.reduce((ids,stationIds) => ids.concat(stationIds),[]);\r\n                    return input;\r\n                }));\r\n    }\r\n}\r\n","import { Input, ElementRef } from '@angular/core';\r\n\r\nimport { detectIE, MonitorsDestroy } from '../common';\r\nimport { VisSelection, VisSelectionEvent, REJECT_INVALID_SELECTION } from './vis-selection';\r\n\r\nimport { fromEvent } from 'rxjs';\r\nimport { debounceTime, takeUntil } from 'rxjs/operators';\r\n\r\nimport { MediaChange, ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nexport const DEFAULT_MARGINS: VisualizationMargins = { top: 20, right: 30, bottom: 60, left: 40 };\r\nexport const FONT_SIZE: number = 14;\r\nexport const FONT_SIZE_PX: string = FONT_SIZE + 'px';\r\n\r\n/*\r\nIMPORTANT: There is a rather annoying chicken and egg problem with angular\r\ndevelopment vs production builds.  This \"component\" originally took full\r\nadvantage of language features and was properly abstract, works great in dev.\r\nProduction builds wouldn't allow this.  They'd complain about the component\r\nnot being registered, comment out the @Component annotation and dev builds\r\nthen fail.\r\n\r\n@Component({\r\n  selector: 'visualization-base',\r\n  template: '\"abstract\" component'\r\n})\r\n*/\r\nexport class VisualizationBaseComponent extends MonitorsDestroy {\r\n    @Input()\r\n    selection: VisSelection;\r\n    @Input()\r\n    thumbnail: boolean = false;\r\n\r\n    id: string = 'visualization-' + Math.floor(Math.random() * 1000);\r\n\r\n    sizing: VisualizationSizing;\r\n    clazz: string = 'visualization ' + this.constructor.name;\r\n\r\n    margins: VisualizationMargins = { top: 0, right: 0, left: 0, bottom: 0 };\r\n    mobileMode: boolean = false;\r\n\r\n    protected isIE: boolean;\r\n\r\n    constructor(protected rootElement: ElementRef, protected media: ObservableMedia) {\r\n        super();\r\n        this.media.asObservable().pipe(takeUntil(this.componentDestroyed))\r\n            .subscribe((mediaChange: MediaChange) => this.mobileMode = mediaChange.mqAlias === 'xs' || mediaChange.mqAlias === 'sm');\r\n        this.isIE = !!detectIE();\r\n    }\r\n\r\n    /**\r\n     * Calculates the dimensions (width based) that the visualization should\r\n     * be drawn to fit properly within the parent element.\r\n     */\r\n    getSizeInfo(minWidth?: number): VisualizationSizing {\r\n        let native = this.rootElement.nativeElement as HTMLElement,\r\n            parent = native.parentElement as HTMLElement,\r\n            ratioMult = 0.5376, // ratio based on initial w/h of 930/500\r\n            strToPx = s => parseInt(s.replace(/px$/, '')),\r\n            style = getComputedStyle(parent, null),\r\n            minusLeft = strToPx(style.paddingLeft) + strToPx(style.borderLeftWidth),\r\n            minusRight = strToPx(style.paddingRight) + strToPx(style.borderRightWidth),\r\n            innerWidth = parent.clientWidth - minusLeft - minusRight,\r\n            margin = this.margins,\r\n            cw = Math.floor(innerWidth),\r\n            scaledWidth = cw;\r\n        if (minWidth && cw < minWidth) {\r\n            cw = minWidth;\r\n        }\r\n        let ch = Math.floor(cw * ratioMult),\r\n            w = cw - margin.left - margin.right,\r\n            h = ch - margin.top - margin.bottom;\r\n        if (isNaN(w)) {\r\n            w = 0;\r\n        }\r\n        if (isNaN(h)) {\r\n            h = 0;\r\n        }\r\n        return (this.sizing = { scaledWidth: scaledWidth, width: w, height: h, margin: margin });\r\n    }\r\n\r\n    /**\r\n     * `reset` is intended to initialize a visualziation to it's known \"clean\" state\r\n     * placing all common elements, etc.  Subclasses will almost certainly over-ride\r\n     * this implementation and call it to get the ball rolling.\r\n     *\r\n     * No asynchronous work should be done here, fetching data, etc. should happen\r\n     * only within `update`.\r\n     */\r\n    protected reset(): void { throw new Error('abstract'); }\r\n\r\n    /**\r\n     * Called when the visualization should be redrawn from data already in hand\r\n     * using the current state of the selection.\r\n     */\r\n    protected redraw(): void { throw new Error('abstract'); }\r\n\r\n    /**\r\n     * Called when the visualization should go get new clean data, based on its\r\n     * selection, and reset/redraw itself.\r\n     */\r\n    protected update(): void { throw new Error('abstract'); }\r\n\r\n    /**\r\n     * Called when the visualization should resize itself.\r\n     */\r\n    protected resize(): void { throw new Error('abstract'); }\r\n\r\n    ngAfterViewInit() {\r\n        console.debug('visualization.ngAfterViewInit');\r\n        // redraw and update the visualization on window re-size, debounce\r\n        // to avoid rapid redraws as the window is resized\r\n        // NOTE: there may be some stupid issue with IE11 and the window\r\n        // resize event.  Could perhaps use the @HostListener route below but\r\n        // that should then implement its own debounce (via setTimeout)\r\n        // and they seem to want to push the use of RxJs so this kind of thing\r\n        // feels cleaner.\r\n        fromEvent(window, 'resize').pipe(debounceTime(500),takeUntil(this.componentDestroyed))\r\n            .subscribe(() => {\r\n                try {\r\n                    this.resize()\r\n                } catch (resizeE) {\r\n                    console.error('error during resize',resizeE);\r\n                }\r\n            });\r\n\r\n        // now that we're prepared to start listening to our selection for\r\n        // VisSelectionEvents.\r\n        this.selection\r\n            .pipe(takeUntil(this.componentDestroyed))\r\n            .subscribe((event) => {\r\n                switch (event) {\r\n                    case VisSelectionEvent.RESET:\r\n                        return this.reset();\r\n                    case VisSelectionEvent.REDRAW:\r\n                        return this.redraw();\r\n                    case VisSelectionEvent.UPDATE:\r\n                        return this.update();\r\n                    case VisSelectionEvent.RESIZE:\r\n                        return this.resize();\r\n                }\r\n            });\r\n    }\r\n\r\n    /* a way of capturing window events...\r\n    @HostListener('window:resize',['$event'])\r\n    onResize(event) {\r\n        this.redraw();\r\n    }*/\r\n\r\n    protected handleError(e?: any): void {\r\n        if (e && e !== REJECT_INVALID_SELECTION) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\nexport class VisualizationMargins {\r\n    top?: number;\r\n    right?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n}\r\n\r\nexport class VisualizationSizing {\r\n    scaledWidth?: number;\r\n    width: number;\r\n    height: number;\r\n    margin: VisualizationMargins;\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { faDownload } from '@fortawesome/pro-light-svg-icons';\r\n\r\nimport * as d3 from 'd3';\r\n\r\n@Component({\r\n    selector: 'visualization-download',\r\n    template: `\r\n    <div class=\"vis-download\">\r\n        <a href (click)=\"download($event)\" title=\"Download\"><fa-icon [icon]=\"faDownload\"></fa-icon></a>\r\n        <canvas id=\"dlcanvas-{{svgWrapperId}}\" style=\"display: none;\"></canvas>\r\n        <a id=\"dllink-{{svgWrapperId}}\" style=\"display: none;\">download</a>\r\n    </div>\r\n    `,\r\n    styles: [`\r\n        .vis-download {\r\n            height: 28px;\r\n            width: 28px;\r\n            position: absolute;\r\n            right: 0px;\r\n            margin: 10px;\r\n            font-size: 1.5em;\r\n        }\r\n        .vis-download >a {\r\n            color: #000;\r\n            &:hover {\r\n                color: #000;\r\n            }\r\n        }\r\n    `]\r\n})\r\nexport class VisualizationDownloadComponent {\r\n    faDownload = faDownload;\r\n    @Input() svgWrapperId: string;\r\n    @Input() filename: string;\r\n\r\n    download($event): void {\r\n        $event.preventDefault();\r\n\r\n        let svg = document.querySelector(`#${this.svgWrapperId} >svg`) as SVGElement,\r\n            wrappedSvg = d3.select(svg);\r\n        wrappedSvg.attr('version', 1.1)\r\n            .attr('xmlns', 'http://www.w3.org/2000/svg');\r\n        let parent = svg.parentNode as HTMLElement,\r\n            html = parent.innerHTML;\r\n        // see here (the unicode problem)\r\n        // https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\r\n        let htmlForBase64 = encodeURIComponent(html).replace(/%([0-9A-F]{2})/g,\r\n            function toSolidBytes(match, p1) {\r\n                return String.fromCharCode(<any>'0x' + p1);\r\n            });\r\n        let imgsrc = 'data:image/svg+xml;base64,' + window.btoa(htmlForBase64),\r\n            canvas = document.querySelector(`#dlcanvas-${this.svgWrapperId}`) as HTMLCanvasElement,\r\n            link = document.querySelector(`#dllink-${this.svgWrapperId}`) as HTMLAnchorElement;\r\n        canvas.width = +wrappedSvg.attr('width');\r\n        canvas.height = +wrappedSvg.attr('height');\r\n\r\n        let context = canvas.getContext('2d'),\r\n            image = new Image();\r\n        image.onload = () => {\r\n            context.drawImage(image, 0, 0);\r\n            let canvasdata = canvas.toDataURL('image/png');\r\n            link.download = this.filename;\r\n            link.href = canvasdata;\r\n            link.click();\r\n        };\r\n        image.src = imgsrc;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { VisSelection } from './vis-selection';\r\nimport { ScatterPlotSelection, ScatterPlotSelectionFactory } from './scatter-plot';\r\nimport { CalendarSelection, CalendarSelectionFactory } from './calendar';\r\nimport { ActivityCurvesSelection, ActivityCurvesSelectionFactory } from './activity-curves';\r\nimport { ObserverActivitySelection, ObserverActivitySelectionFactory } from './observer-activity';\r\nimport { ObservationFrequencySelection, ObservationFrequencySelectionFactory } from './observation-frequency';\r\nimport { ClippedWmsMapSelection, ClippedWmsMapSelectionFactory } from './clipped-wms-map';\r\nimport { MapSelectionFactory, MapSelection } from './map';\r\nimport { AgddTimeSeriesSelection, AgddTimeSeriesSelectionFactory } from './agdd-time-series';\r\n\r\n@Injectable()\r\nexport class VisualizationSelectionFactory {\r\n    private factoryMap:any = {};\r\n\r\n    constructor(private calendar: CalendarSelectionFactory,\r\n                private scatter: ScatterPlotSelectionFactory,\r\n                private activity: ActivityCurvesSelectionFactory,\r\n                private observer: ObserverActivitySelectionFactory,\r\n                private observationFreq: ObservationFrequencySelectionFactory,\r\n                private clippedWmsMap: ClippedWmsMapSelectionFactory,\r\n                private map: MapSelectionFactory,\r\n                private agddTime:AgddTimeSeriesSelectionFactory\r\n\r\n    ) {\r\n        this.factoryMap.CalendarSelection = calendar;\r\n        this.factoryMap.ScatterPlotSelection = scatter;\r\n        this.factoryMap.ActivityCurvesSelection = activity;\r\n        this.factoryMap.ObserverActivitySelection = observer;\r\n        this.factoryMap.ObservationFrequencySelection = observationFreq;\r\n        this.factoryMap.ClippedWmsMapSelection = clippedWmsMap;\r\n        this.factoryMap.MapSelection = map;\r\n        this.factoryMap.AgddTimeSeriesSelection = agddTime;\r\n    }\r\n\r\n    newCalendarSelection():CalendarSelection {\r\n        return this.calendar.newSelection();\r\n    }\r\n\r\n    newScatterPlotSelection():ScatterPlotSelection {\r\n        return this.scatter.newSelection();\r\n    }\r\n\r\n    newActivityCurvesSelection():ActivityCurvesSelection {\r\n        return this.activity.newSelection();\r\n    }\r\n\r\n    newObserverActivitySelection():ObserverActivitySelection {\r\n        return this.observer.newSelection();\r\n    }\r\n    \r\n    newObservationFrequencySelection(): ObservationFrequencySelection {\r\n        return this.observationFreq.newSelection();\r\n    }\r\n\r\n    newClippedWmsMapSelection(): ClippedWmsMapSelection {\r\n        return this.clippedWmsMap.newSelection();\r\n    }\r\n\r\n    newMapSelection(): MapSelection {\r\n        return this.map.newSelection();\r\n    }\r\n\r\n    newAgddTimeSeriesSelection(): AgddTimeSeriesSelection {\r\n        return this.agddTime.newSelection();\r\n    }\r\n\r\n    cloneSelection(selection:VisSelection): VisSelection {\r\n        return this.newSelection(selection.external);\r\n    }\r\n\r\n    newSelections(selections:any[]): VisSelection[] {\r\n        return selections.map(s => this.newSelection(s));\r\n    }\r\n\r\n    newSelection(selection:any): VisSelection {\r\n        if(!this.factoryMap[selection.$class]) {\r\n            throw new Error(`Unknown selection type \"${selection.$class}\"`);\r\n        }\r\n        let s:VisSelection = this.factoryMap[selection.$class].newSelection();\r\n        s.external = selection;\r\n        return s\r\n    }\r\n}\r\n","import {Component,Input,OnInit} from '@angular/core';\r\n\r\nimport {VisSelection} from './vis-selection';\r\n\r\nimport {ScatterPlotSelection} from './scatter-plot';\r\nimport {CalendarSelection} from './calendar';\r\nimport {ActivityCurvesSelection} from './activity-curves';\r\nimport {ObserverActivitySelection} from './observer-activity';\r\nimport {ClippedWmsMapSelection} from './clipped-wms-map';\r\nimport {ObservationFrequencySelection} from './observation-frequency';\r\n\r\n// the idea here is that with Angular 2/4 there is no $compile functionality\r\n// so instead it's probably best to create an \"all knowing\" directive that\r\n// includes all possible visualizations and picks which to render based on\r\n// the type of selection it is given.\r\n@Component({\r\n    selector: 'npn-visualization',\r\n    template: `\r\n    <scatter-plot *ngIf=\"scatter\" [selection]=\"scatter\" [thumbnail]=\"thumbnail\"></scatter-plot>\r\n    <calendar *ngIf=\"calendar\" [selection]=\"calendar\"  [thumbnail]=\"thumbnail\"></calendar>\r\n    <activity-curves *ngIf=\"activity\" [selection]=\"activity\"  [thumbnail]=\"thumbnail\"></activity-curves>\r\n    <observer-activity *ngIf=\"observer\" [selection]=\"observer\" [thumbnail]=\"thumbnail\"></observer-activity>\r\n    <observation-frequency *ngIf=\"observationFreq\" [selection]=\"observationFreq\" [thumbnail]=\"thumbnail\"></observation-frequency>\r\n    <clipped-wms-map *ngIf=\"clippedWmsMap\" [selection]=\"clippedWmsMap\" [thumbnail]=\"thumbnail\"></clipped-wms-map>\r\n    <mat-expansion-panel *ngIf=\"selection.debug\">\r\n        <mat-expansion-panel-header>\r\n            <mat-panel-title>Selection</mat-panel-title>\r\n        </mat-expansion-panel-header>\r\n        <pre>{{selection.external | json}}</pre>\r\n    </mat-expansion-panel>\r\n    `,\r\n    styles: [`\r\n        pre {\r\n            font-family: \"courier new\";\r\n        }\r\n        mat-expansion-panel {\r\n            margin-top: 10px;\r\n        }\r\n    `]\r\n})\r\nexport class VisualizationComponent implements OnInit {\r\n    @Input()\r\n    thumbnail:boolean = false;\r\n\r\n    @Input()\r\n    selection: VisSelection;\r\n\r\n    scatter: ScatterPlotSelection;\r\n    calendar: CalendarSelection;\r\n    activity: ActivityCurvesSelection;\r\n    observer: ObserverActivitySelection;\r\n    observationFreq: ObservationFrequencySelection;\r\n    clippedWmsMap: ClippedWmsMapSelection;\r\n\r\n    ngOnInit() {\r\n        if(this.selection instanceof ScatterPlotSelection) {\r\n            this.scatter = this.selection;\r\n        } else if(this.selection instanceof CalendarSelection) {\r\n            this.calendar = this.selection;\r\n        } else if(this.selection instanceof ClippedWmsMapSelection) {\r\n            this.clippedWmsMap = this.selection;\r\n        } else if(this.selection instanceof ActivityCurvesSelection) {\r\n            this.activity = this.selection;\r\n        } else if(this.selection instanceof ObserverActivitySelection) {\r\n            this.observer = this.selection;\r\n        } else if (this.selection instanceof ObservationFrequencySelection) {\r\n            this.observationFreq = this.selection;\r\n        }\r\n    }\r\n}\r\n","/*\r\nNOTE: this is currently one BIG module that includes all the visualizations.\r\nthat's ok generally but it would be better to have each visualization be its own\r\nmodule that deals with its own dependencies so that they could be imported individually\r\ninto an application (and simplify this module's imports).\r\n\r\nsee the commented out start of such a module in ./clipped-wms-map\r\n\r\nprobably should be an activity for a later date, or if time permits.\r\n*/\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule,DatePipe } from '@angular/common';\r\nimport { FormsModule,ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { FontAwesomeModule } from '@fortawesome/angular-fontawesome';\r\n\r\nimport {VisualizationDownloadComponent} from './visualization-download.component';\r\n\r\nimport {ScatterPlotSelectionFactory,ScatterPlotComponent,ScatterPlotControls} from './scatter-plot';\r\nimport {CalendarSelectionFactory,CalendarComponent,CalendarControlComponent} from './calendar';\r\nimport {ActivityCurvesSelectionFactory,ActivityCurvesComponent,CurveControlComponent,ActivityCurvesControlComponent} from './activity-curves';\r\nimport {ClippedWmsMapComponent,ClippedWmsMapControl,ClippedWmsMapStatisticsComponent,ClippedStatValuePipe,ClippedWmsMapSelectionFactory} from './clipped-wms-map';\r\n//import {ClippedWmsMapVisModule} from './clipped-wms-map';\r\nimport {ObserverActivitySelectionFactory,ObserverActivityComponent,ObserverActivityControl} from './observer-activity';\r\nimport {ObservationFrequencySelectionFactory,ObservationFrequencyComponent,ObservationFrequencyControl} from './observation-frequency';\r\n\r\nimport {\r\n    MapSelectionFactory,\r\n    MapVisualizationComponent,\r\n    ExtentControl, ExtentDateControl, ExtentDoyControl, ExtentYearControl,\r\n    GriddedRangeSliderControl,\r\n    ConsolidatedMapLayerControlComponent,\r\n    PestMapLayerControlComponent,\r\n    TempAccumMapLayerControlComponent,\r\n    SpringIndexMapLayerControlComponent,\r\n    MapVisualizationMarkerIw\r\n} from './map';\r\n\r\nimport {\r\n  AgddTimeSeriesSelectionFactory,\r\n  AgddTimeSeriesComponent,\r\n  AgddTsMapLayerControl\r\n} from './agdd-time-series';\r\n\r\nimport {VisualizationComponent} from './visualization.component';\r\n\r\nimport {VisualizationSelectionFactory} from './visualization-selection-factory.service';\r\nimport {YearRangeInputComponent,HigherSpeciesPhenophaseInputComponent} from './common-controls';\r\n\r\nimport {MatFormFieldModule,MatButtonModule, MatCheckboxModule, MatSelectModule,MatRadioModule,\r\n        MatExpansionModule,MatAutocompleteModule,\r\n        MatInputModule, MatSliderModule, MatProgressBarModule, MatTooltipModule,\r\n        MatDatepickerModule, MatNativeDateModule, MAT_DATE_FORMATS } from '@angular/material';\r\nimport { Ng5SliderModule } from 'ng5-slider';\r\n\r\nimport {AgmCoreModule} from '@agm/core';\r\nimport { FlexLayoutModule } from '@angular/flex-layout';\r\n\r\nimport {NpnCommonModule} from '../common';\r\nimport {NpnGriddedModule} from '../gridded';\r\n\r\n@NgModule({\r\n  imports: [\r\n    /*BrowserAnimationsModule,\r\n    BrowserModule,*/\r\n    CommonModule,\r\n    FormsModule,ReactiveFormsModule,\r\n    FontAwesomeModule,\r\n    MatFormFieldModule,MatButtonModule, MatCheckboxModule,MatSelectModule,MatRadioModule,\r\n    MatExpansionModule,MatAutocompleteModule,\r\n    MatInputModule, MatSliderModule, MatProgressBarModule, MatTooltipModule, MatDatepickerModule,\r\n    MatNativeDateModule,\r\n    Ng5SliderModule,\r\n    AgmCoreModule,\r\n    FlexLayoutModule,\r\n    NpnCommonModule,NpnGriddedModule\r\n  ],\r\n  declarations: [\r\n      //VisualizationBaseComponent,SvgVisualizationBaseComponent,MapVisualizationBaseComponent,\r\n      ScatterPlotComponent,ScatterPlotControls,\r\n      CalendarComponent,CalendarControlComponent,\r\n      ActivityCurvesComponent,CurveControlComponent,ActivityCurvesControlComponent,\r\n      ObserverActivityComponent,ObserverActivityControl,\r\n      ObservationFrequencyComponent,ObservationFrequencyControl,\r\n      ClippedWmsMapComponent,ClippedWmsMapControl,ClippedWmsMapStatisticsComponent,ClippedStatValuePipe /* not exported */,\r\n      MapVisualizationComponent,\r\n      VisualizationDownloadComponent,\r\n      VisualizationComponent,\r\n      YearRangeInputComponent,\r\n      HigherSpeciesPhenophaseInputComponent,\r\n\r\n      ExtentControl, ExtentDateControl, ExtentDoyControl, ExtentYearControl,\r\n      GriddedRangeSliderControl,\r\n      ConsolidatedMapLayerControlComponent,PestMapLayerControlComponent,TempAccumMapLayerControlComponent,SpringIndexMapLayerControlComponent,MapVisualizationMarkerIw,\r\n      AgddTimeSeriesComponent, AgddTsMapLayerControl\r\n  ],\r\n  exports: [\r\n      ScatterPlotComponent,\r\n      ScatterPlotControls,\r\n      ActivityCurvesComponent,CurveControlComponent,ActivityCurvesControlComponent,\r\n      ObserverActivityComponent,ObserverActivityControl,\r\n      ObservationFrequencyComponent,ObservationFrequencyControl,\r\n      CalendarComponent,CalendarControlComponent,\r\n      ClippedWmsMapComponent,ClippedWmsMapControl,ClippedWmsMapStatisticsComponent,\r\n      MapVisualizationComponent,\r\n      VisualizationComponent,\r\n      HigherSpeciesPhenophaseInputComponent,\r\n      YearRangeInputComponent,\r\n      ExtentControl,\r\n      GriddedRangeSliderControl,\r\n      ConsolidatedMapLayerControlComponent,\r\n      AgddTimeSeriesComponent, AgddTsMapLayerControl\r\n  ],\r\n  providers: [\r\n      DatePipe,\r\n      // can inject a specific type of factory\r\n      ScatterPlotSelectionFactory,\r\n      CalendarSelectionFactory,\r\n      ClippedWmsMapSelectionFactory,\r\n      ActivityCurvesSelectionFactory,\r\n      ObserverActivitySelectionFactory,\r\n      ObservationFrequencySelectionFactory,\r\n      MapSelectionFactory,\r\n      AgddTimeSeriesSelectionFactory,\r\n      // OR one factory to rule them all\r\n      VisualizationSelectionFactory,\r\n      {provide: MAT_DATE_FORMATS, useValue: {\r\n        parse: { dateInput: null },\r\n        display: {\r\n          dateInput: {\r\n            year: \"numeric\",\r\n            month: \"long\",\r\n            day: \"numeric\"\r\n          },\r\n          monthYearLabel: {\r\n            year: \"numeric\",\r\n            month: \"long\"\r\n          },\r\n          dateA11yLabel: {\r\n            year: \"numeric\",\r\n            month: \"long\",\r\n            day: \"numeric\"\r\n          },\r\n          monthYearA11yLabel: {\r\n            year: \"numeric\",\r\n            month: \"long\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ]\r\n})\r\nexport class VisualizationsModule { }\r\n\r\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"./$$_lazy_route_resource lazy recursive\";","import {BrowserModule} from '@angular/platform-browser';\r\nimport {NgModule,enableProdMode} from '@angular/core';\r\nimport {HttpClientModule} from '@angular/common/http';\r\n\r\nimport {NpnLibModule,NpnCommonModule,VisualizationsModule,NPN_BASE_HREF,NpnConfiguration,NPN_CONFIGURATION} from '@npn/common';\r\n\r\nimport {FocalSpeciesComponent} from './focal-species.component';\r\nimport {FindingsComponent} from './findings.component';\r\nimport {ResourcesComponent} from './resources.component';\r\nimport {FwsDashboardComponent} from './fws-dashboard.component';\r\nimport {PhenologyTrailPartnersComponent} from './phenology-trail-partners.component';\r\nimport {NewVisualizationDialogComponent,NewVisualizationBuilderComponent} from './new-visualization-dialog.component';\r\nimport { RefugeVisualizationScopeSelectionComponent } from \"./refuge-visualization-scope-selection.component\";\r\nimport { PhenoTrailVisualizationScopeSelectionComponent } from './pheno-trail-visualization-scope-selection.component';\r\nimport { PhenoTrailVisualizationScopeGroupsComponent } from './pheno-trail-visualization-scope-groups.component';\r\nimport { PhenoTrailVisualizationScopeGroupComponent } from './pheno-trail-visualization-scope-group.component';\r\nimport { PhenoTrailVisualizationScopeStationGroupsComponent } from './pheno-trail-visualization-scope-station-groups.component';\r\n\r\nimport {EntityService} from './entity.service';\r\n\r\nimport {FormsModule,ReactiveFormsModule} from '@angular/forms';\r\nimport {BrowserAnimationsModule} from '@angular/platform-browser/animations';\r\nimport {MatCheckboxModule,MatGridListModule,MatCardModule,MatListModule,\r\n        MatTooltipModule,MatSnackBarModule,MatDialogModule,MatStepperModule,\r\n        MatButtonModule,MatRadioModule,MatProgressSpinnerModule,MatSelectModule,\r\n        MatInputModule,MatFormFieldModule,MatTabsModule,MatButtonToggleModule,MatIconModule} from '@angular/material';\r\n\r\nimport { FlexLayoutModule } from '@angular/flex-layout';\r\n\r\nimport { FontAwesomeModule } from '@fortawesome/angular-fontawesome';\r\n\r\nimport {environment} from '../environments/environment';\r\nimport {AgmCoreModule} from '@agm/core';\r\n\r\nimport {DndModule} from 'ng2-dnd';\r\n\r\nexport function baseHrefFactory() {\r\n        return window['npn_base_href'];\r\n}\r\nexport function npnConfigurationFactory() {\r\n        return window['npn_configuration'];\r\n}\r\n\r\n@NgModule({\r\n  declarations: [\r\n    FwsDashboardComponent,\r\n    PhenologyTrailPartnersComponent,\r\n    FocalSpeciesComponent,\r\n    FindingsComponent,\r\n    ResourcesComponent,\r\n    NewVisualizationBuilderComponent,\r\n    RefugeVisualizationScopeSelectionComponent,\r\n    PhenoTrailVisualizationScopeSelectionComponent,\r\n    PhenoTrailVisualizationScopeGroupsComponent,\r\n    PhenoTrailVisualizationScopeGroupComponent,\r\n    PhenoTrailVisualizationScopeStationGroupsComponent,\r\n    NewVisualizationDialogComponent\r\n  ],\r\n  entryComponents: [\r\n      NewVisualizationDialogComponent\r\n  ],\r\n  imports: [\r\n    BrowserAnimationsModule,\r\n    BrowserModule,\r\n    NpnLibModule,\r\n    VisualizationsModule,\r\n    NpnCommonModule,\r\n    HttpClientModule,\r\n    FormsModule,ReactiveFormsModule,\r\n    FontAwesomeModule,MatIconModule,\r\n    MatCheckboxModule,MatGridListModule,\r\n    MatCardModule,MatListModule,\r\n    MatTooltipModule,MatSnackBarModule,\r\n    MatDialogModule,MatStepperModule,\r\n    MatButtonModule,MatRadioModule,\r\n    MatProgressSpinnerModule,MatSelectModule,\r\n    MatInputModule,MatFormFieldModule,MatTabsModule,MatButtonToggleModule,\r\n    FlexLayoutModule,\r\n    AgmCoreModule.forRoot({\r\n        apiKey: environment.googleMapsApiKey\r\n    }),\r\n    DndModule.forRoot()\r\n  ],\r\n  bootstrap: [FwsDashboardComponent],\r\n  providers: [\r\n      EntityService,\r\n      {provide:NPN_BASE_HREF,useFactory:baseHrefFactory},\r\n      {provide:NPN_CONFIGURATION,useFactory:npnConfigurationFactory}\r\n  ]\r\n})\r\nexport class AppModule { }\r\n","import {Injectable} from '@angular/core';\r\n\r\nimport {HttpClient} from '@angular/common/http';\r\n\r\nimport {CacheService,VisualizationSelectionFactory,VisSelection} from '@npn/common';\r\n\r\n// using class instead of interface so can use instanceof\r\nexport class EntityBase {\r\n    id:string;\r\n    title:string;\r\n    selections:VisSelection[];\r\n    resources?:string;\r\n}\r\nexport class Refuge extends EntityBase {\r\n    network_id:number;\r\n    boundary_id:string;\r\n}\r\nexport class PhenologyTrail extends EntityBase {\r\n    network_ids:number[];\r\n}\r\n\r\n// this means that the app can no longer function outside of the context of Drupal, period.\r\nconst API_ROOT = '/api';\r\n\r\nexport enum DashboardMode {\r\n    REFUGE = 'refuge',\r\n    PHENO_TRAIL = 'phenology_trail'\r\n};\r\n\r\nexport const DashboardModeState = (function() {\r\n    let mode:DashboardMode = DashboardMode.REFUGE;\r\n    return {\r\n        get: ():DashboardMode => mode,\r\n        set: (m:DashboardMode) => mode = m,\r\n    };\r\n})();\r\n\r\n@Injectable()\r\nexport class EntityService {\r\n    constructor(private http: HttpClient,\r\n                protected cacheService: CacheService,\r\n                protected selectionFactory: VisualizationSelectionFactory) {\r\n    }\r\n\r\n    parseSelections(json:string):VisSelection[] {\r\n        let selections = this.selectionFactory.newSelections(JSON.parse(json));\r\n        /*\r\n        console.log('JSON',json);\r\n        console.log('SELECTIONS',selections);\r\n        */\r\n        return selections;\r\n    }\r\n\r\n    private apiUrl(entity_id) {\r\n        return `${API_ROOT}/${DashboardModeState.get()}/${entity_id}`;\r\n    }\r\n\r\n    private castEntity(entityId,apiResult:any):EntityBase {\r\n        // actually constructing an instance so that other classes can use instanceof\r\n        let entity;\r\n        switch(DashboardModeState.get()) {\r\n            case DashboardMode.REFUGE:\r\n                entity = new Refuge();\r\n                break;\r\n            case DashboardMode.PHENO_TRAIL:\r\n                entity = new PhenologyTrail();\r\n                break;\r\n            default:\r\n                throw new Error(`Unsupported DASHBOARD_MODE \"${DashboardModeState.get()}\"`);\r\n        }\r\n        Object.assign(entity,apiResult);\r\n        entity.id = entityId;\r\n        let selections = (entity.selections||[]).map(s => JSON.parse(s));\r\n        entity.selections = this.selectionFactory.newSelections(selections);\r\n        return entity;\r\n    }\r\n\r\n    get(entity_id):Promise<EntityBase> {\r\n        return this.http.get(this.apiUrl(entity_id))\r\n                .toPromise()\r\n                .then(response => this.castEntity(entity_id,response));\r\n    }\r\n\r\n    save(entity:EntityBase):Promise<EntityBase> {\r\n        let r = {...{},...entity} as any;\r\n        r.selections = (r.selections||[]).map(s => JSON.stringify(s.external) );\r\n        let json = JSON.stringify(r);\r\n        console.log(`JSON ${json}`);\r\n        return this.http.put(this.apiUrl(entity.id),json,{headers:{'Content-Type':'application/json'}})\r\n                .toPromise()\r\n                .then(response => this.castEntity(entity.id,response));\r\n    }\r\n}\r\n","module.exports = \":host {\\n  position: relative;\\n  display: block; }\\n  :host.adminMode {\\n    /* if were not in another container would simply be $admin-width\\r\\n           but the page content has its own padding so for now just picking\\r\\n           a value that works */\\n    padding-left: 275px; }\\n  @media (min-width: 992px) {\\n      :host.adminMode {\\n        padding-left: 215px; } }\\n  @media (min-width: 1200px) {\\n      :host.adminMode {\\n        padding-left: 200px; } }\\n  .visualizations {\\n  display: flex;\\n  flex-flow: row wrap; }\\n  .visualizations mat-card {\\n    margin: 10px auto;\\n    padding: 10px;\\n    flex: 0 1 95%;\\n    /* a non flex layout attempt\\r\\n        box-sizing: border-box;\\r\\n        width: 100%;\\r\\n        padding: 2px;\\r\\n        margin: 10px 0px;\\r\\n        display: block;\\r\\n        @media(min-width: $screen-sm-min) {\\r\\n            padding: 10px;\\r\\n        }\\r\\n        @media(min-width: $screen-md-min) {\\r\\n            padding: 20px;\\r\\n            display: inline-block;\\r\\n            width: 48%;\\r\\n            margin: 5px;\\r\\n        }\\r\\n        @media(min-width: $screen-lg-min) {\\r\\n            width: 30%;\\r\\n        }\\r\\n\\r\\n        &:first-of-type {\\r\\n            @media(min-width: $screen-md-min) {\\r\\n                margin: auto;\\r\\n                display: block;\\r\\n                width: 95%;\\r\\n            }\\r\\n        }*/\\n    vertical-align: top;\\n    position: relative;\\n    overflow: hidden; }\\n  @media (min-width: 992px) {\\n      .visualizations mat-card {\\n        padding: 15px; } }\\n  @media (min-width: 1200px) {\\n      .visualizations mat-card {\\n        padding: 20px; } }\\n  @media (min-width: 992px) {\\n      .visualizations mat-card {\\n        flex: 0 1 44%; } }\\n  @media (min-width: 1200px) {\\n      .visualizations mat-card {\\n        flex: 0 1 28%; } }\\n  .visualizations mat-card:first-of-type {\\n      flex: 0 1 95%;\\n      /* attempt to avoid jumpiness when switching the active visualization\\r\\n               numbers are rough based widths at different device screen sizes */\\n      min-height: 200px; }\\n  @media (min-width: 992px) {\\n        .visualizations mat-card:first-of-type {\\n          min-height: 400px; } }\\n  @media (min-width: 1200px) {\\n        .visualizations mat-card:first-of-type {\\n          min-height: 500px; } }\\n  .visualizations mat-card .visualization-title {\\n      font-size: 2em;\\n      margin-bottom: 10px;\\n      text-align: center; }\\n  .visualizations mat-card .visualization-description {\\n      color: #aaa;\\n      font-size: 0.8em;\\n      text-align: center; }\\n  .visualizations mat-card > .cover {\\n      position: absolute;\\n      top: 0;\\n      left: 0;\\n      width: 100%;\\n      height: 100%;\\n      z-index: 2;\\n      text-align: center; }\\n  .visualizations mat-card > .cover:hover {\\n        cursor: pointer;\\n        background-color: rgba(0, 0, 0, 0.25); }\\n  .visualizations mat-card > .cover:hover .visualization-title {\\n          display: inherit; }\\n  .visualizations mat-card > .cover .visualization-title {\\n        font-size: 1.25em;\\n        color: #fff;\\n        text-shadow: 1px 1px 2px #000;\\n        display: none;\\n        position: absolute;\\n        top: 50%;\\n        left: 50%;\\n        -webkit-transform: translate(-50%, -50%);\\n                transform: translate(-50%, -50%); }\\n  .visualizations mat-card.new-vis-placeholder {\\n      height: 200px;\\n      background-color: #eee; }\\n  .visualizations mat-card.new-vis-placeholder:before {\\n        content: 'Drop New Visualization Here';\\n        position: absolute;\\n        top: 50%;\\n        left: 50%;\\n        -webkit-transform: translate(-50%, -50%);\\n                transform: translate(-50%, -50%); }\\n  .visualizations mat-card.new-vis-placeholder.look-at-me {\\n        border: 2px solid yellow;\\n        box-shadow: 0 0 10px yellow;\\n        outline: none;\\n        -webkit-animation-name: wiggle;\\n        -ms-animation-name: wiggle;\\n        -ms-animation-duration: 500ms;\\n        -webkit-animation-duration: 500ms;\\n        -webkit-animation-iteration-count: 1;\\n        -ms-animation-iteration-count: 1;\\n        -webkit-animation-timing-function: ease-in-out;\\n        -ms-animation-timing-function: ease-in-out; }\\n  mat-list.new-vis-list {\\n  position: fixed;\\n  top: 0px;\\n  left: 0px;\\n  padding: 65px 0px 100px 0;\\n  width: 320px;\\n  /* if the scrollbar ever kicks in it won't go away\\r\\n    overflow-y:auto;\\r\\n    */\\n  background-color: rgba(0, 0, 0, 0.25);\\n  z-index: 5000;\\n  height: 100vh;\\n  display: flex;\\n  flex-direction: row;\\n  flex-wrap: wrap;\\n  justify-content: flex-start;\\n  align-items: flex-start;\\n  align-content: flex-start; }\\n  @media (max-height: 600px) {\\n    mat-list.new-vis-list {\\n      width: 270px; } }\\n  @media (max-height: 550px) {\\n    mat-list.new-vis-list {\\n      width: 220px; } }\\n  mat-list.new-vis-list > div {\\n    color: #fff; }\\n  mat-list.new-vis-list > div:before, mat-list.new-vis-list > div:after {\\n      content: \\\" \\\";\\n      display: table; }\\n  mat-list.new-vis-list > div:after {\\n      clear: both; }\\n  mat-list.new-vis-list > div button.toggle-admin-mode {\\n      float: right; }\\n  mat-list.new-vis-list > div > p {\\n      background-color: rgba(0, 0, 0, 0.5);\\n      padding: 5px;\\n      clear: right;\\n      line-height: 1.5em; }\\n  @media (max-height: 600px) {\\n        mat-list.new-vis-list > div > p {\\n          font-size: 0.9em; } }\\n  @media (max-height: 550px) {\\n        mat-list.new-vis-list > div > p {\\n          font-size: 0.8em; } }\\n  mat-list.new-vis-list mat-list-item {\\n    width: 150px;\\n    margin-right: 5px; }\\n  @media (max-height: 600px) {\\n      mat-list.new-vis-list mat-list-item {\\n        width: 125px; } }\\n  @media (max-height: 550px) {\\n      mat-list.new-vis-list mat-list-item {\\n        width: 100px; } }\\n  mat-list.new-vis-list mat-list-item:nth-of-type(odd) {\\n      margin-left: 5px; }\\n  mat-list.new-vis-list mat-list-item.vis-template {\\n      border: 1px dotted black;\\n      margin-bottom: 10px;\\n      height: auto; }\\n  mat-list.new-vis-list mat-list-item.vis-template .mat-list-item-content {\\n        height: auto;\\n        padding: 0px; }\\n  mat-list.new-vis-list mat-list-item.vis-template .mat-list-item-content img {\\n          width: 100%; }\\n  mat-list.new-vis-list mat-list-item.trash, mat-list.new-vis-list mat-list-item.save {\\n      position: relative;\\n      margin-top: 20px; }\\n  mat-list.new-vis-list mat-list-item.trash:before {\\n      font-family: 'FontAwesome';\\n      content: '\\\\f1f8';\\n      font-size: 2em;\\n      position: absolute;\\n      top: 50%;\\n      left: 50%;\\n      -webkit-transform: translate(-50%, -50%);\\n              transform: translate(-50%, -50%); }\\n  mat-list.new-vis-list mat-list-item.save button {\\n      font-size: 2em;\\n      position: absolute;\\n      top: 50%;\\n      left: 50%;\\n      -webkit-transform: translate(-50%, -50%);\\n              transform: translate(-50%, -50%); }\\n  .admin-toggle:before {\\n  font-family: 'FontAwesome';\\n  content: '\\\\f073';\\n  margin-right: 5px; }\\n  @-webkit-keyframes wiggle {\\n  0% {\\n    -webkit-transform: rotate(5deg); }\\n  25% {\\n    -webkit-transform: rotate(-5deg); }\\n  50% {\\n    -webkit-transform: rotate(10deg); }\\n  75% {\\n    -webkit-transform: rotate(-2.5deg); }\\n  100% {\\n    -webkit-transform: rotate(0deg); } }\\n  @keyframes wiggle {\\n  0% {\\n    -webkit-transform: rotate(5deg);\\n            transform: rotate(5deg); }\\n  25% {\\n    -webkit-transform: rotate(-5deg);\\n            transform: rotate(-5deg); }\\n  50% {\\n    -webkit-transform: rotate(10deg);\\n            transform: rotate(10deg); }\\n  75% {\\n    -webkit-transform: rotate(-2.5deg);\\n            transform: rotate(-2.5deg); }\\n  100% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg); } }\\n\"","import {Component,Input,HostBinding,Inject,Optional, ViewEncapsulation} from '@angular/core';\r\nimport {MatSnackBar,MatDialog,MatDialogRef} from '@angular/material';\r\nimport { MediaChange, ObservableMedia } from \"@angular/flex-layout\";\r\n\r\nimport {EntityBase,EntityService, DashboardModeState, DashboardMode, Refuge, PhenologyTrail} from './entity.service';\r\nimport {VisSelection,VisualizationSelectionFactory,NPN_BASE_HREF} from '@npn/common';\r\nimport {NewVisualizationDialogComponent} from './new-visualization-dialog.component';\r\n\r\nimport *  as $ from 'jquery';\r\n\r\nconst VIS_TEMPLATES = [{\r\n    $class: 'ActivityCurvesSelection',\r\n    $thumbnail: 'assets/activity-curves.png',\r\n    $tooltip: 'Activity Curves'\r\n},{\r\n    $class: 'ScatterPlotSelection',\r\n    $thumbnail: 'assets/scatter-plot.png',\r\n    $tooltip: 'Scatter Plot'\r\n},{\r\n    $class: 'CalendarSelection',\r\n    $thumbnail: 'assets/calendar.png',\r\n    $tooltip: 'Calendar'\r\n},{\r\n    $class: 'ObserverActivitySelection',\r\n    $thumbnail: 'assets/observer-activity.png',\r\n    $tooltip: 'Observer Activity Metrics'\r\n},{\r\n    $class: 'ClippedWmsMapSelection',\r\n    $thumbnail: 'assets/clipped-wms-map.png',\r\n    $tooltip: 'Map'\r\n},{\r\n    $class: 'ObservationFrequencySelection',\r\n    $thumbnail: 'assets/observation-frequency.png',\r\n    $tooltip: 'Observation Frequency'\r\n}];\r\n\r\n@Component({\r\n  selector: 'fws-dashboard-findings',\r\n  template: `\r\n<mat-list *ngIf=\"adminMode\" class=\"new-vis-list\">\r\n  <div>\r\n    <button mat-icon-button (click)=\"toggleAdminMode()\" class=\"toggle-admin-mode\"><i class=\"fa fa-2x fa-times-circle\" aria-hidden=\"true\"></i></button>\r\n    <p>Click and drag the visualizations below onto your Dashboard. You can have up to 10 visualizations on your Dashboard at one time. You can have multiple versions of each visualization type.</p>\r\n  </div>\r\n  <mat-list-item class=\"vis-template\"\r\n                *ngFor=\"let template of visTemplates\"\r\n                (mouseenter)=\"lookAtVisDrop = true;\" (mouseleave)=\"lookAtVisDrop = false;\"\r\n                [matTooltip]=\"template.$tooltip\"\r\n                matTooltipPosition=\"right\"\r\n                dnd-draggable [dragData]=\"template\"\r\n                [dropZones]=\"['newvis-dropZone']\">\r\n    <img class=\"new-vis-thumbnail\" src=\"{{baseHref}}{{template.$thumbnail}}\" />\r\n  </mat-list-item>\r\n  <mat-list-item *ngIf=\"(visTemplates.length%2) === 1\">\r\n    <!-- empty item to just to keep the number even -->\r\n  </mat-list-item>\r\n  <mat-list-item class=\"trash\"\r\n                matTooltip=\"Drag and drop visualization here to remove\"\r\n                matTooltipPosition=\"right\"\r\n                dnd-droppable [dropZones]=\"['trash-dropZone']\"\r\n                (onDropSuccess)=\"trashVisualization($event)\"></mat-list-item>\r\n  <mat-list-item class=\"save\">\r\n    <button mat-icon-button aria-labelled=\"Save\" (click)=\"save()\" [disabled]=\"!isReordered()\" matTooltip=\"Save current visualization order\"><i class=\"fa fa-floppy-o\" aria-hidden=\"true\"></i><span *ngIf=\"isReordered()\">*</span></button>\r\n  </mat-list-item>\r\n</mat-list>\r\n\r\n<div class=\"visualizations\" *ngIf=\"entity\" dnd-sortable-container [sortableData]=\"entity.selections\" [dropZones]=\"['list-dropZone','trash-dropZone']\" >\r\n    <mat-card  *ngFor=\"let selection of entity.selections; first as isFirst; let i = index\"\r\n              dnd-sortable [sortableIndex]=\"i\"\r\n              [dragEnabled]=\"adminMode\"\r\n              [dragData]=\"selection\"\r\n              (onDragStart)=\"dragStart($event)\"\r\n              (onDropSuccess)=\"reorderVisualizations()\">\r\n        <div *ngIf=\"!isFirst && !mobileMode\" class=\"cover\" (click)=\"makeCurrent(selection)\">\r\n            <span class=\"visualization-title\">{{selection.meta.title}} <button *ngIf=\"adminMode\" mat-icon-button (click)=\"editVisualization(selection,$event)\" matTooltip=\"Edit\"><i class=\"fa fa-pencil\" aria-hidden=\"true\"></i></button></span>\r\n        </div>\r\n        <div *ngIf=\"isFirst || mobileMode\" class=\"visualization-details\">\r\n            <div class=\"visualization-title\">{{selection.meta.title}} <button *ngIf=\"adminMode\" mat-icon-button (click)=\"editVisualization(selection,$event)\" matTooltip=\"Edit\"><i class=\"fa fa-pencil fa-2x\" aria-hidden=\"true\"></i></button></div>\r\n            <p *ngIf=\"selection.meta.description\" class=\"visualization-description\">{{selection.meta.description}}</p>\r\n        </div>\r\n        <npn-visualization [selection]=\"selection\" [thumbnail]=\"!mobileMode && i > 0\"></npn-visualization>\r\n    </mat-card>\r\n    <mat-card *ngIf=\"adminMode && entity.selections.length < maxVisualizations\"\r\n        dnd-droppable [dropZones]=\"['newvis-dropZone']\"\r\n        (onDropSuccess)=\"addVisualization($event)\"\r\n        [ngClass]=\"{'new-vis-placeholder': true, 'look-at-me': lookAtVisDrop}\"></mat-card>\r\n</div>\r\n<button mat-raised-button *ngIf=\"userIsAdmin && !mobileMode && !adminMode && !isTouchDevice\" (click)=\"toggleAdminMode()\"><span class=\"admin-toggle\">Customize</span></button>\r\n  `,\r\n  styleUrls: ['./findings.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class FindingsComponent {\r\n    _entity:EntityBase;\r\n    @Input()\r\n    userIsAdmin:boolean = false;\r\n    isTouchDevice:boolean = false;\r\n\r\n    trash:VisSelection[] = [];\r\n\r\n    @HostBinding('class.adminMode') adminMode:boolean = false;\r\n    maxVisualizations:number = 10;\r\n    visTemplates:any[];\r\n    guidOrder:string[];\r\n    dragStartIndex:number;\r\n    lookAtVisDrop:boolean = false;\r\n    mobileMode:boolean = false;\r\n\r\n    DashboardMode = DashboardMode;\r\n\r\n    constructor(private entityService:EntityService,\r\n                private selectionFactory: VisualizationSelectionFactory,\r\n                public dialog: MatDialog,\r\n                private snackBar: MatSnackBar,\r\n                private media:ObservableMedia,\r\n                @Optional() @Inject(NPN_BASE_HREF) private baseHref?: string) {\r\n        this.media.subscribe((mediaChange:MediaChange) => {\r\n                this.mobileMode = mediaChange.mqAlias === 'xs' || mediaChange.mqAlias === 'sm'    ;\r\n            });\r\n        // test if the device supports touch\r\n        let elm = document.createElement('div');\r\n        elm.setAttribute('ontouchstart','return;');\r\n        this.isTouchDevice = typeof(elm.ontouchstart) === 'function';\r\n        if(this.isTouchDevice) {\r\n            console.warn('Touch device detected any administrative functionality will be disabled.');\r\n        }\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.visTemplates = (DashboardModeState.get() === DashboardMode.PHENO_TRAIL)\r\n            ? VIS_TEMPLATES.filter(t => t.$class !== 'ClippedWmsMapSelection')\r\n            : VIS_TEMPLATES;\r\n    }\r\n\r\n    toggleAdminMode() {\r\n        this.adminMode = !this.adminMode;\r\n        this.resizeAllAfterDelay();\r\n        $('body').toggleClass('fws-customize-mode');\r\n    }\r\n\r\n    @Input()\r\n    set entity(entity:EntityBase) {\r\n        this._entity = entity;\r\n        entity.selections.forEach((s,i) => {\r\n            //s.debug = (i === 0);\r\n            s.update()\r\n        });\r\n        this.guidOrder = entity.selections.map(s => s.guid);\r\n    }\r\n\r\n    get entity():EntityBase {\r\n        return this._entity;\r\n    }\r\n\r\n    resizeAll() {\r\n        this.entity.selections.forEach((s,i) => {\r\n            //s.debug = i === 0;\r\n            s.resize()\r\n        });\r\n    }\r\n\r\n    resizeAllAfterDelay() {\r\n        setTimeout(() => {\r\n            this.resizeAll();\r\n        });\r\n    }\r\n\r\n    makeCurrent(s:VisSelection) {\r\n        let selections = this.entity.selections,\r\n            index = selections.indexOf(s);\r\n        if(index) {\r\n            console.log('MAKE CURRENT',index);\r\n            // swap the currently selected with the newly selected\r\n            selections[index] = selections[0];\r\n            selections[0] = s;\r\n            this.reorderVisualizations();\r\n        }\r\n    }\r\n\r\n    visDialog(s:VisSelection,edit?:boolean):MatDialogRef<NewVisualizationDialogComponent> {\r\n        return this.dialog.open(NewVisualizationDialogComponent,{\r\n            height: '90vh',\r\n            width: '90vw',\r\n            disableClose: true,\r\n            data: {\r\n                entity: this.entity,\r\n                selection: s,\r\n                edit:edit\r\n            }\r\n        });\r\n    }\r\n\r\n    addVisualization($event){\r\n        console.log('add.$event',$event);\r\n        // most selections will simply ignore $entity but some like observer activity\r\n        // metrics, with the introduction of the pheno trail work, need the overall\r\n        // $entity to decide how to label legend items when not performing grouping\r\n        const $entity = this.entity instanceof Refuge\r\n            ? {title: this.entity.title, network_id: this.entity.network_id }\r\n            : {title: this.entity.title, network_ids: (this.entity as PhenologyTrail).network_ids };\r\n        let s = this.selectionFactory.newSelection({...{$entity},...$event.dragData});\r\n        console.log('add.selection',s);\r\n        let dialogRef = this.visDialog(s);\r\n        dialogRef.afterClosed().subscribe(selection => {\r\n            if(selection) {\r\n                this.entity.selections.push(selection);\r\n                this.save();\r\n            }\r\n        });\r\n    }\r\n\r\n    editVisualization(s:VisSelection,$event) {\r\n        $event.stopPropagation();\r\n        let index = this.entity.selections.indexOf(s);\r\n        console.log(`edit.selection[${index}]`,s);\r\n        let copy = this.selectionFactory.cloneSelection(s),\r\n            dialogRef = this.visDialog(copy,true);\r\n        dialogRef.afterClosed().subscribe(selection => {\r\n            if(selection) {\r\n                // replace\r\n                this.entity.selections[index] = selection;\r\n                this.save();\r\n            }\r\n        });\r\n    }\r\n\r\n    isReordered() {\r\n        if(this.guidOrder && this.guidOrder.length === this.entity.selections.length) {\r\n            return this.entity.selections.reduce((reordered,s,i) => {\r\n                return reordered||(s.guid !== this.guidOrder[i] ? true: false);\r\n            },false);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    reorderVisualizations() {\r\n        setTimeout(() => {\r\n            this.resizeAll();\r\n        });\r\n    }\r\n\r\n    save(noSnackBar?:boolean) {\r\n        this.entityService.save(this.entity)\r\n            .then(entity => {\r\n                this.entity = entity;\r\n                if(!noSnackBar) {\r\n                    this.snackBar.open('Visualizations saved',null,{duration:2000});\r\n                }\r\n            })\r\n            .catch(e => this.handleError(e));\r\n    }\r\n\r\n    // capture where a selection was at drag start so it can be restored to its position\r\n    // for undo trash\r\n    dragStart($event) {\r\n        // this seems inconstent but it seems that $event in the onDragStart/End\r\n        // events is the dragData, unlike onDragSuccess\r\n        this.dragStartIndex = $event ? this.entity.selections.indexOf($event) : undefined;\r\n        console.log('dragStart.$event',$event,this.dragStartIndex);\r\n    }\r\n\r\n    trashVisualization($event) {\r\n        console.log('trash.$event',$event);\r\n        let selection = $event.dragData,\r\n            index = this.entity.selections.indexOf(selection);\r\n        console.log(`trashing selection ${index}`);\r\n        this.entity.selections.splice(index,1);\r\n        this.entityService.save(this.entity)\r\n            .then(entity => {\r\n                this.entity = entity;\r\n                this.snackBar.open('Visualization Deleted','Undo',{\r\n                        duration: 5000,\r\n                    }).onAction().subscribe(() => {\r\n                        // issue because of the drag re-order selections normally get put back\r\n                        // at index #1, may need to keep track of index on selection object\r\n                        // change on resize or some such\r\n                        index = typeof(this.dragStartIndex) !== 'undefined' ? this.dragStartIndex : index;\r\n                        console.log(`restoring selection ${index}`);\r\n                        this.entity.selections.splice(index,0,this.selectionFactory.cloneSelection(selection));\r\n                        this.save(true);\r\n                    });\r\n            })\r\n            .catch(e => this.handleError(e));\r\n    }\r\n\r\n    handleError(e?:any) {\r\n        console.error(e);\r\n        this.snackBar.open('Something went wrong',null,{duration: 5000});\r\n    }\r\n}\r\n","import {Component,Input,OnChanges,SimpleChanges} from '@angular/core';\r\n\r\nimport {Species,SpeciesService} from '@npn/common';\r\nimport {EntityBase,Refuge,PhenologyTrail} from './entity.service';\r\n\r\n@Component({\r\n    selector: 'focal-species',\r\n    template:`\r\n    <div *ngIf=\"entity\">\r\n        <h3>Focal Species for {{entity.title}}</h3>\r\n        <ul *ngIf=\"speciesList && speciesList.length\">\r\n            <li *ngFor=\"let s of speciesList\">\r\n            <a target=\"_blank\" [href]=\"'https://usanpn.org/nn/'+s.genus+'_'+s.species\">{{s | speciesTitle:'common-name'}} ({{s | speciesTitle:'scientific-name'}})</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    `,\r\n    styles:[`\r\n        h3 {\r\n            font-size: 28px;\r\n        }\r\n    `]\r\n})\r\nexport class FocalSpeciesComponent implements OnChanges {\r\n    @Input()\r\n    entity:EntityBase;\r\n\r\n    speciesList:Species[];\r\n\r\n    constructor(private speciesService:SpeciesService) {\r\n\r\n    }\r\n\r\n    ngOnChanges(changes:SimpleChanges) {\r\n        if(changes.entity && changes.entity.currentValue) {\r\n            let params = {};\r\n            const entity = changes.entity.currentValue as EntityBase;\r\n            const networkIds = entity instanceof Refuge\r\n                ? [entity.network_id]\r\n                : entity instanceof PhenologyTrail\r\n                    ? entity.network_ids\r\n                    : [];\r\n            if(networkIds.length) { // else should never happen but...\r\n                networkIds.forEach((id,i) => params[`network_id[${i}]`] = id);\r\n            }\r\n            this.speciesService.getAllSpecies(params)\r\n                .then(list => this.speciesList = list)\r\n                .catch(e => console.error(e));\r\n        }\r\n    }\r\n}\r\n","module.exports = \":host {\\n  display: block;\\n  background-color: transparent;\\n  /* when content goes away for a flash avoid dashboard height shrinking and making the page jump around. */\\n  min-height: 896px; }\\n\\n.entity-dashboard-tabs .mat-tab-header {\\n  border-bottom: none; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-ink-bar {\\n    display: none; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels {\\n    flex-flow: row nowrap; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label {\\n    width: 100%;\\n    white-space: normal;\\n    display: block;\\n    font-size: 0.9em;\\n    height: 96px;\\n    opacity: 1;\\n    color: #fff;\\n    padding: 0px;\\n    background-color: transparent; }\\n\\n@media (min-width: 768px) {\\n      .entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label {\\n        display: flex; } }\\n\\n@media (min-width: 992px) {\\n      .entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label {\\n        font-size: 1em; } }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label > .mat-tab-label-content {\\n      width: 100%; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label > .mat-tab-label-content,\\n    .entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label > .mat-tab-label-content > .rd-tab-label {\\n      display: block;\\n      padding: 0px;\\n      height: 100%; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:focus {\\n      background-color: transparent; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label.mat-tab-label-active {\\n      color: orange; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(1) > .mat-tab-label-content > .rd-tab-label {\\n      background-color: #271614; }\\n\\n@media (min-width: 768px) {\\n        .entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(1) > .mat-tab-label-content > .rd-tab-label {\\n          padding-left: 24px; } }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(1)::after {\\n      content: '';\\n      border-top: 48px solid #3f322b;\\n      border-right: 48px solid #3f322b;\\n      border-bottom: 48px solid #271614;\\n      border-left: 48px solid #271614; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(2) > .mat-tab-label-content > .rd-tab-label {\\n      background-color: #3f322b; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(2)::after {\\n      content: '';\\n      border-top: 48px solid #574d3f;\\n      border-right: 48px solid #574d3f;\\n      border-bottom: 48px solid #3f322b;\\n      border-left: 48px solid #3f322b; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(3) > .mat-tab-label-content > .rd-tab-label {\\n      background-color: #574d3f; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(3)::after {\\n      content: '';\\n      border-top: 48px solid #6f5e53;\\n      border-right: 48px solid #6f5e53;\\n      border-bottom: 48px solid #574d3f;\\n      border-left: 48px solid #574d3f; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(4) > .mat-tab-label-content > .rd-tab-label {\\n      background-color: #6f5e53; }\\n\\n.entity-dashboard-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(4)::after {\\n      content: '';\\n      border-top: 48px solid transparent;\\n      border-right: 48px solid transparent;\\n      border-bottom: 48px solid #6f5e53;\\n      border-left: 48px solid #6f5e53; }\\n\\n.entity-dashboard-tabs.three-tabs .mat-tab-header .mat-tab-labels > .mat-tab-label:nth-of-type(3)::after {\\n  content: '';\\n  border-top: 48px solid transparent;\\n  border-right: 48px solid transparent; }\\n\\n.entity-dashboard-tabs .rd-tab-icon {\\n  position: absolute;\\n  top: .75em;\\n  right: 42%;\\n  -webkit-transform: translateX(-50%);\\n          transform: translateX(-50%);\\n  font-size: 2.2em; }\\n\\n.entity-dashboard-tabs .rd-tab-label {\\n  position: relative;\\n  text-transform: uppercase; }\\n\\n.entity-dashboard-tabs .rd-tab-label > label {\\n    color: inherit;\\n    margin-top: 4.25em; }\\n\\n.entity-dashboard-tabs .rd-tab-content {\\n  min-height: 800px;\\n  padding: 20px 5px;\\n  color: #000;\\n  border-left: 2px solid #ddd;\\n  border-right: 2px solid #ddd;\\n  background-color: #fff; }\\n\\n@media (min-width: 992px) {\\n    .entity-dashboard-tabs .rd-tab-content {\\n      padding: 20px; } }\\n\"","import {Component,OnInit,ElementRef,ViewChild, ViewEncapsulation} from '@angular/core';\r\n\r\nimport {FindingsComponent} from './findings.component';\r\nimport {EntityBase,EntityService, DashboardMode, DashboardModeState} from './entity.service';\r\n\r\nimport {MatTabChangeEvent} from '@angular/material';\r\nimport {faHandshake,faBook,faPaw,faSearch} from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nconst WHAT_WERE_FINDING_TAB_IDX = 0;\r\nconst FOCAL_SPECIES_TAB_IDX = 1;\r\nconst RESOURCES_TAB_IDX = 2;\r\nconst PARTNERS_TAB_IDX = 3;\r\n\r\n@Component({\r\n  selector: 'fws-dashboard',\r\n  template: `\r\n  <mat-tab-group [ngClass]=\"{'entity-dashboard-tabs':true, 'three-tabs': !supportsPartners}\" (selectedTabChange)=\"selectedTabChange($event)\">\r\n    <mat-tab label=\"What we're finding\">\r\n        <ng-template mat-tab-label>\r\n            <div class=\"rd-tab-label findings\">\r\n                <mat-icon class=\"rd-tab-icon\"><fa-icon [icon]=\"faSearch\"></fa-icon></mat-icon>\r\n                <label>What we're finding</label>\r\n            </div>\r\n        </ng-template>\r\n        <div class=\"rd-tab-content\" *ngIf=\"renderVisualizations\">\r\n            <fws-dashboard-findings *ngIf=\"entity\" [entity]=\"entity\" [userIsAdmin]=\"userIsAdmin\"></fws-dashboard-findings>\r\n        </div>\r\n    </mat-tab>\r\n\r\n    <mat-tab label=\"Focal Species\">\r\n        <ng-template mat-tab-label>\r\n            <div class=\"rd-tab-label focal-species\">\r\n                <mat-icon class=\"rd-tab-icon\"><fa-icon [icon]=\"faPaw\"></fa-icon></mat-icon>\r\n                <label>Focal Species</label>\r\n            </div>\r\n        </ng-template>\r\n        <div class=\"rd-tab-content\" *ngIf=\"renderFocalSpecies\">\r\n            <focal-species [entity]=\"entity\"></focal-species>\r\n        </div>\r\n    </mat-tab>\r\n\r\n    <mat-tab label=\"Resources for observers\">\r\n        <ng-template mat-tab-label>\r\n            <div class=\"rd-tab-label resources\">\r\n                <mat-icon class=\"rd-tab-icon\"><fa-icon [icon]=\"faBook\"></fa-icon></mat-icon>\r\n                <label>Resources for observers</label>\r\n            </div>\r\n        </ng-template>\r\n        <div class=\"rd-tab-content\" *ngIf=\"renderResources\">\r\n            <fws-dashboard-resources [entity]=\"entity\" [userIsLoggedIn]=\"userIsLoggedIn\"></fws-dashboard-resources>\r\n        </div>\r\n    </mat-tab>\r\n\r\n    <mat-tab label=\"Partners\" *ngIf=\"supportsPartners\">\r\n        <ng-template mat-tab-label>\r\n            <div class=\"rd-tab-label partners\">\r\n                <mat-icon class=\"rd-tab-icon\"><fa-icon [icon]=\"faHandshake\"></fa-icon></mat-icon>\r\n                <label>Partners</label>\r\n            </div>\r\n        </ng-template>\r\n        <div class=\"rd-tab-content\" *ngIf=\"renderPartners\">\r\n        <phenology-trail-partners [entity]=\"entity\"></phenology-trail-partners>\r\n        </div>\r\n    </mat-tab>\r\n  </mat-tab-group>\r\n  `,\r\n  styleUrls: ['./fws-dashboard.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class FwsDashboardComponent implements OnInit {\r\n    entity_id:string;\r\n    entity:EntityBase;\r\n    userIsLoggedIn:boolean = false;\r\n    userIsAdmin:boolean = false;\r\n    dashboardMode:string = null;\r\n\r\n    renderVisualizations:boolean = true;\r\n    renderFocalSpecies:boolean = false;\r\n    renderResources:boolean = false;\r\n    supportsPartners:boolean = false;\r\n    renderPartners:boolean = false;\r\n\r\n    faHandshake = faHandshake;\r\n    faBook = faBook;\r\n    faPaw = faPaw;\r\n    faSearch = faSearch;\r\n\r\n    @ViewChild(FindingsComponent)\r\n    private findingsComponent:FindingsComponent;\r\n\r\n    constructor(private element:ElementRef,\r\n                private entityService:EntityService) {\r\n        let e = element.nativeElement as HTMLElement;\r\n        this.entity_id = e.getAttribute('entity_id');\r\n        this.userIsAdmin = e.getAttribute('user_is_admin') !== null;\r\n        this.userIsLoggedIn = e.getAttribute('user_is_logged_in') !== null;\r\n        DashboardModeState.set(e.getAttribute('mode') as DashboardMode);\r\n        this.supportsPartners = DashboardModeState.get() === DashboardMode.PHENO_TRAIL;\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.entityService.get(this.entity_id).then(entity => this.entity = entity);\r\n    }\r\n\r\n    selectedTabChange($event:MatTabChangeEvent) {\r\n        this.renderFocalSpecies = this.renderFocalSpecies||($event.index === FOCAL_SPECIES_TAB_IDX);\r\n        // lazily render the visualizations, only once visiting their tab\r\n        this.renderVisualizations = this.renderVisualizations||($event.index === WHAT_WERE_FINDING_TAB_IDX);\r\n        this.renderResources = this.renderResources||($event.index === RESOURCES_TAB_IDX);\r\n        this.renderPartners = this.renderPartners||($event.index === PARTNERS_TAB_IDX);\r\n        if($event.index === WHAT_WERE_FINDING_TAB_IDX) {\r\n            // if the visualizations are selected makes ure that resizeAll() is called\r\n            // in case the browser was re-sized AFTER the visualizations were visited but\r\n            // while another tab was visible (the visualizations would have resized themselves down to nothing).\r\n            setTimeout(() => {\r\n                if(this.findingsComponent) {\r\n                    this.findingsComponent.resizeAll();\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {Component,Inject,Input,OnInit, ViewEncapsulation, ViewChild} from '@angular/core';\r\nimport {MAT_DIALOG_DATA,MatDialogRef} from '@angular/material';\r\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\r\n\r\nimport {EntityBase, Refuge, PhenologyTrail, DashboardMode, DashboardModeState} from './entity.service';\r\nimport {VisSelection,NetworkAwareVisSelection,StationAwareVisSelection,\r\n        ActivityCurvesSelection,ScatterPlotSelection,CalendarSelection,\r\n        ObserverActivitySelection,ObservationFrequencySelection,ClippedWmsMapSelection} from '@npn/common';\r\n\r\n@Component({\r\n    selector: 'new-vis-dialog',\r\n    template: `\r\n    <!-- for \"station aware\" visualizations display a multi-step process -->\r\n    <mat-horizontal-stepper (selectionChange)=\"stepChanged($event)\">\r\n        <mat-step *ngIf=\"stationAware\" [stepControl]=\"step1FormGroup\" label=\"Select sites\">\r\n            <div class=\"step-wrapper\">\r\n                <div class=\"step-content\">\r\n                    <refuge-visualization-scope-selection *ngIf=\"mode === 'refuge'\" [selection]=\"selection\" [refuge]=\"entity\" #scopeSelection></refuge-visualization-scope-selection>\r\n                    <pheno-trail-visualization-scope-selection *ngIf=\"mode === 'phenology_trail'\" [selection]=\"selection\" [phenoTrail]=\"entity\" #scopeSelection></pheno-trail-visualization-scope-selection>\r\n                </div>\r\n                <div class=\"step-nav\">\r\n                    <button mat-raised-button (click)=\"dialogRef.close()\">Cancel</button>\r\n                    <button mat-raised-button matStepperNext [disabled]=\"!!scopeSelection && !scopeSelection.valid\">Next</button>\r\n                </div>\r\n            </div>\r\n        </mat-step>\r\n\r\n        <mat-step [stepControl]=\"step2FormGroup\" label=\"Build visualization\">\r\n            <div *ngIf=\"showVis\" class=\"step-wrapper\">\r\n                <div class=\"step-content\">\r\n                    <new-visualization-builder [selection]=\"selection\" [entity]=\"entity\"></new-visualization-builder>\r\n                </div>\r\n                <div class=\"step-nav\">\r\n                    <button mat-raised-button (click)=\"dialogRef.close()\">Cancel</button>\r\n                    <button mat-raised-button *ngIf=\"stationAware\" matStepperPrevious>Back</button>\r\n                    <button mat-raised-button matStepperNext [disabled]=\"!selection.isValid()\">Next</button>\r\n                </div>\r\n            </div>\r\n        </mat-step>\r\n\r\n        <mat-step [stepControl]=\"step3FormGroup\" label=\"Enter visualization details\">\r\n            <div *ngIf=\"showDetails\" class=\"step-wrapper\">\r\n                <div class=\"step-content\">\r\n                    <mat-form-field class=\"visualization-title\">\r\n                        <input matInput placeholder=\"Visualization title\" [(ngModel)]=\"selection.meta.title\" required />\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"visualization-description\">\r\n                        <textarea matInput placeholder=\"Visualization description\" [(ngModel)]=\"selection.meta.description\"></textarea>\r\n                    </mat-form-field>\r\n                    <p class=\"step-instructions\">Add a title and a description that will accompany this visualization on your Refuge Dashboard. The description can help explain the visualization to visitors to your Refuge Dashboard, and provide other background information that will assist with interpretation.</p>\r\n                </div>\r\n                <div class=\"step-nav\">\r\n                    <button mat-raised-button (click)=\"dialogRef.close()\">Cancel</button>\r\n                    <button mat-raised-button matStepperPrevious>Back</button>\r\n                    <button mat-raised-button (click)=\"dialogRef.close(selection)\" [disabled]=\"!selection.meta.title || !selection.isValid()\">{{edit ? 'Save' : 'Add'}}</button>\r\n                </div>\r\n            </div>\r\n        </mat-step>\r\n    </mat-horizontal-stepper>\r\n    `,\r\n    styles: [`\r\n        mat-horizontal-stepper {\r\n            height: 100%;\r\n        }\r\n        /* ViewEncapsulation.None\r\n           75px is slightly larger than the stepper header\r\n        */\r\n        .mat-horizontal-content-container {\r\n            height: calc(100% - 75px);\r\n        }\r\n        .mat-horizontal-content-container .mat-horizontal-stepper-content {\r\n            height: 100%;\r\n        }\r\n        .step-wrapper {\r\n            height: 100%;\r\n        }\r\n        .step-nav {\r\n            padding: 5px;\r\n            height: 46px;\r\n        }\r\n        .step-content {\r\n            height: calc(100% - 46px);\r\n            overflow-y: auto;\r\n        }\r\n\r\n        .step-nav >button {\r\n            margin-right: 5px;\r\n        }\r\n\r\n        .visualization-title,\r\n        .visualization-description {\r\n            display: block;\r\n            width: 100%;\r\n        }\r\n        .visualization-description textarea {\r\n            height: 5em;\r\n        }\r\n        .step-instructions {\r\n            color: #666;\r\n            font-size: 0.95em;\r\n            margin-top: 20px;\r\n        }\r\n    `],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class NewVisualizationDialogComponent implements OnInit {\r\n    edit:boolean;\r\n    stationAware:boolean;\r\n    step1FormGroup: FormGroup;\r\n    step2FormGroup: FormGroup;\r\n    step3FormGroup: FormGroup;\r\n    showVis:number;\r\n    showDetails:boolean;\r\n    mode:DashboardMode = DashboardModeState.get();\r\n    entity:EntityBase;\r\n    selection: VisSelection;\r\n\r\n    @ViewChild('scopeSelection')\r\n    scopeSelection:any; // should there be a common base class?\r\n\r\n    constructor(private formBuilder: FormBuilder,\r\n                private dialogRef: MatDialogRef<NewVisualizationDialogComponent>,\r\n                @Inject(MAT_DIALOG_DATA) private data:any) {\r\n        this.step1FormGroup = this.formBuilder.group({\r\n            firstCtrl: ['',Validators.required]\r\n        });\r\n        this.step2FormGroup = this.formBuilder.group({\r\n            secondCtrl: ['',Validators.required]\r\n        });\r\n        this.step3FormGroup = this.formBuilder.group({\r\n            thirdCtrl: ['',Validators.required]\r\n        });\r\n        this.selection = data.selection as VisSelection;\r\n        this.entity = data.entity;\r\n        this.edit = data.edit;\r\n    }\r\n\r\n    ngOnInit() {\r\n        let s = this.selection;\r\n        s.editMode = true;\r\n        //s.debug = true; // uncomment to show the selection for dev purposes\r\n        // NOTE: TS support for interfaces doesn't extend to actual runtime type\r\n        // introspection.  VisSelection has class extensions Network/StationAwareVisSelection\r\n        // that selections can extend, if use cases get more complex then may instead need\r\n        // to use the `'stationIds' in s` kind of logic instead.\r\n        this.stationAware = s instanceof StationAwareVisSelection;// || 'stationIds' in s;\r\n        this.showVis = !this.stationAware ? 1 : 0;\r\n        if(s instanceof NetworkAwareVisSelection) {\r\n            if(!s.networkIds || !s.networkIds.length) { // don't change on edit (not necessary but seems appropriate)\r\n                if(this.entity instanceof Refuge) {\r\n                    s.networkIds = [this.entity.network_id];\r\n                } else if (this.entity instanceof PhenologyTrail) {\r\n                    s.networkIds = this.entity.network_ids.slice();\r\n                }\r\n            }\r\n        }\r\n        if(this.edit) {\r\n            this.showVis++;\r\n            this.selection.update();\r\n        }\r\n    }\r\n\r\n    stepChanged($event) {\r\n        let visIndex = !this.stationAware ? 0 : 1;\r\n        console.debug(`NewVisualizationDialogComponent:stepChanged visIndex=${visIndex}`,$event);\r\n        if($event.selectedIndex === visIndex) {\r\n            this.showVis++;\r\n            setTimeout(() => {\r\n                if(this.showVis === 1 || !this.selection.isValid()) {\r\n                    this.selection.resize()\r\n                } else {\r\n                    this.selection.update();\r\n                }\r\n            });\r\n        }\r\n        this.showDetails = $event.selectedIndex === (visIndex+1);\r\n    }\r\n}\r\n\r\n@Component({\r\n    selector: 'new-visualization-builder',\r\n    template: `\r\n    <activity-curves-control  *ngIf=\"activity\" [selection]=\"activity\"></activity-curves-control>\r\n    <scatter-plot-control *ngIf=\"scatter\" [selection]=\"scatter\"></scatter-plot-control>\r\n    <calendar-control *ngIf=\"calendar\" [selection]=\"calendar\"></calendar-control>\r\n    <observer-activity-control *ngIf=\"observer\" [selection]=\"observer\"></observer-activity-control>\r\n    <observation-frequency-control *ngIf=\"observationFreq\" [selection]=\"observationFreq\"></observation-frequency-control>\r\n    <clipped-wms-map-control *ngIf=\"clipped\" [selection]=\"clipped\"></clipped-wms-map-control>\r\n\r\n    <npn-visualization *ngIf=\"selection\" [selection]=\"selection\"></npn-visualization>\r\n    <!--pre *ngIf=\"selection\">{{selection.external | json}}</pre-->\r\n    `,\r\n    styles:[`\r\n        npn-visualization {\r\n            margin-top: 20px;\r\n            width: 90%; // within stepper o/w horizontal scroll\r\n        }\r\n    `]\r\n})\r\nexport class NewVisualizationBuilderComponent implements OnInit {\r\n    @Input()\r\n    selection: VisSelection;\r\n    @Input()\r\n    entity: EntityBase;\r\n\r\n    scatter: ScatterPlotSelection;\r\n    calendar: CalendarSelection;\r\n    activity: ActivityCurvesSelection;\r\n    observer: ObserverActivitySelection;\r\n    observationFreq: ObservationFrequencySelection;\r\n    clipped: ClippedWmsMapSelection;\r\n\r\n    ngOnInit() {\r\n        let s = this.selection;\r\n        //s.debug = true;\r\n        if(s instanceof ActivityCurvesSelection) {\r\n            this.activity = s;\r\n        } else if(s instanceof ScatterPlotSelection) {\r\n            this.scatter = s;\r\n        } else if(s instanceof CalendarSelection) {\r\n            this.calendar = s;\r\n        } else if (s instanceof ObserverActivitySelection) {\r\n            this.observer = s;\r\n        } else if (s instanceof ObservationFrequencySelection) {\r\n            this.observationFreq = s;\r\n        } else if (s instanceof ClippedWmsMapSelection) {\r\n            // this visualization only supported for Refuge\r\n            this.clipped = s;\r\n            s.fwsBoundary = (this.entity as Refuge).boundary_id;\r\n        }\r\n        s.resize();\r\n    }\r\n}\r\n\r\n\r\n","import { Input, Component, OnInit, Output, EventEmitter } from '@angular/core';\r\nimport { faChevronRight, faChevronDown } from \"@fortawesome/pro-light-svg-icons\";\r\nimport { NetworkWrapper } from './pheno-trail-visualization-scope-selection.component';\r\n\r\n@Component({\r\n    selector: 'pheno-trail-visualization-scope-group',\r\n    template: `\r\n      <button mat-icon-button [attr.aria-label]=\"'Toggle ' + networkWrapper.network.name\" (click)=\"toggleOpen()\">\r\n        <mat-icon><fa-icon [icon]=\"open ? chevronDownIcon : chevronRightIcon\"></fa-icon></mat-icon>\r\n      </button>\r\n      <mat-checkbox [(ngModel)]=\"networkWrapper.selected\" (change)=\"change.emit()\" [indeterminate]=\"networkWrapper.group.excludeIds?.length > 0\">\r\n        {{networkWrapper.network.name}}\r\n      </mat-checkbox>\r\n      <div class=\"station-input\" *ngIf=\"open\">\r\n        <h3>Exclude Stations</h3>\r\n        <mat-progress-spinner *ngIf=\"loading\" mode=\"indeterminate\"></mat-progress-spinner>\r\n        <div *ngFor=\"let s of networkWrapper.stations | async as all\" class=\"station-input\">\r\n          <mat-checkbox [(ngModel)]=\"s.selected\" (change)=\"stationChange()\" [disabled]=\"!s.selected && networkWrapper.group.excludeIds?.length === (all.length-1)\">{{s.station_name}}</mat-checkbox>\r\n        </div>\r\n      </div>\r\n    `,\r\n    styles: [`\r\n      .station-input {\r\n        display: block;\r\n        padding-left: 34px;\r\n      }\r\n    `]\r\n})\r\nexport class PhenoTrailVisualizationScopeGroupComponent implements OnInit{\r\n  @Input() networkWrapper:NetworkWrapper;\r\n  @Output() change:EventEmitter<void> = new EventEmitter();\r\n  open = false;\r\n  chevronDownIcon = faChevronDown;\r\n  chevronRightIcon = faChevronRight;\r\n  loading = false;\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(){\r\n    //Load any pre-existing selections\r\n    if(this.networkWrapper.selected){\r\n      this.networkWrapper.getStations();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles the view of the group's stations\r\n   */\r\n  toggleOpen(){\r\n    this.loading = true;\r\n    this.networkWrapper.getStations().then(stations => {\r\n      this.open = !this.open;\r\n      this.loading = false;\r\n    });\r\n    \r\n  }\r\n\r\n  /**\r\n   * Toggle whether a station should be excluded for a selected group\r\n   */\r\n  stationChange(){\r\n    this.networkWrapper.getStations().then(stations => {\r\n      this.networkWrapper.selected = true;\r\n      this.networkWrapper.group.excludeIds = stations.filter(station => station.selected).map(station => station.station_id);\r\n      this.change.emit();\r\n    });\r\n  }\r\n}","import { Input, Component } from '@angular/core';\r\nimport { StationAwareVisSelection } from '@npn/common/visualizations/vis-selection';\r\nimport { NetworkWrapper } from './pheno-trail-visualization-scope-selection.component';\r\n\r\n@Component({\r\n    selector: 'pheno-trail-visualization-scope-groups',\r\n    template: `\r\n    <h3>Select Groups to Compare</h3>\r\n    <pheno-trail-visualization-scope-group *ngFor=\"let w of networkWrappers\" [networkWrapper]=\"w\" (change)=\"handleChange()\" class=\"group-input\"></pheno-trail-visualization-scope-group>\r\n    `,\r\n    styles: [`\r\n      .group-input {\r\n        display:block;\r\n      }\r\n    `]\r\n})\r\nexport class PhenoTrailVisualizationScopeGroupsComponent {\r\n  @Input() selection:StationAwareVisSelection;\r\n  @Input() networkWrappers: NetworkWrapper[];\r\n\r\n  handleChange(){\r\n    this.selection.groups = this.networkWrappers.filter(w => w.selected).map(w => w.group);\r\n  }\r\n}","import { Input, Component, OnInit } from '@angular/core';\r\nimport { NetworkService, StationAwareVisSelection, Network, Station } from '@npn/common';\r\nimport { PhenologyTrail } from './entity.service';\r\nimport { SelectionGroup, SelectionGroupMode } from '@npn/common/visualizations/vis-selection';\r\n\r\nexport class NetworkWrapper {\r\n  group:SelectionGroup;\r\n  selected:boolean;\r\n  stations: Promise<Station[]>;\r\n\r\n  constructor(\r\n    private selection:StationAwareVisSelection,\r\n    public network:Network,\r\n    private networkService:NetworkService\r\n  ) {\r\n    if(this.selection.groups) { // existing selection\r\n      const g0 = this.selection.groups[0];\r\n      if(g0.mode === SelectionGroupMode.NETWORK){\r\n        this.group = this.selection.groups.find(g => g.id === network.network_id);\r\n        this.selected = !!this.group\r\n      }\r\n      else if (g0.mode === SelectionGroupMode.STATION){\r\n        this.getStationsWithGroup();\r\n      }\r\n    } \r\n    else {\r\n      this.selected = this.selection.networkIds.indexOf(network.network_id) > -1;\r\n    }\r\n    if(!this.group) {\r\n        // create new group\r\n        this.group = {\r\n        label: network.name,\r\n        mode: SelectionGroupMode.NETWORK,\r\n        id: network.network_id,\r\n        excludeIds: []\r\n      }\r\n    }\r\n    // set label unconditionally in case it changed\r\n    this.group.label = network.name;\r\n  }\r\n\r\n  getStations():Promise<Station[]>{\r\n    if(!this.stations){\r\n      this.stations = this.networkService.getStations(this.network.network_id).then(stations => {\r\n        stations.forEach(station =>  station.selected = (this.group.excludeIds || []).indexOf(station.station_id) > -1);\r\n        return stations;\r\n      });\r\n    }\r\n    return this.stations;\r\n  }\r\n\r\n  // component uses this Promise to render station list\r\n  getStationsWithGroup():Promise<Station[]> {\r\n    this.stations = this.getStations().then(stations => {\r\n        stations.forEach(s => {\r\n            s.selected = !!this.selection.groups ? !!this.selection.groups.find(g => g.id === s.station_id) : false;\r\n            s.group = {\r\n              label: `${this.network.name} - ${s.station_name}`,\r\n              mode: SelectionGroupMode.STATION,\r\n              id: s.station_id\r\n            };\r\n        });\r\n        return stations;            \r\n    });\r\n    return this.stations;\r\n  }\r\n}\r\n\r\n\r\n@Component({\r\n    selector: 'pheno-trail-visualization-scope-selection',\r\n    template: `\r\n    <mat-radio-group name=\"visScope\" class=\"vis-scope-input\" [(ngModel)]=\"visScope\" (change)=\"scopeChanged()\">\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'allGroups'\">Show data for all groups within \"{{phenoTrail.title}}\"</mat-radio-button>\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'selectGroups'\">Show data for select groups within \"{{phenoTrail.title}}\"</mat-radio-button>\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'compareGroups'\">Compare data between groups within \"{{phenoTrail.title}}\"</mat-radio-button>\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'compareSites'\">Compare data between sites within \"{{phenoTrail.title}}\"</mat-radio-button>\r\n      </mat-radio-group>\r\n    <mat-progress-spinner *ngIf=\"networkFetch\" mode=\"indeterminate\"></mat-progress-spinner>\r\n    <div *ngIf=\"visScope === 'selectGroups'\">\r\n      <hr>\r\n      <h3 class=\"group-select-header\">Select Groups</h3>\r\n      <mat-checkbox *ngFor=\"let n of networks | async\" class=\"group-input\" [(ngModel)]=\"n.selected\" (change)=\"selectGroupChange()\" [disabled]=\"n.selected && selection.networkIds.length === 1\">{{n.network.name}}</mat-checkbox>\r\n    </div>\r\n    <div *ngIf=\"visScope === 'compareGroups' && networks | async as networkWrappers\">\r\n      <hr>\r\n      <pheno-trail-visualization-scope-groups [selection]=\"selection\" [networkWrappers]=\"networkWrappers\"></pheno-trail-visualization-scope-groups>\r\n    </div>\r\n    <div *ngIf=\"visScope === 'compareSites' && networks | async as networkWrappers\">\r\n      <hr>\r\n      <pheno-trail-visualization-scope-station-groups [selection]=\"selection\" [networkWrappers]=\"networkWrappers\"></pheno-trail-visualization-scope-station-groups>\r\n    </div>\r\n    <!--pre *ngIf=\"selection\">{{selection.external | json}}</pre-->\r\n    `,\r\n    styles: [`\r\n        .vis-scope-input {\r\n          display: inline-flex;\r\n          flex-direction: column;\r\n        }\r\n        .vis-scope-radio {\r\n          margin: 5px;\r\n        }\r\n        .group-input {\r\n          display: block;\r\n          padding-left: 34px;\r\n        }\r\n        .group-select-header{\r\n          margin-bottom:20px;\r\n        }\r\n        \r\n    `]\r\n})\r\nexport class PhenoTrailVisualizationScopeSelectionComponent implements OnInit{\r\n  @Input() selection:StationAwareVisSelection;\r\n  @Input() phenoTrail:PhenologyTrail;\r\n  visScope: string = 'allGroups';\r\n  networkFetch: boolean = false;\r\n  stations: Station[];\r\n  networks:Promise<NetworkWrapper[]>;\r\n  constructor(private networkService: NetworkService) { }\r\n\r\n  ngOnInit(){\r\n    this.networkFetch = true;\r\n    this.networks = this.networkService.getNetworks(this.phenoTrail.network_ids)\r\n    .then((networks:Network[]) => {\r\n      const wrappers = networks.map(n => new NetworkWrapper(this.selection,n,this.networkService));\r\n      this.networkFetch = false;\r\n      return wrappers;\r\n    });\r\n\r\n    const {selection} = this;\r\n    if(selection.groups && selection.groups.length){\r\n      const g0 = this.selection.groups[0];\r\n      if(g0.mode === SelectionGroupMode.NETWORK){\r\n        this.visScope = \"compareGroups\";\r\n      }\r\n      else if (g0.mode === SelectionGroupMode.STATION){\r\n        this.visScope = \"compareSites\";\r\n      }\r\n    } else if(selection.networkIds && selection.networkIds.length && selection.networkIds.length != this.phenoTrail.network_ids.length){\r\n      this.visScope = \"selectGroups\";\r\n    }else{\r\n      this.visScope = \"allGroups\";\r\n    }\r\n  }\r\n\r\n  get valid():boolean {\r\n    return this.visScope === 'allGroups' || !!(this.selection.networkIds && this.selection.networkIds.length) \r\n            || !!(this.selection.groups && this.selection.groups.length);\r\n  }\r\n\r\n  scopeChanged(){\r\n    // reset to a clean slate\r\n    this.selection.stationIds = undefined;\r\n    this.selection.groups = undefined;\r\n    this.selection.networkIds = this.phenoTrail.network_ids.slice();\r\n    switch (this.visScope) {\r\n      case 'allGroups':\r\n        // it's always set and doesn't ever need to change\r\n        break;\r\n      case 'compareGroups':\r\n      case 'selectGroups':\r\n        this.networks.then(networks => {\r\n          networks.forEach(n => n.selected = this.visScope === 'selectGroups');\r\n        });\r\n        break;\r\n      case 'compareSites':\r\n          this.networks.then(networks => {\r\n            networks.forEach(n => {\r\n              n.selected = this.visScope === 'selectGroups';\r\n              n.getStationsWithGroup();\r\n            });\r\n          });\r\n          break;\r\n    }\r\n  }\r\n\r\n  selectGroupChange(){\r\n    this.networks.then(networks => {\r\n      this.selection.networkIds = networks.filter(n => n.selected).map(n => n.network.network_id);\r\n    });\r\n  }\r\n}","import { Input, Component } from '@angular/core';\r\nimport { StationAwareVisSelection } from '@npn/common/visualizations/vis-selection';\r\nimport { NetworkWrapper } from './pheno-trail-visualization-scope-selection.component';\r\n\r\n@Component({\r\n    selector: 'pheno-trail-visualization-scope-station-groups',\r\n    template: `\r\n    <h3>Select Sites to Compare</h3>\r\n    <div *ngFor=\"let nw of networkWrappers\">\r\n      {{nw.network.name}}\r\n      <div *ngFor=\"let s of nw.stations | async\" class=\"station-input\">\r\n        <mat-checkbox [(ngModel)]=\"s.selected\" (change)=\"stationChange()\">{{s.station_name}}</mat-checkbox>\r\n      </div>\r\n    </div>\r\n    `,\r\n    styles: [`\r\n      .group-input {\r\n        display:block;\r\n      }\r\n      .station-input {\r\n        display: block;\r\n        padding-left: 34px;\r\n      }\r\n    `]\r\n})\r\nexport class PhenoTrailVisualizationScopeStationGroupsComponent {\r\n  @Input() selection:StationAwareVisSelection;\r\n  @Input() networkWrappers: NetworkWrapper[];\r\n\r\n  /**\r\n   * Toggle whether a station should be excluded for a selected group\r\n   */\r\n  stationChange(){\r\n    this.selection.groups = this.networkWrappers.reduce((groups,wrapper) => {\r\n        wrapper.stations.then(stations => {\r\n          stations.filter(s => s.selected).forEach(s => groups.push(s.group));\r\n        });\r\n        return groups;\r\n    },[]);\r\n  }\r\n}","module.exports = \"agm-map {\\n  height: 500px; }\\n\\n.in-info-window {\\n  width: 60px;\\n  height: 60px;\\n  padding: 20px; }\\n\\n.info-window-card {\\n  max-width: 400px; }\\n\\n.info-window-card h3 {\\n    font-weight: 400;\\n    font-size: 2em;\\n    text-align: center;\\n    margin-bottom: 0;\\n    line-height: 1em; }\\n\\n.info-window-card h4 {\\n    text-align: center;\\n    font-size: 1.4em;\\n    margin-top: 0;\\n    margin-bottom: 12px;\\n    line-height: 1.5em;\\n    font-weight: 200; }\\n\\n.info-window-card ul {\\n    margin-top: 0;\\n    margin-bottom: 6px;\\n    display: flex;\\n    justify-content: space-between; }\\n\\n.info-window-card ul li {\\n      width: 170px;\\n      margin: 10px auto;\\n      list-style: none;\\n      text-align: center; }\\n\\n.info-window-card ul li h3 {\\n        line-height: 1em; }\\n\\n.map-legend {\\n  padding: 20px; }\\n\\n.map-legend h3 {\\n    font-size: 2em;\\n    line-height: 1em;\\n    margin-bottom: 20px; }\\n\\n.map-legend ul li {\\n    margin-bottom: 0;\\n    line-height: .5em;\\n    list-style: none; }\\n\\n.map-legend ul li div.legend-box {\\n      width: 14px;\\n      height: 14px;\\n      display: inline-block;\\n      margin-right: 10px; }\\n\"","import { Component, OnInit, Input, ViewChild, HostListener } from '@angular/core';\r\nimport { PhenologyTrail } from './entity.service';\r\nimport { Network, Station, NetworkService, StationService, getStaticColor, MAP_STYLES } from '@npn/common';\r\nimport { MapsAPILoader, AgmMap } from '@agm/core';\r\nimport * as d3 from 'd3';\r\n\r\n@Component({\r\n  selector: 'phenology-trail-partners',\r\n  template: `\r\n  <agm-map #AgmMap [streetViewControl]=\"false\" [scrollwheel]=\"false\" [styles]=\"mapStyles\">\r\n    <agm-marker\r\n        *ngFor=\"let station of stations | async; let i = index\"\r\n        [latitude]=\"station.latitude\"\r\n        [longitude]=\"station.longitude\"\r\n        [iconUrl]=\"station.icon\"\r\n        (markerClick)=\"selectMarker(station)\"\r\n    ></agm-marker>\r\n    <agm-info-window [isOpen]=\"!!selectedStation\" (infoWindowClose)=\"selectedStation = stationInfo = null\"\r\n    [latitude]=\"selectedStation?.latitude\" [longitude]=\"selectedStation?.longitude\">\r\n        <npn-logo class=\"in-info-window\" spin=\"true\" *ngIf=\"!stationInfo\"></npn-logo>\r\n        <div class=\"info-window-card\" *ngIf=\"stationInfo\">\r\n            <h3>{{stationInfo.site_name}}</h3>\r\n            <h4>{{stationInfo.group_name}}</h4>\r\n            <ul>\r\n                <li><h3>{{stationInfo.num_individuals}}</h3> {{stationInfo.num_individuals | i18nPlural: itemPluralMapping['individual'] }}</li>\r\n                <li><h3>{{stationInfo.num_records}}</h3> {{stationInfo.num_records | i18nPlural: itemPluralMapping['record']}}</li>\r\n            </ul>\r\n        </div>\r\n    </agm-info-window>\r\n    \r\n  </agm-map>\r\n  <div class=\"map-legend\">\r\n    <h3>Legend</h3>\r\n    <ul>\r\n        <ng-container *ngFor=\"let network of networks | async; let i = index\">\r\n            <li *ngIf=\"!!network\"><div class=\"legend-box\" [style.background-color]=\"network.colors?.color\"></div> {{network.name}}</li>\r\n        </ng-container>\r\n    </ul>\r\n  </div>\r\n  `,\r\n  styleUrls: ['./phenology-trail-partners.component.scss']\r\n})\r\nexport class PhenologyTrailPartnersComponent implements OnInit {\r\n    @ViewChild('AgmMap') agmMap: AgmMap;\r\n    @Input() entity:PhenologyTrail;\r\n    networks:Promise<Network[]>;\r\n    stations:Promise<Station[]>;\r\n    selectedStation:Station;\r\n    stationInfo:Station;\r\n\r\n    bounds:google.maps.LatLngBounds;\r\n    map: google.maps.Map;\r\n    itemPluralMapping = {\r\n        'record': {\r\n          '=0' : 'Records',\r\n          '=1' : 'Record',\r\n          'other' : 'Records'\r\n        }, \r\n        'individual': {\r\n          '=0' : 'Individuals',\r\n          '=1' : 'Individual',\r\n          'other' : 'Individuals'\r\n        }\r\n      };\r\n    mapStyles: any[] = MAP_STYLES;\r\n\r\n    constructor(\r\n        private networkService:NetworkService,\r\n        private stationService:StationService,\r\n        private mapsAPILoader:MapsAPILoader\r\n        )  { }\r\n\r\n    ngOnInit() {\r\n        // map of network_id to a color\r\n        const colorMap:any = this.entity.network_ids.reduce((map,id,i) => {\r\n            const color = getStaticColor(i);\r\n            const outline = d3.color(color).darker().toString();\r\n            map[`${id}`] = {color,outline};\r\n            return map;\r\n        },{});\r\n\r\n        const mapColors = list => list.map(o => {\r\n            o.colors = colorMap[`${o.network_id}`];\r\n            return o;\r\n        });\r\n\r\n        this.networks = this.networkService.getNetworks(this.entity.network_ids).then(mapColors);\r\n        this.stations = this.networkService.getStations(this.entity.network_ids).then(mapColors).then(stations => {\r\n            return this.mapsAPILoader.load().then( () => {\r\n                stations.forEach(station => {\r\n                    station.icon = this.newGoogleMapsSymbol(station);\r\n                });\r\n                return stations;\r\n            });\r\n            \r\n        });\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        //cycle through the map elements and get the center position of the map\r\n        this.agmMap.mapReady.subscribe(map => {\r\n          this.map = map;\r\n          this.stations.then(stations => {\r\n            const bounds = new google.maps.LatLngBounds();\r\n            for (const mm of stations) {\r\n                bounds.extend(new google.maps.LatLng(mm.latitude, mm.longitude));\r\n            }\r\n            this.bounds = bounds;\r\n            this.resize();\r\n          });\r\n        });\r\n      }\r\n\r\n    @HostListener('window:resize')\r\n    resize(){\r\n        if(this.map && this.bounds){\r\n            this.map.fitBounds(this.bounds);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the station information for display in the agm-info-window\r\n     * @param selectedStation - The station that is selected. Needs latitude, longitude, and station_id\r\n     */\r\n    selectMarker(selectedStation:Station) {\r\n        this.selectedStation = selectedStation;\r\n        this.stationService.getStation(selectedStation.station_id).then(station => this.stationInfo = station);\r\n    }\r\n\r\n    newGoogleMapsSymbol(station:Station):google.maps.Symbol {\r\n        return {\r\n            path: google.maps.SymbolPath.CIRCLE,\r\n            scale: 7,\r\n            fillOpacity: 1,\r\n            fillColor: station.colors.color,\r\n            strokeColor: station.colors.outline,\r\n            strokeWeight:1\r\n        };\r\n    }\r\n}","import { Component, Input } from '@angular/core';\r\nimport { Refuge } from './entity.service';\r\nimport { NetworkService, StationAwareVisSelection, Station } from '@npn/common';\r\nimport { SelectionGroupMode } from '@npn/common/visualizations/vis-selection';\r\nimport { timeHours } from 'd3';\r\n\r\n/** \r\n    Radius Dropdown Options for \"Compare refuge data to sites within a radius\".\r\n    text is what you want the user to see and value is the real value in the form.\r\n*/\r\nconst RADIUS_OPTIONS = [{value:10,text:\"10\"},{value:25,text:\"25\"},{value:50,text:\"50\"}];\r\nconst RADIUS_DEFAULT = 0; //The index of the default radius selected when page first loads\r\n\r\n@Component({\r\n    selector: 'refuge-visualization-scope-selection',\r\n    template: `\r\n    <mat-radio-group name=\"visScope\" class=\"vis-scope-input\" [(ngModel)]=\"visScope\" (change)=\"scopeChanged()\">\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'refuge'\">Show data for all sites at \"{{refuge.title}}\"</mat-radio-button>\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'station'\">Show data for select sites at \"{{refuge.title}}\"</mat-radio-button>\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'stationGroup'\">Compare data for select sites at \"{{refuge.title}}\"</mat-radio-button>\r\n      <mat-radio-button class=\"vis-scope-radio\" [value]=\"'outsideGroup'\">Compare refuge data to sites within a radius</mat-radio-button>\r\n    </mat-radio-group>\r\n    <hr *ngIf=\"visScope !== 'refuge'\" />\r\n    <mat-form-field *ngIf=\"visScope === 'outsideGroup'\" class=\"radius-form-field\">\r\n        <mat-label>Radius (in miles)</mat-label>\r\n        <mat-select class=\"vis-scope-input\" class=\"radius-input\" [(ngModel)]=\"radius\" (selectionChange)=\"outsideGroupChange()\">\r\n            <mat-option *ngFor=\"let opt of radiusDropdownOptions\" [value]=\"opt.value\">{{opt.text}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>   \r\n    <mat-progress-spinner *ngIf=\"stationFetch\" mode=\"indeterminate\"></mat-progress-spinner>\r\n    <div *ngIf=\"(visScope === 'station' || visScope === 'stationGroup' || visScope === 'outsideGroup')\">\r\n    <h3 *ngIf=\"(visScope === 'outsideGroup')\">Select Sites to Exclude</h3>\r\n        <mat-checkbox *ngFor=\"let s of stations\" class=\"station-input\" [(ngModel)]=\"s.selected\" (change)=\"stationChange()\"\r\n            [disabled]=\"visScope === 'station' && s.selected && selection.stationIds?.length === 1\">{{s.station_name}}</mat-checkbox>\r\n    </div>\r\n    <!--<pre *ngIf=\"selection\">{{selection.external | json}}</pre>-->\r\n    `,\r\n    styles: [`\r\n        .vis-scope-input {\r\n          display: inline-flex;\r\n          flex-direction: column;\r\n        }\r\n        .vis-scope-radio {\r\n          margin: 5px;\r\n        }\r\n        .station-input {\r\n            display: block;\r\n            padding-left: 34px;\r\n        },\r\n        .radius-form-field {\r\n            margin:20px 0 20px 0;\r\n        }\r\n        .radius-input {\r\n            width:200px;\r\n        }\r\n    `]\r\n})\r\nexport class RefugeVisualizationScopeSelectionComponent {\r\n    @Input()\r\n    selection: StationAwareVisSelection;\r\n    @Input()\r\n    refuge: Refuge;\r\n    radiusDropdownOptions = RADIUS_OPTIONS; \r\n    radius = RADIUS_OPTIONS[RADIUS_DEFAULT].value;\r\n    visScope: string = 'refuge';\r\n    stationFetch: boolean = false;\r\n    private _stations:Promise<Station []>;\r\n    stations: Station[];\r\n    constructor(private networkService: NetworkService) { }\r\n\r\n    ngOnInit() {\r\n        const {selection} = this;\r\n        if(selection.groups && selection.groups.length) {\r\n            // this control is simplistic when it comes to groups, there are only two use cases\r\n            this.visScope = selection.groups[0].mode === SelectionGroupMode.STATION\r\n                ? 'stationGroup'\r\n                : 'outsideGroup';\r\n        } else if (selection.stationIds && selection.stationIds.length) {\r\n            this.visScope = 'station';\r\n        } else {\r\n            this.visScope = 'refuge';\r\n        }\r\n        if(this.visScope !== 'refuge') {\r\n            this.loadStations().then((stations:Station[]) => stations.forEach(s => {\r\n                if(this.visScope === 'station') {\r\n                    s.selected = selection.stationIds.indexOf(s.station_id) !== -1;\r\n                } else if(this.visScope === 'outsideGroup'){\r\n                    s.selected = selection.groups[0].excludeIds.indexOf(s.station_id) !== -1;\r\n                } else {\r\n                    s.selected = !!selection.groups.reduce((found,g) => (found||(g.id === s.station_id ? s : undefined)),undefined);\r\n                }\r\n            }));\r\n            if(this.visScope === 'outsideGroup'){\r\n                this.radius = this.selection.groups[1].outsideRadiusMiles \r\n                          ? this.selection.groups[1].outsideRadiusMiles \r\n                          : RADIUS_OPTIONS[RADIUS_DEFAULT].value;\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadStations() {\r\n        \r\n        if (!this._stations) {\r\n            this.stationFetch = true;\r\n            this._stations = this.networkService.getStations(this.refuge.network_id)\r\n                .then(stations => {\r\n                    this.stations = stations;\r\n                    this.stationFetch = false;\r\n                    return stations;\r\n                });\r\n        }\r\n        return this._stations;\r\n        \r\n    }\r\n\r\n    scopeChanged() {\r\n        // reset to a clean slate\r\n        this.selection.stationIds = undefined;\r\n        this.selection.groups = undefined;\r\n        switch (this.visScope) {\r\n            case 'refuge':\r\n                // it's always set and doesn't ever need to change\r\n                // this.selection.networkIds = [this.refuge.network_id];\r\n                break;\r\n            case 'station':\r\n            case 'stationGroup':\r\n            case 'outsideGroup':\r\n                this.loadStations().then((stations:Station[]) => {\r\n                    // all selected for station mode and all de-selected for stationGroup mode\r\n                    stations.forEach(s => s.selected = this.visScope === 'station');\r\n                    if(this.visScope === 'outsideGroup') {\r\n                        this.outsideGroupChange();\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n    }\r\n\r\n    outsideGroupChange(){\r\n        let exludeIds = this.stations.filter(s => s.selected).map(s => s.station_id);\r\n\r\n        this.selection.groups = [{\r\n            label: this.refuge.title,\r\n            mode: SelectionGroupMode.NETWORK,\r\n            id: this.refuge.network_id,\r\n            excludeIds: exludeIds\r\n          },{\r\n            label: `Sites within ${this.radius} miles`,\r\n            mode: SelectionGroupMode.OUTSIDE,\r\n            id: this.refuge.network_id,\r\n            outsideRadiusMiles: this.radius\r\n          }]; \r\n    }\r\n\r\n    stationChange() {\r\n        switch(this.visScope) {\r\n            case 'station':\r\n                this.selection.stationIds = this.stations.filter(s => s.selected).map(s => s.station_id);\r\n                break;\r\n            case 'stationGroup':\r\n                const mode:SelectionGroupMode = SelectionGroupMode.STATION;\r\n                this.selection.groups = this.stations\r\n                    .filter(s => s.selected)\r\n                    .map(s => {\r\n                        const label = s.station_name;\r\n                        const id = s.station_id;\r\n                        return {mode,id,label};\r\n                    });\r\n                break;\r\n            case 'outsideGroup':\r\n                this.outsideGroupChange();\r\n                break;\r\n        }\r\n    }\r\n\r\n    get valid():boolean {\r\n        return this.visScope !== 'stationGroup' || !!(this.selection.groups && this.selection.groups.length);\r\n    }\r\n}\r\n","import {Component,Input} from '@angular/core';\r\nimport {EntityBase} from './entity.service';\r\n\r\n@Component({\r\n    selector: 'fws-dashboard-resources',\r\n    template: `\r\n    <div [innerHtml]=\"entity && entity.resources ? entity.resources : ''\"></div>\r\n    <a mat-raised-button *ngIf=\"!userIsLoggedIn\" [href]=\"'//www.usanpn.org/user/register?default_group_id='+entity.network_id\">Register</a>\r\n    <a mat-raised-button *ngIf=\"!userIsLoggedIn\" href=\"/user/login\">Login</a>\r\n    <a mat-raised-button *ngIf=\"userIsLoggedIn\" href=\"//mynpn.usanpn.org/npnapps/\" target=\"_blank\">My Observation Deck</a>\r\n    `,\r\n    styles:[`\r\n        a[mat-raised-button] {\r\n            margin-right: 5px;\r\n        }\r\n    `]\r\n})\r\nexport class ResourcesComponent {\r\n    @Input()\r\n    entity:EntityBase;\r\n    @Input()\r\n    userIsLoggedIn:boolean = false;\r\n}\r\n","// This file can be replaced during build by using the `fileReplacements` array.\r\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\r\n// The list of file replacements can be found in `angular.json`.\r\n\r\nexport const environment = {\r\n  production: false,\r\n  googleMapsApiKey: 'AIzaSyAsTM8XaktfkwpjEeDMXkNrojaiB2W5WyE',\r\n};\r\n\r\n/*\r\n * For easier debugging in development mode, you can import the following file\r\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\r\n *\r\n * This import should be commented out in production mode because it will have a negative impact\r\n * on performance if an error is thrown.\r\n */\r\n// import 'zone.js/dist/zone-error';  // Included with Angular CLI.\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nimport 'hammerjs';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule);\r\n"],"sourceRoot":""}